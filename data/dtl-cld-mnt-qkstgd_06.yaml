- en: '*Chapter 5*: Metrics, Events, and Tags'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '*第五章*：指标、事件和标签'
- en: In the first part of the book, we discussed general monitoring concepts and
    how to get started with Datadog, including installing the Agent and navigating
    the main menu options on the Datadog UI, the main interface available to the end
    users. In the first chapter, we also discussed metrics as a central concept in
    all modern monitoring applications, being used to measure the health and the state
    of software systems. Also, we looked at tags as a means to group and filter metrics
    data and other information such as events generated by the monitoring systems,
    especially Datadog.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在本书的第一部分，我们讨论了一般的监控概念以及如何开始使用Datadog，包括安装Agent和浏览Datadog UI的主菜单选项，Datadog UI是终端用户可用的主要界面。在第一章中，我们还讨论了作为所有现代监控应用程序中的核心概念的指标，指标用于衡量软件系统的健康状况和状态。此外，我们还讨论了标签作为一种分组和过滤指标数据及其他监控信息（如Datadog生成的事件）的手段。
- en: In this chapter, we will explore in detail how metrics and tags, two important
    constructs that Datadog heavily depends on, are implemented. Metrics are the basic
    entities that are used for reporting monitoring information in Datadog. Datadog
    also uses tags to organize metrics and other types of monitoring information such
    as events and alerts. It is important to discuss metrics and tags together as
    appropriate tagging of metrics is very important to make sense out of the large
    volume of metrics time series data that will be available in a typical Datadog
    account.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将详细探讨Datadog heavily依赖的两个重要构件——指标和标签的实现方式。指标是用于报告Datadog中监控信息的基本实体。Datadog还使用标签来组织指标和其他类型的监控信息，如事件和警报。讨论指标和标签是非常重要的，因为对指标进行适当的标签化对于从典型Datadog账户中可用的大量指标时间序列数据中提取有意义的信息至关重要。
- en: While metrics, a central concept in any monitoring system, help to measure the
    health of a system continuously, an event captures an incident that occurs in
    a system. The crashing of a process, the restarting of a service, and the reallocation
    of a container are examples of system events. A metric is measured at a specific
    time interval and there is a numeric value associated with it, but an event is
    not periodic in nature and provides only a status. Tagging can be used to organize,
    group, and search just for events that are used with metrics.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然指标是任何监控系统中的核心概念，帮助持续衡量系统的健康状况，但事件捕获的是系统中发生的某个事件。进程崩溃、服务重启和容器重新分配都是系统事件的例子。指标是在特定时间间隔内进行测量的，并且与其相关联的是一个数值，而事件本质上不是周期性的，仅提供状态信息。标签可以用于组织、分组和仅搜索与指标一起使用的事件。
- en: 'In this chapter, we will discuss metrics, events, and tags in detail. Specifically,
    we will cover these topics:'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将详细讨论指标、事件和标签。具体来说，我们将涵盖以下主题：
- en: Understanding metrics in Datadog
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 理解Datadog中的指标
- en: Tagging Datadog resources
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 标记Datadog资源
- en: Defining custom metrics
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 定义自定义指标
- en: Monitoring event streams
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 监控事件流
- en: Searching events
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 搜索事件
- en: Event notifications
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 事件通知
- en: Generating events
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 生成事件
- en: Best practices
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 最佳实践
- en: Technical requirements
  id: totrans-13
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: 'To try out the examples mentioned in this book, you need to have the following
    tools and resources:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 要尝试本书中提到的示例，您需要具备以下工具和资源：
- en: '- A Datadog account and a user with admin-level access.'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: '- 一个Datadog账户和具有管理员级别权限的用户。'
- en: '- A Datadog Agent running at host level or as a microservice depending on the
    example, pointing to the Datadog account.'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: '- 一个运行在主机级别或作为微服务的Datadog Agent，具体取决于示例，指向Datadog账户。'
- en: Understanding metrics in Datadog
  id: totrans-17
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 理解Datadog中的指标
- en: The health of a software system and the infrastructure it is running on are
    defined by a set of metrics and their threshold values. For example, on the infrastructure
    side, if the CPU usage on a machine is under *70%*, it might be considered healthy
    for a specific use case. When all such metrics that are used for monitoring an
    environment report values in the normal range, the entire environment can be considered
    healthy. By setting relevant thresholds for these metrics on monitors, issues
    can be reported as alerts. Datadog provides features to define metrics-based monitors
    and alerts.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 软件系统及其运行的基础设施的健康状况由一组指标及其阈值定义。例如，在基础设施层面，如果机器上的CPU使用率低于*70%*，则对于特定用例可能被视为健康。当所有用于监控环境的指标报告的值都在正常范围内时，整个环境可以被视为健康。通过在监控中为这些指标设置相关的阈值，可以将问题报告为警报。Datadog提供了定义基于指标的监控和警报的功能。
- en: 'We saw in [*Chapter 2*](B16483_02_Final_VK_ePub.xhtml#_idTextAnchor115), *Deploying
    Datadog Agent*, and [*Chapter 3*](B16483_03_Final_VK_ePub.xhtml#_idTextAnchor139),
    *Datadog Dashboard*, that published metrics can be viewed and filtered using tags
    in **Metrics Explorer** in the Datadog UI, as in the following example:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在[*第2章*](B16483_02_Final_VK_ePub.xhtml#_idTextAnchor115)《*部署Datadog Agent*》和[*第3章*](B16483_03_Final_VK_ePub.xhtml#_idTextAnchor139)《*Datadog
    Dashboard*》中看到，已发布的指标可以在 Datadog UI 的**指标浏览器**中使用标签进行查看和过滤，如以下示例所示：
- en: Navigate to **Metrics** | **Metrics Explorer** to bring up the **Metrics Explorer**
    window:![Figure 5.1 – Metrics Explorer
  id: totrans-20
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到**指标** | **指标浏览器**以打开**指标浏览器**窗口：![图 5.1 – 指标浏览器
- en: '](img/Figure_5.1_B16483.jpg)'
  id: totrans-21
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/Figure_5.1_B16483.jpg)'
- en: Figure 5.1 – Metrics Explorer
  id: totrans-22
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 5.1 – 指标浏览器
- en: In the `docker.cpu.usage`.
  id: totrans-23
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`docker.cpu.usage`中。
- en: In the `docker.cpu.usage` makes the most sense for a specific container running
    on a host, unless you are interested in monitoring the average or total CPU usage
    by containers on one or more machines.
  id: totrans-24
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`docker.cpu.usage`中，对于运行在主机上的特定容器来说意义最大，除非你有兴趣监控一台或多台机器上容器的平均或总 CPU 使用率。
- en: By specifying the tags host and `container_name`, you can narrow down the scope
    to a specific container easily. You can also see that a time series graph is rendered
    on the right side of the window based on the metrics and filter conditions you
    selected on the left pane.
  id: totrans-25
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过指定标签主机和`container_name`，你可以轻松地将范围缩小到特定的容器。你还可以看到，基于你在左侧窗格中选择的指标和过滤条件，右侧窗口呈现了一个时间序列图。
- en: The preceding example demonstrates how metrics and tags work in tandem to draw
    insights from a vast cache of time series metrics data published to Datadog. The
    metrics as implemented in Datadog are far more elaborate than the basic concepts
    we discussed in [*Chapter 1*](B16483_01_Final_VK_ePub.xhtml#_idTextAnchor014),
    *Introduction to Monitoring*; let's look at some of the concepts related to metrics
    as they are defined in Datadog.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 上述示例演示了指标和标签如何协同工作，从Datadog发布的大量时间序列指标数据中提取洞察。Datadog 实现的指标远比我们在[*第1章*](B16483_01_Final_VK_ePub.xhtml#_idTextAnchor014)《*监控简介*》中讨论的基本概念要复杂得多；让我们来看看在
    Datadog 中定义的与指标相关的一些概念。
- en: Metric data
  id: totrans-27
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 指标数据
- en: A metric data value is a measure of a metric at a point in time. For example,
    the `system.memory.free` metric tracks the free memory available on a host. Datadog
    measures that metric and reports the value periodically, and that value is the
    metric data value. A series of such measurements will generate a time series data
    stream, as seen plotted in the example in *Figure 5.1*.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 指标数据值是某一时刻的指标度量。例如，`system.memory.free` 指标跟踪主机上可用的空闲内存。Datadog 测量该指标并定期报告该值，这个值即为指标数据值。这样的一系列测量将生成一个时间序列数据流，如*图
    5.1*所示。
- en: Flush time interval
  id: totrans-29
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 刷新时间间隔
- en: The Datadog processes values received for a metric during this time window and
    processes them based on the metric type.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: Datadog 在此时间窗口内处理接收到的指标值，并根据指标类型进行处理。
- en: Metric type
  id: totrans-31
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 指标类型
- en: 'The main metric types are count, rate, and gauge, and they differ in terms
    of how metric data points are processed to publish as metric values:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 主要的指标类型是计数、速率和仪表，它们在如何处理指标数据点以发布为指标值方面有所不同：
- en: '**Count**: The metric data received during the flush time interval is added
    up to be returned as a metric value.'
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**计数**：在刷新时间间隔内接收到的指标数据相加，作为指标值返回。'
- en: '**Rate**: The total of metric data received during the flush time interval
    is divided by the number of seconds in the interval to be returned as a metric
    value.'
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**速率**：在刷新时间间隔内接收到的指标数据总和除以该间隔中的秒数，作为指标值返回。'
- en: '**Gauge**: The latest value received during the flush time interval is returned
    as the metric value.'
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**仪表**：在刷新时间间隔内接收到的最新值作为指标值返回。'
- en: Metric unit
  id: totrans-36
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 指标单位
- en: A metric type is a group of similar measurement units. For example, the bytes
    group is a type of storage and memory measurement and it consists of units such
    as bit, byte, kibibyte, mebibyte, gibibyte, and so on. The time group consists
    of units from a nanosecond to a week. A full list of metric units is available
    in the Datadog documentation ([https://docs.datadoghq.com/developers/metrics/units/](https://docs.datadoghq.com/developers/metrics/units/))
    for reference.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 指标类型是一组相似的度量单位。例如，字节组是一种存储和内存度量类型，包含位、字节、千字节、兆字节、吉比特等单位。时间组包含从纳秒到一周的单位。有关指标单位的完整列表，请参阅
    Datadog 文档 ([https://docs.datadoghq.com/developers/metrics/units/](https://docs.datadoghq.com/developers/metrics/units/))。
- en: Query
  id: totrans-38
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 查询
- en: A query returns values from a time series metric dataset, for the given filter
    conditions and a time window. For example, the time series data related to the
    `system.memory.free` metric will be reported for all the machines where the Datadog
    Agent runs.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 一个查询返回来自时间序列指标数据集的值，基于给定的筛选条件和时间窗口。例如，`system.memory.free` 指标的时间序列数据将会报告给所有运行
    Datadog Agent 的机器。
- en: If you want to monitor the metric only for a specific host during the last one
    hour, the Datadog-defined `host` tag can be used to narrow down the machine to
    a specific host, and you can also specify a time range. The ways to specify the
    query parameters would depend on the interface that you would use to run the query.
    For example, you have seen how a query works in the **Metrics Explorer** window
    on the Datadog dashboard where those parameters are specified visually.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你只想在过去一小时内监控特定主机的指标，可以使用 Datadog 定义的 `host` 标签来缩小范围，指定一个特定的主机，同时你还可以指定时间范围。指定查询参数的方式取决于你使用的界面。例如，你已经看到如何在
    Datadog 仪表盘上的 **Metrics Explorer** 窗口中运行查询，在那里这些参数是通过可视化方式指定的。
- en: 'Datadog identifies the following parts in a query:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: Datadog 在查询中识别以下部分：
- en: '`host` tag set the scope to a single host.'
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`host` 标签将范围设置为单一主机。'
- en: '`system.disk.free` would have more than one time series dataset for the same
    host, as one would be generated for each disk, and typically there would be multiple
    disks on a host. Assume that you are interested in monitoring the total disk space
    available on all the web hosts. If those hosts are tagged as web hosts using a
    custom tag such as `host_type` having the value `web`, then it could be used to
    set the scope and the `host` tag could be used for grouping.'
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`system.disk.free` 会为同一主机生成多个时间序列数据集，因为每个磁盘会生成一个数据集，并且通常一台主机会有多个磁盘。假设你有兴趣监控所有
    Web 主机的总磁盘空间。如果这些主机使用自定义标签（如 `host_type`，值为 `web`）被标记为 Web 主机，则可以用它来设置范围，`host`
    标签则可用于分组。'
- en: '`system.cpu.*`, `system.load.*`, and `system.mem.*`'
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`system.cpu.*`、`system.load.*` 和 `system.mem.*`'
- en: B. `system.disk.*`
  id: totrans-45
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: B. `system.disk.*`
- en: C. `system.disk.directory.*` pattern
  id: totrans-46
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: C. `system.disk.directory.*` 模式
- en: D. `system.processes.*` pattern
  id: totrans-47
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: D. `system.processes.*` 模式
- en: 'The **integration** pages on the Datadog UI provide a complete list of metrics
    available through these integrations. The metadata associated with a metric can
    be viewed and some of the settings can be edited in the **Metrics Summary** window:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: Datadog UI 上的 **集成** 页面提供了通过这些集成可用的所有指标的完整列表。与指标关联的元数据可以查看，并且一些设置可以在 **Metrics
    Summary** 窗口中编辑：
- en: 'Navigate to **Metrics** | **Metrics Summary**, where all the metrics are listed.
    A specific metric can be searched using its name or tags associated with it. Look
    at the following screenshot for the example of searching for Redis metrics:'
  id: totrans-49
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 转到 **Metrics** | **Metrics Summary**，列出了所有指标。可以通过指标名称或与之关联的标签搜索特定的指标。查看以下屏幕截图，了解如何搜索
    Redis 指标：
- en: '![Figure 5.2 – Searching for Redis metrics in the Metrics Summary interface'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 5.2 – 在 Metrics Summary 界面中搜索 Redis 指标'
- en: '](img/Figure_5.2_B16483.jpg)'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_5.2_B16483.jpg)'
- en: Figure 5.2 – Searching for Redis metrics in the Metrics Summary interface
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.2 – 在 Metrics Summary 界面中搜索 Redis 指标
- en: 'The metadata of a specific metric can be viewed by clicking on any metric of
    interest. In the following screenshot, the summary of the `redis.mem.used` metric
    is provided:'
  id: totrans-53
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可以通过点击任何感兴趣的指标来查看该指标的元数据。在以下屏幕截图中，提供了 `redis.mem.used` 指标的汇总：
- en: '![Figure 5.3 – Summary of the redis.mem.used metric'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 5.3 – redis.mem.used 指标汇总'
- en: '](img/Figure_5.3_B16483.jpg)'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_5.3_B16483.jpg)'
- en: Figure 5.3 – Summary of the redis.mem.used metric
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.3 – redis.mem.used 指标汇总
- en: Using the **Edit** button on this window, the description and flush time interval
    of the metric can be changed. It also provides the source hosts and the tags available
    for filtering. In this section, we have seen how the ideas of metrics are implemented
    in Datadog in general and how they can be viewed on the dashboard in different
    ways. In the next section, we will discuss tags, a construct that is used with
    metrics and other resources.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 使用该窗口上的 **Edit** 按钮，可以更改指标的描述和刷新时间间隔。它还提供了源主机和可用于筛选的标签。在这一部分中，我们了解了 Datadog
    中如何实现指标的概念，并且它们如何在仪表盘上以不同方式呈现。在接下来的部分中，我们将讨论标签，这是与指标和其他资源一起使用的构造。
- en: Tagging Datadog resources
  id: totrans-58
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 标签化 Datadog 资源
- en: In the previous sections of this chapter, we have touched upon the concept of
    tags as a means of grouping and filtering metrics. While the use of tags is similar
    to that of keywords, labels, or hashtags on other systems, it is important to
    learn how tags are applied to metrics. Tags can be applied to other Datadog resources
    such as events and monitors as well. However, we will focus on how they are applied
    and used while working with metrics in the following section.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章的前几节中，我们已经提到过标签作为分组和过滤指标的手段。虽然标签的使用与其他系统中的关键字、标签或话题标签类似，但了解标签是如何应用到指标中的非常重要。标签也可以应用于其他
    Datadog 资源，例如事件和监控。不过，我们将在接下来的部分集中讨论如何在处理指标时使用标签。
- en: Defining tags
  id: totrans-60
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 定义标签
- en: 'The following are the main rules and best practices for defining a tag:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是定义标签的主要规则和最佳实践：
- en: 'A tag should start with a letter and can contain the following characters:
    alphanumeric, underscores, minuses, colons, periods, and slashes.'
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 标签应以字母开头，且可以包含以下字符：字母数字、下划线、连字符、冒号、句点和斜杠。
- en: A tag should be in lowercase letters. If uppercase letters are used, they will
    be converted into lowercase. The auto-conversion of the case can create confusion,
    and so it is advisable to define tags only in lowercase.
  id: totrans-63
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 标签应该使用小写字母。如果使用大写字母，它们会被自动转换为小写。自动转换大小写可能会造成混淆，因此建议仅使用小写字母定义标签。
- en: A tag can be up to 200 characters long.
  id: totrans-64
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 标签最长可以有 200 个字符。
- en: The common pattern of a tag is in `<KEY>:<VALUE>` format, which prepares a tag
    to be used in different parts of a query as we saw earlier. There are reserved
    keywords for tags, such as `host`, `process`, and `env`, that Datadog associates
    special meanings with, and their use should be in line with the related meanings.
  id: totrans-65
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 标签的常见格式是 `<KEY>:<VALUE>`，这种格式准备好在查询的不同部分中使用，正如我们之前所看到的那样。Datadog 对某些标签保留了特定的关键字，例如
    `host`、`process` 和 `env`，这些标签具有特殊含义，使用时应符合相关含义。
- en: Tagging methods
  id: totrans-66
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 标签化方法
- en: 'Datadog offers multiple ways to tag metrics. However, the following two methods
    are the most common:'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: Datadog 提供了多种标签化指标的方法。然而，以下两种方法是最常见的：
- en: From the Datadog Agent configuration file
  id: totrans-68
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 来自 Datadog Agent 配置文件
- en: From the configuration files of integrations
  id: totrans-69
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从集成的配置文件中
- en: Both of these methods are done at the Datadog Agent level. The tagging can also
    be done from the Datadog UI, using the Datadog API, and as part of DogStatsD integration.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 这两种方法都是在 Datadog Agent 层面执行的。标签也可以通过 Datadog UI、使用 Datadog API 或作为 DogStatsD
    集成的一部分来设置。
- en: 'In the Datadog Agent config file, `datadog.yml`, the config item tags can be
    used to add tags as follows:'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Datadog Agent 配置文件 `datadog.yml` 中，可以使用配置项 `tags` 来添加标签，如下所示：
- en: '[PRE0]'
  id: totrans-72
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Here''s an alternative way:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 这里有一种替代方法：
- en: '[PRE1]'
  id: totrans-74
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: The latter syntax is preferred in configuration files for better readability.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 后者的语法在配置文件中更受推荐，因为它具有更好的可读性。
- en: Customizing host tag
  id: totrans-76
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 自定义主机标签
- en: We have come across the use of the system-defined `host` tag already, which
    is very useful in filtering the metrics data. It is set by default based on the
    host name of the machine where the Datadog Agent runs, but it can be customized
    by setting the `hostname` config item in `datadog.yml`.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经遇到过系统定义的 `host` 标签，它在过滤指标数据时非常有用。它默认基于 Datadog Agent 运行的机器的主机名进行设置，但可以通过在
    `datadog.yml` 中设置 `hostname` 配置项进行自定义。
- en: Tagging integration metrics
  id: totrans-78
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 标签化集成指标
- en: 'An integration generates a published list of metrics and those could be tagged
    by configuring the `tags` config item for the integration:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 集成生成一个已发布的指标列表，并可以通过为集成配置 `tags` 配置项来为这些指标打标签：
- en: '[PRE2]'
  id: totrans-80
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: For example, for the Redis integration, this change is done in `/etc/datadog-agent/conf.d/redisdb.d/config.yaml`.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，对于 Redis 集成，此更改在 `/etc/datadog-agent/conf.d/redisdb.d/config.yaml` 中完成。
- en: In addition to tags applied from the configuration files, some integrations
    also supply tags by inheriting them from the source applications and platforms.
    The best example is the extraction of AWS tags by Datadog integrations for related
    AWS services.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 除了从配置文件应用的标签外，一些集成还通过继承源应用程序和平台的标签来提供标签。最好的例子是 Datadog 集成从相关 AWS 服务中提取 AWS 标签。
- en: Tags from microservices
  id: totrans-83
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 来自微服务的标签
- en: 'If the Datadog Agent is deployed in a containerized environment, tags from
    related applications such as Docker and Kubernetes are collected automatically.
    More tags can be extracted by setting the following environment variables:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 如果 Datadog Agent 部署在容器化环境中，Docker 和 Kubernetes 等相关应用程序的标签会自动收集。可以通过设置以下环境变量提取更多标签：
- en: '`DD_TAGS`: Host-level tags can be set using this environment variable.'
  id: totrans-85
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`DD_TAGS`：可以使用此环境变量设置主机级标签。'
- en: '`DD_DOCKER_LABELS_AS_TAGS`: To publish Docker labels as tags.'
  id: totrans-86
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`DD_DOCKER_LABELS_AS_TAGS`：将Docker标签发布为标签。'
- en: '`DD_DOCKER_ENV_AS_TAGS`: To publish Docker environment variables as tags.'
  id: totrans-87
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`DD_DOCKER_ENV_AS_TAGS`：将Docker环境变量发布为标签。'
- en: '`DD_KUBERNETES_POD_LABELS_AS_TAGS`: To publish pod labels as tags.'
  id: totrans-88
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`DD_KUBERNETES_POD_LABELS_AS_TAGS`：将Pod标签发布为标签。'
- en: Filtering using tags
  id: totrans-89
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用标签进行过滤
- en: In a Datadog account, times series data for one metric can originate from multiple
    sources. For example, there can be multiple time series data streams for the `system.disk.free`
    metric from just one host, as that data series is generated for each disk on a
    host. Therefore, data may have to be grouped in ways that make sense in most situations,
    and we have already seen how tags are used in **Metrics Explorer** and queries
    to filter data and extract logical groups of metrics data.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 在Datadog帐户中，某个度量的时间序列数据可以来自多个来源。例如，对于`system.disk.free`度量，同一主机可能会有多个时间序列数据流，因为该数据系列是为主机上的每个磁盘生成的。因此，数据可能需要以在大多数情况下有意义的方式进行分组，我们已经看到如何在**Metrics
    Explorer**和查询中使用标签来过滤数据并提取逻辑分组的度量数据。
- en: 'The use of tagging goes beyond just filtering metrics. The tags could also
    be applied to other Datadog resources for filtering and grouping, as is done with
    metrics data. The following are the main Datadog resources that could be tagged:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 标签的使用不仅限于过滤度量。这些标签也可以应用于其他Datadog资源，用于过滤和分组，就像对度量数据的处理一样。以下是可以被标记的主要Datadog资源：
- en: Events
  id: totrans-92
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 事件
- en: Dashboards
  id: totrans-93
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 仪表盘
- en: 'Infrastructure: mainly hosts, containers and processes'
  id: totrans-94
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 基础设施：主要是主机、容器和进程
- en: Monitors
  id: totrans-95
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 监控
- en: The use of tags in Datadog is widespread, and the preceding list covers only
    the important resources. When the count of a specific resource type such as events
    is very large, it's impossible to trace a specific instance without the help of
    a tag. For example, the events associated with a specific type of host could be
    pulled by tagging those events suitably.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 在Datadog中，标签的使用非常广泛，前面的列表仅涵盖了重要的资源。当某个特定资源类型（例如事件）的数量非常大时，没有标签的帮助，几乎无法追踪到特定实例。例如，关联到某种特定主机类型的事件可以通过适当地标记这些事件来提取。
- en: Wherever there is a need to look for a subset of information, tags are used
    as the keywords to search for related resources and metrics data. That means the
    monitoring data that has been published to Datadog must be tagged well so that
    subsets of that data can be extracted easily.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 无论何时需要查找某些信息的子集时，标签都用作搜索相关资源和度量数据的关键字。这意味着已发布到Datadog的监控数据必须做好标签，以便能够轻松提取该数据的子集。
- en: Datadog and the various third-party product integrations it provides generate
    the bulk of the metrics that we use in real life. In the next section, we will
    discuss custom metrics and how they can be published to Datadog.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: Datadog及其提供的各种第三方产品集成生成了我们在实际工作中使用的大部分度量。在接下来的部分中，我们将讨论自定义度量及其如何发布到Datadog。
- en: Defining custom metrics
  id: totrans-99
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 定义自定义度量
- en: 'You have already seen that metrics are defined, and the related times series
    data is generated, by these methods:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 你已经看到，通过这些方法可以定义度量，并生成相关的时间序列数据：
- en: By enabling core infrastructure integrations with the installation of the Datadog
    Agent
  id: totrans-101
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过启用核心基础设施集成，安装Datadog代理
- en: By enabling platform and application integrations provided by Datadog
  id: totrans-102
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过启用Datadog提供的平台和应用集成
- en: Custom tags can be associated with the preceding set of metrics by defining
    them in the relevant configuration files. Some integrations also offer to inherit
    tags from source applications and platforms.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 可以通过在相关配置文件中定义自定义标签，将其与前述的度量集合关联起来。某些集成还提供从源应用程序和平台继承标签的功能。
- en: In addition to this group of metrics that are available out of the box or that
    can be enabled easily, there are multiple options available in Datadog to define
    custom metrics and tags. This is one of the features that makes Datadog a powerful
    monitoring platform that can be fine-tuned for your specific requirements.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 除了开箱即用或可以轻松启用的这组度量，Datadog还提供了多种选项来定义自定义度量和标签。这是Datadog成为一个强大的监控平台的原因之一，它可以根据你的具体需求进行微调。
- en: 'The following properties need to be set for a custom metric:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 自定义度量需要设置以下属性：
- en: '**Name**: A name should not be more than 200 characters long, should begin
    with a letter, and should contain only alphanumeric characters, underscores, and
    periods. Unlike tags, metric names are case-sensitive.'
  id: totrans-106
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**名称**：名称不得超过 200 个字符，应以字母开头，并且只能包含字母、数字、下划线和句点。与标签不同，指标名称是区分大小写的。'
- en: '**Value and timestamp**: The metric value is published with a timestamp.'
  id: totrans-107
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**值和时间戳**：指标值将与时间戳一起发布。'
- en: '**Metric type**: As discussed earlier, the main types are count, rate, and
    gauge.'
  id: totrans-108
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**指标类型**：如前所述，主要的指标类型有计数、速率和仪表。'
- en: '**Interval**: This sets the flush time interval for the metric.'
  id: totrans-109
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**间隔**：这设置了指标的刷新时间间隔。'
- en: '**Tags**: The tags specifically set for this metric.'
  id: totrans-110
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**标签**：专门为此指标设置的标签。'
- en: 'There are multiple ways to submit custom metrics:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 提交自定义指标有多种方式：
- en: '**Datadog Agent checks**: The Datadog Agent can be configured to run custom
    scripts as checks, and that interface can be leveraged to publish custom metrics.
    We will learn more about implementing custom checks in [*Chapter 8*](B16483_08_Final_VK_ePub.xhtml#_idTextAnchor248),
    *Integrating with Platform Components*.'
  id: totrans-112
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Datadog Agent 检查**：Datadog Agent 可以配置为运行自定义脚本作为检查，并且可以利用该接口发布自定义指标。我们将在[*第
    8 章*](B16483_08_Final_VK_ePub.xhtml#_idTextAnchor248)中进一步了解如何实现自定义检查，*与平台组件集成*。'
- en: '**Datadog REST API**: Datadog resources can be viewed, created, and managed
    using the REST API Datadog provides. The custom metrics and tags can be handled
    that way as well. This is mainly useful when Datadog is not running close to a
    software system that needs to be monitored using Datadog. We will learn how to
    use the Datadog REST API in [*Chapter 9*](B16483_09_Final_VK_ePub.xhtml#_idTextAnchor261),
    *Using the Datadog REST API*.'
  id: totrans-113
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Datadog REST API**：可以使用 Datadog 提供的 REST API 查看、创建和管理 Datadog 资源。自定义指标和标签也可以通过这种方式进行处理。当
    Datadog 不与需要监控的软硬件系统紧密集成时，这种方式特别有用。我们将在[*第 9 章*](B16483_09_Final_VK_ePub.xhtml#_idTextAnchor261)中学习如何使用
    Datadog REST API，*使用 Datadog REST API*。'
- en: '**DogStatsD**: This is a Datadog implementation of the StatsD interface available
    for publishing monitoring metrics. We will discuss this more in [*Chapter 10*](B16483_10_Final_VK_ePub.xhtml#_idTextAnchor302),
    *Working with Monitoring Standards*.'
  id: totrans-114
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**DogStatsD**：这是 Datadog 实现的 StatsD 接口，用于发布监控指标。我们将在[*第 10 章*](B16483_10_Final_VK_ePub.xhtml#_idTextAnchor302)中进一步讨论这一内容，*与监控标准一起工作*。'
- en: '**PowerShell**: This provides an option to submit metrics from Microsoft platforms.'
  id: totrans-115
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**PowerShell**：提供一个选项，从微软平台提交指标。'
- en: The Datadog UI has a dashboard for the event stream, and we will see how the
    events are listed on it and what event details are published. In a large-scale
    environment, the event stream volume can be quite large, and you may have to search
    for events of interest. While events are largely informational, it might make
    sense to be notified about certain categories of events, such as the stopping
    of an important service. Events are usually generated by Datadog, but Datadog
    also offers the feature to generate custom events as an integration option.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: Datadog UI 有一个事件流仪表盘，我们将看到事件是如何在仪表盘上列出的，以及发布了哪些事件详情。在大规模环境中，事件流的数量可能相当大，你可能需要搜索感兴趣的事件。虽然大多数事件仅提供信息，但对于某些类别的事件，比如重要服务的停止，接收通知可能是有意义的。事件通常是由
    Datadog 生成的，但 Datadog 也提供了生成自定义事件的功能，作为集成选项。
- en: Let's see how Datadog handles events out of the box using its event stream dashboard.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看 Datadog 是如何通过其事件流仪表盘开箱即用地处理事件的。
- en: Monitoring event streams
  id: totrans-118
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 监控事件流
- en: The events generated by Datadog or posted by applications provide a log of activities
    happening in the application system in general, especially at the infrastructure
    and system level, such as one-off issues with a host or a service restarting.
    On the Datadog UI, the even stream dashboard lists the latest events and can be
    viewed as follows.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 由 Datadog 生成或由应用程序发布的事件，提供了应用系统中发生的活动日志，特别是在基础设施和系统层面，例如主机出现一次性问题或服务重启。在 Datadog
    UI 中，事件流仪表盘列出了最新的事件，可以按如下方式查看。
- en: 'Click on the **Events** menu and pick a time window in the **Show** field to
    view the events for a specific time period. The event stream dashboard would look
    as follows:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 点击**事件**菜单并在**显示**字段中选择一个时间窗口，以查看特定时间段内的事件。事件流仪表盘将如下所示：
- en: '![Figure 5.4 – Event stream dashboard'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 5.4 – 事件流仪表盘'
- en: '](img/Figure_5.4_B16483.jpg)'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_5.4_B16483.jpg)'
- en: Figure 5.4 – Event stream dashboard
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.4 – 事件流仪表盘
- en: 'The events listed on the event stream are classified and can be filtered on
    the dashboard as follows:'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 事件流中列出的事件已被分类，可以在仪表盘上按如下方式进行过滤：
- en: '**By source**: On the left pane of the dashboard, the **FROM** section lists
    the sources of the events.'
  id: totrans-125
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**按来源**：在仪表盘的左侧窗格中，**FROM** 部分列出了事件的来源。'
- en: '**By Priority**: On the left pane of the dashboard, the **PRIORITY** section
    lists the priorities.'
  id: totrans-126
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**按优先级**：在仪表盘的左侧窗格中，**PRIORITY** 部分列出了事件的优先级。'
- en: '**By Severity**: On the left pane of the dashboard, the **STATUS**section lists
    the severity of the events.'
  id: totrans-127
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**按严重性**：在仪表盘的左侧窗格中，**STATUS** 部分列出了事件的严重性。'
- en: 'By selecting one or more event types described here, the events listed on the
    event stream dashboard can be filtered to see the specific ones you need to look
    at. The related events are aggregated if the **Aggregate related events** option
    is checked on the dashboard as in the following screenshot:'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 通过选择此处描述的一个或多个事件类型，可以在事件流仪表盘上筛选显示您需要查看的特定事件。如果仪表盘上选中了**聚合相关事件**选项，则相关事件将被聚合，如下图所示：
- en: '![Figure 5.5 – The Aggregate related events option on the event stream dashboard'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 5.5 – 事件流仪表盘上的聚合相关事件选项'
- en: '](img/Figure_5.5_B16483.jpg)'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_5.5_B16483.jpg)'
- en: Figure 5.5 – The Aggregate related events option on the event stream dashboard
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.5 – 事件流仪表盘上的聚合相关事件选项
- en: In the next section, we will see how specific events can be located on the event
    stream dashboard.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的部分，我们将看到如何在事件流仪表盘上定位特定的事件。
- en: Searching events
  id: totrans-133
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 搜索事件
- en: In a large-scale environment where the Datadog Agent runs on several hundred
    hosts monitoring a variety of microservices and applications running on them,
    there will be scores of events published to the event stream dashboard every minute.
    In such a situation, manually looking through the event stream is not viable,
    and standard search methods have to be used to locate events of interest. Datadog
    provides multiple options for searching and filtering to get the correct set of
    events.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 在一个大规模环境中，Datadog Agent 运行在数百台主机上，监控着运行在这些主机上的各种微服务和应用程序，每分钟都会有大量事件发布到事件流仪表盘。在这种情况下，手动查看事件流是不可行的，必须使用标准搜索方法来定位感兴趣的事件。Datadog
    提供了多种搜索和筛选选项，以获取正确的事件集合。
- en: 'As we have seen in the previous section, you can specify a time window in the
    **Show** field to look at events only from a specific time period. As shown in
    the following screenshot, the time window can be specified in a variety of ways:'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 如我们在前一部分所见，您可以在**显示**字段中指定一个时间窗口，仅查看特定时间段的事件。如以下截图所示，可以通过多种方式指定时间窗口：
- en: '![Figure 5.6 – Time window options to filter events'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 5.6 – 过滤事件的时间窗口选项'
- en: '](img/Figure_5.6_B16483.jpg)'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_5.6_B16483.jpg)'
- en: Figure 5.6 – Time window options to filter events
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.6 – 过滤事件的时间窗口选项
- en: 'The time can be specified as follows:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 时间可以按如下方式指定：
- en: By selecting fixed buckets of minutes, hours, or days in the past.
  id: totrans-140
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过选择过去的固定时间段（分钟、小时或天）。
- en: By entering custom time windows as shown in the screenshot; a Unix timestamp
    can be used with this option.
  id: totrans-141
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过输入自定义时间窗口，如截图所示；此选项可以使用 Unix 时间戳。
- en: 'There is a full text search option available, which you can use to look for
    events using keywords. In the following example, the `ntp` keyword is used to
    list only the related events:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 提供了一个全文搜索选项，您可以使用它通过关键词查找事件。在以下示例中，使用了 `ntp` 关键词来列出仅相关的事件：
- en: '![Figure 5.7 – Searching events using a keyword'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 5.7 – 使用关键词搜索事件'
- en: '](img/Figure_5.7_B16483.jpg)'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_5.7_B16483.jpg)'
- en: Figure 5.7 – Searching events using a keyword
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.7 – 使用关键词搜索事件
- en: 'A keyword search can be saved for future use. Click on the downward arrow in
    the keyword search field to view the save option, as shown in the following screenshot:'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 可以保存关键词搜索以便将来使用。点击关键词搜索框中的向下箭头查看保存选项，如下图所示：
- en: '![Figure 5.8 – Saving a keyword search of events'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 5.8 – 保存事件的关键词搜索'
- en: '](img/Figure_5.8_B16483.jpg)'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_5.8_B16483.jpg)'
- en: Figure 5.8 – Saving a keyword search of events
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.8 – 保存事件的关键词搜索
- en: 'While the last example does a simple, full text search, the Datadog query language
    can be used to do more complex searches, and some of the important constructs
    that you can use are the following:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然上一个示例进行了简单的全文搜索，但 Datadog 查询语言可以用于进行更复杂的搜索，您可以使用以下一些重要的构造：
- en: '`sources`:`<source_name_1>`, `<source_name_2>`: In this case, the search will
    be run for events from `source_name_1` or `source_name_2`.'
  id: totrans-151
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`sources`:`<source_name_1>`，`<source_name_2>`：在这种情况下，搜索将针对来自 `source_name_1`
    或 `source_name_2` 的事件进行。'
- en: Similarly, you can specify tags, hosts, status (error, warning, or success),
    and priority (low or normal) as the filters in the query.
  id: totrans-152
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 同样，你也可以在查询中指定标签、主机、状态（错误、警告或成功）和优先级（低或正常）作为筛选条件。
- en: '`OR`, `AND`, and `NOT` Boolean operators can be used to combine basic search
    conditions. See the following examples:'
  id: totrans-153
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可以使用 `OR`、`AND` 和 `NOT` 布尔运算符来组合基本搜索条件。以下是一些示例：
- en: '`ntp` `OR` `nagios` will search for either one of the `ntp` and `nagios` keywords.'
  id: totrans-154
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`ntp` `OR` `nagios` 将搜索包含 `ntp` 或 `nagios` 关键字的事件。'
- en: '`tags:region:us-west-2 AND environment:production` will look for events tagged
    with the key values `region:us-west-2` and `environment:production`.'
  id: totrans-155
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`tags:region:us-west-2 AND environment:production` 将搜索标记为 `region:us-west-2`
    和 `environment:production` 的事件。'
- en: '`* NOT "ntp"` will list all the events that do not contain the `ntp` keyword.'
  id: totrans-156
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`* NOT "ntp"` 将列出所有不包含 `ntp` 关键字的事件。'
- en: Now let's see how we can get notified of events.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们来看看如何接收事件通知。
- en: Notifications for events
  id: totrans-158
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 事件通知
- en: The normal way to monitor events is to search using the event stream dashboard
    if some issue occurs in the infrastructure or application system, looking for
    some clues as to the root cause. Events are not very useful in terms of proactive
    monitoring because you get to know about the issue only after the issue happens.
    However, notifying others about some of the events might be useful. Also, filing
    a support ticket based on an event is possible, by notifying the Datadog support.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 监控事件的常规方式是通过事件流仪表板进行搜索，特别是在基础设施或应用系统出现问题时，寻找一些线索来查明根本原因。事件在主动监控方面的作用有限，因为你只能在问题发生后才知道情况。然而，通知他人关于某些事件可能会很有用。此外，通过通知
    Datadog 支持团队，也可以基于事件提交支持工单。
- en: 'Use the **Add comment** link available with the event to send a notification
    as in the following example:'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 使用事件旁边的 **添加评论** 链接可以像以下示例一样发送通知：
- en: '![Figure 5.9 – Notifications for events'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 5.9 – 事件通知'
- en: '](img/Figure_5.9_B16483.jpg)'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_5.9_B16483.jpg)'
- en: Figure 5.9 – Notifications for events
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.9 – 事件通知
- en: As you can see, an event notification can be sent to individual emails, **all**,
    and **Datadog Support**. All the Datadog users in the organization will be notified
    of the event if **all** is chosen. A support ticket will be created if **Datadog
    Support** is selected.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 如图所示，事件通知可以发送到个人邮件、**所有人**和**Datadog 支持**。如果选择 **所有人**，组织中所有的 Datadog 用户将会收到事件通知。如果选择
    **Datadog 支持**，将创建一个支持工单。
- en: 'The event stream is integrated with the following integrations, using which
    the event details can be forwarded to the related tools:'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 事件流与以下集成进行了集成，通过这些集成，事件详情可以转发到相关工具：
- en: '`@slack-<slack_account>-<slack-channel>`.'
  id: totrans-166
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`@slack-<slack_account>-<slack-channel>`。'
- en: '`@webhook_name`. (`webhook_name` must be configured in Datadog for this to
    work, and we will see how to do this in [*Chapter 9*](B16483_09_Final_VK_ePub.xhtml#_idTextAnchor261),
    *Using the Datadog REST API*.)'
  id: totrans-167
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`@webhook_name`。(`webhook_name` 必须在 Datadog 中进行配置才能生效，我们将在[*第 9 章*](B16483_09_Final_VK_ePub.xhtml#_idTextAnchor261)，*使用
    Datadog REST API* 中看到如何操作。)'
- en: '`@pagerduty`, the event details can be forwarded as an alert to **PagerDuty**.'
  id: totrans-168
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`@pagerduty`，事件详情可以作为警报转发到 **PagerDuty**。'
- en: In the next section, we will see how custom events are created and added to
    the event stream.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的部分，我们将了解如何创建自定义事件并将其添加到事件流中。
- en: Generating events
  id: totrans-170
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 生成事件
- en: Thus far, we have discussed how to view, search, and escalate events that are
    generated by Datadog. As with metrics and tags, custom events can be created as
    well in Datadog. The primary use of this feature is to use the event stream dashboard
    as a communication hub for **Site Reliability Engineering** (**SRE**) and production
    engineering teams.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我们已经讨论了如何查看、搜索和提升由 Datadog 生成的事件。与指标和标签一样，Datadog 也可以创建自定义事件。此功能的主要用途是将事件流仪表板作为
    **站点可靠性工程** (**SRE**) 和生产工程团队的沟通中心。
- en: A common scenario is deploying to an environment monitored by Datadog. During
    deployment, multiple services and processes will be restarted, and there will
    be a large volume of events. Posting a deployment as an event with details might
    help to alleviate the concerns of any other teams monitoring the environment but
    not actively participating in the deployment process.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 一个常见的场景是在受 Datadog 监控的环境中进行部署。在部署过程中，多个服务和进程将被重启，并且会产生大量事件。将部署作为事件发布，并附带详细信息，可能有助于缓解其他监控环境但没有积极参与部署过程的团队的担忧。
- en: 'An event can be posted from the event stream dashboard as a status update.
    Look at the following example:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 事件可以从事件流仪表板发布为状态更新。请看以下示例：
- en: '![Figure 5.10 – Posting a custom event'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 5.10 – 发布自定义事件'
- en: '](img/Figure_5.10_B16483.jpg)'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_5.10_B16483.jpg)'
- en: Figure 5.10 – Posting a custom event
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.10 – 发布自定义事件
- en: As with creating and managing other Datadog resources, events can be generated
    programmatically using the Datadog API. This enables standalone programs to post
    into the event stream. In the previous example, the status update was posted directly
    on the event stream dashboard. In a more automated environment, the deployment
    orchestration process, a **Jenkins job**, or an **Ansible playbook** could do
    the same using the API.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 与创建和管理其他 Datadog 资源一样，事件也可以通过 Datadog API 程序化生成。这使得独立程序能够将事件发布到事件流。在前面的例子中，状态更新直接发布在事件流仪表板上。在更自动化的环境中，部署编排过程、**Jenkins
    作业**或**Ansible playbook**可以使用 API 实现相同的操作。
- en: 'The API to post an event is at [https://api.datadoghq.com/api/v1/events](https://api.datadoghq.com/api/v1/events),
    and the main attributes in its payload are the following:'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 发布事件的 API 地址为[https://api.datadoghq.com/api/v1/events](https://api.datadoghq.com/api/v1/events)，其有效载荷中的主要属性如下：
- en: '`alert_type`: Values can be `error`, `warning`, `info`, or `success`.'
  id: totrans-179
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`alert_type`：值可以是 `error`、`warning`、`info` 或 `success`。'
- en: '`priority`: Values can be `normal` or `low`.'
  id: totrans-180
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`priority`：值可以是 `normal` 或 `low`。'
- en: '`source_type_name`: The list of sources is available at [https://docs.datadoghq.com/integrations/faq/list-of-api-source-attribute-value/](https://docs.datadoghq.com/integrations/faq/list-of-api-source-attribute-value/).'
  id: totrans-181
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`source_type_name`：可用源的列表请见[https://docs.datadoghq.com/integrations/faq/list-of-api-source-attribute-value/](https://docs.datadoghq.com/integrations/faq/list-of-api-source-attribute-value/)。'
- en: '`tags`: Tags applied to the event for filtering and grouping.'
  id: totrans-182
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`tags`：应用于事件的标签，用于过滤和分组。'
- en: '`text`: Body of the event.'
  id: totrans-183
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`text`：事件正文。'
- en: '`title`: Title of the event.'
  id: totrans-184
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`title`：事件标题。'
- en: We will learn how to use the Datadog API in detail in [*Chapter 9*](B16483_09_Final_VK_ePub.xhtml#_idTextAnchor261),
    *Using the Datadog REST API*. Posting an event to the event stream using the Datadog
    API will be done there as an example.
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在[*第9章*](B16483_09_Final_VK_ePub.xhtml#_idTextAnchor261)，*使用 Datadog REST
    API* 中详细学习如何使用 Datadog API。我们将在那里通过一个例子展示如何使用 Datadog API 向事件流发布事件。
- en: Now, let's look at the best practices around defining and using metrics, events,
    and tags in Datadog.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们来看看在 Datadog 中定义和使用指标、事件和标签的最佳实践。
- en: Best practices
  id: totrans-187
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 最佳实践
- en: 'The following are the best practices related to creating and maintaining metrics
    and tags:'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是与创建和维护指标和标签相关的最佳实践：
- en: Make sure that all the tags available through various integrations are enabled.
    This mainly involves inheriting tags from source platforms such as public cloud
    services, Docker, and Kubernetes. When complex applications are part of your environment,
    it is better to have more tags to improve traceability.
  id: totrans-189
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 确保启用了通过各种集成提供的所有标签。这主要涉及从源平台（如公共云服务、Docker 和 Kubernetes）继承标签。当复杂应用程序是你环境的一部分时，拥有更多标签有助于提高可追溯性。
- en: Add more tags from the Datadog Agent and integrations to partition your metrics
    data easily and to track the environment, services, and owners efficiently.
  id: totrans-190
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从 Datadog Agent 和集成中添加更多标签，以便轻松划分你的指标数据，并高效追踪环境、服务和所有者。
- en: Have a namespace schema for your custom metrics using periods so that they can
    be grouped and located easily – for example, `mycompany.app1.role1.*`.
  id: totrans-191
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为你的自定义指标使用带有句点的命名空间结构，这样可以方便地进行分组和定位——例如，`mycompany.app1.role1.*`。
- en: Format the names and values of metrics and tags according to the guidelines.
    Datadog silently makes changes to names and values if their format is not compliant.
    Such altered names could cause confusion on the ground as they will be different
    from the expected values.
  id: totrans-192
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 根据指南格式化指标和标签的名称和值。如果其格式不符合规范，Datadog 会默默地对名称和值进行更改。这些更改后的名称可能会导致混淆，因为它们与预期的值不同。
- en: If some incident happens and not much information is available immediately from
    monitoring alerts, query the event stream for clues.
  id: totrans-193
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果发生某些事件，且从监控警报中无法立即获取足够的信息，请查询事件流以寻找线索。
- en: Post custom messages from the dashboard that might help with some ongoing activity,
    such as a deployment, especially if you operate in a distributed team environment.
  id: totrans-194
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从仪表盘发布可能有助于某些正在进行的活动的自定义消息，例如部署，特别是当你在分布式团队环境中工作时。
- en: Consider posting events to the event stream from automation processes if they
    will have some impact on the resources that Datadog monitors.
  id: totrans-195
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果自动化过程对 Datadog 监控的资源有影响，考虑从自动化过程中发布事件到事件流。
- en: Use the notification option to raise tickets with Datadog Support if an event
    warrants any digging by them.
  id: totrans-196
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用通知选项向 Datadog 支持团队提交工单，若某个事件需要他们进一步调查。
- en: Summary
  id: totrans-197
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: Metrics are central to a modern monitoring system and Datadog is no exception.
    Datadog offers a rich set of options to generate and use metrics. Though tags
    have general-purpose uses across all Datadog resources, their main use is to group
    and filter massive amounts of metrics data.
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 指标是现代监控系统的核心，Datadog 也不例外。Datadog 提供了丰富的选项来生成和使用指标。尽管标签在所有 Datadog 资源中都有通用用途，但它们的主要作用是对大量的指标数据进行分组和筛选。
- en: In this chapter, we learned how metrics and tags are defined and how metrics
    and other resources are grouped and searched for using tags. Besides Datadog-defined
    metrics and tags, there are multiple ways to add custom metrics and tags, and
    some of those methods were discussed in this chapter.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们学习了如何定义指标和标签，以及如何通过标签对指标和其他资源进行分组和搜索。除了 Datadog 定义的指标和标签之外，还有多种方法可以添加自定义的指标和标签，其中一些方法在本章中已经讨论过。
- en: An event is an activity in the infrastructure or in the application system that
    Datadog monitors. Datadog captures and lists such events on the event stream dashboard.
    Events can be searched for in multiple ways, including by using keywords and tags.
    Events can be forwarded to different channels such as email, Slack, and PagerDuty.
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 事件是 Datadog 监控的基础设施或应用系统中的活动。Datadog 会捕获并在事件流仪表板上列出这些事件。可以通过多种方式搜索事件，包括使用关键词和标签。事件还可以转发到不同的渠道，如电子邮件、Slack
    和 PagerDuty。
- en: In the next chapter, we will see how monitoring events are managed in Datadog.
    We will also learn how they are searched for and how custom events can be published.
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将了解如何在 Datadog 中管理监控事件。我们还将学习如何搜索这些事件，以及如何发布自定义事件。
