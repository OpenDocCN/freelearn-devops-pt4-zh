- en: Application Monitoring
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 应用程序监控
- en: In the previous chapters, you learned about applying DevOps principles to software
    delivery. You learned how to create a pipeline from source control all the way
    to production. You also learned how to ensure that your delivery is compliant
    and secure, without sacrificing speed or a focus on the delivery of business value.
    In this chapter, you will learn how to start transforming this pipeline into a
    DevOps loop, a continuous process of delivering new software, and then measure
    how your application performs. This is a continuous journey, as you evaluate how
    your application fares in production and learn how to proceed next.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在前几章中，你学习了如何将DevOps原则应用到软件交付中。你学习了如何创建从源代码管理到生产的流水线。你还学会了如何确保你的交付符合合规要求和安全标准，同时不牺牲速度或忽视业务价值的交付。在本章中，你将学习如何将这个流水线转变为一个DevOps循环，持续交付新软件，并衡量应用程序的表现。这是一个持续的过程，在生产环境中评估应用程序的表现，并学习如何决定下一步的方向。
- en: To do this, this chapter starts by introducing a means for gathering application
    crashes. Almost every application will, at some point, throw an unhandled exception
    and crash. Ensuring that application crashes are gathered and reported will enable
    you to investigate the causes and to address them. Next, attention shifts to instrumenting
    applications. Instrumentation is the practice of gathering logs and metrics that
    help you understand how your application performs in production. You can use them
    to get alerts when things go wrong or, hopefully, before they go wrong. The chapter
    concludes by exploring several options for integrating with other tools.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 为了实现这一目标，本章首先介绍了一种收集应用程序崩溃报告的方法。几乎每个应用程序在某个时候都会抛出未处理的异常并崩溃。确保收集和报告应用程序崩溃，可以帮助你调查崩溃的原因并解决它们。接下来，重点转向应用程序的仪器化。仪器化是收集日志和指标的实践，它们可以帮助你了解应用程序在生产环境中的表现。你可以利用这些数据在问题发生时发出警报，或者希望能够在问题发生之前提前发现。最后，本章还探讨了与其他工具集成的几种选择。
- en: 'The following topics are covered in this chapter:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 本章涵盖以下主题：
- en: Investigating application crashes
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 调查应用程序崩溃
- en: Instrumenting web applications
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Web应用程序仪器化
- en: Integrating with other tools
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 与其他工具集成
- en: Technical requirements
  id: totrans-7
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: 'To experiment with the techniques described in this chapter, you will need
    one or more of the following:'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 要尝试本章中描述的技术，你将需要以下之一或更多：
- en: An App Center account for gathering mobile application crashes
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用于收集移动应用程序崩溃的App Center账户
- en: A Raygun subscription for gathering desktop application crashes
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用于收集桌面应用程序崩溃的Raygun订阅
- en: An Azure subscription for instrumenting web applications
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用于对Web应用程序进行仪器化的Azure订阅
- en: Free-trial options are available for all of these.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 所有这些都提供免费试用选项。
- en: Investigating application crashes
  id: totrans-13
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 调查应用程序崩溃
- en: No matter how well an application is engineered, at some point, it will crash
    due to an unexpected condition. To learn from these crashes and to try and prevent
    them in the future, it helps to add code to applications to gather crash reports
    and send them to a central location. Here, they can be analyzed and grouped to
    identify application improvements. How to do this differs depending on the type
    of application.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 无论应用程序设计得多么完美，最终都会因某些意外情况而崩溃。为了从这些崩溃中学习并尽量防止未来发生类似问题，可以向应用程序添加代码来收集崩溃报告，并将其发送到一个中央位置。在这里，这些报告可以被分析并归类，以识别应用程序的改进方向。具体如何操作取决于应用程序的类型。
- en: The following sections discuss how this process for mobile and desktop applications
    works. Regarding web applications, gathering crash reports can be done using the
    same tool as for instrumentation; we will discuss this in the *Instrumenting web
    applications* section later on.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 以下部分将讨论移动应用程序和桌面应用程序的崩溃报告收集过程。关于Web应用程序，崩溃报告的收集可以使用与仪器化相同的工具；我们将在后面的*Web应用程序仪器化*部分讨论这个内容。
- en: Gathering crash reports for mobile applications
  id: totrans-16
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 收集移动应用程序崩溃报告
- en: One of the many tools available for gathering crash reports and errors from
    mobile applications is Visual Studio App Center. Besides distributing mobile applications,
    App Center also allows applications to submit their crashes and errors for analysis.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 许多用于收集移动应用程序崩溃报告和错误的工具之一是Visual Studio App Center。除了分发移动应用程序外，App Center还允许应用程序提交崩溃和错误进行分析。
- en: 'To get started with crash reporting using App Center, the application first
    needs to be defined. This is called an app definition and how to work with it
    was discussed in [Chapter 4](8ab4597a-becd-4855-9b45-89045982c14a.xhtml), *Continuous
    Deployment*. With this app definition, an app secret is created, which is needed
    to configure the application to send out crash reports. To start sending crash
    reports, the following steps need to be performed:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 要开始使用 App Center 进行崩溃报告，首先需要定义应用程序。这被称为应用程序定义，如何操作它在[第 4 章](8ab4597a-becd-4855-9b45-89045982c14a.xhtml)《持续部署》中进行了讨论。通过这个应用程序定义，可以创建一个应用程序密钥，这对于配置应用程序以发送崩溃报告是必需的。要开始发送崩溃报告，需要执行以下步骤：
- en: Install the `Microsoft.AppCenter.Crashes` NuGet package on the project.
  id: totrans-19
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在项目中安装 `Microsoft.AppCenter.Crashes` NuGet 包。
- en: 'Add the following code to the application initialization:'
  id: totrans-20
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将以下代码添加到应用程序初始化中：
- en: '[PRE0]'
  id: totrans-21
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Besides crashes, it is also possible to track other errors that are of interest
    to developers. This can be done using the following code:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 除了崩溃外，还可以跟踪开发者感兴趣的其他错误。可以使用以下代码来完成此操作：
- en: '[PRE1]'
  id: totrans-23
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Now, all the unhandled exceptions are automatically caught and sent back to
    App Center. Here, they become available for analysis, as in the following screenshot:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，所有未处理的异常都会自动捕获并发送回 App Center。在这里，它们可以进行分析，如下图所示：
- en: '![](img/f4aca831-a120-44e4-97fe-a70eedfaec1f.png)'
  id: totrans-25
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f4aca831-a120-44e4-97fe-a70eedfaec1f.png)'
- en: 'Click on any of the reported errors or crashes to open a detailed view, as
    shown:'
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击任何已报告的错误或崩溃，查看详细信息，如下所示：
- en: '![](img/1ee587c6-a5fe-4492-8152-41e45a97463e.png)'
  id: totrans-27
  prefs: []
  type: TYPE_IMG
  zh: '![](img/1ee587c6-a5fe-4492-8152-41e45a97463e.png)'
- en: A dashboard with the most important information is shown for each crash or error.
    This includes the number of reports and the number of affected users. Also, the
    impacted device types and operating systems are shown. At the top of the page,
    the stack traces are shown, which can be used by developers to investigate and,
    hopefully, fix the issue.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 每个崩溃或错误都会显示一个包含最重要信息的仪表板。这包括报告的数量和受影响用户的数量。同时，还会显示受影响的设备类型和操作系统。在页面顶部，显示了堆栈跟踪，开发者可以使用这些信息来调查并且希望能够修复问题。
- en: This covers gathering crash reports and errors from mobile applications. The
    next section introduces the same concepts for desktop applications.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 这部分内容涵盖了从移动应用程序收集崩溃报告和错误。接下来的部分介绍了桌面应用程序的相同概念。
- en: Gathering crash reports for desktop applications
  id: totrans-30
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 收集桌面应用程序的崩溃报告
- en: Crash reporting is also available for desktop applications. There are, again,
    many solutions available for desktop applications and most of them work in roughly
    the same way. One of these solutions is Raygun. Raygun is a commercial offering
    available for .NET applications, but works for many other languages and platforms
    as well.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 崩溃报告同样适用于桌面应用程序。同样，桌面应用程序有许多解决方案，而且它们大多数的工作原理差不多。这些解决方案之一是 Raygun。Raygun 是一个商业服务，适用于
    .NET 应用程序，但也支持许多其他语言和平台。
- en: 'To gather crashes using Raygun, follow these three steps:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用 Raygun 收集崩溃报告，请按照以下三步操作：
- en: Sign up for a Raygun account.
  id: totrans-33
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 注册 Raygun 账户。
- en: Install the `Mindscape.Raygun4Net` NuGet package on the solution.
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在解决方案中安装 `Mindscape.Raygun4Net` NuGet 包。
- en: Catch unhandled exceptions and forward them to Raygun.
  id: totrans-35
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 捕获未处理的异常并将其转发到 Raygun。
- en: 'The following example shows you how to catch and forward unhandled exceptions
    to Raygun:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 以下示例展示了如何捕获并将未处理的异常转发到 Raygun：
- en: '[PRE2]'
  id: totrans-37
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Once this is done, all the exceptions can be explored in the Raygun web interface.
    Here, exceptions are automatically grouped if stack traces are sufficiently similar.
    They can also be grouped and browsed individually, but in most cases, it makes
    sense to only focus on the larger groups of exceptions.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 完成此操作后，可以在 Raygun 网络界面中查看所有异常。在这里，如果堆栈跟踪足够相似，异常会自动分组。也可以单独查看并浏览它们，但在大多数情况下，只关注更大的异常组是有意义的。
- en: 'The following screenshot shows how these groups can be browsed in Raygun:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图展示了如何在 Raygun 中浏览这些组：
- en: '![](img/f11e73bb-a904-4bb6-b4be-5e5cecf9b3df.png)'
  id: totrans-40
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f11e73bb-a904-4bb6-b4be-5e5cecf9b3df.png)'
- en: Clicking on the exception message in this interface shows the complete stack
    trace and all the shared properties of any instance of the exception that has
    occurred.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 点击此界面中的异常消息，可以查看完整的堆栈跟踪以及该异常实例的所有共享属性。
- en: This completes our look into gathering crash reports from mobile and desktop
    applications. Doing so allows you to find and investigate issues that customers
    face in production. In the following section, instrumentation for web applications
    is introduced to further enhance our insight into how applications behave in production.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 这部分内容结束了我们对移动和桌面应用程序崩溃报告收集的讨论。通过这样的做法，你可以发现并调查客户在生产环境中遇到的问题。在接下来的部分，将介绍 web
    应用程序的监控，以进一步增强我们对应用程序在生产环境中表现的理解。
- en: Instrumenting web applications
  id: totrans-43
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 网络应用的监控
- en: Web applications are different from mobile and desktop applications in many
    ways—for instance, the fact that large parts of the application do not run on
    a client, but on a server. This allows developers to collect information on how
    the application is run for web applications more easily than for other types of
    applications. Doing so is called instrumenting an application.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 网络应用程序在许多方面与移动应用和桌面应用程序不同——例如，大部分应用程序代码并不在客户端运行，而是在服务器上运行。这使得开发人员可以比其他类型的应用程序更容易地收集关于
    web 应用程序运行方式的信息。这个过程称为“监控应用程序”。
- en: Logs are text messages that are saved by the system to describe the execution
    path that the server follows. This helps developers go back in time and explore
    what has happened by examining the logging output. Structured logging is quickly
    becoming the standard for trace logging. Structured logging is a technique where
    logs are no longer only text messages. Instead, logs are parameterized text messages
    with a set of values for each parameter. This has two advantages—logs can be better
    compressed and they can be searched more quickly.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 日志是系统保存的文本消息，用于描述服务器执行路径。这有助于开发人员通过检查日志输出回溯并探索发生过的事情。结构化日志正迅速成为追踪日志的标准。结构化日志是一种技术，其中日志不再只是文本消息，而是带有每个参数一组值的参数化文本消息。这样有两个优势——日志可以更好地压缩，并且可以更快速地进行搜索。
- en: Metrics are values that are recorded for an application. They take the form
    of a timestamp, metric name, and value. One example is recording the percentage
    of CPU in use every second.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 指标是记录应用程序数据的值。它们包括时间戳、指标名称和数值。例如，每秒记录一次CPU使用百分比。
- en: When instrumenting an application, it is easy to focus on many server-level
    types of logs and metrics. For example, many operators will, by default, start
    collecting metrics such as CPU usage, memory pressure, and I/O operations. While
    there is nothing wrong with these metrics, they are not always indicative of an
    application's performance from a user's point of view. Other metrics, such as
    response times or queue message processing delays, might yield better insights
    into the user experience. While there is nothing wrong with measuring system metrics
    (they are often great indicators of future issues), you should also try to gather
    user-centric metrics.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 在监控应用程序时，很容易集中关注许多服务器级别的日志和指标。例如，许多操作员默认会开始收集诸如 CPU 使用率、内存压力和 I/O 操作等指标。虽然这些指标没有错，但它们并不总能反映从用户角度来看应用程序的性能。其他指标，如响应时间或队列消息处理延迟，可能会提供更好的用户体验洞察。虽然衡量系统指标是没有问题的（它们通常是未来问题的良好指示），但你也应该尝试收集以用户为中心的指标。
- en: 'Azure offers the Application Insights service for instrumenting applications,
    with a focus on web applications. An Application Insights workspace can be created
    using the Azure portal, which opens up a workspace as in the following screenshot.
    One of the important things here is Instrumentation Key, which will be used in
    later sections. Even though this field is plainly shown, it is recommended that
    you treat this as an application secret:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 提供了 Application Insights 服务来监控应用程序，重点是 web 应用程序。可以通过 Azure 门户创建 Application
    Insights 工作区，这将打开如下截图所示的工作区。这里需要注意的一个重要内容是“Instrumentation Key”，它将在后续章节中使用。尽管该字段明确显示，但建议将其视为应用程序的密钥：
- en: '![](img/29134293-71b6-495b-91b5-d6b2d63a373c.png)'
  id: totrans-49
  prefs: []
  type: TYPE_IMG
  zh: '![](img/29134293-71b6-495b-91b5-d6b2d63a373c.png)'
- en: If you want to experiment with Application Insights and Azure Monitor using
    a ready-made application, there is a link to an example at the end of this chapter
    in the *Further reading* section. The example is a simple URL shortning application
    that uses multiple application components and has logging and monitoring built-in
    and can be used to start experimenting with the concepts introduced in this section
    within minutes.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想通过一个现成的应用程序来实验 Application Insights 和 Azure Monitor，本章末尾的 *进一步阅读* 部分提供了一个示例链接。该示例是一个简单的
    URL 缩短应用，使用了多个应用组件，并且内置了日志记录和监控，可以用来在几分钟内开始实验本节介绍的概念。
- en: The following subsections will go into detail about logging, metrics, and investigating
    individual requests.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 以下小节将详细介绍日志记录、度量以及如何调查单个请求。
- en: Logging
  id: totrans-52
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 日志记录
- en: One of the most basic types of instrumentation is adding logging statements
    to application code. In the past, these logs were saved to the disk of the server
    that ran the application. Retrieving and investigating these logs then took a
    lot of time and effort.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 最基本的仪器化类型之一是将日志语句添加到应用程序代码中。过去，这些日志被保存在运行应用程序的服务器的磁盘上。然后，检索和调查这些日志需要花费大量的时间和精力。
- en: In modern hosting environments, logs are no longer saved on the local filesystem
    but instead stored remotely. With transient infrastructure and servers added or
    removed on the fly, it is no longer possible to store logs on the server and be
    sure that they can be retrieved later. For this reason, they are transmitted over
    HTTP to specialized log stores, such as Application Insights.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 在现代托管环境中，日志不再保存在本地文件系统中，而是远程存储。随着临时基础设施和服务器的动态增减，无法再将日志保存在服务器上，并确保以后能够检索它们。因此，日志通过
    HTTP 传输到专门的日志存储中，如 Application Insights。
- en: Emitting logs
  id: totrans-55
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 发出日志
- en: 'To write log entries to a log store, such as Application Insights, from an
    ASP.NET application, two things must be done:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 要将日志条目写入日志存储（例如 Application Insights）中，必须完成以下两项操作：
- en: Log entries need to be emitted from application code, where applicable, using
    the `ILogger` interface. This interface is available from the `Microsoft.Extensions.Logging.Abstractions`
    NuGet package.
  id: totrans-57
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 日志条目需要在应用程序代码中发出，适用时，使用 `ILogger` 接口。此接口可通过 `Microsoft.Extensions.Logging.Abstractions`
    NuGet 包获得。
- en: The Application Insights NuGet package (`Microsoft.ApplicationInsights.AspNetCore`)
    needs to be installed and Application Insights needs to be registered as `LoggingProvider`.
    This way, all logs sent to the preceding interface are forwarded to the Application
    Insights code. In turn, this code forwards all the logs to the Application Insights
    service.
  id: totrans-58
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 需要安装 Application Insights NuGet 包（`Microsoft.ApplicationInsights.AspNetCore`），并且需要将
    Application Insights 注册为 `LoggingProvider`。这样，所有发送到前述接口的日志将被转发到 Application Insights
    代码中。反过来，这些代码会将所有日志转发到 Application Insights 服务。
- en: 'The following example code shows you how to use the `ILogger` interface from
    a class to emit a structured log entry:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 以下示例代码展示了如何通过类中的 `ILogger` 接口生成结构化日志条目：
- en: '[PRE3]'
  id: totrans-60
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: There should be no dollar sign (`$`) at the start of the log entry. There is
    no string interpolation used here, but two placeholders are inserted into the
    text message. The structured logging entry will recognize these and when showing
    the entry, insert the provided values.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 日志条目开头不应有美元符号（`$`）。这里没有使用字符串插值，但文本消息中插入了两个占位符。结构化日志条目将识别这些占位符，并在显示日志条目时插入提供的值。
- en: With log entries emitted, a logging provider should be registered to capture
    these logs. This is done using the .NET Core built-in dependency injection.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 在生成日志条目后，应注册日志提供程序以捕获这些日志。可以通过 .NET Core 内置的依赖注入来完成此操作。
- en: 'After installing the Application Insights NuGet package, the following code
    needs to be added to the `CreateWebHostBuilder` method:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 安装 Application Insights NuGet 包后，需要在 `CreateWebHostBuilder` 方法中添加以下代码：
- en: '[PRE4]'
  id: totrans-64
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: When using version 2.7.0-beta3 (or later) of the Application Insights NuGet
    package and using Application Insights for metrics, the preceding configuration
    is no longer needed.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 当使用版本 2.7.0-beta3（或更高版本）的 Application Insights NuGet 包，并且使用 Application Insights
    来获取度量数据时，前述配置不再需要。
- en: After starting the application, all log entries of level warning and higher
    are automatically forwarded to Application Insights. To change which entries are
    forwarded and which aren't, filters can be configured. A link to more details
    on configuring Application Insights in detail is provided at the end of this chapter.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 启动应用程序后，所有警告级别及以上的日志条目会自动转发到 Application Insights。要更改转发哪些条目，哪些不转发，可以配置过滤器。本章最后将提供关于如何详细配置
    Application Insights 的更多链接。
- en: Searching logs
  id: totrans-67
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 搜索日志
- en: 'Within a few minutes of emitting a log entry to Application Insights, it becomes
    available on the interface for querying. To do this, open the Application Insights
    instance and navigate to Logs (Analytics) on the left-hand side menu (1). This
    opens the view shown in the following screenshot:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 在将日志条目发送到 Application Insights 后的几分钟内，它将出现在界面上，供查询使用。为此，打开 Application Insights
    实例并导航到左侧菜单中的日志（Analytics）（1）。这将打开如下所示的视图：
- en: '![](img/f220ec5b-f232-4cff-9b39-180f80791a21.png)'
  id: totrans-69
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f220ec5b-f232-4cff-9b39-180f80791a21.png)'
- en: Here, it is possible to write queries (2) that search the recorded logs in **Kusto
    Query Language** (**KQL**). Application Insights is optimized for handling large
    amounts of data and most queries return results within a second or less, even
    when searching millions of log entries.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，可以编写查询（2），用于搜索记录的日志，使用的是**Kusto 查询语言**（**KQL**）。Application Insights 已优化以处理大量数据，大多数查询的返回结果在一秒钟内，甚至在搜索数百万条日志条目时也能快速返回。
- en: Alerting on logs
  id: totrans-71
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 对日志进行警报
- en: Gathering and searching logs is useful when troubleshooting specific situations
    or bugs in response to a user complaint. However, there are situations where it
    is better to be notified automatically when a certain condition arises. This is
    called alerting.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 收集和搜索日志在排查特定情况或响应用户投诉时非常有用。然而，在某些情况下，当特定条件出现时，最好能够自动收到通知。这就是所谓的警报。
- en: Within Azure, it is possible to create alert rules that notify developers whenever
    a certain condition is met. Alerting functionality is provided by the Azure Monitor
    offering that is integrated with many Azure services, including Application Insights.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Azure 中，可以创建警报规则，当某个条件满足时，开发人员将收到通知。警报功能由 Azure Monitor 提供，且与许多 Azure 服务（包括
    Application Insights）集成。
- en: 'To create a new alert rule, follow these steps:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 要创建新的警报规则，请按照以下步骤操作：
- en: Navigate to Azure Monitor using the portal.
  id: totrans-75
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用门户导航到 Azure Monitor。
- en: 'Now, choose Alerts. This opens the view shown in the following screenshot:'
  id: totrans-76
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，选择警报。这样会打开以下截图所示的视图：
- en: '![](img/d3366681-8a38-4547-af41-060ee38b8ee4.png)'
  id: totrans-77
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d3366681-8a38-4547-af41-060ee38b8ee4.png)'
- en: If there are any alerts that need attention, they are shown here.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 如果有任何需要关注的警报，它们会在这里显示。
- en: 'To add new alert rules, use the button at the top-left hand side of the screen.
    Doing so opens another view, as in the following screenshot. Here, the alerting
    conditions can be configured:'
  id: totrans-79
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要添加新的警报规则，请使用屏幕左上方的按钮。点击后会打开另一个视图，如下截图所示。在这里，可以配置警报条件：
- en: '![](img/a964d411-6bf6-43f4-9429-bef7d22d199f.png)'
  id: totrans-80
  prefs: []
  type: TYPE_IMG
  zh: '![](img/a964d411-6bf6-43f4-9429-bef7d22d199f.png)'
- en: 'In the preceding screenshot, the view that opens for configuring alerts is
    shown on the left. Here, it is necessary to make several selections to create
    an alert:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的截图中，左侧显示了用于配置警报的视图。在这里，必须做出多个选择来创建一个警报：
- en: This is the resource that is the subject for the alert. This can be any type
    of resource and, in this instance, the alert will be on an Application Insights
    workspace.
  id: totrans-82
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这是作为警报主题的资源。它可以是任何类型的资源，在本示例中，警报将针对 Application Insights 工作区。
- en: 'These are the conditions to alert under. To select these, the popup on the
    right opens. Here, a choice can be made between different types of alerts. Pick
    the Log Search alert type to open the detailed view shown here. Here, the following
    selections must be made:'
  id: totrans-83
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这是设置警报的条件。要选择这些条件，右侧会弹出窗口。在这里，可以在不同类型的警报之间进行选择。选择“日志搜索”警报类型，将打开如下所示的详细视图。在这里，必须做出以下选择：
- en: '**A query on the trace logs** (refer to 2a in the previous screenshot): In
    this example, the trace log is queried for entries that have a severity of `4`
    or up, which means that they are emitted using the `LogWarning` or `LogCritical`
    methods.'
  id: totrans-84
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**对追踪日志的查询**（参考前面截图中的2a）：在此示例中，查询追踪日志中的条目，这些条目的严重性为 `4` 或更高，意味着它们是通过 `LogWarning`
    或 `LogCritical` 方法发出的。'
- en: '**A condition and operator for triggering the alert** (2b): In this case, the
    alert is triggered whenever there is one or more matches.'
  id: totrans-85
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**触发警报的条件和操作符**（2b）：在此情况下，只要有一个或多个匹配，警报就会触发。'
- en: '**The interval to evaluate the alert condition over **(2c): When specifying
    a query that matches a specific number, this determines the interval in which
    this amount must be met.'
  id: totrans-86
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**评估警报条件的间隔**（2c）：当指定一个匹配特定数字的查询时，这决定了必须满足该数量的时间间隔。'
- en: '**How often to evaluate the alert condition** (2d)**:** Evaluating an alert
    condition too frequently can result in too many alerts opening and closing in
    a fast series. Evaluating an alert condition too infrequently can result in alerts
    coming in too late. Experimentation will help you understand how to configure
    this.'
  id: totrans-87
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**评估警报条件的频率**（2d）：过于频繁地评估警报条件可能导致警报以快速的系列频繁开关。过于不频繁地评估警报条件可能会导致警报来得太晚。实验将帮助你了解如何配置这一点。'
- en: This is the action to execute when the alert condition is met. Since there might
    be a lot of alerts that have to invoke the same group of actions, actions can
    be grouped, and these action groups can be referenced here. Some examples of actions
    are calling a webhook or sending an SMS message or email.
  id: totrans-88
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这是在警报条件满足时执行的操作。由于可能有很多警报需要调用相同的操作组，因此可以将操作分组，并在此处引用这些操作组。操作的一些示例包括调用Webhook或发送短信或电子邮件。
- en: The alert configuration is completed by putting in a name and description.
  id: totrans-89
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 警报配置通过输入名称和描述来完成。
- en: Finally, the alert can be saved.
  id: totrans-90
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，警报可以被保存。
- en: After the alert is created and activated, which is done automatically, within
    a few minutes, the alert is ready to inspect application logs and signal whenever
    the alert condition is met.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 警报创建并激活后，系统会自动完成这一过程，几分钟内，警报就准备好检查应用程序日志，并在满足警报条件时发出信号。
- en: Logging is a great method of gaining deep knowledge about what happened with
    a request and how an error came to be. Another technique for learning more about
    an application's behavior is by using metrics.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 日志记录是深入了解请求发生了什么以及错误如何产生的好方法。另一种了解应用程序行为的技术是使用指标。
- en: Metrics
  id: totrans-93
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 指标
- en: 'Besides logs, an application can also emit one or more metrics. A metric is
    a series of values over time that describes one or more aspects of a system. Some
    examples of metrics are as follows:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 除了日志记录外，应用程序还可以发出一个或多个指标。指标是随着时间变化的一系列值，描述系统的一个或多个方面。一些指标的示例如下：
- en: The number of users currently logged in
  id: totrans-95
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当前登录的用户数量
- en: The number of products viewed by users
  id: totrans-96
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用户查看的产品数量
- en: The number of database transactions
  id: totrans-97
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据库事务的数量
- en: Gathering metrics such as these can provide insight into how a system is used
    and how it currently operates. Metrics are often used for creating dashboards
    and alerts.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 收集这些指标可以提供关于系统如何使用以及当前如何操作的洞察。指标通常用于创建仪表盘和警报。
- en: Emitting metrics
  id: totrans-99
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 发出指标
- en: To start working with metrics, they first have to be emitted by an application
    and stored in a centralized location. Besides logging, Application Insights can
    be used for metrics as well.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 要开始使用指标，首先必须由应用程序发出指标并存储在集中位置。除了日志记录外，应用程序洞察还可以用于获取指标。
- en: 'To use Application Insights for metrics, the following steps need to be taken:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用应用程序洞察来获取指标，需要执行以下步骤：
- en: Metrics need to be emitted from application code where applicable, using the
    `TelemetryClient` class. This interface is available from the `Microsoft.Extensions.Logging.Abstractions`
    NuGet package.
  id: totrans-102
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 指标需要从应用程序代码中发出（在适用的情况下），使用`TelemetryClient`类。此接口可以从`Microsoft.Extensions.Logging.Abstractions`
    NuGet包中获得。
- en: Install the `Microsoft.ApplicationInsights.AspNetCore` Application Insights
    NuGet package.
  id: totrans-103
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装`Microsoft.ApplicationInsights.AspNetCore`应用程序洞察NuGet包。
- en: 'Register `TelemetryClient` with the `Dependency` container. Do this by using
    the extension method on the container builder, as in the following code snippet:'
  id: totrans-104
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`TelemetryClient`注册到`Dependency`容器。通过在容器构建器上使用扩展方法来完成，如以下代码片段所示：
- en: '[PRE5]'
  id: totrans-105
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Once this is done, the application is ready to start emitting metrics. This
    is done using the `TelemetryClient` class:'
  id: totrans-106
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 完成此操作后，应用程序准备开始发出指标。可以使用`TelemetryClient`类来完成：
- en: '[PRE6]'
  id: totrans-107
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Emitting a metric involves two steps. First, a reference to the metric is retrieved
    using the `GetMetric()` method. Next, a value is submitted using the `TrackValue`
    method. Submitted values should be doubles or allow an implicit conversion to
    a double.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 发出一个指标涉及两个步骤。首先，使用`GetMetric()`方法获取该指标的引用。接下来，使用`TrackValue`方法提交一个值。提交的值应为双精度数或允许隐式转换为双精度数。
- en: Once the metrics are emitted, they can be used to create graphs and metrics.
    However, before moving on to these topics, first, another type of metric is discussed—namely,
    Azure platform metrics.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦指标发出，就可以用来创建图表和指标。然而，在继续讨论这些主题之前，首先要讨论另一种类型的指标——即 Azure 平台指标。
- en: 'Besides, the metrics that an application emits, there are also numerous metrics
    that can be recorded from the Azure platform that the system is running on. Some
    examples are as follows:'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 除了应用程序发出的指标之外，还有许多可以从运行系统的 Azure 平台中记录的指标。以下是一些示例：
- en: The percentage of CPU used
  id: totrans-111
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: CPU 使用百分比
- en: The number of messages on a service bus
  id: totrans-112
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 服务总线上的消息数量
- en: The number of database transactions per second
  id: totrans-113
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 每秒数据库事务数
- en: The amount of free disk space
  id: totrans-114
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可用的磁盘空间
- en: These metrics are often closely related to how an application performs and may
    even be leading indicators. For example, when the amount of free disk space reaches
    0, most web servers stop working.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 这些指标通常与应用程序的性能密切相关，甚至可能是领先指标。例如，当可用磁盘空间达到 0 时，大多数 Web 服务器会停止工作。
- en: In Azure, each service emits a series of metrics by default. These are called
    platform metrics. Which metrics are emitted differs from service to service and
    cannot be influenced by the user. Azure Monitor gathers these metrics automatically
    as well, and these metrics can be used in the same way for graphing and alerting
    as metrics are emitted by an application. The first one—graphing—is explored in
    the next section.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Azure 中，每个服务默认会发出一系列的指标，这些称为平台指标。不同的服务发出的指标各不相同，且用户无法影响这些指标的生成。Azure Monitor
    也会自动收集这些指标，这些指标可以像应用程序发出的指标一样用于绘图和警报。第一个要探讨的内容——绘图——将在下一节中介绍。
- en: Platform metrics are built-in and free of charge and are retained for 93 days.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 平台指标是内置的并且免费提供，且保留 93 天。
- en: Graphing metrics
  id: totrans-118
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 绘制指标
- en: 'All metrics that are gathered, either in Application Insights or in Azure Monitor,
    can be used to build graphs and dashboards that visualize the metric. Graphs can
    be created using the Metrics tab that is available on every Azure resource. Graphs
    can also be created using the Azure Monitor offering. This way, graphs for multiple
    resources can be combined on a single canvas. To do this, do the following:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 所有收集的指标，无论是在 Application Insights 中还是在 Azure Monitor 中，都可以用于构建可视化指标的图表和仪表板。可以使用每个
    Azure 资源中可用的“指标”选项卡来创建图表。也可以使用 Azure Monitor 提供的工具来创建图表，这样，可以在一个画布上合并多个资源的图表。操作步骤如下：
- en: Open Azure Monitor, which is available from the menu on the left.
  id: totrans-120
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开 Azure Monitor，可以从左侧菜单访问。
- en: 'Navigate to the Metrics menu. This opens the view shown in the following screenshot:'
  id: totrans-121
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到“指标”菜单。这将打开如下所示的视图：
- en: '![](img/9285c483-99c6-4df1-8e06-edafd069a3ff.png)'
  id: totrans-122
  prefs: []
  type: TYPE_IMG
  zh: '![](img/9285c483-99c6-4df1-8e06-edafd069a3ff.png)'
- en: 'Once the canvas opens, one or more graphs can be added to it. A graph is built
    using the graph builder at the top. Four selections have to be made here:'
  id: totrans-123
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦画布打开，可以将一个或多个图表添加到其中。图表是通过顶部的图表构建器构建的。这里需要做四个选择：
- en: The resource that a graph needs to be drawn for.
  id: totrans-124
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 需要绘制图表的资源。
- en: 'The metrics namespace belonging to that resource that a graph needs to be drawn
    for: For every Azure resource type, there is only a single namespace. The only
    exception is Application Insights, for which there are two—one with default metrics
    and one with application metrics that are emitted using `TelemetryClient`.'
  id: totrans-125
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 需要绘制图表的资源所属的指标命名空间：对于每种 Azure 资源类型，只有一个命名空间。唯一的例外是 Application Insights，它有两个命名空间——一个是默认指标，另一个是通过
    `TelemetryClient` 发出的应用程序指标。
- en: 'The metric to draw: For custom metrics, this refers back to the name chosen
    in the `GetMetric()` method from the previous section.'
  id: totrans-126
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 绘制指标：对于自定义指标，这指的是前一节中在 `GetMetric()` 方法中选择的名称。
- en: 'The mathematical operation to combine multiple measurements into a single point
    on the graph: This can be the minimum, maximum, average, or sum count.'
  id: totrans-127
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用于将多个测量值合并为图表中一个点的数学运算：这可以是最小值、最大值、平均值或总和。
- en: To add multiple graph lines to the same graph, choose Add Metric at the top.
    Repeat the preceding four selections to configure the new graph.
  id: totrans-128
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 要向同一图表添加多个图表线条，请选择顶部的“添加指标”。重复之前的四个选择以配置新的图表。
- en: To make this graph part of a dashboard for easy reuse, click the Pin to dashboard button at
    the top.
  id: totrans-129
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 若要将此图表作为仪表板的一部分以便于重复使用，请点击顶部的“固定到仪表板”按钮。
- en: Dashboards can then be accessed directly using the menu on the right.
  id: totrans-130
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后可以通过右侧的菜单直接访问仪表板。
- en: Having a graph of a metric, or even multiple graphs in a dashboard, is great
    for investigating issues. However, no one likes to continuously watch dashboards
    to see how things are going. For that reason, it is also possible to configure
    alerts on metrics.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 拥有一个度量的图表，甚至是在仪表板中显示多个图表，对于调查问题非常有帮助。然而，没有人愿意持续关注仪表板以查看进展情况。因此，还可以为度量配置警报。
- en: Alerting on metrics
  id: totrans-132
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 对度量进行警报
- en: Just as with log entries, it is possible to be alerted by Azure Monitor when
    a metric goes above or below a certain threshold. Log entries that require a follow
    up could be related to only a single user or customer that is having trouble.
    Metrics, on the other hand, are useful for detecting situations where all users
    are impacted by an issue, or situations where infrastructure no longer works or
    will stop working soon.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 与日志条目类似，当一个度量值超过或低于某个阈值时，Azure Monitor 也可以发出警报。需要跟进的日志条目可能与某个单一用户或客户有关，他们遇到问题。而度量值则有助于检测所有用户受到影响的情况，或基础设施无法正常工作或即将停止工作的情况。
- en: 'Creating alerts for metrics works in a way that is very similar to creating
    alerts from logs. To create a new alert rule, navigate to Azure Monitor using
    the portal and then choose Alerts. Next, click on the New Alert Rule button to
    open the view shown in the following screenshot:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 为度量创建警报的过程与从日志创建警报的过程非常相似。要创建新的警报规则，请使用门户导航到 Azure Monitor，然后选择“警报”（Alerts）。接下来，点击“新建警报规则”按钮，打开如下所示的视图：
- en: '![](img/f5f81d34-9588-4b27-b86c-f8e8bed53dc1.png)'
  id: totrans-135
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f5f81d34-9588-4b27-b86c-f8e8bed53dc1.png)'
- en: 'In this screenshot, the following selections have to be made to create an alert
    on a metric:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 在此截图中，必须进行以下选择才能对度量创建警报：
- en: Select the resource that is the subject for the alert. This can be any type
    of resource that outputs metrics—in this instance, an Application Insights workspace
    has been selected.
  id: totrans-137
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择作为警报主体的资源。这可以是任何类型的输出度量值的资源——在此实例中，已选择一个 Application Insights 工作区。
- en: 'Configure the condition to raise the alert under. For this, a new window opens
    on the right. To get to the view in the preceding screenshot, select a Metric
    alert type and from the list that populates, choose the correct alert. Next, the
    view changes to what is shown in the preceding screenshot. Here, the following
    selections must be made:'
  id: totrans-138
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 配置触发警报的条件。为此，会在右侧打开一个新窗口。要进入前面截图中显示的视图，选择度量警报类型，并从填充的列表中选择正确的警报。接下来，视图将更改为前面截图中显示的内容。在这里，必须进行以下选择：
- en: Select the threshold for the alert to raise (refer to 2a in the previous screenshot).
    Static thresholds are the default and require the configuration of an operator,
    aggregation type, and value.
  id: totrans-139
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 选择触发警报的阈值（参见前面截图中的2a）。静态阈值是默认设置，需要配置操作符、聚合类型和值。
- en: Pick the granularity interval that the alert should be evaluated over (2b).
  id: totrans-140
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 选择警报应评估的粒度间隔（2b）。
- en: Pick the frequency of evaluation (2c). The more often an alert is evaluated,
    the shorter the delay between an occurrence and the alert that is sent out.
  id: totrans-141
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 选择评估频率（2c）。警报评估得越频繁，发生事件与发送警报之间的延迟就越短。
- en: Save the alert condition (2d).
  id: totrans-142
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 保存警报条件（2d）。
- en: Select one or more action groups that need to be triggered when the alert condition
    has been met.
  id: totrans-143
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择一个或多个在满足警报条件时需要触发的操作组。
- en: Configure an alert rule name and description.
  id: totrans-144
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 配置警报规则名称和描述。
- en: Save the alert.
  id: totrans-145
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 保存警报。
- en: The alert becomes active within minutes after saving. Now, whenever an alert
    condition is met, the developers are notified using the methods configured in
    the alert group.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 警报在保存后几分钟内变为活动。现在，每当满足警报条件时，开发人员将通过配置的警报组方法收到通知。
- en: Investigating requests
  id: totrans-147
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 调查请求
- en: When using Application Insights for logging and metrics, there are many more
    built-in capabilities of Application Insights that you can use. One of these capabilities
    is the possibility to execute search queries against all types of data collected
    by Application Insights from one view, called Search.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 在使用 Application Insights 进行日志记录和度量时，Application Insights 还提供了许多内置的功能可供使用。其功能之一是可以通过一个视图——称为“搜索”（Search）——对所有由
    Application Insights 收集的数据执行搜索查询。
- en: 'Here, it is possible to search all the information collected by Application
    Insights, including the following:'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，可以搜索所有由 Application Insights 收集的信息，包括以下内容：
- en: Logs emitted by the application code, which includes NuGet packages and the
    .NET framework.
  id: totrans-150
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 应用程序代码生成的日志，包括 NuGet 包和 .NET 框架。
- en: 'All dependency calls: These are calls to databases and other systems that are
    automatically detected by Application Insights. Application Insights records the
    target system and duration.'
  id: totrans-151
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 所有依赖调用：这些是对数据库和其他系统的调用，Application Insights 会自动检测到。Application Insights 会记录目标系统和持续时间。
- en: 'All exceptions: All exceptions that occur in an application are recorded by
    Application Insights, even if properly handled by the application code.'
  id: totrans-152
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 所有异常：应用程序中发生的所有异常都会被 Application Insights 记录，即使它们已经被应用程序代码正确处理。
- en: 'Requests: Every user request that comes in over HTTP is logged. Important properties,
    such as the URL, duration, and HTTP verb, are also included.'
  id: totrans-153
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 请求：所有通过 HTTP 进入的用户请求都会被记录。重要的属性，如 URL、持续时间和 HTTP 方法，也会被包括在内。
- en: 'To open the search view, navigate to the correct Application Insights instance
    and navigate to the Search tab (1) to get the view shown in the following screenshot:'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 要打开搜索视图，请导航到正确的 Application Insights 实例，然后转到搜索标签（1），以获得以下截图所示的视图：
- en: '![](img/90ab0619-d7cc-45c4-8584-51e9628f9335.png)'
  id: totrans-155
  prefs: []
  type: TYPE_IMG
  zh: '![](img/90ab0619-d7cc-45c4-8584-51e9628f9335.png)'
- en: 'In the Search view, several search parameters can be configured (*2*):'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 在搜索视图中，可以配置多个搜索参数（*2*）：
- en: 'An interval to search within: This defaults to the last 24 hours.'
  id: totrans-157
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 搜索的时间间隔：默认为过去24小时。
- en: 'The types of events to search in: This can be requests, log entries, page views,
    exceptions, dependency calls, and more.'
  id: totrans-158
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 搜索的事件类型：可以是请求、日志条目、页面视图、异常、依赖调用等。
- en: Any text to search for.
  id: totrans-159
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 搜索的文本内容。
- en: Within seconds, all matching results are shown in a bar chart. Each bar stands
    for a time period and shows how many matches there are within that time frame.
    Below this chart, all the individual matches are shown. These are a mix of all
    of the types of events available.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 几秒钟内，所有匹配的结果会以条形图形式显示。每个条形代表一个时间段，并显示在该时间段内的匹配次数。此图表下方会显示所有单独的匹配项。这些是所有可用事件类型的混合。
- en: 'Clicking on any of the results opens a new view that shows the selected record
    in relation to all the other types, grouped per request. This allows you to quickly
    navigate to all the logs, dependency calls, and exceptions that are gathered by
    Application Insights during the execution of a single user request. The results
    can be displayed as a list and as a timeline. This allows you to very quickly
    see what the server was doing when performing the user request:'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 点击任何一个结果会打开一个新视图，显示选定记录与所有其他类型的关系，按请求分组。这使你能够快速导航到所有由 Application Insights 在单个用户请求执行期间收集的日志、依赖调用和异常。结果可以以列表和时间轴的形式显示。这使你能够非常快速地查看在执行用户请求时，服务器所做的操作：
- en: '![](img/d38bddfb-25c8-4d85-bccb-5b6de1b664ad.png)'
  id: totrans-162
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d38bddfb-25c8-4d85-bccb-5b6de1b664ad.png)'
- en: With all of these means to investigate applications and be notified regarding
    events, it is important to decide which alerts to create and which not to, not
    only in order to create a healthy working environment, but also to balance monitoring
    with new work. This is the topic of the next section.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 通过这些调查应用程序和接收事件通知的方式，决定创建哪些警报、哪些不创建非常重要，这不仅是为了创建一个健康的工作环境，还为了在监控和新工作的平衡中找到合适的点。这是下节的主题。
- en: Optimizing alerting
  id: totrans-164
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 优化警报
- en: Once teams start instrumenting their applications and adding alerts to metrics
    that they find important, it will not be long before the first alerts start coming
    in. At this point, it is important to not only respond to the alerts, but also
    to investigate them and then close the alert. Alerts should also be evaluated
    and viewed as an opportunity for learning.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦团队开始为其应用程序添加指标和警报，并且关注他们认为重要的指标，警报很快就会开始出现。在此时，重要的不是仅仅响应警报，而是要调查警报并关闭它们。警报还应该被视为学习的机会。
- en: Optimizing alerts
  id: totrans-166
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 优化警报设置
- en: 'An important thing to do after creating a series of alerts is to re-evaluate
    them on a regular basis. Two things that might come out of an evaluation such
    as this are as follows:'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 创建一系列警报后，重要的步骤是定期重新评估它们。通过这样的评估，可能得出以下两种结论：
- en: '**Changes in the alerting threshold**: Evaluating alerts regularly involves
    taking a look at the metric over time and seeing where the alerting threshold
    is at now. This might lead to the conclusion that the threshold is too low or
    too high.'
  id: totrans-168
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**警报阈值的变化**：定期评估警报涉及查看一段时间内的指标，并检查警报阈值目前的位置。这可能导致结论认为阈值过低或过高。'
- en: '**Removing duplicates**: Looking at alerts that have been raised over the month(s),
    it is very likely to identify one or more groups of alerts that are always raised
    at the same time. For example, a set of alerts set on a specific web server can
    be so related that they are always raised at the same time. A common example is
    the CPU usage and the average response time for an HTTP request; these two often
    rise at the same time. If this is the case, it is worth considering either removing
    one of them or downgrading one of them to be a warning only. Duplicate alerts
    increase the number of items that need an immediate reaction, leading to increased
    pressure on the team without a clear benefit.'
  id: totrans-169
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**去除重复**：查看一个月内已触发的警报，很可能会发现一组或多组警报总是同时触发。例如，某个特定Web服务器上设置的一组警报可能是如此相关，它们总是在同一时间触发。一个常见的例子是CPU使用率和HTTP请求的平均响应时间；这两个指标通常会同时上升。如果是这种情况，值得考虑去除其中一个警报，或者将其中一个警报降级为仅为警告。重复的警报增加了需要立即响应的事项数量，导致团队在没有明确好处的情况下承受更大的压力。'
- en: Constantly optimizing the set of alerts not only helps to reduce waste, but
    also prevents so-called alert fatigue.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 不断优化警报集不仅有助于减少浪费，还能防止所谓的警报疲劳。
- en: Alert fatigue
  id: totrans-171
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 警报疲劳
- en: If alert rules are not constantly reviewed and updated, they could negatively
    influence a team, especially when alert rules trigger too easily or too frequently
    as people will no longer respond to them properly. If there are too many alerts,
    it will wear people out and they will become numb to the effect of an alert. It
    does not even matter whether these are false alerts or real alerts; just the number
    of alerts can be enough to get people into a state where they do not care anymore.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 如果警报规则没有持续进行审查和更新，它们可能会对团队产生负面影响，特别是当警报规则触发过于容易或过于频繁时，人员将不再正确响应这些警报。如果警报数量过多，会使人感到疲惫，变得对警报麻木。无论这些警报是虚假的还是实际的，警报的数量足以让人们进入一种不再关心的状态。
- en: If a situation such as this is observed within a team, it is time to drastically
    change the way alerts are generated and responded to. If this does not happen,
    team members might fall ill or leave the company altogether.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 如果在团队中观察到这种情况，就该彻底改变警报的生成和响应方式。如果不这样做，团队成员可能会生病或完全离开公司。
- en: One of the ways to prevent this situation is by implementing a healthy on-call
    schedule.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 防止这种情况的一种方法是实施一个健康的值班计划。
- en: Which metrics to capture
  id: totrans-175
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 要捕获哪些指标
- en: 'One question that comes up frequently when talking about metrics is about what
    metrics to emit and monitor. There are many possible metrics and even more opinions
    on this subject. As a good starting point, the following metrics are often gathered
    for web applications:'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 在讨论指标时，一个常见的问题是应该发出和监控哪些指标。这里有许多可能的指标，以及更多关于此主题的不同看法。作为一个好的起点，通常会收集以下Web应用程序的指标：
- en: 'Requests per minute, transactions per minute, or something similar: This is
    a metric that is intended to capture the current load or throughput on a web application.'
  id: totrans-177
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 每分钟请求数、每分钟事务数或类似指标：这是用来捕捉Web应用程序当前负载或吞吐量的度量标准。
- en: 'The average response time: This metric captures the response time for all requests
    within a time window.'
  id: totrans-178
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 平均响应时间：这个度量标准捕捉的是在某一时间窗口内所有请求的响应时间。
- en: 'The error rate: This metric captures the percentage of all requests that result
    in an error. As a guideline for an error, often, all HTTP response codes of `400`
    and up are taken.'
  id: totrans-179
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 错误率：这个度量标准捕捉的是所有请求中导致错误的百分比。作为错误的指导标准，通常将所有`400`及以上的HTTP响应码视为错误。
- en: 'When these three metrics are captured and graphed together in one graph, they
    provide the first step toward understanding the behavior of an application. Let''s
    explore a few examples:'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 当这三个指标一起被捕获并绘制在同一图表中时，它们为理解应用程序行为提供了第一步。让我们看几个例子：
- en: When the average response time goes up but the throughput (requests per minute)
    stays the same, this might be an indication that the infrastructure that hosts
    the application is having issues.
  id: totrans-181
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当平均响应时间上升，但吞吐量（每分钟请求数）保持不变时，这可能表明承载应用程序的基础设施出现了问题。
- en: When both the throughput and the average response times go up, this might be
    an indication that traffic is increasing and that the current infrastructure is
    not capable of sustaining that throughput at the same response times.
  id: totrans-182
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当吞吐量和平均响应时间同时上升时，这可能意味着流量正在增加，当前的基础设施无法在相同的响应时间下支持这种吞吐量。
- en: When the error rate goes up but the other metrics stay the same, this might
    be an indication that a deployment has gone wrong or that a specific code path
    is starting to generate (more) errors.
  id: totrans-183
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当错误率上升，但其他指标保持不变时，这可能意味着部署出现问题，或者某个特定的代码路径开始生成（更多）错误。
- en: Of course, these are just examples and there are many more possible scenarios.
    Other metrics can help to rule out a specific scenario or try to avoid them. For
    example, also starting to monitor the database load as a percentage can help detect
    a specific instance of the second scenario. If the database load gets close to
    100%, it might be time to scale the database up to a higher performance tier to
    help to sustain the higher throughput at the same response times as before.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，这些只是一些示例，还有许多可能的场景。其他指标可以帮助排除特定的场景或尽量避免它们。例如，开始监控数据库负载百分比也可以帮助检测第二种场景的特定实例。如果数据库负载接近100%，可能是时候将数据库升级到更高性能的层级，以维持相同响应时间下的更高吞吐量。
- en: To conclude this section, there is one final recommendation—when starting with
    monitoring, there is often a tendency to focus on the systems that host the application.
    As an alternative, also consider monitoring metrics that have a direct business
    impact or metrics that are an indication of user satisfaction in terms of the
    usability of an application. This comes much closer to measuring business value
    than when only you watch systems.
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 总结这一部分内容时，最后有一个建议——在开始监控时，往往会倾向于关注托管应用程序的系统。作为替代方案，还应考虑监控那些对业务产生直接影响的指标，或者是能够反映用户在应用程序可用性方面满意度的指标。这比仅仅关注系统要更接近衡量业务价值。
- en: 'Some examples of this are as follows:'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是一些示例：
- en: In an online shop, the number of books sold per minute can be a very valuable
    business metric. Just imagine the impact it can have on a business if this metric
    is available in near real time using Azure Monitor and custom metrics from the
    application code.
  id: totrans-187
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在在线商店中，每分钟售出的书籍数量可以是一个非常有价值的商业指标。试想一下，如果能够通过 Azure Monitor 和应用程序代码中的自定义指标实时获取这个指标，将会对业务产生什么样的影响。
- en: For an online reading platform, the number of virtual page turns can be a valuable
    metric that signals whether users are happily working with the service. As soon
    as this number sees a sharp drop or rapidly increases, this might be an indication
    that something is going wrong.
  id: totrans-188
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于在线阅读平台，虚拟翻页的数量可以是一个有价值的指标，表明用户是否愉快地使用该服务。只要这个数字出现急剧下降或迅速增加，可能就表明出现了问题。
- en: To find out which metrics make sense in a given scenario, it might help to talk
    to the business or subject matter experts.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 要找出在特定场景下哪些指标有意义，可能有助于与业务或领域专家进行沟通。
- en: Having an on-call schedule
  id: totrans-190
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 制定值班计划
- en: Once alerts are configured and start to be raised, it does not make sense to
    configure them to not trigger before 8 AM and after 5 PM. In other words, it is
    necessary to make sure that alerts of a certain severity are followed up even
    outside of business hours.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦配置了警报并开始触发，就没有必要设置警报在早上8点之前或下午5点之后不触发。换句话说，必须确保某些严重性的警报即使在办公时间之外也能得到跟进。
- en: In many companies where having alerts is new, there is some form of implicit
    expectation that some people will be available outside of office hours (alongside
    their regular duties) to handle these alerts. Sometimes, when an alert is raised
    only once or twice a year, and there are no agreements about response times, this
    might not even be a problem at all.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 在许多公司中，警报机制还是新鲜事物，因此隐性地期望某些人在办公时间外（除了他们的常规职责）可以处理这些警报。有时，当警报每年只触发一两次，且没有关于响应时间的约定时，这可能根本不会成为问题。
- en: However, in many organizations—especially over time—there is an expectation
    that these alerts are responded to within a certain period of time. Besides that,
    the number of alerts may increase as systems become larger and more complex or
    the number of systems grows.
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，在许多组织中——尤其是随着时间的推移——人们通常期望在一定的时间范围内对这些警报作出响应。除此之外，随着系统的规模变大、复杂性增加，或者系统数量的增长，警报的数量也可能会增加。
- en: The way to cope with this is by creating an on-call schedule and formal agreements
    on what is expected of engineers and how the organization will reward them for
    their efforts. This allows them to set clear expectations and allows engineers
    to guard their free time based on these agreements. Having enough downtime helps
    the engineers relax between periods of higher stress. This allows them to stay
    alert when they are on call, ready to react when this is expected of them.
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 应对这一问题的方式是制定值班计划，并与工程师达成正式协议，明确他们的职责以及组织将如何奖励他们的付出。这使得工程师能够设定清晰的期望，并根据这些协议保护自己的自由时间。足够的休息时间有助于工程师在高压期间得到放松，这样他们才能在值班时保持警觉，随时准备应对预期的任务。
- en: 'There is much material available on what constitutes a healthy on-call schedule
    and what doesn''t, and the keyword here is *healthy*. Some general pointers are
    as follows:'
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 有很多关于什么构成健康值班计划的资料，关键字是*健康*。一些基本建议如下：
- en: Those who are on call during non-business hours should not be on call during
    business hours as well.
  id: totrans-196
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在非工作时间值班的员工，不应在工作时间继续值班。
- en: Provide engineers who are on call with reasonable compensation for being close
    to a phone, not under the influence, and so on. What is reasonable differs from
    situation to situation, but the more demanding being on call is, the higher the
    compensation should be.
  id: totrans-197
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为值班工程师提供合理的补偿，考虑他们保持电话畅通、避免受影响等情况。什么是合理的补偿因情况而异，但值班的要求越高，补偿应该越高。
- en: Provide the proper tools for being on call. For example, when a response time
    of 30 minutes or less is expected, provide those on call with a backpack with
    a laptop, phone, and means to connect to the internet.
  id: totrans-198
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为值班人员提供合适的工具。例如，当响应时间要求为 30 分钟或更短时，给值班人员配备一个背包，里面放有笔记本电脑、电话和连接互联网的设备。
- en: Ensure that every employee is not on call at least 75% of the time.
  id: totrans-199
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 确保每位员工的值班时间不超过至少 75%。
- en: Allow employees to take time off in lieu, so they can be late for work if they
    had to respond to an alert overnight.
  id: totrans-200
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 允许员工以调休的形式休假，这样如果他们需要在夜间响应警报，可以晚点上班。
- en: After every disturbance of the normal operation of a system, whether this is
    during business hours or after, a live site incident review can be performed to
    learn what happened and how to reduce the chance of it happening again.
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 每当系统的正常运行受到干扰时，无论是工作时间还是非工作时间，都可以进行实时站点事件回顾，以了解发生了什么以及如何减少再次发生的可能性。
- en: Live site reviews
  id: totrans-202
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 实时站点回顾
- en: 'After an alert is triggered and the team has responded and remediated the situation,
    it is time to evaluate what happened. This is called a live site incident review.
    Here, the whole team gathers to address the following:'
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 在警报触发并且团队已响应并解决问题后，是时候评估发生了什么了。这就是所谓的实时站点事件回顾。在这里，整个团队会聚集在一起，讨论以下内容：
- en: What happened—to start, a timeline should be constructed from the time the incident
    was discovered to the point that normal operations were restored. Next, the timeline
    is expanded with the events that led to the situation that triggered the incident.
  id: totrans-204
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 发生了什么——首先，应该构建一个时间线，从发现事件的时刻到恢复正常操作为止。接着，时间线会扩展，加入导致触发事件的前因后果。
- en: Next, the series of events is evaluated to learn what worked well in the response.
    If one member of the team used a new tool to quickly diagnose a problem, this
    can benefit other members of the team as well.
  id: totrans-205
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，评估一系列事件，了解响应过程中哪些做得好。如果团队的某个成员使用了一个新工具快速诊断问题，这也能对团队其他成员产生帮助。
- en: Only then is it time to look at the possible points of improvement and translate
    these points into high-priority work for the team. Possible fail-safes are identified
    and scheduled for implementation or new alerts are identified that send an alert
    before a similar problem occurs again.
  id: totrans-206
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 只有在此之后，才是审视可能改进的地方，并将这些改进点转化为团队的高优先级工作。识别出可能的安全保障措施，并安排实施，或者识别新的警报机制，在类似问题发生之前就能发出警报。
- en: The alert or group of alerts that triggered the initial response is evaluated
    to determine whether they are adequate or possibly contain duplicates.
  id: totrans-207
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 触发初始响应的警报或一组警报被评估，以确定它们是否足够充分，或者是否可能包含重复内容。
- en: The best time for a live site incident review is as soon after the incident
    itself as possible. In practice, this means giving everyone enough time to rest
    and recuperate and plan a meeting for the next business day.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 实时站点事件回顾的最佳时间是尽可能接近事件发生的时间。实际上，这意味着要给每个人足够的时间休息和恢复，并计划安排在下一个工作日进行会议。
- en: This completes our overview of Application Insights and the Azure Monitor capabilities
    for instrumenting web applications. The following section describes several approaches
    for integrating Application Insights and Azure Monitor with other tools.
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 这完成了我们对 Application Insights 和 Azure Monitor 在监控网络应用程序时功能的概述。下一节将介绍几种将 Application
    Insights 和 Azure Monitor 与其他工具集成的方法。
- en: Integrating with other tools
  id: totrans-210
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 与其他工具的集成
- en: Azure Monitor and Application Insights are excellent tools for gathering application
    logs and metrics, as well as storing them and making them searchable. However,
    there could be reasons why development teams or businesses prefer to work with
    other tools to visualize application performance or responding to alerts. One
    important driver for integration is often the primary tool used by a person or
    team. If a team operates mainly in ServiceNow or Grafana, it is often useful to
    integrate these with Azure Monitor instead of forcing these teams to work with
    multiple tools.
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: Azure Monitor 和 Application Insights 是收集应用程序日志和指标的优秀工具，同时还可以存储这些数据并进行搜索。然而，开发团队或企业可能有一些原因偏好使用其他工具来可视化应用程序性能或响应警报。一个重要的整合驱动因素通常是一个人或团队使用的主要工具。如果一个团队主要在
    ServiceNow 或 Grafana 中操作，那么将这些工具与 Azure Monitor 集成通常更为有用，而不是强迫这些团队使用多个工具。
- en: Many possible integrations exist; some examples are detailed in the following
    subsections.
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 存在许多可能的集成，以下小节中详细介绍了一些例子。
- en: IT service management applications
  id: totrans-213
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: IT 服务管理应用程序
- en: Action groups were introduced in the previous section where we looked at instrumenting
    web applications. Action groups are groups of actions to be performed in response
    to an alert.
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 在前一节中我们介绍了操作组，并讨论了如何在网络应用程序中进行监控。操作组是响应警报时执行的一组操作。
- en: Next to the rich built-in capabilities, it is also possible to automatically
    raise an alert in an existing **IT Service Management** (**ITSM**) solution. If
    there is already an ITSM solution in place within a company, it makes sense not
    to create a separate alerting channel using Azure Monitor. Instead, using an ITSM
    connector from Azure Monitor allows you to manage all the company-wide alerts
    from one solution.
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 除了丰富的内置功能外，还可以在现有的**IT服务管理**（**ITSM**）解决方案中自动触发警报。如果公司内已经有 ITSM 解决方案，那么通过 Azure
    Monitor 创建一个单独的警报通道并不合适。相反，使用 Azure Monitor 的 ITSM 连接器可以让你从一个解决方案中管理公司范围内的所有警报。
- en: Currently, there are integrations available with ServiceNow, Provance, System
    Center Service Manager, and more. These connections are created through the ITSM
    connector.
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 当前，ServiceNow、Provance、System Center Service Manager 等工具已有可用的集成。这些连接通过 ITSM
    连接器创建。
- en: Azure Boards
  id: totrans-217
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Azure Boards
- en: In many development teams, Azure DevOps is the tool that developers spend most
    of their time with. This is also where they perform their backlog management using
    Azure Boards.
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 在许多开发团队中，Azure DevOps 是开发人员花费大部分时间使用的工具。这也是他们通过 Azure Boards 执行待办事项管理的地方。
- en: Meanwhile, operators (and hopefully, developers, too) perform investigative
    work in Application Insights to determine the cause of user errors and to drill
    down into the reasons for failure. This investigative work could result in new
    work that needs to be backlogged in Azure DevOps.
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 同时，操作员（希望开发人员也能参与）在 Application Insights 中进行调查工作，以确定用户错误的原因，并深入分析失败的原因。这项调查工作可能会导致需要在
    Azure DevOps 中回溯的任务。
- en: 'To facilitate this, integration between Application Insights and Azure DevOps
    can be configured from Application Insights by taking the following steps:'
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 为了简化操作，可以通过以下步骤从 Application Insights 配置与 Azure DevOps 的集成：
- en: 'Navigate to the Work Items option on the left-hand side menu (1). This opens
    the view shown on the left in the following screenshot. Here, a connection to
    Azure Boards can be configured:'
  id: totrans-221
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到左侧菜单中的工作项选项（1）。这将打开下图所示的视图。在这里，可以配置与 Azure Boards 的连接：
- en: '![](img/88cc179b-182f-4fee-8030-7b2a2c4b411e.png)'
  id: totrans-222
  prefs: []
  type: TYPE_IMG
  zh: '![](img/88cc179b-182f-4fee-8030-7b2a2c4b411e.png)'
- en: 'To configure the connection, the following details need to be filled out:'
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 要配置连接，必须填写以下详细信息：
- en: Enter the Azure DevOps link. Here, the name of the organization needs to be
    appended.
  id: totrans-224
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入 Azure DevOps 链接。此时需要附加上组织的名称。
- en: Select the Azure DevOps project to use. This can be selected from the dropdown.
  id: totrans-225
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择要使用的 Azure DevOps 项目。可以从下拉菜单中选择。
- en: Select a product area where new items will be created. By default, this is the
    same as the name of the project, unless you change it.
  id: totrans-226
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择一个产品区域，在该区域中将创建新的项目项。默认情况下，这是与项目名称相同，除非你更改它。
- en: Provide the name of a user as the default owner of new work items.
  id: totrans-227
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为新的工作项提供一个用户名称，作为默认所有者。
- en: After configuring this connection, a new Create work item button is visible
    on the relevant pages in Application Insights. This button allows you to create
    a bug with all the relevant information directly on the backlog.
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 配置此连接后，在Application Insights的相关页面上会显示一个新的“创建工作项”按钮。此按钮允许您直接在待办事项列表中创建一个包含所有相关信息的缺陷。
- en: Grafana
  id: totrans-229
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Grafana
- en: Azure Monitor allows you to build simple, easy-to-use dashboards. The advantage
    of using Azure Monitor dashboards is that they integrate perfectly with all the
    other Azure practices, such as **Role-Based Access Controls** (**RBAC**) and Azure
    Resource Manager templates.
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: Azure Monitor允许您构建简单、易用的仪表板。使用Azure Monitor仪表板的优势在于，它们与所有其他Azure实践（例如**基于角色的访问控制**（**RBAC**）和Azure资源管理器模板）完美集成。
- en: However, teams may have already adopted other tools for visualization, such
    as Grafana. Grafana is a well-known platform that works well for operational dashboards.
    Grafana can be configured to connect using Azure Monitor and can query metrics
    for graphing. Grafana also has alerting capabilities. It does not, however, support
    querying logs.
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，团队可能已经采用了其他可视化工具，如Grafana。Grafana是一个广受欢迎的平台，非常适合用于操作仪表板。Grafana可以配置为通过Azure
    Monitor进行连接，并查询指标以生成图表。Grafana还具有告警功能，但不支持查询日志。
- en: 'To connect Grafana to Azure Monitor, the following steps need to be taken:'
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 要将Grafana连接到Azure Monitor，需要执行以下步骤：
- en: Create a new app registration in the Azure Active Directory account that is
    used by your Azure subscription. Take note of the Tenant Id, Client Id, Subscription
    Id, and Client Secret properties of this app registration.
  id: totrans-233
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在您的Azure订阅使用的Azure Active Directory帐户中创建一个新的应用注册。记下该应用注册的**Tenant Id**、**Client
    Id**、**Subscription Id**和**Client Secret**属性。
- en: Create a new RBAC role assignment for the app registration, with at least the Reader
    permissions set on the resources to monitor.
  id: totrans-234
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为应用注册创建新的RBAC角色分配，并为要监控的资源至少设置**Reader**权限。
- en: Configure a new data source in Grafana of the Azure Monitor type. Insert the
    properties collected in *step 1* for authenticating to Azure.
  id: totrans-235
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在Grafana中配置一个新的Azure Monitor类型的数据源。插入在*第1步*中收集的用于Azure身份验证的属性。
- en: Add a new graph to the dashboard, selecting Azure Monitor as a data source.
  id: totrans-236
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 向仪表板添加一个新的图表，选择Azure Monitor作为数据源。
- en: By taking the preceding steps, a Grafana-to-Azure Monitor connection can be
    set up within a matter of minutes.
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 通过执行上述步骤，可以在几分钟内设置Grafana与Azure Monitor的连接。
- en: Summary
  id: totrans-238
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: In this chapter, you learned how to start completing the DevOps loop. You also
    learned how to work with crash reports and gather them from all types of applications,
    as well as how to instrument web applications. You now know how to use Application
    Insights to centralize logs and metrics and to get insight into requests and dependency
    calls. You also learned how you can integrate Azure Monitor with other tools to
    further streamline your development processes.
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，您学习了如何开始完成DevOps循环。您还学会了如何处理崩溃报告，并从各种应用程序中收集它们，以及如何为Web应用程序添加监控代码。您现在知道如何使用Application
    Insights集中日志和指标，并深入了解请求和依赖调用。您还学会了如何将Azure Monitor与其他工具集成，以进一步简化您的开发过程。
- en: With this knowledge, you can now start learning about how your applications
    operate in production. By doing so, you can not only deliver your software faster
    but also learn from its usage and start improving from there.
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 通过这些知识，您现在可以开始了解您的应用程序如何在生产环境中运行。通过这样做，您不仅可以更快地交付软件，还可以从使用中学习并从中进行改进。
- en: In the next chapter, you will learn about gathering user feedback to complement
    what you have learned from your system logs and metrics. You will also learn how
    to measure the end user satisfaction of your application and new features.
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，您将学习如何收集用户反馈，以补充从系统日志和指标中学到的内容。您还将学习如何衡量应用程序和新功能的最终用户满意度。
- en: Questions
  id: totrans-242
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 问题
- en: 'As we conclude, here is a list of questions for you to test your knowledge
    regarding this chapter''s material. You will find the answers in the *Assessments*
    section of the Appendix:'
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们总结时，这里有一系列问题供您测试对本章内容的理解。您可以在附录的*评估*部分找到答案：
- en: True or false – it is possible to capture custom metrics from the Azure platform
    offerings using Application Insights.
  id: totrans-244
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 判断正误——是否可以使用Application Insights捕获Azure平台提供的自定义指标？
- en: How long are platform metrics retained for in Azure Monitor?
  id: totrans-245
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Azure Monitor中平台指标的保留时间是多少？
- en: True or false – it is possible to capture custom metrics from your own application
    code using Application Insights.
  id: totrans-246
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 判断题 – 使用 Application Insights 可以从您自己的应用程序代码中捕获自定义指标。
- en: What do you call a situation where engineers start ignoring alerts as they are
    worn down by too many of them?
  id: totrans-247
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你怎么称呼工程师因为警报过多而开始忽视警报的情况？
- en: True or false – it is possible to call a webhook when an alert fires in Azure.
  id: totrans-248
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 判断题 – 在 Azure 中，触发警报时可以调用 webhook。
- en: Further reading
  id: totrans-249
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 进一步阅读
- en: More information about the App Center SDK can be found at [https://docs.microsoft.com/en-us/appcenter/sdk/](https://docs.microsoft.com/en-us/appcenter/sdk/).
  id: totrans-250
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 有关 App Center SDK 的更多信息可以在[https://docs.microsoft.com/en-us/appcenter/sdk/](https://docs.microsoft.com/en-us/appcenter/sdk/)找到。
- en: More information on Raygun can be found at [https://raygun.com](https://raygun.com).
  id: totrans-251
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 关于 Raygun 的更多信息可以在[https://raygun.com](https://raygun.com)找到。
- en: A complete example application that uses Application Insights and Azure Monitor
    is available at [https://github.com/henrybeen/MonitoringLogging.UrlShortnerDemo2](https://github.com/henrybeen/MonitoringLogging.UrlShortnerDemo2).
  id: totrans-252
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个完整的示例应用程序，使用了 Application Insights 和 Azure Monitor，可以在[https://github.com/henrybeen/MonitoringLogging.UrlShortnerDemo2](https://github.com/henrybeen/MonitoringLogging.UrlShortnerDemo2)找到。
- en: More detailed information on configuring Application Insights is available at
    [https://docs.microsoft.com/en-us/azure/azure-monitor/app/app-insights-overview](https://docs.microsoft.com/en-us/azure/azure-monitor/app/app-insights-overview).
  id: totrans-253
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 关于配置 Application Insights 的更多详细信息可以在[https://docs.microsoft.com/en-us/azure/azure-monitor/app/app-insights-overview](https://docs.microsoft.com/en-us/azure/azure-monitor/app/app-insights-overview)找到。
- en: The KQL reference page can be found at [https://docs.microsoft.com/en-us/sharepoint/dev/general-development/keyword-query-language-kql-syntax-reference](https://docs.microsoft.com/en-us/sharepoint/dev/general-development/keyword-query-language-kql-syntax-reference).
  id: totrans-254
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: KQL 参考页面可以在[https://docs.microsoft.com/en-us/sharepoint/dev/general-development/keyword-query-language-kql-syntax-reference](https://docs.microsoft.com/en-us/sharepoint/dev/general-development/keyword-query-language-kql-syntax-reference)找到。
