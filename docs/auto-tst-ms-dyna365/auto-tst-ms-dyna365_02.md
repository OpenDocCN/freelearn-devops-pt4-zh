# 自动化测试简介

最终，我得到了一个关于写一本关于应用测试自动化的书的同意——这是我多年来一直想写的书，因为自动化测试似乎对很多人来说并不是*一见钟情*的话题。而且，像测试一样，在许多实现中，它往往是从属于需求规格和应用程序编码的，不论是项目还是产品。说实话，谁真正喜欢测试呢？这通常不是普通开发者热衷的事情。在我进行的许多自动化测试研讨会中，当我提出这个问题时，往往需要一些时间，功能顾问才会举手。

不可避免地，我问自己：我喜欢测试吗？我的答案是：是的，强烈的 YES。这接着引发了一些额外的问题，比如：是什么让我喜欢测试？我一直都喜欢测试吗？为什么我喜欢它，而其他人似乎不喜欢呢？这些问题的答案让我环游世界，宣扬测试自动化，固执地分享我的发现，并推动微软改进测试，使其变得更好、更可复用。这一切，都是因为我认为这很有趣——非常有趣！

曾在微软前任 Dynamics NAV **全球开发本地化** (**GDL**) 团队担任应用测试员的我，当然接触过测试的“病毒”。可以说，我必须学习如何进行测试，因为这是我的工作，而我也因此获得报酬。但这项工作对我来说也非常适合，显然我有一种特定的基因，使得我能成为一名测试员。喜欢打破*东西*，同时又喜欢证明它的健壮性——希望如此。最重要的是，敢于打破它，冒着开发者可能再也不喜欢你的风险。

在微软的一个下午，我的开发团队成员走进了我们的办公室，停在我的桌旁。他个子非常高，而我坐着，我不得不抬起头才能看见他。

“怎么了？”我问道。

“你不喜欢我了吗？”他回答道。

我：？

他：“你不喜欢我了吗？”

我：“不，还是喜欢你。怎么了？”

他：“你拒绝了我的代码，你不喜欢我了吗？”

我： “伙计，我还是喜欢你，但关于你的代码，我的测试显示它似乎没什么用。”

测试不是火箭科学。自动化测试也不是。它只是另一项可以学习的技能。然而，从开发者的角度来看，它需要转变思维方式，用与你习惯的目的完全不同的方式来编写代码。我们都知道，改变往往不是最容易实现的事情。正因如此，在我的研讨会中，参会者达到一定程度的挫败感并不罕见。

应用测试是一种思维方式，并且它也需要大量的纪律——做需要做的事情的纪律：验证功能是否构建正确；验证被测功能是否符合要求；以及在报告和修复 bug 后，执行整个测试过程，反复测试每个新 bug，以确保验证完整。

我倾向于把自己看作一个有纪律的专业人士。我一直是一个非常有纪律的测试员，报告 bug 的频率也很高。但，我总是喜欢做测试吗？你知道的，在那些日子里，我们的所有测试都是手动执行的，每当我找到一个 bug，我的纪律就会在某种程度上受到挑战。想象一下，在修复完一个 bug 后执行第五次测试时，我的内心在怎么想。现在是下午 4 点，我快完成了。早上，我向妻子承诺会按时回家，不管出于什么原因。我们随便选一个原因：我们的结婚纪念日。所以，作为一个有纪律的测试员，我承诺按时回家，下午 4 点，结果……我……又……碰到……一个……bug。知道修复它并重新运行测试至少要花几个小时，你觉得我当时的心情怎么样？没错：二进制。

我有两个选择：

+   报告 bug 会让我加班，至少会让我的妻子非常失望

+   不报告 bug 会让我按时回家，免去很多家庭麻烦

如果当时有自动化测试，选择就会变得非常简单：第一个选择，既没有家庭麻烦，也没有工作上的麻烦。

在本章中，我们将讨论以下主题：

+   为什么选择自动化测试？

+   何时使用自动化测试。

+   什么是自动化测试？

如果你更喜欢先看*什么*，你可能首先想跳到*什么是自动化测试？*

# 为什么选择自动化测试？

直白地说：归根结底，自动化测试可以为你节省很多麻烦。它没有情感，也没有耗时的执行来阻止你（重新）运行测试。只是按下按钮，测试就会自动执行。这是可重现的，快速的，且客观的。

为了澄清，自动化测试是以下内容：

+   容易重现

+   执行速度快

+   其报告是客观的

如果事情真这么简单，那为什么这些年我们在 Dynamics 365 Business Central 的世界里没有一直做这个呢？你可能能列出一些相关的论点，其中最突出的可能是：我们没有时间做这个。或者也许是：谁来为这个付费？

# 为什么不呢？

在详细阐述任何论点之前，让我先列出一个更完整的*为什么不？*列表。我们可以称之为*非自动化测试的理由*：

+   成本太高，会让我们失去竞争力。

+   Dynamics 365 Business Central 平台不支持此功能。

+   客户来做测试，那我们为什么还要费心呢？

+   谁来写测试代码？我们已经很难找到人手了。

+   我们的日常业务没有空闲时间来增加新的学科。

+   项目太多，无法实现测试自动化。

+   微软已经实现了测试自动化，但 Dynamics 365 Business Central 仍然不是无 bug 的。

# 为什么是这样呢？

Dynamics 365 Business Central 不像以前那么简单了，当时它叫做 Navigator、Navision Financials 或 Microsoft Business Solutions—Navision。周围的世界也不再单一。我们的开发实践变得更加规范化，随着这一点，测试自动化的需求几乎出于与*非自动化测试的原因*相同的原因，迫切需要。

+   推动测试向上游发展，节省成本

+   Dynamics 365 Business Central 平台支持测试自动化

+   依赖客户进行测试并不是一个好主意

+   找不到合适的人选？开始自动化你的测试吧

+   测试自动化将释放出更多时间用于日常业务

+   因为测试自动化继续处理不同的项目

+   自动化测试也是代码

# 推动测试向上游发展，节省成本

关于成本，我倾向于说，平均而言，Dynamics 365 Business Central 项目最终会超出预算的 25%，主要是因为上线后修复 bug。我不打算详细讨论由谁来支付这部分费用，但我的经验是，通常是实施伙伴承担。如果假设这是事实，那么数学很简单。如果你最终需要额外花费 25%的费用，为什么不把这笔钱推向上游，在开发阶段进行自动化测试并建立可重用的支持文件呢？

在我 2000 年代在微软工作期间，曾对在产品重大版本开发的不同阶段发现错误的成本进行过研究。如果我的记忆没错的话，研究发现，在发布后发现一个 bug 的成本大约是提前在需求规格阶段发现它的成本的 1000 倍。

把这个转化到**独立软件供应商**（**ISV**）的世界，可能大致是一个低十倍的因素。因此，发现一个 bug 在下游的成本将比在上游发现的成本高出 100 倍。对于一个做一次性项目的**增值经销商**（**VAR**）来说，成本可能再低十倍。不管这些因素是什么，任何上游的支出都比下游更具成本效益，无论是更规范的测试、更好的应用编程、代码检查，还是更详细的需求说明。

请注意，人们常常纠正我，说 25%的比例实际上偏低。

# Dynamics 365 Business Central 平台支持测试自动化

说实话，这个问题不难理解，因为这正是本书的主题。但值得注意的是，平台内部的可测试性框架自 2009 年夏季发布的 2009 SP1 版本起就已经存在。因此，平台已经支持我们构建自动化测试超过九年了。如果我说我们在这段时间里一直处于“沉睡”状态，你觉得奇怪吗？至少，大多数人是这样的。

# 依赖客户进行测试并不是一个好主意

我同意客户可能最了解他们的功能，因此他们是可能的测试者。但你能百分之百地依赖他们的测试不被夹在实施的截止日期之间，并且还要在他们日常工作中的截止日期之间吗？而且，他们的测试将如何为未来更有效的测试工作做出贡献？它的结构性和可重现性如何？

提出这些问题本身就已经回答了这些问题。一般来说，如果你希望改进开发实践，依赖客户进行测试并不是一个好主意。话虽如此，这并不意味着客户不应该被纳入其中；无论如何，应将他们纳入自动化测试的设置过程中。我们稍后会详细阐述这一点。

# 找人很困难——开始自动化你的测试

就在此时，当我写下这些文字时，Dynamics 领域的所有实施合作伙伴都在为找到合适的人才以完成工作而苦恼。请注意，我故意没有在那句话中使用形容词*right*（正确）。我们都面临着这个挑战。即便人力资源充足，实践表明，随着业务的增长，无论是规模还是体量，所使用的资源数量并不会按比例增长。

因此，我们都必须投资改变日常实践，这往往会导致自动化的出现，例如使用 PowerShell 来自动化行政任务，使用 RapidStart 方法来配置新公司。同样，编写自动化测试以使测试工作变得更加轻松和快捷。确实，启动它需要一定的投入，但最终它会节省你的时间。

# 测试自动化将为日常业务释放时间

类似于用相对较少的资源完成工作，测试自动化最终会帮助释放时间来处理日常业务。这需要一定的初期投入，但随着时间的推移，它将带来回报。

当我讨论花时间进行测试自动化时，一个常见的问题是关于应用程序和测试编码所花时间的比例。通常，在微软 Dynamics 365 Business Central 团队中，这是 1:1 的比例，意味着每花一小时进行应用程序编码，就需要花一小时进行测试编码。

# 继续处理不同的项目，因为有了测试自动化

传统的 Dynamics 365 Business Central 实施合作伙伴通常忙于客户的一次性解决方案。因此，他们有专门的团队或顾问负责这些安装，测试与最终用户密切合作，每次测试都给参与者带来显著的负担。试想一下，如果有一个自动化的测试辅助工具，你将如何在业务扩展的同时继续服务这些一次性项目。

在任何主要的开发平台上，比如 Visual Studio，已经有很长一段时间的惯例是，应用程序会附带自动化测试。请注意，越来越多的客户已经意识到这些做法。越来越多的客户会问你为什么不为他们的解决方案提供自动化测试。

每个现有的项目都是一个门槛，拥有大量功能却没有自动化测试。在很多情况下，使用的主要功能是标准的 Dynamics 365 Business Central 功能，对于这些功能，微软自 2016 年起就提供了他们自己的测试。总的来说，最新版本的 Business Central 提供了超过 21,000 个测试。这是一个巨大的数字，你可以利用这一点，快速开始。稍后我们将讨论这些测试以及如何让它们在任何解决方案上运行。

# 自动化测试也是代码

不能否认的是：自动化测试也是代码。而任何一行代码都有一定的几率包含缺陷。

这是否意味着你应该避免进行测试自动化？如果是这样，那听起来就像是避免编码一样。挑战无疑是将测试设计作为需求和需求评审的一部分，像审查应用代码一样审查测试代码，并确保测试总是以适当数量的验证结束，将其纳入源代码管理，从而将缺陷概率控制在最低水平。

很久以前，我看过一部关于这个主题的纪录片，指出研究表明这种概率大约在 2%到 5%之间。具体的概率可能取决于相关开发者的编码技能。

# 更多的论据

还是不确定为什么你应该开始使用测试自动化？你需要更多的论据来在公司内部和向客户推销它吗？

以下是一些论据：

+   没有人喜欢测试

+   降低风险，提高满意度

+   一旦学习曲线过去，它通常会比手动测试更快

+   更短的更新周期

+   需要进行测试自动化

# 没有人喜欢测试

嗯，几乎没有人喜欢。当测试意味着今天、明天、明年反复进行时，它往往会变得令人厌烦，从而影响测试的纪律性。自动化那些让人感到无聊的任务，为更有意义的测试释放时间，在这些测试中，手动工作能够产生更大的影响。

# 降低风险，提高满意度

拥有自动化测试材料使你能够比以往更快速地洞察代码的状态。同时，在建立这些集合的过程中，回归性缺陷和新缺陷的引入将比以往更少。这一切都带来了更低的风险和更高的客户满意度，而你的管理层会喜欢这个。

# 一旦学习曲线过去，它通常会比手动测试更快

学习自动化测试这一新技能肯定需要一段时间，毫无疑问。但一旦掌握，构思和创建自动化测试的速度往往比手动执行要快得多，因为测试通常是彼此的变体。用代码复制粘贴是……嗯……你能用手动测试做到这一点吗？更不用说重新运行这些自动化测试或手动测试了。

# 更短的更新周期

随着敏捷方法和云服务的发展，更新以更短的时间间隔交付已成为常态，留给全面测试的时间更少了。而 Dynamics 365 Business Central 正是这一故事的一部分。如果微软不强制我们这么做，我们的客户会越来越多地向我们提出这一要求。参见前面的讨论。

# 需要进行测试自动化

最后但同样重要的是，这一段对*为什么要进行测试自动化*的讨论，也许是你读这本书的唯一理由：当你准备在*AppSource*上销售你的 Dynamics 365 Business Central 扩展时，微软要求进行自动化测试。这对我来说也是一个绝佳机会，可以与您分享我对讲学、举办研讨会、写这本书的激情。

说正经的，这是我们大家的一个巨大机会。是的，我们面临压力，但我们在这个话题上徘徊太久了。现在，让我们开始吧。

# 灵丹妙药？

然而，你或许有理由怀疑，测试自动化是否真的是解决一切问题的灵丹妙药。我不能否认这一点。然而，我可以告诉你，如果操作得当，它肯定会提高你开发工作的质量。如前所述，它具有以下优点：

+   易于重现

+   执行速度快

+   客观的报告

# 何时使用自动化测试

这些理由大概足以说服你为什么要使用自动化测试了吧。那么，*何时*使用它们呢？理想情况下，应该是在每次代码更改时，测试已经经过测试的功能是否仍然正常工作，以确保最近的修改不会影响现有的应用程序。

听起来很有道理，但如果没有自动化测试，这意味着什么呢？你该如何开始创建你的第一个自动化测试？基本上，我建议你使用以下两个标准：

+   哪种代码更改会在创建自动化测试时带来最高的投资回报率？

+   哪种代码更改会让你的测试自动化创建最能提升测试编码技能？

使用这两个标准，以下类型的代码更改通常是你首次尝试的理想候选：

+   上线后修复漏洞

+   有缺陷的代码

+   经常修改的代码

+   业务关键代码被更改

+   现有代码的重构

+   新功能开发

+   微软更新

# 上线后修复漏洞

上线后的缺陷揭示了初步测试工作中的遗漏，这种遗漏通常可以追溯到需求中的缺陷。它通常具有有限的范围，且不容忽视的是，清晰的重现场景。无论如何，这类缺陷应当防止再次出现。

# 有缺陷的代码

你有一个功能总是让你和客户感到烦恼。这个代码总是不断地出现缺陷，似乎永远也不会停止。你应该首先从*上线后的缺陷修复*方法入手，如前所述。但更重要的是，利用这些代码第一次创建一个完整的测试套件。

缺陷是一个特别有用的起点，因为它们通常会提供以下信息：

+   明确定义的期望

+   重现场景的步骤

+   清晰的代码失败定义

# 经常修改的代码

良好代码治理的基本规则之一是，代码只有在准备进行测试时才能更改。因此，如果代码经常修改，后果就是它也会频繁地被测试。自动化这些测试肯定会带来丰厚的投资回报。

# 关键业务代码被更改

彻底测试应该始终是常态，但鉴于实际情况，遗憾的是并不总是可行。然而，测试对关键业务代码所做的更改，应该始终是全面的。你绝对不能容忍这些代码出现任何故障。将发现即便是统计上总会存在的 2%到 5%的漏洞作为一种荣誉！

# 重构现有代码

重构代码可能让人紧张。删除、重写、重新排列。你怎么知道它仍然在完成它原本的任务？它不会破坏其他东西吧？它肯定需要经过测试。但是，当手动执行时，通常是在整个重构完成后才进行测试。那时可能已经太晚，因为许多部分已经被破坏。在任何重构之前，先为这些代码制定一个自动化测试套件，确保其有效性，从而让自己安心。每进行一步重构，就运行这个测试套件，再运行一次。这样，重构过程会变得轻松有趣。

# 新功能开发

从头开始，无论是在测试代码还是应用程序代码方面，都会是一个不可辩驳的经验。对一些人来说，这可能是最终的方式。而对其他人来说，这可能是一个*过于遥远的桥梁*，在这种情况下，之前的所有方案可能都是更好的选择。在第三部分，*为 Microsoft Dynamics 365 Business Central 设计和构建自动化测试*，我们将采用这种方法，并向你展示在应用代码旁边编写测试代码的价值。

# 微软更新

在 Microsoft 进行任何更新（无论是在本地还是在云端），都必须（重新）测试功能，以证明它们仍然像以前一样正常工作。如果您没有现有的自动化测试，请开始创建它们。基于对各种变更及其可能引入错误风险的分析进行此操作。

# 什么是自动化测试？

我们讨论了为什么要自动化您的测试以及何时进行此操作；或更具体地说，从哪里开始。但在结束本章之前，我们没有考虑过什么是自动化测试。所以，让我们在总结之前先做这件事。

通过自动化测试，我们解决了应用程序测试的自动化问题，脚本化手动应用程序测试以检验功能的有效性。在我们的情况下，这些是驻留在 Dynamics 365 Business Central 中的功能。您可能已经注意到，我们一直在使用略有不同的术语来描述它：

+   测试自动化

+   自动化测试

+   自动化测试

所有这些都意味着相同的事情。

一方面，自动化测试正在取代手动、通常是探索性的测试。它正在取代那些可重现但执行起来往往不那么有趣的手动测试。

什么是探索性测试？查看以下链接获取更多信息：

[探索性测试](https://en.wikipedia.org/wiki/Exploratory_testing).

另一方面，它们是互补的。手动测试仍然有助于提升功能的质量，利用富有创造力和经验丰富的人类思维来发现当前测试设计中的漏洞。自动化测试也可能包括所谓的单元测试。这些测试验证组成功能的原子单元的工作。通常，这些单元将是单个的、全局的 AL 函数——这些单元永远不会手动测试。

最终，无论是手动测试还是自动化测试，都是为了验证测试对象是否符合要求。

更多关于单元测试和功能测试的信息，请访问以下链接：[`www.softwaretestinghelp.com/the-difference-between-unit-integration-and-functional-testing/`](https://www.softwaretestinghelp.com/the-difference-between-unit-integration-and-functional-testing/)。

# 摘要

在本章中，我们讨论了*为什么*要自动化您的应用程序测试，以及*何时*创建和运行它们。最后，我们简要描述了*什么*——什么是自动化测试？

在第二章，*可测试性框架*，您将了解到内建在 Dynamics 365 Business Central 平台中的技术特性，这些特性使我们能够运行和创建自动化测试。
