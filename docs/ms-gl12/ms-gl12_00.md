# 序言

GitLab 是一款提升团队工作流程的工具，能够支持 DevOps 生命周期的各个环节。最初，它只是一个源代码管理工具，但如今，GitLab 能够从管理初步想法、构建和测试源代码，到开发和生产的各个环节提供帮助。

你将学习如何利用 GitLab 中的所有功能，通过整合开发过程的各个阶段来提升业务。通过在本地或云端创建一个平台，你将受益于降低摩擦、提高协作，并通过更高效的运营推动竞争优势。

# 本书面向谁

本书适合开发人员和 DevOps 专业人员，他们希望掌握 GitLab 中的软件开发工作流，并通过将团队部署到 GitLab 来提升生产力，无论是本地安装还是基于云的基础设施。

# 本书内容

第一章，*介绍 GitLab 架构*，简要介绍了公司及其产品的创造者，并对 GitLab 及其组件进行了高层次的概述。

第二章，*安装 GitLab*，展示了如何通过几种不同的方法安装和配置 GitLab。可以从零开始，也可以使用 Omnibus 安装程序。特别关注了容器化解决方案中的 Docker 和 Kubernetes。最后，以 DigitalOcean 基础设施为例，展示了云安装的过程。

第三章，*通过 UI 配置 GitLab*，解释了安装后可以在 GitLab Web UI 中配置的选项。本章还涵盖了这些实例级选项所在的管理页面。

第四章，*通过终端配置 GitLab*，讲解了配置 GitLab 的不同方式。首先是通过 GitLab 提供的 Omnibus 包安装程序进行配置，该程序自动化了大部分安装工作。接下来，本章继续介绍源代码安装的配置过程，还涵盖了 Docker 容器的配置和 Kubernetes 安装的管理。

第五章，*从 GitHub 导入项目到 GitLab*，通过动手实验展示了从 GitHub 迁移的过程。首先，探讨了应该修改的 GitHub 项目设置。然后，展示了在 GitLab 中准备导入所需的设置，最后讲解了执行导入的步骤。

第六章，*从 CVS 迁移*，首先比较了 CVS 和 Git 这两种根本不同的系统。接着提供了迁移准备的指导，并讨论了实际转换的过程，以及清理不再需要的遗留物。

第七章，*从 SVN 迁移*，首先解释了 SVN 和 Git 之间的微妙及不那么微妙的区别。读者将学习如何通过两种不同的方法进行迁移：使用 SubGit 进行镜像和使用 svn2git 工具。

第八章，*从 TFS 迁移仓库*，首先处理了 TFS 和 Git 之间的差异。随后，展示了如何通过使用 git-tfs 工具将 TFS 项目的信息迁移到 Git 中。

第九章，*GitLab 愿景 - 一体化工具链*，解释了 GitLab 提供整个 DevOps 工具链给开发者的愿景，回顾了 XP 的起源和敏捷宣言。同时也探讨了 DevOps 范式的兴起，并总结了 GitLab 提供的工具链。

第十章，*创建你的产品，验证它，并打包它*，展示了 GitLab 的产品愿景及其工作流，重点围绕提供一个完整的工具链来创建产品的理念。本章专注于不同的阶段，并通过实例解释相关概念。

第十一章，*发布和配置阶段*，讨论了 GitLab 的一个大特点：能够通过不同、易于设计的阶段提供完整的生产之旅。通过这种方式，你可以创建不同的环境，并最终自动化整个产品的流水线。

第十二章，*使用 Prometheus 监控*，介绍了如何通过使用内置的 Prometheus 功能和默认脚本语言来监控你的 GitLab 环境。本章的第二部分解释了可用的不同安全性测试。

第十三章，*将 GitLab 与 CI/CD 工具集成*，解释了虽然 GitLab 旨在提供一个完整的工具链，但在实际使用中总是需要进行集成。本章讲解了一些开箱即用的大型集成，并以一个关于 webhooks 如何提供一种通用方式来从 GitLab 获取信息的部分作结。

第十四章，*为 GitLab 持续集成设置项目*，介绍了 GitLab CI 概念，这些概念存在于应用服务器上，并可以针对每个项目进行精细调整和自定义。本章的第二部分主要集中在如何准备你的项目以使用这些 CI 概念，并为其设置 runner。

第十五章，*安装和配置 GitLab Runners*，解释了 GitLab runners 的工作原理，包括如何安装它们。接下来的步骤是创建一个示例项目，并使用 shell 执行器来构建它。

第十六章，*使用 GitLab 运行器与 Docker 或 Kubernetes*，检查基于 Docker 的运行器架构以及使用 Kubernetes API 的运行器，使用与前面章节相同的示例。

第十七章，*自动扩展 GitLab CI 运行器*，展示了使用自动扩展的运行器架构。根据需求，所需的运行器数量会增加或减少。所示的示例使用 VirtualBox 和 **亚马逊网络服务**（**AWS**）来部署实例。

第十八章，*监控 CI 指标*，处理监控特定的 GitLab 运行器。通过实验室，我们展示了如何在运行器内部启用监控。介绍之后，具体的功能和系统指标将被解释。

第十九章，*使用水平扩展创建基础 HA 架构*，展示了不同组件如何互动。其次，展示了数据库的准备工作，以及多个一体化的应用服务器。最后，解释了该 **高可用性**（**HA**）设置中仓库的共享文件系统和 Redis 缓存的配置。我们将使用 Terraform 和 Ansible 创建演示环境。

第二十章，*管理混合 HA 环境*，在早期的水平 HA 架构基础上进行扩展，但复杂性继续增加。主要区别在于，应用服务器将几个组件合并，而这些组件现在被拆分到新的层次中。

第二十一章，*使您的环境完全分布式*，建立在前面的章节基础上。完全分布式架构旨在通过再次将组件拆分为新层次来提高容错能力。现在有了一个 SSH 节点和多个 sidekiq 层。

第二十二章，*使用 Geo 创建 GitLab 的分布式只读副本*，从 GEO 产品的解释开始，GEO 是企业版许可证的一部分。使用本书第五章《扩展服务器基础设施（高可用性设置）》中相同的工具，我们将解释如何设置 GEO 以在两个不同的地理位置之间创建复制。

# 为了最大化从本书中获得收益

为了最大限度地从本书中获得收益，您应该有一台 Linux 或 macOS 机器，具备互联网连接，并且拥有亚马逊 AWS、Google 和微软 Azure 账户。这些都是运行示例所必需的。

阅读本书需要一些基本的 IT 知识。您需要具备以下方面的经验：

+   Linux

+   Shell 脚本

+   Ruby 和 JavaScript 的基础编程技能

+   基本的 Docker 容器知识

+   基本的使用 Terraform 创建基础设施即代码的知识

+   基本的 Ansible 知识

# 下载示例代码文件

你可以从你的账户中下载本书的示例代码文件，访问[www.packt.com](http://www.packt.com)。如果你在其他地方购买了这本书，可以访问[www.packt.com/support](http://www.packt.com/support)并注册以便直接通过电子邮件获取文件。

你可以通过以下步骤下载代码文件：

1.  登录或注册到[www.packt.com](http://www.packt.com)。

1.  选择**支持**标签。

1.  点击代码下载和勘误表。

1.  在搜索框中输入书名，并按照屏幕上的指示操作。

下载文件后，请确保使用最新版本的工具解压或提取文件夹：

+   WinRAR/7-Zip for Windows

+   Zipeg/iZip/UnRarX for Mac

+   7-Zip/PeaZip for Linux

本书的代码包也托管在 GitHub 上，地址是[`github.com/PacktPublishing/Mastering-GitLab-12`](https://github.com/PacktPublishing/Mastering-GitLab-12)。如果代码有更新，它将在现有的 GitHub 仓库中更新。

我们还提供来自我们丰富的书籍和视频目录中的其他代码包，您可以在**[`github.com/PacktPublishing/`](https://github.com/PacktPublishing/)**找到它们。快去看看吧！

# 代码实战

访问以下链接查看代码的执行情况：

[`bit.ly/2KirIoO`](http://bit.ly/2KirIoO)

# 下载彩色图片

我们还提供了一份 PDF 文件，其中包含本书中使用的截图/图表的彩色图像。你可以在这里下载：[`static.packt-cdn.com/downloads/9781789531282_ColorImages.pdf`](https://static.packt-cdn.com/downloads/9781789531282_ColorImages.pdf)。

# 使用的约定

本书中使用了多种文本约定。

`CodeInText`：表示文本中的代码词、数据库表名、文件夹名称、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 用户名。例如：“让我们继续在`/usr/local/www`目录下安装网页文档。”

代码块的格式如下：

```
server {
listen 8080;
server_name localhost;
```

当我们希望引起你注意代码块中的特定部分时，相关行或项目会以粗体显示：

```
server {
listen 8080;
server_name localhost;
```

任何命令行输入或输出都按如下格式书写：

```
$mkdir /usr/local/www
$chmod 755 /usr/local/www
$cd /usr/local/www
```

**粗体**：表示一个新术语、一个重要的词或在屏幕上看到的单词。例如，菜单或对话框中的单词在文本中会以这种方式出现。比如：“你可以通过点击靠近 Logo 部分的选择文件按钮来完成此操作。”

警告或重要的注意事项会以这种方式显示。

小贴士和技巧以这种方式显示。

# 与我们联系

我们欢迎读者的反馈。

**一般反馈**：如果你对本书的任何方面有疑问，请在邮件主题中提到书名，并通过`customercare@packtpub.com`联系我们。

**勘误**：虽然我们已尽最大努力确保内容的准确性，但错误仍然会发生。如果您在本书中发现任何错误，我们将不胜感激，若您能将其报告给我们。请访问 [www.packt.com/submit-errata](http://www.packt.com/submit-errata)，选择您的书籍，点击“勘误提交表单”链接，并填写相关详情。

**盗版**：如果您在互联网上发现我们作品的任何非法复制品，烦请提供相关位置或网站名称。请通过 `copyright@packt.com` 与我们联系，并附上该材料的链接。

**如果您有兴趣成为作者**：如果您在某个领域有专业知识，且有兴趣撰写或为书籍贡献内容，请访问 [authors.packtpub.com](http://authors.packtpub.com/)。

# 评价

请留下评价。在您阅读并使用本书之后，何不在您购买书籍的网站上留下评论呢？潜在读者可以看到您的公正意见，从而做出购买决定，我们在 Packt 也可以了解您对我们产品的看法，而我们的作者也可以看到您对他们书籍的反馈。谢谢！

想了解更多有关 Packt 的信息，请访问 [packt.com](http://www.packt.com/)。
