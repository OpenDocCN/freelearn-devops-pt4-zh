<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">The Test Tool and Standard Tests</h1>
                </header>
            
            <article>
                
<p>Ever since NAV 2009 SP1, providing automated tests has been a major part of Microsoft's work on the application. Using the testability framework, they have created the following:</p>
<ul>
<li>A humongous set of automated tests to verify the standard application</li>
<li>A Test Tool feature, that has become part of the standard application</li>
<li>A vast number of test helper libraries</li>
</ul>
<p>In this chapter, we will discuss all three matters in more details.</p>
<div class="packt_infobox">Note that each of these is provided by Microsoft as a separate component; that is, a <kbd>.fob</kbd>, on the product DVD and in the Docker images from NAV 2016 and up.
<p>The Test Tool is also present in Business Central online, but you will only be able to fetch tests for the extensions that reside in CRONUS, not for the standard application. To get yourself a free trial, visit: <a href="https://dynamics.microsoft.com/en-us/business-central/overview/">https://dynamics.microsoft.com/en-us/business-central/overview/</a>.<a href="https://dynamics.microsoft.com/en-us/business-central/overview/"/></p>
<p>On the use of Docker, visit: <a href="https://docs.microsoft.com/en-us/dynamics365/business-central/dev-itpro/developer/devenv-running-container-development">https://docs.microsoft.com/en-us/dynamics365/business-central/dev-itpro/developer/devenv-running-container-development</a>.<a href="https://docs.microsoft.com/en-us/dynamics365/business-central/dev-itpro/developer/devenv-running-container-development"/></p>
</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Test Tool</h1>
                </header>
            
            <article>
                
<p class="mce-root"><span>Goal: U</span>nderstand what the Test Tool entails and learn how to use and apply it.</p>
<p>The Test Tool is a standard application feature that allows you to manage and run the automated tests that reside in the database, and collect their results, be they test codeunits that belong to the standard application or that are part of extensions. With the various hands-on example tests, we will be using this tool a lot. However, before we do this, let's elaborate a little bit on it.</p>
<p>You can easily access the <span class="packt_screen">Test Tool</span> using the <span class="packt_screen">TELL ME WHAT YOU WANT TO DO</span> feature in Dynamics 365 Business Central, as displayed in the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-743 image-border" src="assets/e8c97af4-613c-4400-8a11-f5b1054bb943.png" style="width:80.75em;height:42.67em;"/></p>
<p>When in a clean database, or at least a database or company where the <span class="packt_screen">Test Tool</span> has not been used yet, this is how the <span class="packt_screen">Test Tool</span> appears. A suite called <span class="packt_screen">DEFAULT</span> with no records in it appears, as seen as follows:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-744 image-border" src="assets/38bd9b71-d616-45ea-bd41-aa3a1faf8585.png" style="width:81.00em;height:36.92em;"/></p>
<p>To populate the suite take the following steps:</p>
<ol>
<li>Select the <strong><span class="packt_screen">Get Test Codeunits</span></strong> action.</li>
<li>On the dialog that opens, you have the following two options:
<ul>
<li><span class="packt_screen">Select Test Codeunits</span>: This will open a list page showing all test codeunits that are present in the database from which you can select specific test codeunits; once you have selected and clicked <span class="packt_screen">OK,</span> these codeunits will be added to the suite</li>
<li><span class="packt_screen">All Test Codeunits</span>:<strong> </strong>This will add all test codeunits that exist in the database to the test suite</li>
</ul>
</li>
</ol>
<p style="padding-left: 60px">Let's select the first option, <span class="packt_screen">Select Test Codeunits</span>. This will open the <span class="packt_screen">CAL Test Get Codeunits</span> page. Unsurprisingly, it shows the four test codeunits we have created in <a href="1e679d13-4037-48e2-b8ae-f550f507f8c9.xhtml" target="_blank">Chapter 2</a>, <em>The Testability Framework</em>, followed by the long list of over 700 standard test codeunits:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-745 image-border" src="assets/d9ef589c-646a-4561-88ba-222360dc4f32.png" style="width:80.75em;height:42.92em;"/></p>
<ol start="3">
<li>Select the four test codeunits <span class="packt_screen">60000</span> through <span class="packt_screen">60003</span> and click <span class="packt_screen">OK</span>.</li>
</ol>
<p style="padding-left: 60px">The suite now shows for each test <span class="packt_screen">Codeunit</span> a line with <span class="packt_screen">LINE TYPE</span> = <span class="packt_screen">Codeunit</span> and, linked to this line and indented, all its test functions (<span class="packt_screen">LINE TYPE</span> = <span class="packt_screen">Function</span>) as shown in the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-746 image-border" src="assets/ecf55f01-53d7-4b41-8af4-4dfe14a00a70.png" style="width:80.92em;height:42.75em;"/></p>
<ol start="4">
<li>To run the tests, select the <span class="packt_screen">Run</span> action.</li>
</ol>
<ol start="5">
<li>On the following dialog that opens, with options <span class="packt_screen">Active Codeunit</span> and <span class="packt_screen">All</span>, select <span class="packt_screen">All</span> and press <span class="packt_screen">OK</span>. Now all four test codeunits will be run and each test will yield a result, <span class="packt_screen"><span class="packt_screen">Success</span></span> or <span class="packt_screen"><span class="packt_screen">Failure</span>:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-747 image-border" src="assets/5a6ee3af-1cdb-4554-b5ad-ac5e009f28c1.png" style="width:80.67em;height:42.83em;"/></p>
<p style="padding-left: 60px">Had we selected the option <span class="packt_screen">Active Codeunit</span> only, the selected codeunit would have been executed.</p>
<p style="padding-left: 60px">For each failure, the <span class="packt_screen">First Error</span> field will display the error that caused the failure. As you can see, <span class="packt_screen">First Error</span> is a FlowField. If you drill down into it, the <span class="packt_screen">CAL Test Result</span> window opens. This displays the whole test run history for a specific test.<br/>
Note that the message dialog in <kbd>MyFirstTestCodeunit</kbd> yields an <kbd>Unhandled UI</kbd> error.</p>
<p>Running the test by selecting <span class="packt_screen">Run</span> will call the standard test runner codeunit <kbd>CAL Test Runner</kbd> (130400) and will make sure that the following happen:</p>
<ul>
<li>Tests run from the <span class="packt_screen">Test Tool</span> will be run in isolation</li>
<li>The results of each test function will be logged</li>
</ul>
<p>In this short overview of the Test Tool, we used the following features:</p>
<ul>
<li>Get test codeunits</li>
<li>Creating multiple test suites</li>
</ul>
<p>When diving into test coding, the Test Tool will be our companion. There we will be using various other features of it, including the following:</p>
<ul>
<li>Run selected</li>
<li>Drilling into the test results</li>
<li>Referencing the call stack</li>
<li>Clearing the results</li>
<li>Test coverage map</li>
</ul>
<div class="packt_infobox">
<p><span class="packt_screen">Regarding on-premises installation</span>: The <span class="packt_screen">Test Too</span>l can be accessed and executed using an end-user license. This has been enabled since the fall of 2017.</p>
</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Standard tests</h1>
                </header>
            
            <article>
                
<p><span>Goal: G</span>et to know the basics of the standard tests provided by Microsoft.</p>
<div>
<p>Ever since NAV 2016, Microsoft made their own application test collateral a part of the product. A humongous set of tests is delivered as a <kbd>.fob</kbd> file on the product DVD, in the <kbd>TestToolKit</kbd> folder, and in the Docker images. Indeed, the tests haven't been delivered as an extension yet.</p>
</div>
<div class="packt_infobox">
<p>The standard test suite does contain mainly test codeunits. But there are also a number of supporting table, page, report, and XMLport objects in the <kbd>.fob</kbd> file.</p>
</div>
<p>For Dynamics 365 Business Central, the whole set contains almost 23,000 tests in more than 700 test codeunits, for w1 and local functionality for each country in which Microsoft releases. And with every bug that's fixed and with every new feature introduced in the application, the number of tests is growing. It has been built over the last ten years and it covers all functional areas of Business Central.</p>
<p>Let's set up a new suite in the Test Tool called <strong>ALL W1</strong>:</p>
<ol>
<li>Click on the <span class="packt_screen">Assist Edit</span> button in the <span class="packt_screen">Suite Name</span> <span class="packt_screen">control</span></li>
<li>In the <span class="packt_screen">CAL Test Suites</span> pop-up window select <span class="packt_screen">New</span></li>
<li>Populate the <span class="packt_screen">Name</span> and <span class="packt_screen">Description</span> fields</li>
<li>Click <span class="packt_screen">OK</span></li>
</ol>
<p>To open the newly created test suite:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-748 image-border" src="assets/0713c7d2-02b0-4d0f-8baa-2bc6ed490ffd.png" style="width:80.92em;height:65.25em;"/></p>
<p>Now, using the <span class="packt_screen">Get Test Codeunits</span> action, let Business Central fetch all standard test codeunits as shown in the next screenshot. Note that I did remove our test codeunit <span class="packt_screen">60000</span> through <span class="packt_screen">60003</span>:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-749 image-border" src="assets/c10fced8-a914-4b0e-b932-23e6712fff61.png" style="width:81.00em;height:65.33em;"/></p>
<p>Reading the names of all test codeunits will give you a first impression of what they entail, which are as follows:</p>
<ul>
<li><span><strong>Enterprise Resource Management</strong> (</span><strong>ERM</strong>) and <span><strong>Supply Chain Management</strong> (</span><strong>SCM</strong>) codeunits:
<ul>
<li>These two categories contain <span>almost 450 codeunits </span>to form the major part of standard test collateral</li>
<li>ERM test codeunits cover G/L, sales, purchase, and inventory</li>
<li>SCM test codeunits cover warehouse and production</li>
</ul>
</li>
<li>Apart from ERM and SCM, several other categories can be noted, of which the biggest are:
<ul>
<li>Service (approximately 50 test codeunits)</li>
<li>O365 integration (<span>approximately </span>35)</li>
<li>Job (<span>approximately</span> 25)</li>
<li>Marketing <span>(approximately 15)</span></li>
</ul>
</li>
</ul>
<p>Most of these test codeunits contain functional, end-to-end tests. But there are also codeunits that hold <strong>unit tests</strong> (<strong>UT</strong>). These are marked by the addition of Unit Test to their name. Some examples are as follows:</p>
<ul>
<li><kbd>Codeunit 134155 - ERM Table Fields UT</kbd></li>
<li><kbd>Codeunit 134164 - Company Init UT II</kbd></li>
<li><kbd>Codeunit 134825 - UT Customer Table</kbd></li>
</ul>
<p>With headless testing being the initial trigger for bringing the testability framework into the platform, it's no surprise that the clear majority of standard test codeunits comprises headless tests. Test codeunits that are meant to test the <strong>user interface</strong> (<strong>UI</strong>) are marked using <kbd>UI</kbd> or <kbd>UX</kbd> in their name. <span>Some examples are as follows</span>:</p>
<ul>
<li><kbd>Codeunit 134280 - Simple Data Exchange UI UT</kbd></li>
<li><kbd>Codeunit 134339 - UI Workflow Factboxes</kbd></li>
<li><kbd>Codeunit 134711 - Autom. Payment Registration.UX</kbd></li>
<li><kbd>Codeunit 134927 - ERM Budget UI</kbd></li>
</ul>
<p>Note that these are not the only test codeunits addressing the UI. Any other might contain one or more UI tests, where, in general, the bulk will be headless tests.</p>
<p>As I am often asked how to test reports, it is noteworthy to mention as a last category those test codeunits that are dedicated to testing reports. Search for any test codeunit that is marked with the word <kbd>Report</kbd> in its name. You will find 50+ of them. The following are a couple of examples:</p>
<ul>
<li><kbd>Codeunit 134063 - ERM Intrastat Reports</kbd></li>
<li><kbd>Codeunit 136311 - Job Reports II</kbd></li>
<li><kbd>Codeunit 137351 - SCM Inventory Reports – IV</kbd></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Categorization by FEATURE</h1>
                </header>
            
            <article>
                
<p>By inspecting the names of the standard test codeunits, we got an impression of what kind of tests this collateral is made. Microsoft, however, has a better structured categorization, which so far, due to low priority, hasn't been explicitly shared with the outside world. Now that automated testing is being picked up more and more, it's pressing on Microsoft to put this on higher priority. But for now, we can access it already inside most of the test codeunits. You need to look for the <kbd>FEATURE</kbd> tag. This tag is part of the <strong>Acceptance Test-Driven Development</strong> (<strong>ATDD</strong>) test case design pattern, which we will be discussing later in <a href="db955f66-11f4-4d9a-90c7-5af04058ebbe.xhtml" target="_blank">Chapter 4</a>, <em>Test Design</em>. Using the <kbd>[FEATURE]</kbd> tag, Microsoft categorizes their test codeunits and, in some cases, individual test functions. Note that this tagging is far from complete as not all test codeunits have it, yet.</p>
<p>Have a look at the (partial) abstract of the following codeunits:</p>
<ul>
<li><kbd>Codeunit 134000 - ERM Apply Sales/Receivables</kbd>:
<ul>
<li><kbd>OnRun</kbd>:
<ul>
<li><kbd>[FEATURE] [Sales]</kbd></li>
</ul>
</li>
<li><kbd>[Test] PROCEDURE VerifyAmountApplToExtDocNoWhenSetValue</kbd>:
<ul>
<li><kbd>[FEATURE] [Application] [Cash Receipt]</kbd></li>
</ul>
</li>
<li><kbd>[Test] PROCEDURE PmtJnlApplToInvWithNoDimDiscountAndDefDimErr</kbd>:
<ul>
<li><kbd>[FEATURE] [Dimension] [Payment Discount]</kbd></li>
</ul>
</li>
</ul>
</li>
<li><kbd>Codeunit 134012 - ERM Reminder Apply Unapply</kbd>:
<ul>
<li><kbd>OnRun</kbd>:
<ul>
<li><kbd>[FEATURE] [Reminder] [Sales]</kbd></li>
</ul>
</li>
<li><kbd>[Test] PROCEDURE CustomerLedgerEntryFactboxReminderPage</kbd>:
<ul>
<li><kbd>[FEATURE] [UI]</kbd></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>In later chapters, we will look in more detail at various standard test functions. You will see how to take them as examples for your own test writing (<a href="db955f66-11f4-4d9a-90c7-5af04058ebbe.xhtml" target="_blank">Chapter 4</a>, <em>Test Design</em>, <a href="56634efe-664c-421a-9582-b2a6ae69722a.xhtml" target="_blank">Chapter 5</a>, <em>From Customer Wish to Test Automation - The Basics</em>, <a href="0f8efb81-438e-48ed-9f7f-bcfa5caa8e92.xhtml" target="_blank">Chapter 6</a>, <em>From Customer Wish to Test Automation - Next Level</em>, and <a href="bb9ee41e-4c60-4a27-8fad-5343adfcd86a.xhtml" target="_blank">Chapter 7</a>, <em>From Customer Wish to Test Automation - And Some More</em>), and how to get them to run on your own solution (<a href="795b3870-b6f5-43be-953c-0ffd01db9102.xhtml" target="_blank">Chapter 9</a>, <em>Getting Business Central Standard Tests Working on Your Code</em>).</p>
<div class="packt_infobox">At this very moment, the standard test suite objects are to be found in the following ID ranges:<br/>
<span>134000 to 139999: w1 tests<br/></span> <span>144000 to 149999: local tests</span></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Standard libraries</h1>
                </header>
            
            <article>
                
<p><span>Goal: G</span>et to know the basics about the standard test helper libraries provided by Microsoft.</p>
<p>Supporting their standard tests, Microsoft has created a nice and very useful collection of helper functions in more than 70 library codeunits. These helper functions range from random data generations and master data generation to standard generic and more specific check routines.</p>
<p>Need a new item? You might make use of the <kbd>CreateItem</kbd> or <kbd>CreateItemWithoutVAT</kbd> helper functions in <kbd>Library - Inventory</kbd> (codeunit 132201).</p>
<p>Need a random text? Use the <kbd>RandText</kbd> helper function in <kbd>Library – Random</kbd> (codeunit 130440).</p>
<p>Want to get the same formatted error messages when verifying your test outcome? Use one of the helper functions in the <kbd>Assert</kbd> (codeunit 130000), such as <kbd>IsTrue</kbd>, <kbd>AreNotEqual</kbd>, and <kbd>ExpectedError</kbd>.</p>
<p>A frequently reappearing question during my workshops is:</p>
<div class="packt_quote">How do I know if these libraries contain a helper function I need in my own test? Is there an overview of the various helper functions?</div>
<p>Unfortunately, there is no overview of all available helper functions for Dynamics 365 Business Central. However, up to NAV 2018, a <kbd>.chm</kbd> help file containing this information was included in the <kbd>TestToolKit</kbd> folder on the product DVD. You might want to make use of this, but I always use a very simple method. Having all our code in a source code management system, I can do a quick file search in the standard test objects folder. In case I need a helper that will create me a service item, I might open VS Code on that folder and search for <kbd>CreateServiceItem</kbd>, as shown in the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-750 image-border" src="assets/3d7319ea-4dfa-4769-87f1-09ee9980adf6.png" style="width:103.25em;height:64.00em;"/></p>
<p>In <a href="13a9d0b2-ae46-45ba-8790-8489439e70fc.xhtml" target="_blank">Section 3</a>, <em>Designing and Building Automated Tests for Microsoft Dynamics 365 Business Central</em>, of this book, when building tests, we will happily make use of various standard helper functions, making our work much more efficient and consistent.</p>
<div class="packt_infobox">At this very moment, the standard test library objects are to be found in the following ID ranges:<br/>
<span>130000 to 133999: w1 test helper libraries<br/></span><span>Note that all test tool objects also reside in the lower part of this range:<br/></span><span>140000 to 143999: local test helper libraries</span></div>
<div class="packt_tip">
<p>More on unit and functional tests? Go to:<br/>
<a href="https://www.softwaretestinghelp.com/the-difference-between-unit-integration-and-functional-testing/">https://www.softwaretestinghelp.com/the-difference-between-unit-integration-and-functional-testing/</a></p>
</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, we discussed in a nutshell what the Test Tool is and how to use it to run your tests, or even run the collection of tests Microsoft has built and provided us with. We gave a short overview of the various categories of tests this vast collection contains. We concluded with a brief description of the 70+ libraries containing useful helper functions to support your own test writing.</p>
<p>Now that we have discussed the various test features that exist in Dynamics 365 Business Central, we are ready to go and start designing and coding our own test. We will start in <a href="db955f66-11f4-4d9a-90c7-5af04058ebbe.xhtml" target="_blank">Chapter 4</a>, <em>Test Design</em>, to introduce several design patterns that facilitate easier and consistent test case coding.</p>


            </article>

            
        </section>
    </body></html>