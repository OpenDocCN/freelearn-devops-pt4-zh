<html><head></head><body><div id="sbo-rt-content"><div id="_idContainer126">
			<h1 id="_idParaDest-207"><a id="_idTextAnchor212"/>Chapter 8: Creating Workloads with CodeCommit and CodeBuild</h1>
			<p>AWS has come up with an admirable set of tools to help developers and organizations run their CI/CD operations entirely from the Amazon ecosystem. </p>
			<p>Continuous integration starts with the process of source code versioning and then building and testing your code in a repeatable, automated fashion. Two of the tools provided by the <strong class="bold">AWS Codes Services Suite</strong>, <strong class="bold">CodeCommit</strong> and <strong class="bold">CodeBuild</strong>, help engineers achieve these goals. </p>
			<p>In this chapter, we're going to cover the following main topics:</p>
			<ul>
				<li>Using CodeCommit for code versioning</li>
				<li>Setting up your CodeCommit repository</li>
				<li>Approvals in CodeCommit </li>
				<li>Using AWS CodeBuild</li>
				<li>Creating a <strong class="source-inline">buildspec</strong> file</li>
			</ul>
			<h1 id="_idParaDest-208"><a id="_idTextAnchor213"/>Technical requirements</h1>
			<p>As we start on this path, a few assumptions are going to be made, especially with pursuing the professional DevOps certification. The first is that you have a basic knowledge of using the software versioning system known as Git. This basic knowledge includes creating a bare repository, creating a branch, making a commit to that branch, and then pushing that commit to a remote repository. If you need to get up to speed with Git, then using the tutorial <em class="italic">Getting Started with Git and AWS CodeCommit</em> is suggested. You can find it at <a href="https://docs.aws.amazon.com/codecommit/latest/userguide/getting-started.html">https://docs.aws.amazon.com/codecommit/latest/userguide/getting-started.html</a>.</p>
			<p>The second assumption is that you already have Git installed on your laptop or workstation. Suppose you don't have Git installed yet or cannot access it due to a lack of administrative permissions. In that case, a perfect alternative is to spin up an Amazon EC2 instance in your AWS account that you can install Git on so that you can follow along with the exercises.</p>
			<p>If Git is not installed on your local workstation and you either cannot install it or would not like to install it, AWS provides the Cloud9 development environment, which allows you to create code inside of a browser window. </p>
			<h1 id="_idParaDest-209"><a id="_idTextAnchor214"/>Using CodeCommit for code versioning </h1>
			<p>There are plenty of choices regarding where you can store your code, both on-premises and within <a id="_idIndexMarker786"/>SaaS solutions. Features and values are what tend to drive decisions on which product to use. AWS CodeCommit provides <a id="_idIndexMarker787"/>both a robust set of features and the value of being a pay-per-use service, containing elements such as native connectivity to AWS services, along with them complying with multiple assurance programs such as SOC2, PCI, HIPAA, and others.</p>
			<p>In <a href="B17405_06_Final_JM_ePub.xhtml#_idTextAnchor166"><em class="italic">Chapter 6</em></a>, <em class="italic">Understanding CI/CD and the SDLC</em>, we discussed the four major phases of the software development life cycle: source, build, test, and deploy. The initial phase, source, is what we will be concentrating on in this section. As a quick recap, the source phase allows you to check your code into a central repository and also allows multiple people to collaborate on the same code base. </p>
			<h2 id="_idParaDest-210"><a id="_idTextAnchor215"/>What is CodeCommit? </h2>
			<p>CodeCommit is a secure, highly scalable, managed source control service that hosts private Git <a id="_idIndexMarker788"/>repositories. This may sound a bit foreign initially, but you have probably used a SaaS service to host code already if you have used BitBucket or GitHub private repositories. </p>
			<p>The fundamental object in CodeCommit is the repository. The repository is where users store code and objects of any type and size for their projects. CodeCommit also stores and tracks changes that have been made to uploaded files, along with changes that have been made to files. You can configure the repository to send notifications when events happen, such as branch merges or comments being added to code. It also allows users to work on their local systems and then push changes to the CodeCommit storage system. </p>
			<h2 id="_idParaDest-211"><a id="_idTextAnchor216"/>Benefits of CodeCommit </h2>
			<p>As part of the AWS ecosystem, CodeCommit can integrate with services such as KMS for encryption, as well <a id="_idIndexMarker789"/>as CloudWatch to incorporate metrics and alarms for our repositories, and this doesn't even touch on some of the development tools that are tightly integrated with the CodeCommit service. Aside from just being tightly coupled with numerous other AWS services, CodeCommit provides many other benefits:</p>
			<ul>
				<li>IAM for CodeCommit provides high service availability and durability.</li>
				<li>CodeCommit repositories are encrypted at rest and in transit, so you know that your code is always secure.</li>
				<li>It scales easily and has no limits on the size of repositories or the types and sizes of the files you can store. </li>
				<li>Seamlessly integrates with several AWS services (Lambda, SNS, CodePipeline).</li>
				<li>Allows you to migrate from other remote Git-based repositories easily.</li>
				<li>Allows you to use the Git tools and commands that you already know.</li>
			</ul>
			<p>With this overview and the benefits of AWS CodeCommit under our belt, we will look at the available access control features before creating our repository and our new group specifically for CodeCommit access. </p>
			<h2 id="_idParaDest-212"><a id="_idTextAnchor217"/>Controlling access to repositories </h2>
			<p>Before we go through the process of creating the CodeCommit repository, we need to do a little <a id="_idIndexMarker790"/>pre-work as far as permissions are concerned. Up until this point, we have been doing most things as an administrative user. We are starting to add developers and development teams into the mix, some of which only need access to the CodeCommit repositories and no other services. We are going to create a new IAM group and then add a developer entity to that group. This will demonstrate good GitFlow practices of the developer contributing code and then asking for their branch to be merged into the main branch. </p>
			<p>This works when the developers are all part of the same account where we are creating our CodeCommit repositories. There are other scenarios that we need to be aware of as well. For example, what happens when a developer in another account needs access to CodeCommit <a id="_idIndexMarker791"/>repositories in our account? CodeCommit can provide cross-account access to users and roles in another AWS account. This can solve the issue of not having to add external developers to your IAM list of users if they already have an AWS account.</p>
			<h1 id="_idParaDest-213"><a id="_idTextAnchor218"/>Setting up your CodeCommit repository </h1>
			<p>A CodeCommit repository can be created via the CLI. However, when using the AWS management <a id="_idIndexMarker792"/>console, there are some additional features, such as the info panel, that are only available in that environment. </p>
			<p>Before we create the repository, be sure to open your browser to the AWS CodeCommit home page, <a href="https://console.aws.amazon.com/codesuite/codecommit/home">https://console.aws.amazon.com/codesuite/codecommit/home</a>, and sign in if prompted. </p>
			<p>Once you have signed in, we can go through the process of creating a repository in CodeCommit: </p>
			<ol>
				<li>Once you're on the <strong class="source-inline">CodeCommit</strong> main page for the region you are working in (we are doing everything in our examples in the Ohio region/<strong class="source-inline">us-east-2</strong>), click on the orange <strong class="bold">Create repository</strong> button in the top right-hand corner to start the process of creating a new repository:<p class="figure-caption"> </p><div id="_idContainer103" class="IMG---Figure"><img src="Images/Figure_8.1_B17405.jpg" alt="Figure 8.1 – Create repository button&#13;&#10;" width="338" height="77"/></div><p class="figure-caption">Figur<a id="_idTextAnchor219"/>e 8.1 – Create repository button</p></li>
				<li>On the <strong class="bold">Create repository</strong> screen, under <strong class="bold">Repository settings</strong>, use <strong class="source-inline">chapter8</strong> for the name of the repository. If you like, you can add a description for the repository, but it is not necessary. You may wish to enable the CodeGuru reviewer at this point; however, since this is a new feature, we will not be going over this: <div id="_idContainer104" class="IMG---Figure"><img src="Images/Figure_8.2_B17405.jpg" alt="Figure 8.2 – New code commit repository settings&#13;&#10;" width="747" height="660"/></div><p class="figure-caption"> </p><p class="figure-caption">Figure 8.2 – New code commit repository settings</p><p class="callout-heading">Note</p><p class="callout">The Amazon CodeGuru reviewer is an optional feature and an additional service of AWS that, at the time of publishing, only works for the Java and Python languages. More languages may be available at a later time.</p></li>
				<li>Once you <a id="_idIndexMarker793"/>have created your repository, you will be taken to a screen showing the connection steps for connecting to your new repository in several ways. These include HTTPS, <strong class="source-inline">SSH</strong>, and the git-remote-connect protocol over HTTPS. Take a moment to look over these. We will be using this section more once our developer has been created and we are using their set of permissions. Scroll down past the connection steps. At the bottom of the page, you will see a button called <strong class="bold">Create file</strong>. Click this button so that we can set up our main branch:<div id="_idContainer105" class="IMG---Figure"><img src="Images/Figure_8.3_B17405.jpg" alt="Figure 8.3 – Creating an initial file for our CodeCommit repository&#13;&#10;" width="554" height="207"/></div><p class="figure-caption">Figure 8.3 – Creating an initial file for our CodeCommit repository</p></li>
				<li>On the <strong class="bold">Create a file</strong> screen, type some text into the box. Any text will do; for example, <strong class="source-inline">Welcome to my repository</strong>. Once you have done this, in the <strong class="bold">File name</strong> box, name <a id="_idIndexMarker794"/>the file <strong class="source-inline">sample.txt</strong>. You will also have to enter a name and an <strong class="bold">Email address</strong> for the commit on the web interface, as shown in the following screenshot: <div id="_idContainer106" class="IMG---Figure"><img src="Images/Figure_8.4_B17405.jpg" alt="Figure 8.4 – Committing the change to CodeCommit via the web interface&#13;&#10;" width="562" height="441"/></div><p class="figure-caption">Figure 8.4 – Committing the change to CodeCommit via the web interface</p></li>
				<li>Once you've entered this information, you can press the orange <strong class="bold">Commit changes</strong> button. From here, you will be taken to the file in the repository; however, it's more important to note that, in the top right-hand corner of the screen, we have successfully created the <strong class="bold">main</strong> branch: </li>
			</ol>
			<div>
				<div id="_idContainer107" class="IMG---Figure">
					<img src="Images/Figure_8.5_B17405.jpg" alt="Figure 8.5 – The main branch of our CodeCommit repository&#13;&#10;" width="648" height="78"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.5 – The main branch of our CodeCommit repository</p>
			<p>With our repository and main branch now created, we can start creating the permission set that our <a id="_idIndexMarker795"/>developers will use to push code up to the repository. Depending on how your organization is structured, you may give all developers the ability to create new repositories and merge pull requests to the main branch. </p>
			<p>In our example scenario, as we work through the exercises, we will be separating the duties from what a developer can do versus an administrator or DevOps power user. It's imperative to think about how to divide responsibilities as you prepare for the exam, as well as some of the questions and scenarios that may be presented.</p>
			<h2 id="_idParaDest-214"><a id="_idTextAnchor220"/>Creating your IAM group for developers </h2>
			<p>Before we begin, make sure that you download the files from this book's GitHub repository, from the <strong class="source-inline">Chapter-8</strong> folder. We will <a id="_idIndexMarker796"/>start by creating the IAM policy for the developers. Once our policy has been uploaded, we will create the developer group and then attach our policy to the newly created group:</p>
			<ol>
				<li value="1">Open your terminal so that you have access to your AWS CLI. </li>
				<li>We want to create a group just for our code commit developers. You may have made a developers group previously, but we want to make a new group just for this chapter:<p class="source-code"><strong class="bold">aws iam create-group --group-name CC_Developers</strong></p></li>
				<li>Now that you have created the group, we will attach the policy to it. We will need the policy ARN from when we created our <strong class="source-inline">CC_Developers </strong>policy just a few moments ago:<p class="source-code"><strong class="bold">aws iam attach-group-policy </strong></p><p class="source-code"><strong class="bold">  --policy-arn arn:aws:iam::aws:policy/AWSCodeCommitPowerUser –group-name CC_developers</strong></p></li>
				<li>Now <a id="_idIndexMarker797"/>that we have created the <strong class="source-inline">CC_Developers</strong> group, we can create our developer and allow them to log in and add their <strong class="source-inline">SSH</strong> key to start using <strong class="source-inline">CodeCommit</strong>.</li>
			</ol>
			<h2 id="_idParaDest-215"><a id="_idTextAnchor221"/>Creating your developer</h2>
			<p>In this section, we are going to create a fictional developer called <strong class="source-inline">Mariel</strong>. If you like, you can change <a id="_idIndexMarker798"/>the name of the developer from <strong class="source-inline">Mariel</strong> to something else. If you haven't already, download the <strong class="source-inline">change-password.json</strong> file and follow these steps: </p>
			<ol>
				<li value="1">If your terminal isn't open still, open it back up so that you can perform commands in the AWS CLI. Use the <strong class="source-inline">create-user</strong> command from <strong class="source-inline">iam</strong>:  <p class="source-code"><strong class="bold">$aws iam create-user --user-name mariel</strong></p></li>
				<li>Once this command has finished running, it should return a <strong class="source-inline">JSON</strong> statement that shows, among other things, the User ID, as shown in the following example:<p class="source-code"><strong class="bold">{</strong></p><p class="source-code"><strong class="bold">    "User": {</strong></p><p class="source-code"><strong class="bold">        "Path": "/",</strong></p><p class="source-code"><strong class="bold">        "UserName": "mariel",</strong></p><p class="source-code"><strong class="bold">        "UserId": "AIDAW24Q7QQFVGQHQJM3Y",</strong></p><p class="source-code"><strong class="bold">        "Arn": "arn:aws:iam::000066100007:user/mariel",</strong></p><p class="source-code"><strong class="bold">        "CreateDate": "2021-05-02T11:06:47+00:00"</strong></p><p class="source-code"><strong class="bold">    }</strong></p><p class="source-code"><strong class="bold">}</strong></p></li>
				<li>With our user created, we can attach them to the <strong class="source-inline">CC_Developers</strong> group and allow them to inherit all the group's permissions:<p class="source-code"><strong class="bold">$aws iam add-user-to-group --user-name mariel --group-name CC_Developers</strong></p></li>
				<li>Now that we've created our user and attached them to the <strong class="source-inline">CC_Developers</strong> group, we will need to create an initial password for the user so that they can log into the management console and upload their <strong class="source-inline">SSH</strong> key. It is also a good idea to require them to reset their password: <p class="source-code"><strong class="bold">aws iam create-login-profile --user-name mariel --password Dev0psPRO123! --password-reset-required</strong></p></li>
			</ol>
			<p>With that, we have created an initial password for our user to configure their <strong class="source-inline">SSH</strong> key settings in <a id="_idIndexMarker799"/>the console and view the CodeCommit branches via the console. </p>
			<p>Now that we've created our developer using the AWS CLI, we can switch contexts and assume the role of the developer as we continue. </p>
			<h2 id="_idParaDest-216"><a id="_idTextAnchor222"/>Adding your developer's SSH key </h2>
			<p>Now that <a id="_idIndexMarker800"/>we have created our developer, we will switch from the CLI and move to the <strong class="bold">Management Console</strong>. Before we <a id="_idIndexMarker801"/>do this, however, we must ensure that we have an <strong class="source-inline">SSH</strong> key pair <a id="_idIndexMarker802"/>in our working environment that we can use to authenticate ourselves when creating code. </p>
			<p class="callout-heading">Tip</p>
			<p class="callout">When using a specific repository or set of repositories for an account, client, or specific purpose, it's a good idea to create a particular key just for that project, account, or client. Using distinct keys is part of an overall risk mitigation strategy in case anything were to happen to the servers, SaaS offerings, or your workstation.</p>
			<p>Let's start by creating an <strong class="source-inline">SSH</strong> key pair that's specific for our developer to be able to add to the AWS IAM console. </p>
			<p>In your terminal, use the following command to generate a new key pair file for Linux or macOS users:</p>
			<p class="source-code">$ ssh-keygen -t rsa -b 4096</p>
			<p>Running this command will start by asking you a few prompts, the first of which will be where you want to save your key. The default should be in your local <strong class="source-inline">.ssh</strong> folder, but with an <strong class="source-inline">id_rsa</strong> name. Instead, we will use a custom name for our key so that we know it is specifically for our code commit project:</p>
			<p class="source-code">Enter file in which to save the key (/Users/abook/.ssh/id_rsa): /Users/abook/.ssh/cc_developer</p>
			<p>After you <a id="_idIndexMarker803"/>have chosen where to save you key with its name, then you will be presented with a prompt for a <strong class="source-inline">passphrase</strong>:</p>
			<p class="source-code">Enter passphrase (empty for no passphrase):</p>
			<p>We have no <a id="_idIndexMarker804"/>requirements for a passphrase, so just hit <em class="italic">Enter</em> twice to leave this blank. At this point, you should see statements saying where your identity and public key have been saved, along with something that looks like ASCII art.</p>
			<p>You will need to cat out your public key and have that available when we log into the AWS console as the developer. </p>
			<h3>After you have generated your key</h3>
			<p>Now that <a id="_idIndexMarker805"/>we have generated our key, we need to log into the AWS console using the developer's username and credentials that we just created (and not the DevOps user who has administrator privileges, which is what we have been using up to this point.)</p>
			<p class="callout-heading">Tip</p>
			<p class="callout">You may want to use a different browser or start an incognito/private session, just to be sure that you don't have any lingering cookies. </p>
			<p>In your new browser, log in as the developer user that we just created:</p>
			<ol>
				<li value="1">We will now use the developer account instead of our administrator account. Log into your account at <a href="https://aws.amazon.com/">https://aws.amazon.com/</a> and use the developer's name (<strong class="source-inline">mariel</strong>, in our case) and password (<strong class="source-inline">Dev0psPRO</strong>) to sign into the AWS Management Console initially. </li>
				<li>Once signed in, you will be immediately prompted to change your password from the <a id="_idIndexMarker806"/>initial password that was set to one of your choosing. If you previously put a password policy in the <strong class="bold">IAM Account</strong> settings, you must adhere to these guidelines when changing the password: <div id="_idContainer108" class="IMG---Figure"><img src="Images/Figure_8.6_B17405.jpg" alt="Figure 8.6 – Mandatory password change for the developer user&#13;&#10;" width="707" height="454"/></div><p class="figure-caption">Figure 8.6 – Mandatory password change for the developer user</p></li>
				<li>Once you have changed the password, you will be brought to the main page of the AWS management console. Now, we need to type <strong class="bold">IAM</strong> in the search box to go to the <strong class="bold">IAM service</strong>.</li>
				<li>Once you have reached the IAM service, it will look as if you don't have permission to do anything. However, this is only because the developer role has a limited scope of permissions. This user can list users and update information about their user. Click on the <strong class="bold">Users</strong> menu item on the left-hand menu. </li>
				<li>Once you're on the user's menu, you will see a list of users. Click on the name of the developer that we created (in our case, <strong class="source-inline">mariel</strong>):<div id="_idContainer109" class="IMG---Figure"><img src="Images/Figure_8.7_B17405.jpg" alt="Figure 8.7 – List of IAM users &#13;&#10;" width="766" height="333"/></div><p class="figure-caption">Figure 8.7 – List of IAM users </p></li>
				<li>On the <strong class="bold">Summary</strong> page for the user, you will be met by a few red boxes, but here, we <a id="_idIndexMarker807"/>are interested in the <strong class="bold">Security credentials</strong> tab. Click on this tab so that you can start modifying the <strong class="bold">Security credentials</strong> page:<div id="_idContainer110" class="IMG---Figure"><img src="Images/Figure_8.8_B17405.jpg" alt="Figure 8.8 – IAM user summary top menu &#13;&#10;" width="1164" height="86"/></div><p class="figure-caption">Figure 8.8 – IAM user summary top menu </p></li>
				<li>Scrolling down on the <strong class="bold">Security credentials</strong> page, you will come to <strong class="source-inline">SSH</strong><strong class="bold"> Keys for AWS CodeCommit</strong>. Underneath this header will be a button we need to press labeled <strong class="bold">Upload </strong><strong class="source-inline">SSH</strong><strong class="bold"> public key</strong>. Before pressing this button, make sure that you have the output of your <strong class="source-inline">public key</strong> not only available but in your clipboard, ready to paste. Press the <strong class="bold">Upload </strong><strong class="source-inline">SSH</strong><strong class="bold"> public key</strong> button to continue. </li>
				<li>When the pop-up window appears, paste your public key into the text box and then click the blue <strong class="bold">Upload </strong><strong class="source-inline">SSH</strong><strong class="bold"> public key</strong> button. Once your key has been uploaded and the pop-up has disappeared, you should see a unique identifier for your key under the <strong class="source-inline">SSH</strong><strong class="bold"> key ID</strong> listing. Take note of this as we need this ID in just a moment for our local setup: <div id="_idContainer111" class="IMG---Figure"><img src="Images/Figure_8.9_B17405.jpg" alt="Figure 8.9 – The SSH key ID is given in the IAM console once the SSH public key has been uploaded&#13;&#10;" width="901" height="109"/></div><p class="figure-caption">Figure 8.9 – The SSH key ID is given in the IAM console once the SSH public key has been uploaded</p></li>
				<li>Back in your workstation, we need to either create a <strong class="source-inline">.ssh/config</strong> file or modify the existing <strong class="source-inline">config</strong> file by adding a few lines specific to the code commit. Use your editor <a id="_idIndexMarker808"/>of choice to create or open <strong class="source-inline">~/.ssh/config</strong> and then add the following lines. Be sure to change out the sample user ID for the one that the AWS console returned to you after uploading your key. Also, if you created a different name for your <strong class="source-inline">SSH</strong> key, you will have to substitute that in the <strong class="source-inline">IdentityFile</strong> line: <p class="source-code"><strong class="bold">Host git-codecommit.*.amazonaws.com</strong></p><p class="source-code"><strong class="bold">User APKAW24Q7QQFSRFEETDF</strong></p><p class="source-code"><strong class="bold">IdentityFile ~/.ssh/cc_developer</strong></p></li>
				<li>Going back to the browser and the AWS Management console, we will now switch over to the CodeCommit service so that we can get the repository information to clone the repository. In the top search box, type <strong class="source-inline">CodeCommit</strong> and then click on the icon to be taken to the <strong class="bold">CodeCommit</strong> service page. <div id="_idContainer112" class="IMG---Figure"><img src="Images/Figure_8.10_B17405.jpg" alt="Figure 8.10 – The CodeCommit icon from the search bar in the AWS Management Console&#13;&#10;" width="614" height="404"/></div><p class="figure-caption">Figure 8.10 – The CodeCommit icon from the search bar in the AWS Management Console</p></li>
				<li>Once on the <strong class="bold">CodeCommit</strong> page, you should see the <strong class="bold">chapter8</strong> repository that we created <a id="_idIndexMarker809"/>previously. Click on the <strong class="source-inline">SSH</strong> link on the right-hand side to copy the <strong class="bold">Clone URL</strong> property:<div id="_idContainer113" class="IMG---Figure"><img src="Images/Figure_8.11_B17405.jpg" alt="Figure 8.11 - The CodeCommit repository as it appears to the developer user&#13;&#10;" width="1082" height="238"/></div><p class="figure-caption">Figure 8.11 - The CodeCommit repository as it appears to the developer user</p></li>
				<li>Switch back to your terminal and navigate to the root of your home folder. Then, cut and paste the copied URL after the <strong class="source-inline">git clone</strong> command, as shown here:<p class="source-code"><strong class="bold">$cd ~</strong></p><p class="source-code"><strong class="bold">$git clone ssh://git-codecommit.us-east-2.amazonaws.com/v1/repos/chapter8</strong></p></li>
				<li>Finally, move to the <strong class="source-inline">chapter8</strong> directory. Now, you are ready to start adding some code or objects.</li>
			</ol>
			<p>At this point, we have created an <strong class="source-inline">SSH</strong> key and added that to our development user. Then, we updated our local <strong class="source-inline">SSH</strong> config to let CodeCommit know that when working with code commit, which user and keypair are connected. Finally, we downloaded the repository that the administrative user had created earlier. We are now ready to create our developer branch and start pushing up some commits. </p>
			<h2 id="_idParaDest-217"><a id="_idTextAnchor223"/>Creating a developer branch and pushing commits to that branch </h2>
			<p>Now that we have successfully cloned our repository to our local workstation, it's time to create <a id="_idIndexMarker810"/>a branch and submit it. All of these actions will happen in the directory where you cloned your repository. If you followed the same naming convention as in the preceding examples, you should go to your home directory and find the <strong class="source-inline">chapter8</strong> folder. </p>
			<p>The first thing that we will do is create a feature branch off of the main branch: </p>
			<p class="source-code">$git checkout -b feature1</p>
			<p class="source-code">Switched to a new branch feature 1</p>
			<p>Now that we're in our branch, we can start adding some files to make the commit. There are two sample files (<strong class="source-inline">hello.py</strong> and <strong class="source-inline">loops.py</strong>) in the <strong class="source-inline">Chapter-8</strong> folder of the GitHub repository. You can view these files and then cut and paste the raw contents into new files of the same name in the <strong class="source-inline">chapter8</strong> CodeCommit repository that we have downloaded. </p>
			<p>Before we make our commits, we should check the status of our files in our directory:</p>
			<p class="source-code"><strong class="bold">$git status</strong></p>
			<p>After using the <strong class="source-inline">status</strong> command, we should see an output similar to the following:</p>
			<p class="source-code">On branch feature1</p>
			<p class="source-code">No commits yet</p>
			<p class="source-code">Untracked files:</p>
			<p class="source-code">  (use "git add &lt;file&gt;..." to include in what will be committed)</p>
			<p class="source-code"> hello.py</p>
			<p class="source-code"> loops.py</p>
			<p class="source-code">nothing added to commit but untracked files present (use "git add" to track)</p>
			<p>Now, we need to add the two files to the commit. Since they are both of the same types, we can use a wildcard in our commit command. As an alternative, you can use just a pure wildcard and add all the untracked files to the commit at once: </p>
			<p class="source-code">$git add *.py </p>
			<p>At this point, we need to commit the files to our feature branch:</p>
			<p class="source-code">$git commit -m "adding python files for feature 1"</p>
			<p>Finally, with the two files committed to the feature branch, it's time to push that feature branch up to CodeCommit:</p>
			<p class="source-code">$git push origin feature1</p>
			<p>Upon successfully pushing the new feature branch, you should receive confirmation from the command line: </p>
			<p class="source-code">* [new branch]      feature1 -&gt; feature1</p>
			<p>Now that <a id="_idIndexMarker811"/>we have made the commit to our feature branch and pushed it up to the CodeCommit repository, it's time to make the merge request. This merge request will allow our code to become part of the main branch for everyone else who is working off of the same code repository, along with keeping up to date with the main branch. </p>
			<p>We will go back to the AWS console as our developer user to create the pull request. If you still have your developer's separate session open in a web browser, then you can switch back to that browser session; otherwise, log into your account at <a href="https://aws.amazon.com/">https://aws.amazon.com/</a> and then use the developer's username (<strong class="source-inline">mariel</strong>, in our case) and the new password you changed for your developer user: </p>
			<ol>
				<li value="1">In the search box at the top, type <strong class="source-inline">CodeCommit</strong> and then click on the <strong class="bold">CodeCommit</strong> icon to be brought to the <strong class="bold">Service</strong> page. </li>
				<li>You should see your repository, as shown in <em class="italic">Figure 8.7</em>. Click on the name of the repository (<strong class="source-inline">chapter8</strong>).</li>
				<li>In the top menu, you will see a dropdown that currently says <strong class="bold">main</strong>. Click on this dropdown and select your branch (<strong class="bold">feature1</strong>). Once you've done this, the two files that you have uploaded will appear. </li>
				<li>Now that your branch name is showing in the top menu, you should see a button called <strong class="bold">Create pull request</strong>. Click on this button to start the merge request:<div id="_idContainer114" class="IMG---Figure"><img src="Images/Figure_8.12_B17405.jpg" alt="Figure 8.12 – The Create pull request button alongside the branch name &#13;&#10;" width="995" height="96"/></div><p class="figure-caption">Figure 8.12 – The Create pull request button alongside the branch name </p></li>
				<li>A green <a id="_idIndexMarker812"/>box should appear, showing that we don't currently have any conflicts between our branch and the main branch. Before you create the merge request, you will need to add something to the <strong class="bold">Title</strong> box in the <strong class="bold">Details</strong> section. It can be as simple as <strong class="source-inline">Python files</strong>. With the title filled in, click on the orange <strong class="bold">Create pull request</strong> button at the bottom of the screen:<div id="_idContainer115" class="IMG---Figure"><img src="Images/Figure_8.13_B17405.jpg" alt="Figure 8.13 – The pull request showing that it has no conflicts&#13;&#10;" width="760" height="287"/></div><p class="figure-caption">Figure 8.13 – The pull request showing that it has no conflicts</p></li>
				<li>Once you have created the pull request, you will be taken to a screen where you can view the details of the currently opened pull request.</li>
			</ol>
			<p>Now that we have entered the pull request, this is where the developer user stops. The IAM policy that we have allocated will not allow them to merge the branches, and this is by design. </p>
			<p>Next, using our administrator, we will learn how to merge the request into the main branch. </p>
			<h2 id="_idParaDest-218"><a id="_idTextAnchor224"/>Approvals in CodeCommit </h2>
			<p>As developers update code and then push those updates to the CodeCommit repository, especially <a id="_idIndexMarker813"/>if they are using their feature branches, there needs to be a process for incorporating their changes into the main branch. Let's walk through how to take the code that our developer created on their branch and merge it into the main branch. </p>
			<h2 id="_idParaDest-219"><a id="_idTextAnchor225"/>Merging your developer branch with the main branch</h2>
			<p>At <a id="_idIndexMarker814"/>this point, we haven't enabled any notifications for our repository, but in a real-world scenario, this is an excellent way to add notifications for when someone has created a pull request. Our developer has created a branch on our repository, which is now ready to be merged. As the account user with merge privileges, we will log in and merge the feature branch and the main branch: </p>
			<ol>
				<li value="1">Open your console and log into <strong class="bold">Amazon Web Console</strong> as the primary administrative user that you have been using up to this point, not the developer user. </li>
				<li>Navigate to the <strong class="bold">CodeCommit</strong> service by searching for <strong class="source-inline">CodeCommit</strong> in the top search bar in the middle of the screen. Once the <strong class="bold">CodeCommit</strong> icon becomes visible, click on it:<div id="_idContainer116" class="IMG---Figure"><img src="Images/Figure_8.14_B17405.jpg" alt="Figure 8.14 – Searching for CodeCommit in the top search box for services &#13;&#10;" width="648" height="423"/></div><p class="figure-caption">Figure 8.14 – Searching for CodeCommit in the top search box for services </p></li>
				<li>Once on the main CodeCommit screen, so long as you are in the correct region, you should see the repository that we created earlier by the developer user named <strong class="bold">chapter8</strong>. Click on this repository name to be taken into the repository: <div id="_idContainer117" class="IMG---Figure"><img src="Images/Figure_8.15_B17405.jpg" alt="Figure 8.15 – The chapter8 repository inside of CodeCommit&#13;&#10;" width="1210" height="240"/></div><p class="figure-caption">Figure 8.15 – The chapter8 repository inside of CodeCommit</p></li>
				<li>After <a id="_idIndexMarker815"/>clicking the repository's name, a set of menu options will appear on the left-hand side of the screen, under <strong class="bold">Repositories</strong>. Here, you will find a sub-heading called <strong class="bold">Pull requests</strong> that will show us any outstanding pull requests, including the one that was created by our developer user previously. Click on the <strong class="bold">Pull requests</strong> menu item to be taken to the pull requests screen:<div id="_idContainer118" class="IMG---Figure"><img src="Images/Figure_8.16_B17405.jpg" alt="Figure 8.16 – Pull requests on the Repositories menu of CodeCommit &#13;&#10;" width="234" height="280"/></div><p class="figure-caption">Figure 8.16 – Pull requests on the Repositories menu of CodeCommit </p></li>
				<li>Our pull request name should be <strong class="bold">Python Files</strong>, predicated by number one. <strong class="bold">Python Files</strong> was the name that our developer user used when creating the pull request originally. We should also see a blue status of <strong class="bold">Open</strong> on the right-hand side of the pull request name. Click on the pull request's name, <strong class="bold">1:Python files</strong>, to be taken to the <strong class="bold">Merge</strong> screen: <div id="_idContainer119" class="IMG---Figure"><img src="Images/Figure_8.17_B17405.jpg" alt="Figure 8.17 – Pull request with status&#13;&#10;" width="860" height="98"/></div><p class="figure-caption">Figure 8.17 – Pull request with status</p></li>
				<li>Now, on the pull requests screen, which will be labeled with <strong class="bold">1: Python files</strong> at the top of the screen, you should see three colored labels right below the heading: <strong class="bold">Open</strong> (in blue), <strong class="bold">No approval rule</strong> (in dark gray), and <strong class="bold">No merge conflicts</strong> (in green). The latter is telling us that we can easily merge our pull request into the main branch. Do this by clicking on the orange <strong class="bold">Merge </strong>button at the top right-hand side of the screen: <div id="_idContainer120" class="IMG---Figure"><img src="Images/Figure_8.18_B17405.jpg" alt="Figure 8.18 – Notifications about the CodeCommit pull request&#13;&#10;" width="609" height="68"/></div><p class="figure-caption">Figure 8.18 – Notifications about the CodeCommit pull request</p></li>
				<li>At <a id="_idIndexMarker816"/>this point, we will come to the <strong class="bold">Merge pull request</strong> screen. This screen is all about the merge strategy, but for this exercise, we are going to leave the defaults as-is. This includes keeping the box checked at the bottom that will delete the branch that is being merged in and using the fast forward merge strategy. Click the orange <strong class="bold">Merge pull request</strong> button at the bottom right of the page to merge the feature branch into the main branch. </li>
				<li>Finally, you should see a notification at the top of the screen in green, telling you that your <strong class="source-inline">feature1</strong> branch has been merged into the main branch. </li>
			</ol>
			<p>We have just taken a thorough look at the CodeCommit service and looked at how to perform commits and merges from the perspective of multiple team members. With our source code in order, we will look at an AWS service that can produce packages along with test software: AWS CodeBuild. </p>
			<h1 id="_idParaDest-220"><a id="_idTextAnchor226"/>Using AWS CodeBuild </h1>
			<p><strong class="bold">AWS CodeBuild</strong> is a fully managed service that compiles source code, produces packages and container images, and runs tests. These steps are part of the continuous integration process, although <a id="_idIndexMarker817"/>not every project needs each of these steps. CodeBuild can also scale to meet your needs without any complex provisioning. Once you have configured the <strong class="source-inline">buildspec</strong> file and the job is initiated, CodeBuild will allocate the specified resources. </p>
			<p>This is in contrast to other build systems, where you need to manually provision the compute for the workers or perform complex setups to ensure that autoscaling environments are available for heavy build and test periods. </p>
			<p>You can run AWS CodeBuild as a standalone service, or it can be integrated with other services, such as <strong class="bold">CodeCommit</strong> and <strong class="bold">AWS CodePipeline</strong>, to create a repeatable, automated process that is part of your continuous integration life cycle. </p>
			<h2 id="_idParaDest-221"><a id="_idTextAnchor227"/>Features to know about CodeBuild</h2>
			<p>The following <a id="_idIndexMarker818"/>are some of the features you should know about CodeBuild:</p>
			<ul>
				<li><strong class="bold">It's a fully managed build service</strong>: There is no need to set up, patch, or update any servers or software.</li>
				<li><strong class="bold">It scales to meet your needs</strong>: CodeBuild can scale up and down to meet the demand you place on it. </li>
				<li><strong class="bold">It's securely backed by AWS</strong>: With optional encryption powered by KMS, along with permissions down to the specific job with IAM, you can feel confident in securing your build environment. </li>
				<li>It's one of the AWS developer tools that tightly integrates with CodeCommit, CodeDeploy, and CodePipeline. </li>
				<li>CodeBuild integrates natively with <strong class="bold">CloudWatch Events</strong> so that failed builds and items can be triggered, such as sending SNS messages. </li>
				<li>Logs can be set as output to S3 or <strong class="bold">CloudWatch Logs</strong>.</li>
				<li>CloudWatch metrics and alarms can be used to monitor CodeBuild thresholds. </li>
			</ul>
			<h2 id="_idParaDest-222"><a id="_idTextAnchor228"/>Creating a CodeBuild job</h2>
			<p>CodeBuild is <a id="_idIndexMarker819"/>very versatile in the tasks it can perform. For our <a id="_idIndexMarker820"/>example, we will create an <strong class="bold">Elastic Container Registry</strong> (<strong class="bold">ECR</strong>), use our <strong class="source-inline">buildspec</strong> file to create a Docker image, and then push that Docker image to the ECR: </p>
			<div>
				<div id="_idContainer121" class="IMG---Figure">
					<img src="Images/Figure_8.19_B17405.jpg" alt="Figure 8.19 – Layout of what the example CodeBuild job does&#13;&#10;" width="299" height="217"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.19 – Layout of what the example CodeBuild job does</p>
			<p>If you haven't already downloaded the <strong class="source-inline">Chapter-8</strong> files from this book's GitHub repository, then now is the perfect time since we will be using the <strong class="source-inline">docker</strong> directory in our first CodeBuild exercise: </p>
			<ol>
				<li value="1">Navigate to the directory where you have downloaded the <strong class="source-inline">Chapter-8</strong> files. Do not go into the <strong class="source-inline">docker</strong> directory, as we will upload all of the files at once using a recursive command: <p class="source-code"><strong class="bold">$ aws s3 cp docker s3://{yourS3bucket}/docker/ --recursive</strong></p></li>
				<li>First, we're going to create our ECR repository so that our container has a place to go once it's been built:<p class="source-code"><strong class="bold">$aws ecr create-repository \</strong></p><p class="source-code"><strong class="bold">    --repository-name chapter8</strong></p></li>
				<li>With our ECR repository created, we will open the AWS Console to complete the rest of the CodeBuild project. Make sure that you do this using the administrative user and not the developer user. Once your AWS console is open, search for <strong class="source-inline">CodeBuild</strong> in the top search box and then click on the icon to be taken to the CodeBuild service. </li>
				<li>On the CodeBuild service, click the orange button at the top right-hand corner that says <strong class="bold">Create build project</strong>.</li>
				<li>To create our project, we will start with the initial section: <strong class="bold">Project configuration</strong>. Use the following specified values to fill out this section. We are not <a id="_idIndexMarker821"/>going to use the optional build badge since it does not work with source code located in S3 buckets, but if we did, it would be a quick way to display whether our build is passing or failing to both ourselves and others on our team:<p>a. <strong class="bold">Project name</strong>: <strong class="source-inline">chapter8_docker</strong> </p><p>b. <strong class="bold">Description</strong>: <strong class="source-inline">An example build for chapter 8</strong>:</p><div id="_idContainer122" class="IMG---Figure"><img src="Images/Figure_8.20_B17405.jpg" alt="Figure 8.20 – Project configuration on the CodeBuild Create build project page&#13;&#10;" width="620" height="608"/></div><p class="figure-caption">Figure 8.20 – Project configuration on the CodeBuild Create build project page</p></li>
				<li>Next, we will move to the <strong class="bold">Source</strong> section. First, change the source from <strong class="bold">CodeCommit</strong> to <strong class="bold">S3</strong> since we have uploaded our source files to our S3 bucket. Then, we must find the bucket name where we uploaded our files. In this case, the bucket name is <strong class="source-inline">devopspro-beyond</strong>. Finally, we will provide the key that is asking for <a id="_idIndexMarker822"/>the folder that we uploaded the files in. In our case, this would be <strong class="source-inline">docker/</strong>. We don't have any versioning on our bucket, so we can leave this field blank: <div id="_idContainer123" class="IMG---Figure"><img src="Images/Figure_8.21_B17405.jpg" alt="Figure 8.21 – Source declaration in the CodeBuild project&#13;&#10;" width="527" height="520"/></div><p class="figure-caption">Figure 8.21 – Source declaration in the CodeBuild project</p></li>
				<li>Next, we will be taken to the <strong class="bold">Environment</strong> section of the CodeBuild project. Use the following values to complete the <strong class="bold">Environment</strong> section:<p>    a. <strong class="bold">Environment image</strong>: <strong class="bold">Managed image</strong><strong class="source-inline"> </strong></p><p>    b. <strong class="bold">Operating system</strong>: <strong class="bold">Ubuntu </strong></p><p>    c. <strong class="bold">Runtime(s)</strong>: <strong class="bold">standard</strong></p><p>    d. <strong class="bold">Image</strong>: <strong class="source-inline">aws/codebuild/standard:5.0</strong></p><p>    e. <strong class="bold">Image version</strong>: <strong class="bold">Always use the latest version for this runtime version</strong></p><p>    f. <strong class="bold">Environment type</strong>: <strong class="bold">Linux</strong> </p><p>    g. <strong class="bold">Service role</strong>: <strong class="bold">New service role</strong></p><p class="callout-heading">Note</p><p class="callout">For the image in the CodeBuild project, we have specified version 5.0 here. However, you may want to look for the latest version available from AWS.</p></li>
				<li>At this <a id="_idIndexMarker823"/>point, you can leave the rest of the options as they are, scroll down to the bottom of the page, and click on the orange <strong class="bold">Create build project</strong> button. </li>
				<li>You should now be taken to the screen of your build project. At the top, you will see a green banner stating that your build project has been created: <div id="_idContainer124" class="IMG---Figure"><img src="Images/Figure_8.22_B17405.jpg" alt="Figure 8.22 – A successful project created in AWS CodeBuild &#13;&#10;" width="636" height="74"/></div><p class="figure-caption">Figure 8.22 – A successful project created in AWS CodeBuild </p></li>
				<li>Now, we can try to run our job and see how it turns out. If you would like to run the job and start a build, then click the orange <strong class="bold">Start build</strong> button at the top right-hand corner of the screen. </li>
			</ol>
			<p>This is just a base project and doesn't have to be the stopping point. We can still edit both the job and the <strong class="source-inline">buildspec</strong> file to add enhancements to the job if we so wish. </p>
			<p>With our project created via the console using an S3 bucket as the source, we will now take a closer look at the actual file that runs the CodeBuild job: the <strong class="source-inline">buildspec</strong> file. </p>
			<h2 id="_idParaDest-223"><a id="_idTextAnchor229"/>Constructing the buildspec file</h2>
			<p>The <strong class="source-inline">buildspec</strong> file is <a id="_idIndexMarker824"/>what drives the CodeBuild process and has a few strict requirements:</p>
			<ul>
				<li>It must be named <strong class="source-inline">buildspec.yml</strong>, and it can go by no other names. </li>
				<li>It must be in the <strong class="source-inline">root directory</strong> of your source code folder.</li>
				<li>It must be in the YAML language.</li>
			</ul>
			<p>If you open the <strong class="source-inline">buildspec</strong> file to examine it after completing the previous exercise, then you would notice that it contains three major sections:</p>
			<ul>
				<li><strong class="bold">Version</strong>: This tells the CodeBuild service which version of the syntax you are using and is one of the few required sections. </li>
				<li><strong class="bold">Phases</strong>: These are the actual build phases that CodeBuild executes. The <strong class="bold">Phases</strong> section is one of the most powerful in CodeBuild as it performs many (if not all) of the following actions that comprise the build process: <p>a. <strong class="source-inline">Install</strong>: This is only used for installing packages in the build environment. If you need <a id="_idIndexMarker825"/>to install a testing framework such as <strong class="source-inline">pytest</strong> or <strong class="source-inline">Mocha</strong>, this is the step where you would perform this task. </p><p>b. <strong class="source-inline">pre-build</strong>: These are commands that happen before the actual build command is run. Pre-build commands can include signing into an <strong class="bold">Elastic Container Repository</strong> or installing packages from a <strong class="bold">PyPI server</strong>.</p><p>c. <strong class="source-inline">Build</strong>: At this part of the phase, these are the commands that are run during the build. These can be commands that build the software, create a container, or create commands that test the software. </p><p>d. <strong class="source-inline">post-build</strong>: Once the build has been completed, these are any commands that are performed afterward, which can include packaging up the software in a <strong class="source-inline">.jar</strong> or <strong class="source-inline">.war</strong> file, or creating a Python egg file. It can even involve uploading a container to a repository such as ECR or DockerHub. </p></li>
				<li><strong class="bold">Artifacts</strong>: This is the build output. This can include the names of the files, the actual files themselves, or both. The artifacts phase also allows you to keep the directory structure where the files have been created or strip that away so that you just have the files themselves. </li>
			</ul>
			<p>There are quite a few other options that are available in the <strong class="source-inline">buildspec</strong> file, depending on your use case. You can use environment variables, create reports, and even run as a specific user or a Linux operating system. For a complete list of options, please reference the AWS build spec documentation available at <a href="https://docs.aws.amazon.com/codebuild/latest/userguide/build-spec-ref.html">https://docs.aws.amazon.com/codebuild/latest/userguide/build-spec-ref.html</a>.</p>
			<p>We just <a id="_idIndexMarker826"/>took a deeper look at constructing <strong class="source-inline">buildspec</strong> files and what components they comprise. Next, we will concentrate on the artifacts that CodeBuild produces and how to export them and store them elsewhere. </p>
			<h2 id="_idParaDest-224"><a id="_idTextAnchor230"/>Storing CodeBuild artifacts</h2>
			<p>When you create a software package, you can have AWS CodeBuild automatically save this artifact <a id="_idIndexMarker827"/>into an S3 bucket for use during deployments. </p>
			<p>Inside of your <strong class="source-inline">buildspec</strong> file, if you are looking to create artifacts, you can declare just one artifact, or you can declare multiple artifacts. In the <em class="italic">Creating a CodeBuild job</em> section, the <strong class="source-inline">buildspec</strong> file had one artifact declared at the end. </p>
			<p class="callout-heading">Note</p>
			<p class="callout">While the name CodeArtifact may lead you to believe that you can automatically store CodeBuild artifacts <a id="_idIndexMarker828"/>after a build, you can't. CodeArtifact can be used in conjunction <a id="_idIndexMarker829"/>with CodeBuild by supplying language packages just like a <strong class="bold">NuGet</strong>, <strong class="bold">PyPi</strong>, or <strong class="bold">npm server</strong> would do <a id="_idIndexMarker830"/>during the build process so that your team can have standardized packages and forgo download limits from public servers. </p>
			<h2 id="_idParaDest-225"><a id="_idTextAnchor231"/>Using CodeBuild to test </h2>
			<p>While the <a id="_idIndexMarker831"/>first use of AWS CodeBuild that comes to mind may be creating packages for deployment and building Docker containers, this service also can serve a dual function in the SDLC process, and that is for testing. CodeBuild allows you to run the predefined unit tests and see reports of both a graphical and textual nature in the console regarding the results of those tests. </p>
			<p>Reports expire after 30 days of creation and once they have expired, you nor anyone else with access to the report can view the report. If you need to keep the results of a report for more than 30 days, then you have the option to export the raw results of the report to an S3 bucket, where they will not expire and will only be phased out based on the bucket's life cycle policy. </p>
			<p>CodeBuild supports the following test report file formats:</p>
			<ul>
				<li>Cucumber JSON </li>
				<li>Junit XML </li>
				<li>NUnit XML </li>
				<li>TestNG XML </li>
				<li>Visual Studio TRX </li>
			</ul>
			<p>Specifying a <a id="_idIndexMarker832"/>report group name in your <strong class="source-inline">buildspec</strong> file with information about your test cases allows CodeBuild to create a report group for you if one doesn't already exist. </p>
			<p>Once tests have been created, AWS CodeBuild can show reports on the console, providing a quick summary of the status of all of our tests. </p>
			<h2 id="_idParaDest-226"><a id="_idTextAnchor232"/>Triggering CodeBuild jobs via CodeCommit </h2>
			<p>AWS CodeCommit can be used as the input source for the build. CodeCommit by itself cannot <a id="_idIndexMarker833"/>natively signal to CodeBuild that it has received either a new commit or a merge into a branch. However, with the help of the Lambda service, you can add a trigger that will initiate the CodeBuild job. </p>
			<p>Having an automated process such as this without any manual intervention helps teams find bugs, along with deployed software, in a more expedient fashion. Creating a trigger that <a id="_idIndexMarker834"/>automatically signals the CodeBuild project to kick off the build is a great way to add continuous feedback to your <strong class="bold">Software Development Life Cycle </strong>(<strong class="bold">SDLC</strong>): </p>
			<div>
				<div id="_idContainer125" class="IMG---Figure">
					<img src="Images/Figure_8.23_B17405.jpg" alt="Figure 8.23 – Triggering a CodeBuild job from CodeCommit &#13;&#10;" width="635" height="157"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.23 – Triggering a CodeBuild job from CodeCommit </p>
			<p>Now that <a id="_idIndexMarker835"/>we have looked at how to start a CodeBuild job using the CodeCommit service automatically, we know how to automatically start CodeBuild jobs as soon as new code has been successfully merged into the project. </p>
			<p>In the next chapter, <a href="B17405_09_Final_JM_ePub.xhtml#_idTextAnchor237"><em class="italic">Chapter 9</em></a>, <em class="italic">Deploying Workloads with CodeDeploy and CodePipeline</em>, we will learn how the CodePipeline service can also be used to start a build process from CodeCommit. </p>
			<p>Next, we will look at some of the advanced features of AWS CodeBuild. </p>
			<h2 id="_idParaDest-227"><a id="_idTextAnchor233"/>Advanced features of AWS CodeBuild</h2>
			<p>Some of the features we will talk about in this section aren't mandatory for the DevOps professional exam. Since <a id="_idIndexMarker836"/>this book has <em class="italic">beyond</em> in its title, the following are some helpful features that can make using the service a bit easier. They are also good tips that you can share with teammates and clients. </p>
			<h3>Using AWS Session Manager to help troubleshoot builds</h3>
			<p>If you are <a id="_idIndexMarker837"/>trying to troubleshoot builds, then rather than looking up a way to <strong class="source-inline">ssh</strong> into the AWS-based docker images session manager, AWS Session Manager will allow you to jump into the build and try and troubleshoot what is happening. You can pause your build by adding <strong class="source-inline">codebuild-breakpoint</strong> to your <strong class="source-inline">buildspec</strong> file: </p>
			<p class="source-code">phases:</p>
			<p class="source-code">  pre_build:</p>
			<p class="source-code">    commands:</p>
			<p class="source-code">      - echo Entered the pre_build phase...</p>
			<p class="source-code">      - echo "Hello World"&gt; /tmp/test.txt</p>
			<p class="source-code">      - codebuild-breakpoint</p>
			<p>Once you <a id="_idIndexMarker838"/>have finished troubleshooting, you can pass <strong class="source-inline">codebuild-resume</strong> via the Command Prompt to pick up where you left off in your <strong class="source-inline">buildspec</strong> file. </p>
			<h1 id="_idParaDest-228"><a id="_idTextAnchor234"/>Summary</h1>
			<p>In this chapter, we looked at how we can get our teams to share code using the AWS native source code tool CodeCommit. We also looked at how to package, build, and test our software using the CodeBuild tool. </p>
			<p>In the next chapter, we will continue looking at <strong class="bold">AWS Developer Tools</strong>. This includes using CodeDeploy to deploy workloads and then tying everything together using AWS CodePipeline. </p>
			<h1 id="_idParaDest-229"><a id="_idTextAnchor235"/>Review questions </h1>
			<ol>
				<li value="1">You have been asked to set up a CodeCommit repository for your organization for the development team. The developers need the ability to push commits to their branches but not merge commits to the main branch, nor push commits to the main branch. The project manager also needs to be notified whenever a merge or a commit to the main branch occurs. Which combination of steps will safeguard the master branch and send the notification in the shortest time possible?<p>a. Attach a resource policy to the CodeCommit repository that denies members of the IAM developer group actions of pushing commits, merging requests, and adding files to the main branch. </p><p>b. Affix an IAM policy to the developer IAM developer group that denies the actions of pushing commits, merging requests, and adding files to the main branch. </p><p>c. Configure AWS CloudTrail to send log events to send logs events to Amazon CloudWatch logs. Create a CloudWatch alarm based on a defined metric filter to identify CodeCommit Repository events. Use an SNS topic as a target that the project manager is subscribed to for the CloudWatch Alarm.</p><p>d. Create an Amazon CloudWatch Events rule that's triggered by a CodeCommit Repository State Change event by the main branch. Use an SNS topic that the project manager is subscribed to for the target.</p><p>e. Create a Lambda function to check for repository changes that will be sent to an SNS topic that the project manager is subscribed to if changes are found. Have AWS CloudWatch Events run the Lambda every 15 minutes.</p></li>
				<li>You have a CodeCommit repository in your account that your developers have a limited set of actions for. Two new developers from a different Organizational Unit need to access this CodeCommit repository, but their users are based in a different AWS account. What is the most effective way to grant these new developers access?<p>a. Enable public access for the repository.</p><p>b. Create IAM users for each new developer and then grant them access to the repository.</p><p>c. Create an IAM group for the external developers, add the IAM users, and then provide access to the repository.</p><p>d. Create a cross-account role in your account, assign the necessary privileges to the role. and then provide the role ARN to the developers so that they can assume the role. </p></li>
				<li>A client is looking for a new code versioning service and no longer wants the management hassle of running his servers. Currently, his team is small and not looking to grow exponentially over the next four quarters, but he is extremely concerned about the encryption abilities of any service he considers. What can you explain to him regarding AWS CodeCommit's ability to protect objects and code with encryption? <p>a. All transmissions are encrypted in transit and can only be done through the HTTPS or <strong class="source-inline">SSH</strong> protocols. </p><p>b. Transmissions are encrypted in transit when sent through the <strong class="source-inline">SSH</strong> protocol.</p><p>c. CodeCommit repositories are automatically encrypted using KMS.</p><p>d. CodeCommit repositories can be encrypted using KMS.</p></li>
				<li>You are setting up a new build process that is using S3 as the source of the code. You want to have unit tests run against the code that you and other developers have previously created and placed in a directory called <strong class="source-inline">test/</strong>, which is located in the child directory in the main source code directory. You plan to work on this build process for 60 days and want to be able to view the historical test reports, even from the first build. How can you configure this with native AWS services?<p>a. The test reports will be available in the <strong class="bold">Reports</strong> tab of the CodeBuild section of the console if you specify a report section in your <strong class="source-inline">buildspec</strong> file.</p><p>b. Export the CodeBuild test data to S3 after every build and use AWS QuickSight to create the test reports. </p><p>c. The test reports will be available in the Reports tab of the CodeBuild section of the console if you specify a report section in your <strong class="source-inline">buildspec</strong> file. Create a Lambda function that is triggered by CloudWatch events to export the raw data from the test reports that will be saved to an S3 bucket and available to be reviewed. </p><p>d. This is not possible with native AWS services. </p></li>
			</ol>
			<h1 id="_idParaDest-230"><a id="_idTextAnchor236"/>Review answers </h1>
			<ol>
				<li value="1">b, d</li>
				<li>d</li>
				<li>a, c</li>
				<li>c</li>
			</ol>
		</div>
	</div></body></html>