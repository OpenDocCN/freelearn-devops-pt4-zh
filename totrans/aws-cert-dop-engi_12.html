<html><head></head><body><div id="sbo-rt-content"><div id="_idContainer161">
			<p><a id="_idTextAnchor265"/></p>
			<h1 id="_idParaDest-259"><a id="_idTextAnchor266"/>Chapter 10: Using AWS Opsworks to Manage and Deploy your Application Stack</h1>
			<p>If your operations team is already managing infrastructure and applications with either Puppet or Chef, then you should have already heard of OpsWorks. We'll look at how stacks can use pre-defined code to create the infrastructure applications and even the data tier for you. Need to perform updates to your apps? We will look into that as well.</p>
			<p>In this chapter, we're going to cover the following main topics:</p>
			<ul>
				<li>OpsWorks essentials</li>
				<li>Available OpsWorks platforms</li>
				<li>OpsWorks and Chef Automate</li>
				<li>Creating and deploying a recipe</li>
			</ul>
			<h1 id="_idParaDest-260"><a id="_idTextAnchor267"/>Technical requirements</h1>
			<p>Although not necessary, familiarity with either the Chef or Puppet platform will be helpful when reading this chapter. It is required that you understand the different components of a full-stack application and how they interact with each other. </p>
			<h1 id="_idParaDest-261"><a id="_idTextAnchor268"/>OpsWorks essentials</h1>
			<p>In <a href="B17405_07_Final_JM_ePub.xhtml#_idTextAnchor188"><em class="italic">Chapter 7</em></a>, <em class="italic">Using CloudFormation Templates to Deploy Workloads,</em> we took <a id="_idIndexMarker932"/>a look at the <strong class="bold">Infrastructure as a Service</strong> (<strong class="bold">IaaS</strong>) offering from <strong class="bold">Amazon Web Services</strong> (<strong class="bold">AWS</strong>). Now we <a id="_idIndexMarker933"/>will look at <a id="_idIndexMarker934"/>one of the <strong class="bold">Platform as a Service</strong> (<strong class="bold">PaaS</strong>) offerings from AWS, OpsWorks. </p>
			<p>OpsWorks is, in essence, a wrapper around the automation packages Chef and Puppet. Why would <a id="_idIndexMarker935"/>you want to use OpsWorks? The following bullet points outline why you would choose to implement OpsWorks as a solution for your client or enterprise:</p>
			<ul>
				<li><strong class="bold">Simple</strong>: OpsWorks is easy to use. </li>
				<li><strong class="bold">Productive</strong>: OpsWorks helps reduce errors by using scripted configuration.</li>
				<li><strong class="bold">Flexible</strong>: Deployments of any size can be simplified by using OpsWorks. </li>
				<li><strong class="bold">Powerful</strong>: OpsWorks helps reduce both the time of deployment and the costs to deploy. </li>
				<li><strong class="bold">Secure</strong>: The OpsWorks service allows for fine-grained access control. <p class="callout-heading">Important note</p><p class="callout">OpsWorks is <a id="_idIndexMarker936"/>one of the few services that doesn't require a region. It is a global service that shows all stacks created, no matter what region your cloud resources are currently residing in. </p></li>
			</ul>
			<p>OpsWorks can be especially helpful if you have a lean team that is responsible for all or most components:</p>
			<div>
				<div id="_idContainer144" class="IMG---Figure">
					<img src="Images/Figure_10.1_B17405.jpg" alt="Figure 10.1 – OpsWorks serving users from an app&#13;&#10;" width="359" height="459"/>
				</div>
			</div>
			<p class="figure-caption">Figure 10.1 – OpsWorks serving users from an app</p>
			<p>Through a <a id="_idIndexMarker937"/>series of events, you can both construct and manage your applications using AWS OpsWorks: </p>
			<div>
				<div id="_idContainer145" class="IMG---Figure">
					<img src="Images/Figure_10.2_B17405.jpg" alt="Figure 10.2 – Overview of how OpsWorks operates&#13;&#10;" width="687" height="189"/>
				</div>
			</div>
			<p class="figure-caption">Figure 10.2 – Overview of how OpsWorks operates</p>
			<p>First, you create a stack for your application. Multiple applications can reside on the same stack. They should all be components of the same system, such as a LAMP stack, a Rails deployment, or even a single- or double-tiered application. </p>
			<p>Second, after your stack has been provisioned, you must define your layers. In the case of a LAMP stack, those layers would be an Apache web server with PHP pages, along with a MySQL data store. </p>
			<p>Third, you will have your applications defined in a combination of code versioning repositories and deployment code, such as Puppet manifests or Chef recipes. </p>
			<p>Fourth, EC2 instances <a id="_idIndexMarker938"/>need to be defined in both number and size so that our application has a spot to be deployed to. </p>
			<p>And finally, for the fifth step, we need to choose a deployment strategy for our different layers. This strategy can vary based on whether you are performing manual or automated deployments. </p>
			<h2 id="_idParaDest-262"><a id="_idTextAnchor269"/>Understanding the components of OpsWorks </h2>
			<p>As we start <a id="_idIndexMarker939"/>to talk about OpsWorks, it will be essential to understand specific keywords. Let's now look at the components that make up the parts of OpsWorks. </p>
			<h3>Stacks </h3>
			<p>A <strong class="bold">stack</strong> represents the cloud infrastructure and applications that you want to manage. </p>
			<p>You cannot <a id="_idIndexMarker940"/>mix and match Windows and Linux instances <a id="_idIndexMarker941"/>in a stack. You can, however, run different distributions of Linux in the same stack. </p>
			<p>Your stack <a id="_idIndexMarker942"/>can comprise custom <strong class="bold">Amazon Machine Images</strong> (<strong class="bold">AMIs</strong>) as long as the base operating system from which the image was made is one of the supported operating systems. OpsWorks does not support custom Windows AMIs. </p>
			<h3>Layers </h3>
			<p>A <strong class="bold">layer</strong> defines how <a id="_idIndexMarker943"/>to set up and configure a set of instances, as well as any related <a id="_idIndexMarker944"/>resources. Every stack in OpsWorks contains one or more layers. You can think of a layer as a blueprint for OpsWorks to use for a set of one or more EC2 instances. </p>
			<p>At the layer level, you can define how to configure the instances, what packages are installed, and <a id="_idIndexMarker945"/>also define critical events that will happen during the lifecycle. </p>
			<p>There are <a id="_idIndexMarker946"/>several different types of layers that you can define in OpsWorks:</p>
			<ul>
				<li>Load balancer layers.</li>
				<li>Database layers. </li>
				<li>Application server layers. </li>
				<li>Custom OpsWorks layers (this is when no pre-defined layer will meet your requirements). </li>
				<li>Other layers: Linux stacks have the ability to create Ganglia layers for monitoring or Memcached layers for caching. </li>
			</ul>
			<h3>Instances </h3>
			<p>An instance <a id="_idIndexMarker947"/>in OpsWorks comprises a computing resource, such as an EC2 instance or on-premises server. </p>
			<p>Users can <a id="_idIndexMarker948"/>add instances to an OpsWorks stack in one of two ways:</p>
			<ul>
				<li>You can use OpsWorks to provision the instance. </li>
				<li>In the case of Linux-based stacks, you can register a previously created EC2 instance or on-premises server. This would then allow OpsWorks to manage the instance. </li>
			</ul>
			<p>AWS OpsWorks supports 64-bit versions of a few of the operating systems offered on the AWS EC2 platform, including Ubuntu and Amazon Linux, along with Windows Server. </p>
			<h3>Apps </h3>
			<p>In OpsWorks, an <strong class="bold">app</strong> represents <a id="_idIndexMarker949"/>code that you would like to apply to an application <a id="_idIndexMarker950"/>server. The code itself will reside in an application repository, such as GitHub or S3. When you deploy an application, OpsWorks triggers a deploy event. </p>
			<h2 id="_idParaDest-263"><a id="_idTextAnchor270"/>Lifecycle events in OpsWorks </h2>
			<p>There are <a id="_idIndexMarker951"/>five series of events that happen during the lifecycle of an instance when managed by OpsWorks. The events are as follows:</p>
			<ul>
				<li>Setup</li>
				<li>Configure </li>
				<li>Deploy</li>
				<li>Undeploy </li>
				<li>Shutdown</li>
			</ul>
			<p>Let's take a look at some of the events in a bit more detail:</p>
			<ul>
				<li><strong class="bold">Setup</strong>: This is <a id="_idIndexMarker952"/>triggered every time an instance boots up. It is also used for the initial installation of packages. </li>
				<li><strong class="bold">Deploy</strong>: This event <a id="_idIndexMarker953"/>is triggered when deploying a new software version. The Deploy event also allows for customizable software deployments. </li>
				<li><strong class="bold">Configure</strong>: The Configure <a id="_idIndexMarker954"/>event is triggered on all instances when there is a state change. This event is used to ensure that the configuration is up to date on all instances.</li>
			</ul>
			<h2 id="_idParaDest-264"><a id="_idTextAnchor271"/>Access management in OpsWorks </h2>
			<p>If you have a requirement to provide individual user-level access to instances, be they Linux or <a id="_idIndexMarker955"/>Windows instances, then OpsWorks might be the solution you are looking for. The AWS OpsWorks service provides an easy way to allow individual users to log in to the server with their own credentials without the use of custom scripts. </p>
			<p>If you have ever stood up EC2 instances and tried to get in via SSH, then you are most likely going to use the EC2 user or Ubuntu user, depending on the flavor of the operating system that you have used to provision your instance. If you would like to have custom users be able to access individual EC2 instances then this can become a complex setup, provisioning individual users and having them authenticate with either LDAP or an Active Directory Server. </p>
			<p>The same is true if you are allocating Windows servers on AWS. You need to take the key pair that <a id="_idIndexMarker956"/>you used to stand up the instance and then, using that key pair, decrypt the administrator password.</p>
			<p class="callout-heading">Important note</p>
			<p class="callout">All users <a id="_idIndexMarker957"/>for AWS OpsWorks Stacks must originate from <strong class="bold">Identity and Access Management</strong> (<strong class="bold">IAM</strong>) users.</p>
			<p>Opsworks lets you provision access for users to access to the instances in the stack quickly and easily without the need to set up an Active Directory or LDAP server. </p>
			<h3>Types of users in OpsWorks </h3>
			<p>There are two types of users inside of the AWS OpsWorks service: administrative users and regular OpsWorks users. </p>
			<p>Regular users <a id="_idIndexMarker958"/>in OpsWorks do not require an attached policy or any special OpsWorks permissions in their IAM user permissions. On a stack-by-stack basis, you can designate one or more of the following four permissions:</p>
			<ul>
				<li><strong class="bold">Show</strong>: This permission allows users to view the stack only. </li>
				<li><strong class="bold">Deploy</strong>: The deploy permission also includes the show permission, and adds on extra permissions for users to update and deploy apps. </li>
				<li><strong class="bold">Manage</strong>: The manage permission includes the deploy permission set along with adding stack management permissions, such as adding layers or instances. </li>
				<li><strong class="bold">Deny</strong>: The deny permission is used to deny specific permissions across a stack. </li>
			</ul>
			<h3>Importing users into OpsWorks </h3>
			<p>Throughout the course of the exercises we have performed so far, we have created a number of IAM users in the account we have been using. We are going to use these users in our <a id="_idIndexMarker959"/>next exercise to practice importing users into OpsWorks: </p>
			<ol>
				<li>Log on to the AWS terminal as the administrative user. </li>
				<li>Once logged in, navigate to the <strong class="bold">OpsWorks</strong> service by searching for <strong class="source-inline">OpsWorks</strong> in the top search box. Once <strong class="bold">OpsWorks</strong> appears, click on the <strong class="bold">OpsWorks</strong> icon to be taken to the <strong class="bold">OpsWorks</strong> service: <div id="_idContainer146" class="IMG---Figure"><img src="Images/Figure_10.3_B17405.jpg" alt="Figure 10.3 – The OpsWorks service from the top search bar in the AWS Console&#13;&#10;" width="525" height="173"/></div><p class="figure-caption">Figure 10.3 – The OpsWorks service from the top search bar in the AWS Console</p></li>
				<li>Even though once you import users, they appear in any one of the three sections of <a id="_idIndexMarker960"/>the OpsWorks service, we are going to import our users into <strong class="bold">OpsWorks Stacks</strong>. Click on the blue button on the bottom right, which is labeled <strong class="bold">Go to OpsWorks Stacks</strong>. </li>
				<li>Now, in the OpsWorks Stacks service, look to the left-hand menu and find the menu item named <strong class="bold">Users</strong>. Click on <strong class="bold">Users</strong> to be taken to the <strong class="bold">Users</strong> management screen: <div id="_idContainer147" class="IMG---Figure"><img src="Images/Figure_10.4_B17405.jpg" alt="Figure 10.4 – The Users menu item on the OpsWorks Stacks side menu bar&#13;&#10;" width="318" height="283"/></div><p class="figure-caption">Figure 10.4 – The Users menu item on the OpsWorks Stacks side menu bar</p></li>
				<li>In the main window pane, under any current users, find the link labeled <strong class="bold">Import IAM users to US East (Ohio)</strong>. Click on this link to be brought to the import page. </li>
				<li>Once you have clicked on this link, a new menu will appear, allowing you to select the users that you want to import into OpsWorks. Select one or more users that <a id="_idIndexMarker961"/>you want to import into OpsWorks as OpsWorks users, and then click the blue <strong class="bold">Import to OpsWorks</strong> button: <div id="_idContainer148" class="IMG---Figure"><img src="Images/Figure_10.5_B17405.jpg" alt="Figure 10.5 – Selecting the users to import inside of the OpsWorks service&#13;&#10;" width="1157" height="278"/></div><p class="figure-caption">Figure 10.5 – Selecting the users to import inside of the OpsWorks service</p></li>
				<li>Now we should see a list of our users that we have imported into OpsWorks. If we wanted to add further users or restrict their permissions (such as giving a user self-management access to add their own SSH key, or the ability to change their own password), we could do that by editing the user. Let's edit one user. Click on the edit link next to our developer, Mariel.</li>
				<li>In another terminal window, print out the contents of your developer's public SSH key that you created previously for the exercise in <a href="B17405_08_Final_JM_ePub.xhtml#_idTextAnchor212"><em class="italic">Chapter 8</em></a><em class="italic">,</em> <em class="italic">Creating Workloads with CodeCommit and CodeBuild</em>. Copy this public key to your clipboard for use in the next step: <p class="source-code"><strong class="bold">$cat ~/.ssh/cc_developer.pub </strong></p></li>
				<li>Switching back to the AWS Console, and now on the user Mariel's screen, scroll down until you see the multi-line text box to the left of <strong class="bold">Public SSH key</strong>. Paste the public key that you have previously copied into this box: <div id="_idContainer149" class="IMG---Figure"><img src="Images/Figure_10.6_B17405.jpg" alt="Figure 10.6 – Adding the developer's public SSH key to the OpsWorks user &#13;&#10;" width="1090" height="191"/></div><p class="figure-caption">Figure 10.6 – Adding the developer's public SSH key to the OpsWorks user </p></li>
				<li>With the public key added, our developer can log in to an instance with the following:<p class="source-code"><strong class="bold">$ ssh -i ~/.ssh/cc_developer mariel@INSTANCE-DNS</strong></p></li>
			</ol>
			<p>We have <a id="_idIndexMarker962"/>now gone through the exercise of importing previously created IAM users into OpsWorks, along with setting up our developer's previously created SSH key so that they can easily log into an OpsWorks instance with their own username. </p>
			<p>Next, we will look at some of the scenarios where you would want to use the OpsWorks service. </p>
			<h1 id="_idParaDest-265"><a id="_idTextAnchor272"/>Use cases for AWS OpsWorks </h1>
			<p>After getting this far, you may be wondering what the best cases to put this service into practical use are. We will look at a few scenarios detailing when it would make sense to use the OpsWorks service. You need to understand that when evaluating either scenarios <a id="_idIndexMarker963"/>presented by test questions or real-life situations, OpsWorks is one of a number of deployment and management tools that AWS offers. Elastic Beanstalk is another tool that can be used to provision, deploy, and manage instances and code. We will cover this in much more depth in the next chapter, <a href="B17405_11_Final_JM_ePub.xhtml#_idTextAnchor284"><em class="italic">Chapter 11</em></a>, <em class="italic">Using Elastic Beanstalk to Deploy your Application</em>. </p>
			<h1 id="_idParaDest-266"><a id="_idTextAnchor273"/>Available OpsWorks platforms</h1>
			<p>OpsWorks, by its nature, is a configuration management service that provides managed instances <a id="_idIndexMarker964"/>of Chef and Puppet. Both of these software packages are industry-recognized automation platforms that enable you to use code and configure your servers via automation. </p>
			<p>Now let's take a look at the three platforms that OpsWorks offers in a bit more depth. </p>
			<h2 id="_idParaDest-267"><a id="_idTextAnchor274"/>OpsWorks Stacks </h2>
			<p>The original <a id="_idIndexMarker965"/>service offering from OpsWorks was OpsWorks Stacks. By using layers, it helps you manage and organize your EC2 instances. </p>
			<h2 id="_idParaDest-268"><a id="_idTextAnchor275"/>OpsWorks for Chef Automate </h2>
			<p>If you have a team that is well versed in the creation of Chef cookbooks and knows how to use some <a id="_idIndexMarker966"/>of the more advanced features of Chef, such as Knife, yet doesn't want to deal with the hassles and headaches of maintaining their own Chef servers, then Chef Automate can be a logical choice for your team. </p>
			<p>If you are currently using Chef to manage some of your on-premises infrastructure, OpsWorks for Chef Automate can be set up to manage hybrid environments from a single source. </p>
			<p>OpsWorks for Chef Automate also has the ability to perform compliance scans. These compliance scans allow you to audit your applications on a regular basis to detect exposures and non-compliant configurations.</p>
			<p>There is no need to worry about patching, updating, or backing up your Chef server, since these are some of the tasks that OpsWorks takes care of for you. OpsWorks for Chef Automate also allows you to manage the instance of Chef through the Chef Console, or via the command line with Knife. </p>
			<h2 id="_idParaDest-269"><a id="_idTextAnchor276"/>OpsWorks for Puppet Enterprise</h2>
			<p>Puppet helps <a id="_idIndexMarker967"/>enforce the desired state of the infrastructure with its set of tools. </p>
			<p>If you are an existing Puppet user, then OpsWorks for Puppet Enterprise would be the most logical choice for you. Using OpsWorks for Puppet Enterprise, you can launch a Puppet master server in minutes, and then allow the OpsWorks service to handle operations tasks such as backup, software upgrades, and restorations. </p>
			<p>When using the Puppet Enterprise version of OpsWorks, the Puppet master houses and provisions all of <a id="_idIndexMarker968"/>the Puppet modules for the instances that need to run <strong class="bold">Puppet Agent</strong>. </p>
			<p>Now that <a id="_idIndexMarker969"/>we have looked at the various different options available for OpsWorks, including the two options that use Chef recipes as the basis, and the one option that uses Puppet manifests, we will now examine a quick example. This example will give us a better understanding of how all the different components of OpsWorks come together when trying to pick out the best solution, both for our clients and when looking at possible solutions for the <em class="italic">DevOps Professional Exam</em>. </p>
			<h1 id="_idParaDest-270"><a id="_idTextAnchor277"/>Creating and deploying a recipe</h1>
			<p>In this example, we will use OpsWorks to set up a stack and then create a layer. After our layer <a id="_idIndexMarker970"/>has been created, we will then use a recipe that is <a id="_idIndexMarker971"/>publicly available to deploy to our app: </p>
			<ol>
				<li value="1">Log in to the AWS Console as your administrative user and use the unified search bar to search for the <strong class="source-inline">OpsWorks</strong> service. Once you see the OpsWorks icon appear, click on the icon to be taken to the <strong class="bold">OpsWorks</strong> main page:<div id="_idContainer150" class="IMG---Figure"><img src="Images/Figure_10.7_B17405.jpg" alt="Figure 10.7 – The OpsWorks service from the unified search bar&#13;&#10;" width="540" height="174"/></div><p class="figure-caption">Figure 10.7 – The OpsWorks service from the unified search bar</p></li>
				<li>On the OpsWorks Stacks page, click on the blue <strong class="bold">Go to OpsWorks Stacks</strong> button, which should be at the bottom left. This is the original offering from OpsWorks:<div id="_idContainer151" class="IMG---Figure"><img src="Images/Figure_10.8_B17405.jpg" alt="Figure 10.8 – The OpsWorks Stacks option on the OpsWorks service page&#13;&#10;" width="385" height="375"/></div><p class="figure-caption">Figure 10.8 – The OpsWorks Stacks option on the OpsWorks service page</p></li>
				<li>Once on the OpsWorks Stacks page, click on the blue <strong class="bold">Create stack</strong> button at the top <a id="_idIndexMarker972"/>right-hand side of the page. This will start <a id="_idIndexMarker973"/>the process of creating a new stack in OpsWorks. </li>
				<li>Next, we are going to create a <strong class="source-inline">Chef-11</strong> stack with the following options:<ul><li><strong class="bold">Stack name</strong> – <strong class="source-inline">chapt-10</strong></li><li><strong class="bold">Region</strong> – <strong class="source-inline">US East (Ohio)</strong> </li><li><strong class="bold">VPC</strong> – (choose your default VPC) </li><li><strong class="bold">Default subnet</strong> – (leave the default subnet) </li><li><strong class="bold">Chef version</strong> – <strong class="source-inline">11.10</strong> </li><li><strong class="bold">Use Custom Cookbooks</strong> – <strong class="source-inline">YES</strong> </li><li><strong class="bold">Repository Type</strong> – <strong class="source-inline">Git</strong> </li><li><strong class="bold">Repository URL</strong> – <a href="https://github.com/amazonwebservices/opsworks-example-cookbooks.git">https://github.com/amazonwebservices/opsworks-example-cookbooks.git</a></li></ul></li>
				<li>Leave everything else as it is. </li>
				<li>Click on the blue <strong class="bold">Add Stack</strong> button.</li>
				<li>Refer to the following screenshot: <div id="_idContainer152" class="IMG---Figure"><img src="Images/Figure_10.9_B17405.jpg" alt="Figure 10.9 – Adding the options to create the stack &#13;&#10;" width="768" height="878"/></div><p class="figure-caption">Figure 10.9 – Adding the options to create the stack </p></li>
				<li>Now <a id="_idIndexMarker974"/>we should have seen a <strong class="bold">Congratulations! Your stack was created </strong>notification. Our next step is to add a <a id="_idIndexMarker975"/>layer to our stack. We can click the <strong class="bold">Add a layer</strong> link and click add a layer:<div id="_idContainer153" class="IMG---Figure"><img src="Images/Figure_10.10_B17405.jpg" alt="Figure 10.10 – The congratulations banner showing the link to add a layer &#13;&#10;" width="678" height="202"/></div><p class="figure-caption">Figure 10.10 – The congratulations banner showing the link to add a layer </p></li>
				<li>Now on the layer screen, we will select <strong class="bold">PHP App Server</strong> from the drop-down list. Once that is selected, then we can click the blue button that says <strong class="bold">Add Layer</strong>: <div id="_idContainer154" class="IMG---Figure"><img src="Images/Figure_10.11_B17405.jpg" alt="Figure 10.11 – Adding the layer in OpsWorks &#13;&#10;" width="1160" height="257"/></div><p class="figure-caption">Figure 10.11 – Adding the layer in OpsWorks </p></li>
				<li>With our <a id="_idIndexMarker976"/>layer available, we need to add an instance <a id="_idIndexMarker977"/>to our layer. With our <strong class="bold">PHP App Server</strong> page showing, we need to click the <strong class="bold">Add instance</strong> link at the very right-hand side: <div id="_idContainer155" class="IMG---Figure"><img src="Images/Figure_10.12_B17405.jpg" alt="Figure 10.12 – Showing our created layer in OpsWorks&#13;&#10;" width="1209" height="154"/></div><p class="figure-caption">Figure 10.12 – Showing our created layer in OpsWorks</p></li>
				<li>Now add the instance with the following details:<p><strong class="bold">Hostname</strong> – <strong class="source-inline">php-app1</strong></p><p><strong class="bold">Size</strong> – <strong class="source-inline">c5.large</strong></p><p><strong class="bold">Subnet </strong>– (leave the default subnet that is selected) </p><p>When you have filled in all of these options, click the blue <strong class="bold">Add Instance</strong> button at the bottom right-hand side of the selection window:</p><div id="_idContainer156" class="IMG---Figure"><img src="Images/Figure_10.13_B17405.jpg" alt="Figure 10.13 – Adding an instance to the OpsWorks layer &#13;&#10;" width="706" height="374"/></div><p class="figure-caption">Figure 10.13 – Adding an instance to the OpsWorks layer </p></li>
				<li>With your <a id="_idIndexMarker978"/>instance added, you can now start your <a id="_idIndexMarker979"/>instance. You will notice that on the screen this instance type is designated as a 24/7 instance. Press the <strong class="bold">start</strong> link under the <strong class="bold">Actions</strong> column to start your instance. </li>
				<li>After about a minute or so, the instance status should change from <strong class="source-inline">stopped</strong> or <strong class="source-inline">booting</strong> to <strong class="source-inline">online</strong>.</li>
			</ol>
			<p>Congratulations, you now have your stack up and running! </p>
			<p>Now that we have seen how to create an OpsWorks stack, including its layers, instances, and app, we will take a closer look at deployments in OpsWorks. We will continue with our current stack that we just created, using that stack to create an app and then deploy it to the stack. </p>
			<h1 id="_idParaDest-271"><a id="_idTextAnchor278"/>Deployments in OpsWorks</h1>
			<p>When you <a id="_idIndexMarker980"/>deploy an app in OpsWorks, its primary purpose is to deploy the application code and all of the files to the server instances. We previously created a stack, a layer, and an instance in OpsWorks. Now we will add an app and make a deployment to the stack:</p>
			<ol>
				<li value="1">Return to the OpsWorks Console and enter back into the stack we had previously created – named <strong class="source-inline">chapt-10</strong>. You can enter the stack by clicking on the stack name. </li>
				<li>Once inside the stack, on the left-hand menu, click on the item named <strong class="bold">Apps</strong> to be taken <a id="_idIndexMarker981"/>to the apps page. At the top of this page, click on the blue button labeled <strong class="bold">Add App</strong> to create a new app: <div id="_idContainer157" class="IMG---Figure"><img src="Images/Figure_10.14_B17405.jpg" alt="Figure 10.14 – Apps and Deployments in the left-hand menu in OpsWorks &#13;&#10;" width="241" height="126"/></div><p class="figure-caption">Figure 10.14 – Apps and Deployments in the left-hand menu in OpsWorks </p></li>
				<li>Use the following values to populate your app:<ul><li><strong class="bold">Name</strong> – <strong class="source-inline">S<a id="_idTextAnchor279"/>ampleAPP</strong></li><li><strong class="bold">Type</strong> – <strong class="source-inline">PHP</strong></li><li><strong class="bold">Repository Type</strong> – <strong class="source-inline">Git </strong></li><li><strong class="bold">Repository URL</strong> – <a href="https://github.com/awslabs/opsworks-demo-php-simple-app.git">https://github.com/awslabs/opsworks-demo-php-simple-app.git</a></li></ul><p>All other values can be left blank. After you have filled out these values click the blue <strong class="bold">Add App</strong> button at the bottom of the screen: </p><div id="_idContainer158" class="IMG---Figure"><img src="Images/Figure_10.15_B17405.jpg" alt="Figure 10.15 – Adding the app settings &#13;&#10;" width="990" height="726"/></div><p class="figure-caption">Figure 10.15 – Adding the app settings </p></li>
				<li>You should <a id="_idIndexMarker982"/>now see a screen showing our app. It's now time to deploy the app using OpsWorks. OpsWorks makes this easy with the <strong class="bold">deploy</strong> link being directly under the <strong class="bold">Actions</strong> column at the right-hand side of the app. Click the <strong class="bold">deploy</strong> link to start the deployment process: <div id="_idContainer159" class="IMG---Figure"><img src="Images/Figure_10.16_B17405.jpg" alt="Figure 10.16 – After the app has been created, it is ready to be deployed &#13;&#10;" width="897" height="104"/></div><p class="figure-caption">Figure 10.16 – After the app has been created, it is ready to be deployed </p></li>
				<li>On the deploy screen, before you deploy, click on the drop-down menu that currently has <strong class="bold">Deploy</strong> selected to see all of the different options for deployment. In this section, you can not only deploy the app, but also allow OpsWorks to undeploy, roll back, start, or stop a web server. Make sure that you retain the setting on deployment, and simply keep all of the defaults. Then click the blue <strong class="bold">Deploy</strong> button at the bottom of the screen. </li>
			</ol>
			<p>We have <a id="_idIndexMarker983"/>just completed provisioning an app using a custom recipe. We also deployed that app to the instance that we previously created. </p>
			<h1 id="_idParaDest-272"><a id="_idTextAnchor280"/>Monitoring OpsWorks </h1>
			<p>You can <a id="_idIndexMarker984"/>monitor your AWS OpsWorks stacks in a number of ways:</p>
			<ul>
				<li>Using Amazon CloudWatch </li>
				<li>Using Amazon CloudWatch Logs </li>
				<li>Using Amazon CloudWatch Events </li>
				<li>Using Amazon CloudTrail</li>
			</ul>
			<p>With Amazon CloudWatch, there are 13 custom metrics provided for detailed monitoring of each of the instances in the stack. There is also a custom monitoring page created in OpsWorks that summarizes the data and makes it easy to understand these metrics. If you are running Windows instances, the monitoring page will not display the metrics for those Windows instances. The metrics are displayed for the entire stack, but you can also concentrate on a particular layer or a particular instance. </p>
			<p>If you still have the deployment running from the previous exercise, you can click the <strong class="bold">Monitoring</strong> menu icon to be taken to the dashboard. This can give you quick insights into the state of your application: </p>
			<div>
				<div id="_idContainer160" class="IMG---Figure">
					<img src="Images/Figure_10.17_B17405.jpg" alt="Figure 10.17 – Monitoring dashboard in OpsWorks&#13;&#10;" width="1190" height="332"/>
				</div>
			</div>
			<p class="figure-caption">Figure 10.17 – Monitoring dashboard in OpsWorks</p>
			<p>We have just <a id="_idIndexMarker985"/>covered the full OpsWorks process from creating a stack to monitoring the stack. Now let's review what we learned. </p>
			<h1 id="_idParaDest-273"><a id="_idTextAnchor281"/>Summary</h1>
			<p>In this chapter we looked at how the OpsWorks service can help us provision and deploy both our infrastructure and application. It does this by using stacks and layers. We also learned that OpsWorks is a good way to quickly transition a team that is currently using either Chef or Puppet to provision their servers and/or applications in their current environment. </p>
			<p>In the next chapter, we will learn about the Elastic Beanstalk service and how it can help you deploy your applications into environments, create revisions for those applications, and help you monitor those applications using a number of different programming languages. </p>
			<h1 id="_idParaDest-274"><a id="_idTextAnchor282"/>Review questions</h1>
			<ol>
				<li value="1">You have been brought into a company that is starting its move to the AWS cloud. They have a sizable library of Chef recipes that they currently use to manage their on-premises systems. The recipes have already been moved to a private GitHub repository. The individual who managed and administrated the Chef servers left around one month ago. The company is not prepared to re-write all of the recipes to another means in the current fiscal year with their current available resources. What AWS service or services would be best for their migration? <p>a) Use AWS Server Migration Service to move the current Chef server to the AWS cloud. </p><p>b) Stand up the latest version of Chef on EC2 with autoscaling for redundancy. Add a Route 53 record in a locally hosted zone for the Chef server. Create a base AMI that already has the Chef agent pre-installed and connects to the DNS entry configured in Route 53. </p><p>c) Set up the applications as stacks in OpsWorks. Create all the different users as IAM users, and then import them into OpsWorks. Then assign the OpsWorks users to individual stacks as needed. </p><p>d) Create a CodePipeline instance to install and configure the applications as needed, using headless Chef in the user <strong class="source-inline">init</strong> script. </p></li>
				<li>A company has developed a PHP shopping cart platform. The platform is currently being managed and deployed by AWS OpsWorks with separate stacks for dev, QA, and production. With most of the PHP developers who originally developed the platform no longer with the company, management has given the go-ahead to start re-developing the platform in Python. How should the company manage the deployment?<p>a) Create a new OpsWorks stack that contains a new layer with the new Python code. To make the transition over to the new stack, the organization should use a blue/green deployment. </p><p>b) Create a new OpsWorks stack that has the new Python code manage separate deployments of the application from the secondary stack. </p><p>c) Update the existing stack with the new Python application code and deploy the app using the Deploy lifecycle event. </p><p>d) Create a new layer on the OpsWorks stack with the new Python code. To make the transition over to the new stack, the organization should use a rolling deployment. </p></li>
				<li>An enterprise oversees a combination of Windows servers and Linux servers (Red Hat Enterprise Linux and Amazon Linux) in their on-premises data center, along with their AWS account. After recently being audited, the CTO was told that there was no process in place for core application patches, nor for updating the operating systems. There was no baseline level of patching for any of the servers, either in the on-premises data centers or in the AWS cloud. You have been called in to help remedy the situation. What solution would you recommend that would be not only the most consistent for providing and maintaining OS and core application patch levels but would also prove the most reliable? <p>a) Use AWS Systems Manager to store the credentials in the parameter store, and then create resource groups for the instances. Allow the Systems Manager <strong class="source-inline">Run</strong> command to deploy patches remotely using the credentials stored in the parameter store. </p><p>b) Install the OpsWorks agent on all the servers, both on-premises and in the AWS account. Using a single stack, create different layers for the different operating systems. Create maintenance windows whenever an operating system or core application patch needs to be applied. </p><p>c) Configure the AWS Systems Manager agent on all of the servers, both on-premises and in the AWS account. Create resource groups for the instances and then allow Systems Manager Patch Manager to run with a pre-configured baseline, using set maintenance windows. </p><p>d) Install the OpsWorks agent on all the servers, both on-premises and in the AWS account. Create two different stacks, one for Windows and the other one for the Red Hat Linux instances. Create a Lambda job that will curl an RSS feed two times a day, checking for new patch updates. If it finds one, then it will trigger the deployment on the OpsWorks layer.</p></li>
			</ol>
			<h1 id="_idParaDest-275"><a id="_idTextAnchor283"/>Review answers</h1>
			<ol>
				<li value="1">c</li>
				<li>a</li>
				<li>c</li>
			</ol>
		</div>
	</div></body></html>