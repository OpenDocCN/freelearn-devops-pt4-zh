<html><head></head><body><div id="sbo-rt-content"><div id="_idContainer171">
			<h1 id="_idParaDest-276"><a id="_idTextAnchor284"/>Chapter 11: Using Elastic Beanstalk to Deploy your Application</h1>
			<p>Knowing and understanding Elastic Beanstalk is essential to the DevOps Pro exam. How to use the service's nuances, what the service's limitations are, and especially the way Beanstalk interacts with containers can be vital knowledge for both passing the exam and getting application teams up and running quickly in the real world. </p>
			<p>In this chapter, we're going to cover the following main topics:  </p>
			<ul>
				<li>Understanding the built-in functionality of Elastic Beanstalk</li>
				<li>Creating a service role in the IAM console</li>
				<li>Installing and using the Elastic Beanstalk command-line interface (EB CLI) </li>
				<li>Understanding advanced configuration options with .ebextensions</li>
				<li>Using Elastic Beanstalk to deploy an application</li>
				<li>Elastic Beanstalk use cases</li>
			</ul>
			<h1 id="_idParaDest-277"><a id="_idTextAnchor285"/>Technical requirements </h1>
			<p>Since Elastic Beanstalk requires some local development and we will be writing our example program in Python, you will need to have Python 3.x locally installed on your workstation. At the time of writing, the most up-to-date version of Python, which Elastic Beanstalk supported, was 3.8.5, and hence this would be the version of Python that we will be using in this chapter. It is the suggestion of the author that you install the <strong class="source-inline">pyenv</strong> Python runtime manager to help you to be able to develop and manage multiple versions of Python on your local workstation. You can find the project's information and how to install it on its GitHub site, which can be found at <a href="https://github.com/pyenv/pyenv">https://github.com/pyenv/pyenv</a>. </p>
			<h1 id="_idParaDest-278"><a id="_idTextAnchor286"/>Understanding the built-in functionality of Elastic Beanstalk </h1>
			<p>Elastic Beanstalk is a flexible platform that allows developers who develop in languages such as Python, Java, Ruby, .NET, PHP: Hypertext pre-processor (PHP), Go, or even Docker containers to develop <a id="_idIndexMarker986"/>and scale out their applications swiftly. Elastic Beanstalk is a <strong class="bold">Platform as a Service</strong> (<strong class="bold">PaaS</strong>), which means that it is <a id="_idIndexMarker987"/>serving as an abstraction layer above all of the other services <a id="_idIndexMarker988"/>that it is helping orchestrate and manage. This makes <a id="_idIndexMarker989"/>it easy for developers who are eager to get going with the <strong class="bold">Amazon Web Services</strong> (<strong class="bold">AWS</strong>) cloud but might not have <a id="_idIndexMarker990"/>a vast amount of knowledge of items such as setting up infrastructure or monitoring, the ability to get started, and concentrating on their application in the language of their choice. </p>
			<p>Elastic Beanstalk is constantly updating the languages and platforms that it supports. While it does not always support the latest version of a language, it does try to keep up to date with newer revisions and then sunset older versions. This is important to remember since legacy applications cannot just be pushed to the cloud and then left to run forever. There are times when applications will need to be upgraded in order to retain the functionality of the Elastic Beanstalk service. Here are some of the services that Elastic Beanstalk incorporates:</p>
			<div>
				<div id="_idContainer162" class="IMG---Figure">
					<img src="Images/Figure_11.1_B17405.jpg" alt="Figure 11.1 – A look at some of the services that Elastic Beanstalk incorporates &#13;&#10;" width="535" height="372"/>
				</div>
			</div>
			<p class="figure-caption">Figure 11.1 – A look at some of the services that Elastic Beanstalk incorporates </p>
			<p>Before the Elastic Beanstalk service was available for use, developers had to figure out which services to use to <a id="_idIndexMarker991"/>work together, and not only for computing, load balancing, and routing. They also needed to—either manually or with the help of a service such as CloudFormation templates—incorporate security, storage, and monitoring into their application. For developers who wanted to get up and running quickly on the AWS cloud, this could present a challenge, as they were used to creating application code rather than configuring environments. </p>
			<h2 id="_idParaDest-279"><a id="_idTextAnchor287"/>Different environments in Elastic Beanstalk </h2>
			<p>Any type of <a id="_idIndexMarker992"/>application that you build and deploy using Elastic Beanstalk allows you to manage all of the different components contained for that application as a single environment. There are two major classifications of environments that are run using the Beanstalk framework: web server environments and worker environments. </p>
			<h3>Web server environments </h3>
			<p>In a web server environment, Elastic Beanstalk manages three things: a load balancer, an <strong class="bold">Auto Scaling Group</strong> (<strong class="bold">ASG</strong>), and the requested number of <strong class="bold">Elastic Compute Cloud</strong> (<strong class="bold">EC2</strong>) instances. Even if your <a id="_idIndexMarker993"/>application has been containerized, those <a id="_idIndexMarker994"/>containers still need an EC2 instance to run on, and <a id="_idIndexMarker995"/>hence the web server environment <a id="_idIndexMarker996"/>will bring up a corresponding set of EC2 instances in which to run the containers. </p>
			<p>A web server environment also creates a <strong class="bold">Canonical Name</strong> (<strong class="bold">CNAME</strong>) (<strong class="bold">Uniform Resource Locator</strong>, or <strong class="bold">URL</strong>) that points to the created load balancer. That initial CNAME is created using the Route <strong class="source-inline">53</strong> service and is therefore highly available and scalable. If desired, you can <a id="_idIndexMarker997"/>register your own domain name and use the Route <strong class="source-inline">53</strong> service to point to your load balancer so that instead of the generic CNAME that <a id="_idIndexMarker998"/>was originally created for you, your customized URL can be what drives the traffic to your web application. </p>
			<h3>Worker environments </h3>
			<p>The big difference in a <a id="_idIndexMarker999"/>worker environment provisioned by Elastic Beanstalk <a id="_idIndexMarker1000"/>versus a web server environment is that in a worker environment, a <strong class="bold">Simple Queue Service</strong> (<strong class="bold">SQS</strong>) queue is provisioned if you <a id="_idIndexMarker1001"/>have not already provisioned one and there is no provisioning of a CNAME via Route <strong class="source-inline">53</strong>. Beanstalk automatically installs a daemon that allows for autoscaling, as illustrated in the following diagram:</p>
			<div>
				<div id="_idContainer163" class="IMG---Figure">
					<img src="Images/Figure_11.2_B17405.jpg" alt="Figure 11.2 – Web server and worker environments in Elastic Beanstalk &#13;&#10;" width="618" height="355"/>
				</div>
			</div>
			<p class="figure-caption">Figure 11.2 – Web server and worker environments in Elastic Beanstalk </p>
			<p>Next, we are going to cover the different components that make up Elastic Beanstalk.</p>
			<h2 id="_idParaDest-280"><a id="_idTextAnchor288"/>The different components that make up Elastic Beanstalk</h2>
			<p>No matter <a id="_idIndexMarker1002"/>which of the different types of environments you are trying to build using the Beanstalk service, it will be composed of multiple components. </p>
			<h3>Application</h3>
			<p>In Elastic <a id="_idIndexMarker1003"/>Beanstalk, a logical grouping of <a id="_idIndexMarker1004"/>components is called an <strong class="bold">application</strong>. This includes environments and environment configurations, along with versions. All of these items are grouped into a folder-like structure, and this folder is the application.  </p>
			<h3>Application version</h3>
			<p>Elastic Beanstalk allows for <a id="_idIndexMarker1005"/>the packaging and labeling of specific versions of an <a id="_idIndexMarker1006"/>application. Each specific packaged version of an application is known as an <strong class="bold">application version</strong>. These versions are packaged <a id="_idIndexMarker1007"/>up and sent to the <strong class="bold">Simple Storage Service</strong> (<strong class="bold">S3</strong>) service behind the scenes for deployment to one or more of your environments, as illustrated in the following diagram:</p>
			<div>
				<div id="_idContainer164" class="IMG---Figure">
					<img src="Images/Figure_11.3_B17405.jpg" alt="Figure 11.3 – Application versions can only be deployed to a single environment &#13;&#10;" width="371" height="280"/>
				</div>
			</div>
			<p class="figure-caption">Figure 11.3 – Application versions can only be deployed to a single environment </p>
			<p>You can have multiple <a id="_idIndexMarker1008"/>versions running in various environments using Elastic Beanstalk, such as your current stable version running in your production <a id="_idIndexMarker1009"/>environment and your latest version running in your test environment. Only one version can be deployed to a single environment at a time. </p>
			<h3>Environment </h3>
			<p>A collection of running <a id="_idIndexMarker1010"/>resources in Elastic Beanstalk running a specific application <a id="_idIndexMarker1011"/>version is known as an <strong class="bold">environment</strong>. </p>
			<h3>Environment configuration </h3>
			<p>As you define the <a id="_idIndexMarker1012"/>parameters and settings for your environment, these become the <strong class="bold">environment configuration</strong>. As you iterate on your application and change the settings to the underlying configuration of the environment, then Beanstalk deploys those changes <a id="_idIndexMarker1013"/>automatically and adds or removes items based on your configuration, as illustrated in the following diagram:</p>
			<div>
				<div id="_idContainer165" class="IMG---Figure">
					<img src="Images/Figure_11.4_B17405.jpg" alt="Figure 11.4 – A closer look at an Elastic Beanstalk configuration&#13;&#10;" width="416" height="344"/>
				</div>
			</div>
			<p class="figure-caption">Figure 11.4 – A closer look at an Elastic Beanstalk configuration</p>
			<h3>Configuration template </h3>
			<p>The configuration <a id="_idIndexMarker1014"/>template in Elastic Beanstalk is a starting <a id="_idIndexMarker1015"/>point for creating customized environment configurations. </p>
			<h3>Saved configuration </h3>
			<p>Saved <a id="_idIndexMarker1016"/>configurations are <strong class="bold">YAML Ain't Markup Language</strong> (<strong class="bold">YAML</strong>) files stored in S3 that can be put <a id="_idIndexMarker1017"/>to use for other running environments or during <a id="_idIndexMarker1018"/>environment creation. Saved configurations define the <a id="_idIndexMarker1019"/>following values:</p>
			<ul>
				<li>Platform version</li>
				<li>Tier</li>
				<li>Configuration option settings</li>
				<li>Tags</li>
			</ul>
			<h3>Platform </h3>
			<p>When you incorporate the operating system of your choice and the preferred programming language <a id="_idIndexMarker1020"/>that you will use, your web and application servers all become your <strong class="bold">platform</strong>. </p>
			<p>Now that we have an understanding of the Elastic Beanstalk components and platform, let's go through an exercise of creating an application in Elastic Beanstalk, starting with creating the necessary permissions. </p>
			<h1 id="_idParaDest-281"><a id="_idTextAnchor289"/>Creating a service role in the IAM console</h1>
			<p>Before we begin, we will need to create a service role for Beanstalk to use when pushing out the environments and applications. A failure to do so, or even a failure to update a previously created service role that was created a few years ago, can result in errors and frustration when moving further along in the chapter. </p>
			<p>Start by logging in to the <strong class="bold">AWS Management Console</strong> with your administrative user, and then follow these next steps:</p>
			<ol>
				<li>Once you <a id="_idIndexMarker1021"/>have logged in, navigate to <strong class="bold">IAM service</strong>.</li>
				<li>In the left-hand <a id="_idIndexMarker1022"/>menu, click on <strong class="bold">Roles</strong>.</li>
				<li>Once on the <strong class="bold">Create Role</strong> page, keep the trusted entity as <strong class="bold">AWS Service</strong>, and then, in the middle of the page, choose <strong class="bold">Elastic Beanstalk</strong> as the service for which you would like to create a service role. Click on the <strong class="bold">Elastic Beanstalk</strong> service. </li>
				<li>After you have selected the <strong class="bold">Elastic Beanstalk</strong> service, another set of selections will appear at the bottom of the screen so that you can select your use case. Choose the use case of <strong class="bold">Elastic Beanstalk</strong>. After you have clicked on <strong class="bold">Elastic Beanstalk</strong> in the use case and it is highlighted in blue, as shown in the following screenshot, then you can click on the blue button on the bottom right-hand side of the screen labeled <strong class="bold">Next: Tags</strong>:<div id="_idContainer166" class="IMG---Figure"><img src="Images/Figure_11.5_B17405.jpg" alt="Figure 11.5 – Selecting the Elastic Beanstalk use case in Identity and Access Management (IAM) &#13;&#10;" width="1001" height="297"/></div><p class="figure-caption">Figure 11.5 – Selecting the Elastic Beanstalk use case in Identity and Access Management (IAM) </p></li>
				<li>After clicking <strong class="bold">Next</strong> and landing on the <strong class="bold">Roles</strong> screen, the default Beanstalk policy should <a id="_idIndexMarker1023"/>already be populated for you. Click on <a id="_idIndexMarker1024"/>the blue button at the bottom of the screen labeled <strong class="bold">Next:Tags</strong> to move on to the next screen. </li>
				<li>Tags are optional and you can add them if you wish; otherwise, click the blue <strong class="bold">Next:Review</strong> button at the bottom of the screen. </li>
				<li>On the <strong class="bold">Review</strong> page, you should be shown that you are about to create a service role named <strong class="source-inline">AWSServiceRoleForElasticBeanstalk</strong>. Click the blue <strong class="bold">Create role</strong> button at the bottom of the page to create this role.</li>
			</ol>
			<p>Now that we have our service role created, we can proceed with using the Elastic Beanstalk service. </p>
			<h1 id="_idParaDest-282"><a id="_idTextAnchor290"/>Installing and using the Elastic Beanstalk command-line interface (EB CLI) </h1>
			<p>There are a number <a id="_idIndexMarker1025"/>of commands <a id="_idIndexMarker1026"/>available from the AWS CLI that allow you, as a user, to take advantage of Elastic Beanstalk.</p>
			<p>Basic commands supplied by the EB CLI include those that will do things all the way from creating the correct project structure in your local environment to quickly and efficiently pulling down the log files from your instances for review. We will now review the basic commands that the EB CLI provides, along with a short description of their nature, as follows:</p>
			<ul>
				<li><strong class="source-inline">eb create</strong>: This command <a id="_idIndexMarker1027"/>will create a new local environment for Elastic Beanstalk and deploys an <a id="_idIndexMarker1028"/>initial application version to that directory structure. </li>
				<li><strong class="source-inline">eb status</strong>: This command returns the <a id="_idIndexMarker1029"/>status of your environment, including <a id="_idIndexMarker1030"/>items such as application name, region, CNAME, and health status.</li>
				<li><strong class="source-inline">eb health</strong>: This command <a id="_idIndexMarker1031"/>returns the health status of the instances in your environment, updating <a id="_idIndexMarker1032"/>every 10 seconds.</li>
				<li><strong class="source-inline">eb events</strong>: This command returns a list of log statements that state the most recent events for the <a id="_idIndexMarker1033"/>current Elastic Beanstalk environment. Examples of events can include the creation of resources such as instances <a id="_idIndexMarker1034"/>or load balancers or the changing of the environment status to different health levels.</li>
				<li><strong class="source-inline">eb ssh</strong>: This command <a id="_idIndexMarker1035"/>will temporarily open port <strong class="source-inline">22</strong> on your security groups for all incoming traffic if you have <a id="_idIndexMarker1036"/>not configured port <strong class="source-inline">22</strong> for a specific <strong class="bold">classless inter-domain routing</strong> (<strong class="bold">CIDR</strong>) range of addresses. It will then <a id="_idIndexMarker1037"/>prompt you to connect to your running <a id="_idIndexMarker1038"/>instance or allow you to select which running instance you would like to connect to via <strong class="bold">Secure Shell</strong> (<strong class="bold">SSH</strong>).</li>
				<li><strong class="source-inline">eb logs</strong>: This command can <a id="_idIndexMarker1039"/>perform two explicit commands <a id="_idIndexMarker1040"/>regarding the logging of files, as follows:<p>     a. It can toggle the streaming of logs to the CloudWatch Logs service.</p><p>     b. It can fetch instance logs for you to review locally.</p></li>
				<li><strong class="source-inline">eb open</strong>: This command will <a id="_idIndexMarker1041"/>use your default browser <a id="_idIndexMarker1042"/>to open the public URL of your application. </li>
				<li><strong class="source-inline">eb deploy</strong>: This <a id="_idIndexMarker1043"/>command will deploy your application to the Elastic Beanstalk service <a id="_idIndexMarker1044"/>using the current source bundle.</li>
				<li><strong class="source-inline">eb config</strong>: This command will <a id="_idIndexMarker1045"/>allow you to change <a id="_idIndexMarker1046"/>the environment configuration settings.</li>
				<li><strong class="source-inline">eb terminate</strong>: This <a id="_idIndexMarker1047"/>command shuts down and stops your instances and environment so that <a id="_idIndexMarker1048"/>you do not incur additional charges.</li>
			</ul>
			<h2 id="_idParaDest-283"><a id="_idTextAnchor291"/>Installing the EB CLI</h2>
			<p>The simplest way to get the <strong class="bold">EB CLI</strong> installed on your local workstation, no matter which operating <a id="_idIndexMarker1049"/>system you are using, is to u<a id="_idIndexMarker1050"/>se the <strong class="source-inline">eb-cli-setup</strong> script, which is available on GitHub at <a href="https://github.com/aws/aws-elastic-beanstalk-cli-setup">https://github.com/aws/aws-elastic-beanstalk-cli-setup</a>). </p>
			<p>If you are using a Mac, however, and prefer to install software via the <strong class="source-inline">brew</strong> package manager, then the <a id="_idIndexMarker1051"/>EB CLI is available through this method as well. Just make sure that your current version of <strong class="source-inline">brew</strong> is up to date before attempting to install the EB CLI. Here's the code you'll need:  </p>
			<p class="source-code">$ brew update </p>
			<p class="source-code">$ brew install awsebcli</p>
			<p>No matter which method you choose, once installed, you should then be able to get directly to the EB CLI from a terminal prompt using just a simple <strong class="source-inline">$ eb</strong> command.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">If you have previously installed the EB CLI on your machine in the past, it is a good idea before proceeding to update the package using the <strong class="source-inline">pip3 install --upgrade awsebcli</strong> command.</p>
			<p>Now, with the CLI installed, let's look at creating and deploying a project using the EB CLI. </p>
			<h2 id="_idParaDest-284"><a id="_idTextAnchor292"/>Using the EB CLI to create a project </h2>
			<p>We will be using our terminal to invoke the <strong class="source-inline">eb cli</strong> command and then create our Elastic Beanstalk project. Start by opening up your terminal window. Then, follow these steps:</p>
			<ol>
				<li value="1">With your terminal <a id="_idIndexMarker1052"/>window open, use the EB CLI to create a new folder to start our project. It's best to start from the root of your home directory so that your folder will be easier to find if you need to come back to it later. We will name our local folder <strong class="source-inline">11-beanstalk</strong>. Here's the code you'll need:<p class="source-code"><strong class="bold">$ cd ~</strong></p><p class="source-code"><strong class="bold">$ mkdir 11-beanstalk</strong></p></li>
				<li>We need to make sure that the <strong class="source-inline">virtualenv</strong> program has been installed on our system for the Python 3.x set of programming languages. We will do this using <strong class="source-inline">pip</strong>, as follows:<p class="source-code"><strong class="bold">$ pip3 install -U virtualenv</strong></p></li>
				<li>Now, with our folder created, we can move into that folder so that we can create our <a id="_idIndexMarker1053"/>virtual environment for Python. Once you have enacted the virtual environment, you will see your prompt change slightly to be prepended with 11 before the command prompt, as illustrated in the following code snippet. This lets you know that you are inside the virtual environment:  <p class="source-code"><strong class="bold">$ cd ll-beanstalk</strong></p><p class="source-code"><strong class="bold">$ virtualenv eleven</strong></p></li>
				<li>If the virtual environment has been created successfully, then you should see an output like the one shown next:<p class="source-code"><strong class="bold">created virtual environment CPython3.9.1.final.0-64 in 767ms</strong></p><p class="source-code"><strong class="bold">  creator CPython3Posix(dest=/Users/abook/11-beanstalk/eleven, clear=False, no_vcs_ignore=False, global=False)</strong></p><p class="source-code"><strong class="bold">  seeder FromAppData(download=False, pip=bundle, setuptools=bundle, wheel=bundle, via=copy, app_data_dir=/Users/abook/Library/Application Support/virtualenv)</strong></p><p class="source-code"><strong class="bold">    added seed packages: pip==21.1.2, setuptools==57.0.0, wheel==0.36.2</strong></p><p class="source-code"><strong class="bold">  activators BashActivator,CShellActivator,FishActivator,PowerShellActivator,PythonActivator,XonshActivator</strong></p></li>
				<li>Since we have created our virtual environment, we now need to activate it, as follows: <p class="source-code"><strong class="bold">$ source eleven/bin/activate </strong></p></li>
				<li>With <a id="_idIndexMarker1054"/>the virtual environment prompt showing, we will now install <strong class="source-inline">flask</strong> locally to make a quick web application using Python, as follows: <p class="source-code"><strong class="bold">(eleven) ~/11-beanstalk $ pip3 install flask flask_bootstrap template-render</strong></p><p>Installing the <strong class="source-inline">flask</strong> package will also install a number of dependent packages that <strong class="source-inline">flask</strong> needs, including <strong class="bold">MarkupSafe</strong>, <strong class="bold">Werkzeug</strong>, <strong class="bold">Jinja</strong>, <strong class="bold">ItsDangerous</strong>, and <strong class="bold">Click</strong>. </p><p class="callout-heading">Note</p><p class="callout">If you're not familiar with it, <strong class="source-inline">flask</strong> is a lightweight web application framework written in Python. It uses Jinja templates for rendering pages but can also just parse text or <strong class="bold">HyperText Markup Language</strong> (<strong class="bold">HTML</strong>). It can also be combined with other Python libraries to do <a id="_idIndexMarker1055"/>more complex calculations and then render the results. </p></li>
				<li>With our environment being set up, we can then move the files that we took from the <strong class="source-inline">Chapter-11</strong> GitHub repository and copy them over to our <strong class="source-inline">11-beanstalk</strong> directory. Start by going into the directory where you have cloned the files <a id="_idIndexMarker1056"/>from the GitHub repository so that the copy will be a shorter command, as illustrated here:<p class="source-code"><strong class="bold">$ cp -r * ~/11-beanstalk/.</strong></p><p>This recursive copy command will bring over not only the <strong class="source-inline">application.py</strong> file that runs the application but also the <strong class="source-inline">templates</strong> folder (this holds the Jinja templates) along <a id="_idIndexMarker1057"/>with the static folder (this holds the <strong class="bold">Cascading Style Sheets</strong> (<strong class="bold">CSS</strong>) style sheet). </p></li>
				<li>Now, let's capture all of the requirements that we will need to install once we go to our remote environment using the <strong class="source-inline">pip freeze</strong> command and then push that out to a file called <strong class="source-inline">requirements.txt</strong>, as illustrated in the following code snippet: <p class="source-code"><strong class="bold">$ pip freeze &gt; requirements.txt</strong></p></li>
				<li>At this point, we should test our <strong class="source-inline">flask</strong> application locally to ensure that it runs and is <a id="_idIndexMarker1058"/>ready for deployment. Use the following command to test your application:<p class="source-code"><strong class="bold">$ python3 application.py</strong></p><p>Assuming that the application starts successfully, you should see a return like the one shown next:</p><p class="source-code"><strong class="bold">* Serving Flask app 'application' (lazy loading)</strong></p><p class="source-code"><strong class="bold"> * Environment: production</strong></p><p class="source-code"><strong class="bold">   WARNING: This is a development server. Do not use it in a production deployment.</strong></p><p class="source-code"><strong class="bold">   Use a production WSGI server instead.</strong></p><p class="source-code"><strong class="bold"> * Debug mode: on</strong></p><p class="source-code"><strong class="bold"> * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)</strong></p><p class="source-code"><strong class="bold"> * Restarting with stat</strong></p><p class="source-code"><strong class="bold"> * Debugger is active!</strong></p><p class="source-code"><strong class="bold">* Debugger PIN: 688-856-306</strong></p><p>With the local URL displayed, you can open up a web browser and see the application in action. </p><p>Once you <a id="_idIndexMarker1059"/>are done testing the local application, press <em class="italic">Ctrl</em> + <em class="italic">C</em> in the terminal window to stop running the local server.</p></li>
				<li>With our <a id="_idIndexMarker1060"/>application tested locally, we can now create the environment with the EB CLI. Using the command prompt that you still have open, we will initiate the Elastic Beanstalk environment. Make sure that you are still inside the <strong class="source-inline">11-beanstalk</strong> folder before you run the next command, shown here: <p class="source-code"><strong class="bold">$ eb init</strong></p><p>As you initiate your Beanstalk environment, use the following values:</p><ul><li><strong class="bold">Default region</strong>: <strong class="source-inline">us-east-2</strong></li><li><strong class="bold">Application</strong>: <strong class="source-inline">flask-quiz</strong></li><li><strong class="bold">Python</strong>: <strong class="source-inline">(Y)es</strong></li><li><strong class="bold">Python version</strong>: <strong class="source-inline">Python 3.8</strong> </li><li><strong class="bold">SSH for instances</strong>: <strong class="source-inline">(Y)es</strong></li><li><strong class="bold">Select a keypair</strong>: Create a new keypair</li><li><strong class="bold">Keypair name</strong>: <strong class="source-inline">DevOps-pro</strong> (no passphrase)</li></ul></li>
			</ol>
			<p>Now that we have created our environment, we will move on to looking at how we can customize our environment using <strong class="source-inline">.ebextensions</strong>. </p>
			<h1 id="_idParaDest-285"><a id="_idTextAnchor293"/>Understanding advanced configuration options with .ebextensions</h1>
			<p>Elastic Beanstalk allows you to add configuration files to your application's source code to customize and <a id="_idIndexMarker1061"/>configure the AWS <a id="_idIndexMarker1062"/>resources in your environment. </p>
			<p>We can create a <em class="italic">hidden</em> folder in our directory to create and store our custom configurations.</p>
			<p>From inside our <strong class="source-inline">11-beanstalk</strong> directory, we will create a <strong class="source-inline">.ebextensions</strong> directory, as follows:</p>
			<p class="source-code">$ mkdir .ebextensions</p>
			<p>We can now run a <strong class="source-inline">tree</strong> command with a level of <strong class="source-inline">1</strong> and ask it to show all files (in order to show the hidden <strong class="source-inline">.ebextensions</strong> folder) and see our current working environment structure, as follows:  </p>
			<p class="source-code">$ tree -a -L 1</p>
			<p>This should show a current structure like this:</p>
			<p class="source-code">.</p>
			<p class="source-code">├── .ebextensions</p>
			<p class="source-code">├── .elasticbeanstalk</p>
			<p class="source-code">├── .gitignore</p>
			<p class="source-code">├── application.py</p>
			<p class="source-code">├── eleven</p>
			<p class="source-code">├── requirements.txt</p>
			<p class="source-code">├── static</p>
			<p class="source-code">└── templates</p>
			<p>Next, we will <a id="_idIndexMarker1063"/>move the file that we copied over with <a id="_idIndexMarker1064"/>all of the other files named <strong class="source-inline">cloudwatch.config</strong> inside the <strong class="source-inline">.ebextensions</strong> folder, like this: </p>
			<p class="source-code">$ mv cloudwatch.config .ebextensions/.</p>
			<p>This file is also available in the GitHub repository in the <strong class="source-inline">Chapter-11</strong> folder if needed. </p>
			<p>With our extra resources created, we are now ready to look at the deployment types available for applications in Elastic Beanstalk before we deploy our application.</p>
			<h1 id="_idParaDest-286"><a id="_idTextAnchor294"/>Deployment types with Elastic Beanstalk </h1>
			<p>Elastic Beanstalk allows for multiple deployment types for your application. Let's take a look at <a id="_idIndexMarker1065"/>each one in detail. </p>
			<h2 id="_idParaDest-287"><a id="_idTextAnchor295"/>All-at-once deployments </h2>
			<p>Using an <strong class="bold">all-at-once deployment</strong> strategy, Elastic Beanstalk will take the specified version of the <a id="_idIndexMarker1066"/>application that <a id="_idIndexMarker1067"/>has been marked for deployment and then simultaneously deploy this version to all instances in your environment.  </p>
			<p>This deployment type takes the least amount of time to implement and has the lowest associated cost; however, it also comes with the most risk. If something were to go awry during the deployment, then you would be facing downtime with your application. This is a deployment strategy that is best served for development and test environments but it should seldom or never be used in a production environment. </p>
			<h2 id="_idParaDest-288"><a id="_idTextAnchor296"/>Rolling deployments </h2>
			<p>A <strong class="bold">rolling deployment</strong> will push out a newer version of your application to your existing EC2 instances, but <a id="_idIndexMarker1068"/>instead of pushing out the application to all instances at the same time, it uses batches to <a id="_idIndexMarker1069"/>govern how many instances are updated at any single time. </p>
			<p>While this deployment type is not as fast as the all-at-once method, it also allows for the safeguard of not allowing all your instances to be down at the same time in case of an application issue. A rolling instance is also less expensive than one of the blue/green types of deployment options since you are utilizing EC2 instances that you already have up and running and don't need to create a whole new environment. </p>
			<h2 id="_idParaDest-289"><a id="_idTextAnchor297"/>Rolling with additional batch </h2>
			<p>Although extremely <a id="_idIndexMarker1070"/>similar to a rolling deployment, <strong class="bold">rolling with additional batch</strong> has <a id="_idIndexMarker1071"/>a very distinct difference. That difference is that this deployment ensures that your full capacity is maintained throughout the deployment process. </p>
			<p>This deployment <a id="_idIndexMarker1072"/>type will launch an additional set of instances before beginning the actual deployment. This is a good option if you are serving a <a id="_idIndexMarker1073"/>constant flow of traffic and need to ensure capacity even while performing application updates. </p>
			<h2 id="_idParaDest-290"><a id="_idTextAnchor298"/>Immutable </h2>
			<p>When you think of immutable infrastructure, you should think of not making an update to a current <a id="_idIndexMarker1074"/>instance. This is <a id="_idIndexMarker1075"/>the same concept when using an <strong class="bold">immutable deployment</strong>, since we are setting up a whole <a id="_idIndexMarker1076"/>new set of instances and deploying to those instances, waiting for them to become healthy before switching the <strong class="bold">Domain Name System</strong> (<strong class="bold">DNS</strong>) of Elastic Beanstalk over from the previous environment, as illustrated in the following diagram:</p>
			<div>
				<div id="_idContainer167" class="IMG---Figure">
					<img src="Images/Figure_11.6_B17405.jpg" alt="Figure 11.6 – Immutable deployment during deployment &#13;&#10;" width="714" height="293"/>
				</div>
			</div>
			<p class="figure-caption">Figure 11.6 – Immutable deployment during deployment </p>
			<p>This is one of the safest ways to deploy your application, but it can also be one of the most expensive since you are setting up double the number of instances, as illustrated in the following diagram: </p>
			<div>
				<div id="_idContainer168" class="IMG---Figure">
					<img src="Images/Figure_11.7_B17405.jpg" alt="Figure 11.7 – Immutable deployment after deployment &#13;&#10;" width="712" height="306"/>
				</div>
			</div>
			<p class="figure-caption">Figure 11.7 – Immutable deployment after deployment </p>
			<p>After the health <a id="_idIndexMarker1077"/>check has been completed on the new version <a id="_idIndexMarker1078"/>of the instances, then the older version of the instances is taken down and the traffic is routed to the new version of the application. If there were any problems with any of the instances, then the traffic would never get routed to those instances in the first place. </p>
			<h2 id="_idParaDest-291"><a id="_idTextAnchor299"/>Traffic splitting</h2>
			<p>A <strong class="bold">traffic-splitting</strong> deployment is somewhat like an immutable deployment in the fact that it creates a whole <a id="_idIndexMarker1079"/>new set of instances. A major difference is that with a traffic-splitting deployment, the older instances <a id="_idIndexMarker1080"/>don't terminate as soon as the new version is up and healthy. Instead, the traffic is shifted at a controlled pace, one that you set in the console or via the CLI, to direct a portion of the traffic from one version to the next version, as illustrated in the following diagram: </p>
			<div>
				<div id="_idContainer169" class="IMG---Figure">
					<img src="Images/Figure_11.8_B17405.jpg" alt="Figure 11.8 – Traffic-splitting deployment showing the percent of traffic &#13;&#10;" width="715" height="327"/>
				</div>
			</div>
			<p class="figure-caption">Figure 11.8 – Traffic-splitting deployment showing the percent of traffic </p>
			<p>Now that we have looked at different deployment strategies, we will use the EB CLI and our terminal to create and deploy a Beanstalk application. </p>
			<h1 id="_idParaDest-292"><a id="_idTextAnchor300"/>Using Elastic Beanstalk to deploy an application </h1>
			<p>The best way to <a id="_idIndexMarker1081"/>understand some of these services <a id="_idIndexMarker1082"/>is to test them out with a hands-on example. This is most certainly the case with Elastic Beanstalk, as you need to be able to think about the capabilities of the service when reading through both the questions and answers that the DevOps professional exam presents you with.</p>
			<p>We are going to continue with our example code from before that we started earlier in this chapter. If you didn't do the first part of the exercise and you want to deploy the application, then it's suggested that you go back to the part of the chapter entitled <em class="italic">Using the EB CLI to create a project</em>. </p>
			<p>If you have previously closed your terminal window, then you will need to open it up again and navigate back to the <strong class="source-inline">11-beanstalk</strong> folder. We already initiated our environment locally previously, and can now proceed as follows: </p>
			<ol>
				<li value="1">Since our environment has been initiated previously, we can create our initial environment—<strong class="source-inline">developmen</strong>t, as follows:<p class="source-code"><strong class="bold">$ eb create development</strong></p><p>The terminal should show you a return like the one shown next:</p><p class="source-code"><strong class="bold">Creating application version archive "app-210606_181258".</strong></p><p class="source-code"><strong class="bold">Uploading: [##################################################] 100% Done...</strong></p><p class="source-code"><strong class="bold">Environment details for: development</strong></p><p class="source-code"><strong class="bold">  Application name: flask-quiz</strong></p><p class="source-code"><strong class="bold">  Region: us-east-2</strong></p><p class="source-code"><strong class="bold">  Deployed Version: app-210606_181258</strong></p><p class="source-code"><strong class="bold">  Environment ID: e-mscggmggrw</strong></p><p class="source-code"><strong class="bold">  Platform: arn:aws:elasticbeanstalk:us-east-2::platform/Python 3.8 running on 64bit Amazon Linux 2/3.3.0</strong></p><p class="source-code"><strong class="bold">  Tier: WebServer-Standard-1.0</strong></p><p class="source-code"><strong class="bold">  CNAME: UNKNOWN</strong></p><p class="source-code"><strong class="bold">  Updated: 2021-06-06 22:12:41.224000+00:00</strong></p><p class="source-code"><strong class="bold">Printing Status:</strong></p><p class="source-code"><strong class="bold">2021-06-06 22:12:40    INFO    createEnvironment is starting.</strong></p><p class="source-code"><strong class="bold">2021-06-06 22:12:41    INFO    Using elasticbeanstalk-us-east-2-182968331794 as Amazon S3 storage bucket for environment data.</strong></p></li>
				<li>Although it will <a id="_idIndexMarker1083"/>most likely take a few <a id="_idIndexMarker1084"/>minutes to finish the setup of your new environment, once it has been completed, you can see the web <a id="_idIndexMarker1085"/>application up and running by using the <strong class="source-inline">eb</strong> <strong class="source-inline">open</strong> command, as follows:<p class="source-code"><strong class="bold">$ eb open</strong></p></li>
				<li>You can <a id="_idIndexMarker1086"/>check on all the events of your application by using the <strong class="source-inline">events</strong> command from within the EB CLI, like this:<p class="source-code"><strong class="bold">$ eb events </strong></p></li>
				<li>If you wanted to check on the health of your environment, then you could log in to the AWS console to see the visual dashboard, or you could simply use the <strong class="source-inline">eb health</strong> command to get a quick look at the statistics for your environment, as follows:<p class="source-code"><strong class="bold">$ eb health</strong></p><p>Alternatively, if you look at the health of the Beanstalk application from the console, then you <a id="_idIndexMarker1087"/>will be presented with a very easy-to-read <strong class="bold">user interface</strong> (<strong class="bold">UI</strong>), as illustrated in the following screenshot:</p><div id="_idContainer170" class="IMG---Figure"><img src="Images/Figure_11.9_B17405.jpg" alt="Figure 11.9 – A look at the Elastic Beanstalk monitoring dashboard &#13;&#10;" width="1455" height="935"/></div><p class="figure-caption">Figure 11.9 – A look at the Elastic Beanstalk monitoring dashboard </p></li>
				<li>If you like, you can check the log files directly from the command line using the <strong class="source-inline">eb logs</strong> command. </li>
				<li>Once you are <a id="_idIndexMarker1088"/>done, then you should <a id="_idIndexMarker1089"/>deactivate your virtual environment by running the following command: <p class="source-code"><strong class="bold">$ deactivate</strong></p><p class="callout-heading">Note</p><p class="callout">If you are running into errors from the deployment, please look at the following troubleshooting section regarding the IAM role that the EB CLI is using. As an alternative, you can create an application in the AWS console and then zip up the entire directory using the <strong class="source-inline">zip ../eleven.zip -r * .[^.]*</strong> command to use as the source bundle to upload. </p></li>
			</ol>
			<p>Follow the guidance in the next section to help troubleshoot your deployment if you are having issues. </p>
			<h2 id="_idParaDest-293"><a id="_idTextAnchor301"/>Troubleshooting the deployment with the EB CLI </h2>
			<p>If you are running into issues during the deployment of your environment, perform the following steps:</p>
			<ol>
				<li value="1">Find the line that states the <strong class="bold">Web Server Gateway Interface</strong> (<strong class="bold">WSGI</strong>) path. An example <a id="_idIndexMarker1090"/>of this is shown next:<p class="source-code"><strong class="bold">WSGIPath: application</strong></p></li>
				<li>Edit this line after the colon to ensure that <strong class="source-inline">.py</strong> appears after the word <strong class="source-inline">application</strong>.</li>
				<li>Save <a id="_idIndexMarker1091"/>and close the file. </li>
				<li>Try deploying your application again with the <strong class="source-inline">eb deploy</strong> command.</li>
			</ol>
			<p>Now that we have gone through the exercise of deploying our Beanstalk application and looking at the logs and events of the application, we will now look both at use cases and anti-patterns of using Elastic Beanstalk. </p>
			<h1 id="_idParaDest-294"><a id="_idTextAnchor302"/>Elastic Beanstalk use cases </h1>
			<p>Elastic Beanstalk makes it easy for developers to get up and running on the cloud without having to worry about the underlying infrastructure or management of underlying components. Next, we will look at some of the optimal use cases for using Elastic Beanstalk. </p>
			<p><em class="italic">You have a smaller development team that needs to get going quickly</em> </p>
			<p>If you have a smaller team that needs to get up and running quickly on AWS but is not as familiar with all of <a id="_idIndexMarker1092"/>the other components, services, and interconnectivity, then Elastic Beanstalk can be a good choice to meet deadlines.  </p>
			<p><em class="italic">You don't have any in-house DevOps expertise  </em></p>
			<p>Somewhat like the previous example, if a company or development team has an application that is needing a rapid deployment to AWS, then Elastic Beanstalk presents a very viable solution <a id="_idIndexMarker1093"/>without the need for any advanced DevOps expertise. Since the product itself can be used with Git, a tool that most developers are familiar with, getting up and running in a minimal amount of time is a simple task. Beanstalk then takes care of tasks such as DNS, autoscaling, easy access to application logs, and even pre-built dashboards for metrics on your environment without any additional setup. </p>
			<h2 id="_idParaDest-295"><a id="_idTextAnchor303"/>Elastic Beanstalk anti-patterns </h2>
			<p>As we just looked at some of the cases where the use of Elastic Beanstalk would make sense, there are also cases where Beanstalk would not be a good choice. Here, we will examine some of the known anti-patterns for using Elastic Beanstalk, where you would want to look at a different service offering from AWS.</p>
			<h3>Applications or projects that need a lot of environment variables </h3>
			<p>One of Elastic Beanstalk's limitations is the fact that it only has 4 <strong class="bold">Kilobytes</strong> (<strong class="bold">KB</strong>) to store all key-value pairs. Taking this <a id="_idIndexMarker1094"/>fact into account, then, if you have numerous environment variables <a id="_idIndexMarker1095"/>such as different database strings, usernames, and passwords for each environment that you create, then you could run up against this hard limit, and Elastic Beanstalk would not be a good choice for your application. </p>
			<h3>Applications that are very large</h3>
			<p>Elastic Beanstalk deployment bundles can only be at a maximum of 512 <strong class="bold">Megabytes</strong> (<strong class="bold">MB</strong>) in size. Hence, if your application is large and complex, it might not be a good application for <a id="_idIndexMarker1096"/>deployment and management via the Beanstalk platform. There are some possible workarounds since this only applies to the source code bundle that Beanstalk itself is dealing with and managing. For instance, if you have lots of data, then you can offload that onto a <strong class="bold">Relational Database Service</strong> (<strong class="bold">RDS</strong>) database and store those configurations in your <strong class="source-inline">.ebextensions</strong> directory. Also, if you have a lot <a id="_idIndexMarker1097"/>of static assets, such as pictures or media, then those could be stored in S3 with pointers in either your application or in a dynamic store such as DynamoDB, and this can keep your source bundle size down.  </p>
			<h1 id="_idParaDest-296"><a id="_idTextAnchor304"/>Summary</h1>
			<p>In this chapter, we covered the Elastic Beanstalk service, another one of the deployment services offered by AWS. We covered the different deployment options available with Elastic Beanstalk, along with creating and deploying a Beanstalk application using the EB CLI tool. We also took a look at some of the best-case scenarios for using Elastic Beanstalk, as well as some anti-patterns whereby the Elastic Beanstalk service would not be a good fit. </p>
			<p>In the next chapter, we will look at using Lambda functions and step functions in order to deploy our code in a serverless manner. </p>
			<h1 id="_idParaDest-297"><a id="_idTextAnchor305"/>Review questions </h1>
			<ol>
				<li value="1">You have been brought into a company that has an application team whose application has two tiers—a web layer and a database layer. The application team needs a method to provision and deploy an environment to AWS quickly. Which of the following options would be the fastest and most ideal way to get this team set up?<p>a. Use the Elastic Beanstalk service to provision an environment and then push the application to the environment. </p><p>b. Create an OpsWorks stack with two layers, one for the application and another for the database. Deploy the application to the application layer. </p><p>c. Use CloudFormation to create an S3 bucket, an RDS database, and an EC2 instance. Use user-data scripting to load the application from the S3 bucket and parameters for the RDS connection strings, username, and password. </p><p>d. Create an RDS database and then use Lambda to deploy the application. </p></li>
				<li>You have been brought into a company that is trying to automate its move to the AWS cloud as quickly as possible. The applications that it is trying to move are built using a multitude of different programming languages. How can you get these applications moved and deployed to the cloud as swiftly as possible?<p>a. Create a master CloudFormation template that utilizes a nested stack design for the deployment of the applications. Create a child template for each of the applications after creating a Docker container for the applications. </p><p>b. Develop each application in one Docker container and use Elastic Beanstalk to deploy. </p><p>c. Develop each application in a separate Docker container and use Elastic Beanstalk to deploy.  </p><p>d. Create a stack using OpsWorks. Create a separate layer for each application and then deploy each application to its layer. </p></li>
				<li>There is a service that Elastic Beanstalk can perform for you if your application takes a while to complete its activities or workflows. What is that service?<p>a. Beanstalk can manage the Elastic Load Balancing (ELB) service and run a daemon process on each of the instances. </p><p>b. Beanstalk can manage a Simple Notification Service (SNS) topic and run a daemon process on each of the instances. </p><p>c. Beanstalk can manage Lambda functions and run a daemon process on each of the instances. </p><p>d. Beanstalk can manage an SQS queue and run a daemon process on each of the instances.  </p></li>
				<li>You have been brought into a company in order to help automate a recovery strategy in case an outage hits the primary region where resources are hosted in AWS. The company has a priority on minimizing costs for this recovery strategy but also needs to be able to spin up the complete infrastructure if needed. How would you suggest that it does this with the least cost?<p>a. Create a pilot light infrastructure in another region and automatically resize based on CloudWatch events.</p><p>b. Create a duplicate infrastructure by creating a whole new environment in the disaster recovery (DR) region using Elastic Beanstalk. Switch the Route 53 record to the DR region's load balancer in case of an outage. </p><p>c. Use Elastic Beanstalk to create another environment as a copy of the application in case of an outage.</p><p>d. Use CloudFormation to spin up resources in another region in case of an outage.  </p></li>
			</ol>
			<h1 id="_idParaDest-298"><a id="_idTextAnchor306"/>Review answers </h1>
			<ol>
				<li value="1">a.</li>
				<li>c.</li>
				<li>d.</li>
				<li>d.</li>
			</ol>
		</div>
	</div></body></html>