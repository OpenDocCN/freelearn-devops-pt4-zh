<html><head></head><body><div id="sbo-rt-content"><div id="_idContainer261">
			<h1 id="_idParaDest-423"><a id="_idTextAnchor433"/>Chapter 18: Autoscaling and Lifecycle Hooks</h1>
			<p>One of the critical features of automation is taking advantage of autoscaling. Although many use this <strong class="bold">Amazon Web Services</strong> (<strong class="bold">AWS</strong>) service in its essential capacity, the educated <strong class="bold">Development Operations</strong> (<strong class="bold">DevOps</strong>) professional understands and takes advantage of some of the more advanced capabilities that Auto Scaling can provide. Insight into these components will not only help you pass the certification exam but will also allow you to manage your AWS environment more effectively. </p>
			<p>In this chapter, we're going to cover the following main topics:  </p>
			<ul>
				<li>Understanding AWS Auto Scaling </li>
				<li>Deploying <strong class="bold">Elastic Compute Cloud</strong> (<strong class="bold">EC2</strong>) instances with Auto Scaling </li>
				<li>The Auto Scaling lifecycle </li>
				<li>Using Auto Scaling lifecycle hooks </li>
			</ul>
			<h1 id="_idParaDest-424"><a id="_idTextAnchor434"/>Understanding AWS Auto Scaling </h1>
			<p>Auto Scaling, which<a id="_idIndexMarker1482"/> is a subset of the <strong class="bold">Amazon EC2 service</strong>, revolves around automatically provisioning and managing your EC2 instances without the need for any manual intervention. The Auto Scaling service can be used to constantly maintain a fixed number of servers at any one time across one or more <strong class="bold">Availability Zones</strong> (<strong class="bold">AZs</strong>) within <a id="_idIndexMarker1483"/>an Amazon Region. The service also provides you elasticity in that it can scale up to meet spikes of demand that your customers or applications present without constantly monitoring the system. </p>
			<p>It does this by tapping into the power of a complementary service, Amazon CloudWatch. It watches a <a id="_idIndexMarker1484"/>metric such as <strong class="bold">Central Processing Unit</strong> (<strong class="bold">CPU</strong>) utilization on an instance and makes sure that if it rises above 80 percent, meaning that 80 percent of the available CPU of the instance is being used for a specific time, such as 5 minutes, a scale-out event will then occur. This helps ease the load on this particular instance and should bring the total percent of CPU utilization back under that 80 percent threshold once the new instance comes online.  </p>
			<p>The Auto Scaling service is constantly performing periodic health checks on the instances in its <strong class="bold">Auto Scaling Group</strong> (<strong class="bold">ASG</strong>). The time between health checks can be configured, but the <a id="_idIndexMarker1485"/>default setting is 300 seconds (5 minutes). You also configure how many health checks an instance can fail before it is taken out of the ASG for being unhealthy. On a similar note, whichever number of health checks that an instance must fail in order to be removed from the ASG is the same number of health checks that it must pass before being added as a healthy instance to the ASG. </p>
			<p>Auto Scaling also plays a key component in infrastructure event planning. If you know that you are about to have an increase in customer traffic, such as the marketing department has bought a television spot on a popular television show or there is a special sale about to happen, then you can simply increase both the desired capacity and the maximum capacity of your ASG to ensure that your customers not only have a good experience but also that your servers do not get overloaded. </p>
			<p>Now that we <a id="_idIndexMarker1486"/>have a basic understanding of the Auto Scaling service, let's look at the key components that make up this service. </p>
			<h2 id="_idParaDest-425"><a id="_idTextAnchor435"/>Understanding the differences between vertical and horizontal scaling </h2>
			<p>As we <a id="_idIndexMarker1487"/>discuss the Auto <a id="_idIndexMarker1488"/>Scaling<a id="_idIndexMarker1489"/> service throughout this chapter, we will be talking about how to horizontally scale your instances in and out to meet the demands of your workload. This is usually a more cost-efficient way to scale and gain resources as you can benchmark your workload and know how much memory and CPU that your workload actually needs. This leads to a number of benefits, including your workload having a much higher availability since there are multiple instances or containers running the application at the same time. This prevents the instance (or container) that was scaled up vertically from <a id="_idIndexMarker1490"/>becoming a <strong class="bold">Single Point of Failure</strong> (<strong class="bold">SPoF</strong>). You also don't have a limit on hardware. With vertical scaling, there comes a point in time when you will hit a resource limit. Although there are instances in AWS that have massive amounts of <strong class="bold">Random-Access Memory</strong> (<strong class="bold">RAM</strong>) and large numbers of CPUs, this is not a way to correctly construct and deploy your application.</p>
			<p>The processes <a id="_idIndexMarker1491"/>of horizontal and vertical scaling are depicted in the following diagram:</p>
			<div>
				<div id="_idContainer252" class="IMG---Figure">
					<img src="Images/Figure_18.1_B17405.jpg" alt="Figure 18.1 – Horizontal scaling versus vertical scaling&#13;&#10;" width="580" height="222"/>
				</div>
			</div>
			<p class="figure-caption">Figure 18.1 – Horizontal scaling versus vertical scaling</p>
			<p>Now that we know the differences between horizontal and vertical scaling, let's take a look at the <a id="_idIndexMarker1492"/>key components<a id="_idIndexMarker1493"/> of <a id="_idIndexMarker1494"/>AWS Auto Scaling. </p>
			<h2 id="_idParaDest-426"><a id="_idTextAnchor436"/>The key components of Auto Scaling </h2>
			<p>One of the main <a id="_idIndexMarker1495"/>components of Auto Scaling is the ASG. This ASG is a logical group of instances for your application or service. You set three main variables for the ASG: the minimum number of instances, the maximum number of instances, and the desired number of instances. The minimum number of instances tells the ASG what is the lowest number of instances that can be running at any one time in a combination of all AZs specified. The maximum number of instances tells the ASG what is the greatest number of instances that it can allocate in that region. These maximums must stay within the service limits. Finally, the desired capacity is the number of running instances at any given moment in time if there are no scheduled actions or scaling events driven by scaling policies. </p>
			<p>You can see a depiction of an ASG in the following diagram:</p>
			<div>
				<div id="_idContainer253" class="IMG---Figure">
					<img src="Images/Figure_18.2_B17405.jpg" alt="Figure 18.2 – ASG visualization&#13;&#10;" width="421" height="416"/>
				</div>
			</div>
			<p class="figure-caption">Figure 18.2 – ASG visualization</p>
			<p>Another key<a id="_idIndexMarker1496"/> component of Auto Scaling is the <strong class="bold">launch template</strong>. The launch <a id="_idIndexMarker1497"/>template determines which properties the instances inside the ASG will launch with. These properties are provided inside of the launch <a id="_idIndexMarker1498"/>template. You can determine items such as the instance size, image <strong class="bold">Identifier</strong> (<strong class="bold">ID</strong>), <strong class="bold">Virtual Private Cloud</strong> (<strong class="bold">VPC</strong>) ID, along with others, when crafting your launch template. </p>
			<p>If you have used ASGs in the past, then you may be familiar with launch configurations. Launch configurations are very similar to launch templates, but launch templates replaced launch configurations in a few respects. Firstly, launch configurations are immutable. Each time that you want to make a change to your launch configuration, you need to clone your launch configuration, make the change, and then attach it to the ASG. This is in contrast to launch templates. Launch templates allow for versioning. Launch templates also allow for the latest EC2 features, such as the use of unlimited T2 instances <a id="_idIndexMarker1499"/>and <strong class="bold">Elastic Block Store</strong> (<strong class="bold">EBS</strong>) tagging. </p>
			<p>ASGs are fully <a id="_idIndexMarker1500"/>integrated with <strong class="bold">Elastic Load Balancing</strong> (<strong class="bold">ELB</strong>). It doesn't matter which one of the three types of ELBs that you use; ASGs fully integrate without issues. This means that if an ASG is associated with a load balancer, whenever an instance is provisioned, it will automatically get registered with the load balancer. Conversely, when an instance is either de-provisioned or terminated, the load balancer will drain the traffic from the instance and deregister the instance from the load balancer before terminating the instance. </p>
			<p class="callout-heading">Note</p>
			<p class="callout">If you have old launch configurations but would like to take advantage of the latest EC2 technology, then AWS has a documentation page on how to convert a launch configuration to a launch template. It can be found here: <a href="https://docs.aws.amazon.com/autoscaling/ec2/userguide/copy-launch-config.html">https://docs.aws.amazon.com/autoscaling/ec2/userguide/copy-launch-config.html</a>.</p>
			<p>The final key component that we are going to discuss is <a id="_idIndexMarker1501"/>going to be the <strong class="bold">scaling plan</strong>. A scaling plan<a id="_idIndexMarker1502"/> can be set to use either predictive scaling or dynamic scaling. If you put your scaling plan to use predictive scaling, the <a id="_idIndexMarker1503"/>ASG will use <strong class="bold">Machine Learning</strong> (<strong class="bold">ML</strong>) to look at how taxed your workload is, especially in respect to certain hours and days of the week, and then generates scheduled scaling actions so that your application has the capacity to meet those needs, as illustrated in the following diagram:</p>
			<div>
				<div id="_idContainer254" class="IMG---Figure">
					<img src="Images/Figure_18.3_B17405.jpg" alt="Figure 18.3 – How predictive scaling works to schedule resources in Auto Scaling&#13;&#10;" width="681" height="247"/>
				</div>
			</div>
			<p class="figure-caption">Figure 18.3 – How predictive scaling works to schedule resources in Auto Scaling</p>
			<p>Dynamic scaling policies are the component that you configure when using dynamic scaling with a scaling plan. </p>
			<p>It's important to note that even if your scaling calculation states that you should go beyond the maximum number of instances that you have set, that maximum is a hard limit and will not be surpassed by the scaling policy. You can raise the maximum number of instances if you hit the ceiling while scaling, or you may want to create a new version of your launch configuration to account for a different type or family of instances that may handle the type of traffic your application is receiving in a better fashion. </p>
			<p>There is an old saying when it comes to Auto Scaling that you should <em class="italic">scale up like a rocket and down like a feather</em>. This is due to the fact that scaling up instances is expensive from a time perspective. If you are starting one or three instances based on a scaling event, they should all take the same amount of time to come online. Bringing in three instances will allow you to have a bit more capacity rather than scaling up a single instance at a time. If that capacity is unjustified, then you can scale down a single instance at a time in order to keep your spending at an appropriate level using Auto Scaling.</p>
			<p>When you plan out your ASG, you want to take into consideration the following factors:</p>
			<ul>
				<li>How long does it take to launch and configure a server that will be part of the ASG?</li>
				<li>Which metrics would be most applicable when monitoring your workload's performance?</li>
				<li>Do you want the ASG to span multiple AZs? If so, how many?</li>
				<li>What type of role should Auto Scaling play in your application?</li>
			</ul>
			<p>With the <a id="_idIndexMarker1504"/>key components of Auto Scaling under our belt, let's look at the main use cases for AWS Auto Scaling. </p>
			<h2 id="_idParaDest-427"><a id="_idTextAnchor437"/>Understanding the different types of Auto Scaling </h2>
			<p>Amazon's EC2 Auto<a id="_idIndexMarker1505"/> Scaling gives you a number of options on how you can scale your instances to meet both the demand of your business and the goals of your budget. </p>
			<p>If you wanted total control of how to scale your instances, then you can use <strong class="bold">manual scaling</strong>. With the<a id="_idIndexMarker1506"/> use of manual scaling, you would set the minimum, maximum, and desired capacity to what you desire for your workload, and your ASG will adjust accordingly. </p>
			<p>There are also times when the traffic that is coming to your workload is rather predictable. These may be cases where your customers are more active during normal business hours, or you may have business workloads that you use internally, and your staff that uses the workloads are all in one or two particular time zones. These are perfect cases for<a id="_idIndexMarker1507"/> the use of <strong class="bold">scheduled scaling</strong>. With the use of scheduled scaling, your ASG will scale in and out automatically based on the times and dates that you set. </p>
			<p>If you want your ASG to automatically scale out when there is a high demand for the application's services along with scaling back in when that same demand has diminished, then this is a <a id="_idIndexMarker1508"/>case for <strong class="bold">dynamic scaling</strong>. Dynamic scaling allows you to choose a specific metric that matters to your application and set a percentage whereby once that percentage has been reached, the associated CloudWatch alarm on the metric will be triggered and one or more instances will be launched so that they can be added to the ASG. In the same vein, if you have previously scaled up capacity in response to a particular metric and that metric has fallen to a level where it is being underutilized, then the scaling policy will look at which one of the instances it should start to put in a terminating state. Based on your configuration, this could be the oldest instance, the newest instance, or even the instance that is closest to the next billing hour. </p>
			<p>Dynamic scaling also <a id="_idIndexMarker1509"/>allows <a id="_idIndexMarker1510"/>you to put in <strong class="bold">step scaling</strong>. These step adjustments can vary based on the type of metric alarm breach, meaning that you can scale up to multiple instances at once if you have a large spike in traffic if your maximum capacity allows. </p>
			<p>Taking the properties of dynamic scaling one<a id="_idIndexMarker1511"/> step further is <strong class="bold">predictive scaling</strong>. Predicative scaling analyses your traffic over time and then increases and decreases the number of EC2 instances in your ASG based on these trends. Predictive scaling is a good choice when you can't decide exactly which metric would be best suited to your application's needs or you have applications that take a long time to initialize. It can also be a wise choice if you have workloads that seem to come up and down, such as batch processing. The predictive scaling analysis can analyze these workloads and decide when it would be best to bring on more capacity. </p>
			<p>We have just looked at the different ways in which ASGs can be set and adjusted to accommodate the influx of traffic for our workloads. Now, let's look at the primary use cases for Auto Scaling.  </p>
			<h2 id="_idParaDest-428"><a id="_idTextAnchor438"/>The four primary use cases for AWS Auto Scaling </h2>
			<p>There are<a id="_idIndexMarker1512"/> four popular use cases that Auto Scaling solves for customers, outlined as follows:</p>
			<ol>
				<li>It automates the provisioning of servers.</li>
				<li>It reduces paging frequency.</li>
				<li>It makes it easier to use spot instances. </li>
				<li>It allows you to scale your cloud infrastructure up and down and save costs. </li>
			</ol>
			<p>Now that we know some of the main use cases for using Auto Scaling, let's look at how we can put ASGs into action by creating our own launch template. </p>
			<h1 id="_idParaDest-429"><a id="_idTextAnchor439"/>Deploying EC2 instances with Auto Scaling</h1>
			<p>The best way<a id="_idIndexMarker1513"/> to get a full understanding <a id="_idIndexMarker1514"/>of a service is to jump in hands-on to see how it performs, and the Auto Scaling service is no different. In this hands-on exercise, we will create a launch template for our ASG. We will then create an ASG. Follow these next steps:</p>
			<ol>
				<li value="1">Log on to the <strong class="bold">Amazon Management Console</strong> using your administrative user account. Once logged in, navigate to the EC2 service. Once on the EC2 service, locate and click on the <strong class="bold">Launch Templates</strong> sub-menu item on the left-hand menu, which is located under the <strong class="bold">Instances</strong> menu heading. </li>
				<li>Once you are on the EC2 <strong class="bold">Launch Templates</strong> main screen, click on the orange <strong class="bold">Create launch template</strong> button in the main window. </li>
				<li>We should now be on a screen labeled <strong class="bold">Create launch template</strong>. Use the following values in the first box labeled <strong class="bold">Launch template name</strong> and the fields that come after this:<ul><li><strong class="bold">Launch template name</strong>—<strong class="source-inline">chapter18</strong></li><li><strong class="bold">Template version description</strong>—<strong class="source-inline">version 1</strong> </li><li><strong class="bold">Auto Scaling guidance</strong>—Check the box, as shown in the following screenshot: </li></ul></li>
			</ol>
			<div>
				<div id="_idContainer255" class="IMG---Figure">
					<img src="Images/Figure_18.4_B17405.jpg" alt="Figure 18.4 – The first section of the launch template completed&#13;&#10;" width="923" height="518"/>
				</div>
			</div>
			<p class="figure-caption">Figure 18.4 – The first section of the launch template completed</p>
			<ol>
				<li value="4">Next, scroll <a id="_idIndexMarker1515"/>down the page for the next box of<a id="_idIndexMarker1516"/> selection criteria. We will fill out the rest of the fields using the following values:<ul><li><strong class="bold">Amazon machine image</strong>—Select <strong class="bold">Amazon Linux 2 AMI (HVM), SSD volume (x86)</strong>.</li><li><strong class="bold">Instance type</strong>—<strong class="source-inline">t2.micro</strong>.</li><li><strong class="bold">Key pair (login)</strong>—Don't include this in the launch template. </li><li><strong class="bold">Network settings</strong>—<strong class="bold">VPC</strong>.</li><li><strong class="bold">Go to Network settings</strong> | <strong class="bold">Security groups</strong> and choose your default security group. </li></ul></li>
				<li>Once you have completed filling out all of the values, we can then click the orange <strong class="bold">Create launch template</strong> button. You should see that you have successfully created a launch template at this time. </li>
				<li>Use the link in the middle of the page under the <strong class="bold">Create an Auto Scaling group from your template</strong> heading to be brought to the <strong class="bold">Auto Scaling</strong> section where we can create our new ASG, as illustrated in the following screenshot:<div id="_idContainer256" class="IMG---Figure"><img src="Images/Figure_18.5_B17405.jpg" alt="Figure 18.5 – Create an Auto Scaling group section once you have completed your launch template&#13;&#10;" width="1252" height="248"/></div><p class="figure-caption">Figure 18.5 – Create an Auto Scaling group section once you have completed your launch template</p></li>
				<li>You <a id="_idIndexMarker1517"/>should now be at the <strong class="bold">Create Auto Scaling groups</strong> page. If <a id="_idIndexMarker1518"/>not, you can find this page by navigating back to the EC2 service page and then using the left-hand menu to choose <strong class="bold">Auto Scaling groups</strong>. Once on the <strong class="bold">Auto Scaling groups</strong> page, you can choose to create an ASG. We will name our group <strong class="source-inline">eighteen</strong>. </li>
				<li>In the next box, labeled <strong class="bold">Launch template</strong>, choose the launch template that we just created (named <strong class="source-inline">chapter18</strong>) from the drop-down list. Click the orange <strong class="bold">Next</strong> button at the bottom of the screen. </li>
				<li>On the <strong class="bold">Configure settings</strong> screen, just leave all the default options, including the default VPC. We will not be using any spot instances or extra VPCs in this exercise. In the <strong class="bold">Network</strong> box, add all three subnets in your default VPC by selecting one after the other until all three appear underneath the selection dropdown. After all the subnets have been added, click on the orange <strong class="bold">Next</strong> button at the bottom of the page, as illustrated in the following screenshot:<div id="_idContainer257" class="IMG---Figure"><img src="Images/Figure_18.6_B17405.jpg" alt="Figure 18.6 – Adding the three subnets from the default VPC to the ASG&#13;&#10;" width="661" height="572"/></div><p class="figure-caption">Figure 18.6 – Adding the three subnets from the default VPC to the ASG</p></li>
				<li>Now, at <a id="_idIndexMarker1519"/>the <strong class="bold">Configure advanced options</strong> page, under <strong class="bold">Load balancer</strong>, leave the radio button selected <a id="_idIndexMarker1520"/>at <strong class="bold">No load balancer</strong>. We do want to make a change under the box labeled <strong class="bold">Health checks</strong>. Here, we want to change the health-check grace period from <strong class="source-inline">300</strong> to <strong class="source-inline">30</strong> seconds. Once you have made this change, click the orange <strong class="bold">Next</strong> button.  </li>
				<li>On the <strong class="bold">Configure group size and scaling policies</strong> page, in the <strong class="bold">Group size</strong> box, set <strong class="bold">Desired capacity</strong> to <strong class="source-inline">1</strong>, <strong class="bold">Minimum capacity </strong>to <strong class="source-inline">1</strong>, and <strong class="bold">Maximum capacity</strong> to <strong class="source-inline">3</strong>. </li>
				<li>Scroll down to the <strong class="bold">Scaling policies</strong> box. Choose the radio button for <strong class="bold">Target tracking scaling policy</strong>. Use the following values to fill out the boxes:<ul><li><strong class="bold">Scaling policy name</strong>—<strong class="source-inline">18 ASG Policy</strong> </li><li><strong class="bold">Metric type</strong>—<strong class="source-inline">Average network in (bytes)</strong></li><li><strong class="bold">Target value</strong>—<strong class="source-inline">5000</strong> </li></ul><p>The following screenshot illustrates this process:</p><div id="_idContainer258" class="IMG---Figure"><img src="Images/Figure_18.7_B17405.jpg" alt="Figure 18.7 – The scaling policy with metric for our ASG &#13;&#10;" width="791" height="731"/></div><p class="figure-caption">Figure 18.7 – The scaling policy with metric for our ASG </p></li>
				<li>Once<a id="_idIndexMarker1521"/> you<a id="_idIndexMarker1522"/> have filled out the values for the scaling policies, scroll down to the bottom of the page and click the white button labeled <strong class="bold">Skip to review</strong>. </li>
				<li>On the <strong class="bold">Review</strong> page, scroll down to the bottom of the page and click the orange <strong class="bold">Create Auto Scaling group</strong> button to create our ASG. </li>
				<li>Once you click the button, you should be taken to the <strong class="bold">EC2</strong> | <strong class="bold">Auto Scaling groups</strong> page where you will see the status of your group is initially <strong class="bold">Updating capacity</strong> as the first instance is being brought online. </li>
				<li>If you want to see your instance scale out, then you can do so by taking the following steps. In the <strong class="bold">Auto Scaling groups</strong> section, click on your group name, which is <strong class="source-inline">eighteen</strong>.  </li>
				<li>In the horizontal menu bar, click on the <strong class="bold">Automatic scaling</strong> menu item, as illustrated in the following screenshot. This will bring you to the dynamic scaling policy that we created earlier. Click on the box in the top right-hand corner of our <strong class="source-inline">eighteen</strong> ASG policy. Once this is selected, then using the <strong class="bold">Actions</strong> drop-down, choose <strong class="bold">Edit</strong>:<div id="_idContainer259" class="IMG---Figure"><img src="Images/Figure_18.8_B17405.jpg" alt="Figure 18.8 – The horizontal menu bar on a single ASG highlighting Automatic scaling&#13;&#10;" width="1070" height="82"/></div><p class="figure-caption">Figure 18.8 – The horizontal menu bar on a single ASG highlighting Automatic scaling</p></li>
				<li>On the <strong class="bold">Edit dynamic scaling policy</strong> page, change the <strong class="bold">Target Value</strong> field from <strong class="source-inline">5000</strong> to <strong class="source-inline">100</strong>. Once you have changed this value, then click the orange <strong class="bold">Update</strong> button. </li>
				<li>Go back to the main <strong class="bold">Auto Scaling groups</strong> page and refresh as you see the instances come online to meet the <em class="italic">demand</em> of the incoming traffic. </li>
			</ol>
			<p>Now that we<a id="_idIndexMarker1523"/> have seen how to create both a launch<a id="_idIndexMarker1524"/> configuration and an ASG in the real world, let's move on to gaining a fuller understanding of the Auto Scaling lifecycle and how it differs from just launching an EC2 instance. </p>
			<h1 id="_idParaDest-430"><a id="_idTextAnchor440"/>The Auto Scaling lifecycle</h1>
			<p>When you put <a id="_idIndexMarker1525"/>an <strong class="bold">EC2 instance</strong> into an ASG, it follows a particular path that a normal EC2 instance you initiate via the command line or the AWS Management Console does not follow. The instance starts by being launched by the ASG. If this is part of a <strong class="bold">scale-out</strong> event, then the instance has an opportunity to have special commands be<a id="_idIndexMarker1526"/> performed on it via a <strong class="bold">lifecycle hook</strong>. Lifecycle hooks allow you to add custom actions when either launching or terminating instances that are part of an ASG. Once the instance becomes healthy, it is then <strong class="bold">InService</strong> and is part of the ASG. If that instance fails the set number of health checks, the instance can then go to a <strong class="bold">Terminating</strong> state. Moving to a Terminating state can also happen if there is not enough traffic or metric data to support having the number of instances currently running, in which case there could be a <strong class="bold">scale-in</strong> event. Once again, just as with a scale-out event, this scale-in event allows us to use a lifecycle hook.</p>
			<p>The Auto Scaling lifecycle process is illustrated in the following diagram:</p>
			<div>
				<div id="_idContainer260" class="IMG---Figure">
					<img src="Images/Figure_18.9_B17405.jpg" alt="Figure 18.9 – The Auto Scaling lifecycle process&#13;&#10;" width="1484" height="919"/>
				</div>
			</div>
			<p class="figure-caption">Figure 18.9 – The Auto Scaling lifecycle process</p>
			<p>Now that we<a id="_idIndexMarker1527"/> have an understanding of the lifecycle of ASGs, let's take a deeper look at lifecycle hooks and when it would be most appropriate to use them. </p>
			<h1 id="_idParaDest-431"><a id="_idTextAnchor441"/>Using Auto Scaling lifecycle hooks </h1>
			<p>As we just looked <a id="_idIndexMarker1528"/>at the Auto Scaling lifecycle, there are two states when an instance enters these states that allow for extra actions to occur. These two states are the <strong class="bold">Pending</strong> state and the <strong class="bold">Terminating</strong> state. When a lifecycle hook is added to an ASG, there is a configurable amount of time set that an instance can wait before moving to the next state. In the case of the <strong class="source-inline">Terminating:Wait</strong> state, you can have the instance pause for up to 30 minutes before moving on to the <strong class="source-inline">Terminating:Proceed</strong> state and then on to <strong class="source-inline">Terminated</strong>. </p>
			<h2 id="_idParaDest-432"><a id="_idTextAnchor442"/>Use cases for lifecycle hooks </h2>
			<p>You may want to<a id="_idIndexMarker1529"/> know some of the use cases for lifecycle hooks. Let's take a quick look at a few. </p>
			<p>The first one is using the launching state to invoke a Lambda function. Once our instance has passed the pending state and gone on to the <strong class="source-inline">Pending:Wait</strong> state, we can use this event to call a specific Lambda function for our application. A good use for this would be if we had Windows instances and we needed to join each instance as it came up to a <a id="_idIndexMarker1530"/>specific <strong class="bold">Active Directory</strong> (<strong class="bold">AD</strong>) domain and name server. As the instance entered in the initial lifecycle hook, it could run a script to get its <strong class="bold">Domain Name System</strong> (<strong class="bold">DNS</strong>) name <a id="_idIndexMarker1531"/>as well as join the domain.</p>
			<p>The same is true when we start the termination process of an instance. When you are terminating an instance, there are some cases where to want to be sure to capture all of the data from that set of applications before allowing the instances to proceed to the termination state. </p>
			<p>As a word of caution, using complex scripts in lifecycle hooks can cause an extra amount of time between the time we have either requested a new instance to come online and join our ASG or be terminated and allow us to have more elasticity when we need it. Instances in the wait states still take up an instance worth of capacity when calculated against the total maximum size capacity of the ASG. </p>
			<h2 id="_idParaDest-433"><a id="_idTextAnchor443"/>Cleaning up resources </h2>
			<p>As with many of<a id="_idIndexMarker1532"/> our other exercises, it is suggested that you terminate any running instances and clean up the ASG once you are done with this chapter so that you don't incur any unwanted charges on your AWS account.  </p>
			<h1 id="_idParaDest-434"><a id="_idTextAnchor444"/>Summary</h1>
			<p>In this chapter, we looked at Auto Scaling and how it can automatically manage the demand that is presented to us by both internal and external customers. We took a look at the different ways in which ASGs could be configured using different scaling policies, and even went through the hands-on exercise of deploying an ASG. Lastly, we looked at the Auto Scaling lifecycle and how lifecycle hooks can help perform more complex tasks than just simple scaling. </p>
			<p>In the next chapter, we will be starting the first of a few chapters focused on securing your environment and your pipeline by talking about protecting your data both in transit and at rest. This will especially cover the <strong class="bold">Key Management Service</strong> (<strong class="bold">KMS</strong>) and using <strong class="bold">Amazon Certificate Manager</strong> (<strong class="bold">ACM</strong>) for server-side certificates.  </p>
			<h1 id="_idParaDest-435"><a id="_idTextAnchor445"/>Review questions</h1>
			<ol>
				<li value="1">You have been brought into a company that is running a business-critical workload using ELB and Auto Scaling. This workload is a two-tier application that consists of an application tier and a database tier. Both tiers are currently deployed across two AZs in the <strong class="source-inline">us-east-1</strong> region. The database needs to be replicated in a synchronous fashion from the application. The chief technical officer (CTO) has told you that the application must stay fully available even if a single AZ becomes unavailable and Auto Scaling cannot launch new instances in the remaining AZ. How can you establish this through AWS-specific services and architecture?<ol><li> Set the configuration in ELB to deploy in three AZs with Auto Scaling set to deploy to handle 33 percent of the load per zone at peak. </li><li> Set the configuration in ELB to deploy in three AZs with Auto Scaling set to deploy to handle 50 percent of the load per zone at peak. </li><li> Set the configuration in ELB to deploy in two regions using the Round Robin algorithm with Auto Scaling set to deploy to handle 50 percent of the load per zone at peak.</li><li> Set the configuration in ELB to deploy in two regions using the Round Robin algorithm with Auto Scaling set to deploy to handle 100 percent of the load per zone at peak.</li></ol></li>
				<li>You have created a DevOps pipeline for an application that is running on EC2 instances. Customers interact with this application via an application load balancer that is attached to an ASG. Since releasing the latest version of both the application and the launch template, the application seems to be scaling up and down multiple times each hour of the day. Which fixes should you and your team make in order to stabilize the ASG, preserve elasticity, and optimize costs? (Choose two answers) <ol><li>Modify the application's ASG so that it uses scheduled scaling actions. </li><li>Modify the application's ASG termination policy to terminate the oldest instance first. </li><li>Modify the application's ASG cooldown timers so that they are bigger. </li><li>Modify the CloudWatch alarm associated with the application's ASG group so that there is a longer alarm period associated with the scale-down policy.</li></ol></li>
				<li>The company you work for has an application that consists of EC2 instances that are launched using an ASG. It has come to your attention that the EC2 instances are not scaling up as more demand is needed. How should you check and remedy the situation?<ol><li>Check to make sure that the ASG is placing instances across multiple regions. </li><li>Check to make sure that the ASG is placing instances across multiple AZs. </li><li>Check to make sure that the ELB health checks are being utilized.</li><li>Check to make sure that the correct metrics are being measured to trigger the scale-out event. </li></ol></li>
			</ol>
			<h1 id="_idParaDest-436"><a id="_idTextAnchor446"/>Review answers</h1>
			<ol>
				<li value="1">b</li>
				<li>c, d</li>
				<li>d</li>
			</ol>
		</div>
	</div></body></html>