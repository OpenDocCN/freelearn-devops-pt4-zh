<html><head></head><body><div id="sbo-rt-content"><div id="_idContainer272">
			<h1 id="_idParaDest-437"><a id="_idTextAnchor447"/>Chapter 19: Protecting Data in Flight and at Rest</h1>
			<p>As you and your developers start to connect to your systems, security is not always front of mind. This is especially the case if you think that encryption keys and certificate handshakes could cause latency. Incorporating encryption both for data in transit and at rest is a must, especially in today's environments. </p>
			<p>There are multiple ways to incorporate encryption into your environment. It can start with how to secure the transmissions you are sending back and forth between you and AWS. It then progresses to securing data that you are storing on the Amazon cloud and then moves on to data that you are serving for your customers to access. </p>
			<p>In this chapter, we're going to cover the following main topics:  </p>
			<ul>
				<li>Understanding KMS keys</li>
				<li>Adding encryption to storage </li>
				<li>Adding encryption to data stores</li>
				<li>Protecting data in transit with AWS Certificate Manager</li>
				<li>Adding a certificate to Amazon CloudFront</li>
			</ul>
			<h1 id="_idParaDest-438"><a id="_idTextAnchor448"/>Data encryption introduction </h1>
			<p>There are many reasons why there is a bigger push to encrypt data these days. The requirement could stem from a regulation that your company needs to follow for the industry they are in. It may be that there is internal compliance governance that states that data needs to be encrypted. And it just may come down to taking a proactive stance on <a id="_idIndexMarker1533"/>security by adding an additional layer of protection to your environment. No matter what the driving reason is, the goal, in the end, is to have a more secure platform for your customers to use and better data protection:</p>
			<div>
				<div id="_idContainer262" class="IMG---Figure">
					<img src="Images/Figure_19.1_B17405.jpg" alt="Figure 19.1 – The AWS cryptography stack &#13;&#10;" width="516" height="184"/>
				</div>
			</div>
			<p class="figure-caption">Figure 19.1 – The AWS cryptography stack </p>
			<p>In the end, what you and your organization's end goal should be with the use of encryption can be <a id="_idIndexMarker1534"/>simplified by minimizing the unauthorized physical and logical access to data. </p>
			<p>There are three categories to be aware of when looking at data and encryption:</p>
			<ul>
				<li>Data in transit </li>
				<li>Data at rest </li>
				<li>Data in use </li>
			</ul>
			<p>If you go by the recommendation from Amazon, then you should encrypt as much as possible in your environment. This includes encrypting data at rest when it's stored and encrypting data in transit, as it's being shipped back and forth between client and server. </p>
			<h2 id="_idParaDest-439"><a id="_idTextAnchor449"/>Options for encrypting data at rest in AWS </h2>
			<p>Throughout this chapter, we will be concentrating on two services from AWS, Key Management<a id="_idTextAnchor450"/> <a id="_idIndexMarker1535"/>Service and Certificate Manager. There <a id="_idIndexMarker1536"/>are other services in the Amazon ecosystem <a id="_idIndexMarker1537"/>that play a part in the data encryption process, and we wanted to give them a brief mention just in case they happened to appear on the test. </p>
			<p>The first is part of Amazon Virtual Private Cloud, and the second is <strong class="bold">AWS Virtual Private Network</strong> (<strong class="bold">AWS VPN</strong>). Using an AWS site-to-site VPN connection to connect your data center <a id="_idIndexMarker1538"/>to your VPC allows your transmissions of data to happen securely over the IPSec protocol. This is a group of protocols <a id="_idIndexMarker1539"/>for encrypting internet transmissions. </p>
			<p>You get started by setting up a customer gateway, which usually consists of a router, and then create the VPN gateway on your VPC. VPNs have a throughput limit of 1.25 gigabits per second. </p>
			<p>Now that we understand the options for encrypting data at rest in our AWS accounts, let's concentrate on using AWS <strong class="bold">Key Management Service</strong> (<strong class="bold">KMS</strong>) to protect our data at rest. </p>
			<h1 id="_idParaDest-440"><a id="_idTextAnchor451"/>Understanding KMS keys </h1>
			<p>KMS is a managed service from Amazon that makes it easy to produce and manage <strong class="bold">Customer-Managed Keys</strong> (<strong class="bold">CMKs</strong>). CMKs are the encryption keys used to secure and control access <a id="_idIndexMarker1540"/>data stored on AWS. KMS integrates seamlessly <a id="_idIndexMarker1541"/>with many other services, especially the IAM service, so that you can control who is allowed access to the keys. </p>
			<p>AWS creates the key material for the KMS key. You, as the customer, cannot extract, export, view, or manage this key material. You can delete the key but cannot delete the key material itself:</p>
			<div>
				<div id="_idContainer263" class="IMG---Figure">
					<img src="Images/Figure_19.2_B17405.jpg" alt="Figure 19.2 – Master and data keys in AWS KMS &#13;&#10;" width="426" height="310"/>
				</div>
			</div>
			<p class="figure-caption">Figure 19.2 – Master and data keys in AWS KMS </p>
			<p>One of the key concepts to understand in KMS is <strong class="bold">envelope encryption</strong>. When AWS encrypts <a id="_idIndexMarker1542"/>your data, your data is secured, but your key needs <a id="_idIndexMarker1543"/>to be protected as well. AWS does this by encrypting your data with a data key and then encrypting the data key with another key. That top-level plaintext key is known as the master key. </p>
			<p>Using the envelope encryption process provides a number of benefits:</p>
			<ul>
				<li><strong class="bold">It protects the data keys</strong> – This way, you can store the encrypted data key beside the encrypted data. </li>
				<li><strong class="bold">You can encrypt the same data using multiple keys</strong> – KMS allows you to only re-encrypt the <a id="_idIndexMarker1544"/>data keys that protect the raw data instead of all raw data that the key encrypts. </li>
				<li><strong class="bold">You can combine the strengths of multiple algorithms</strong> – Symmetric key algorithms are smaller than public-key algorithms generally. However, public-key algorithms allow for inherited separation of roles. Using envelope encryption allows you to use both strategies at the same time.</li>
			</ul>
			<h2 id="_idParaDest-441"><a id="_idTextAnchor452"/>Using AWS-managed CMKs keys to encrypt storage </h2>
			<p>Each AWS service that offers encryption has its own AWS-managed KMS key. </p>
			<p>One of the key differences between AWS-managed CMKs and user-created CMKs is the rotation <a id="_idIndexMarker1545"/>schedule. With AWS-managed <a id="_idIndexMarker1546"/>keys, key rotation is required, and it happens every 1,095 days or every 3 years. </p>
			<p>The similarity between the two different types of keys is the fact that both AWS-managed keys and CMKs are used only for your AWS account.</p>
			<h3>Using KMS with S3 to protect objects stored at rest</h3>
			<p>KMS integrates seamlessly with S3 object storage. S3 has its own service-managed key that allows <a id="_idIndexMarker1547"/>you to encrypt objects in your buckets with almost little to no effort on your part. There are also the following security controls available to help incorporate KMS with S3:</p>
			<ul>
				<li>Amazon S3 has the ability to encrypt all new objects placed into a bucket automatically. This is done through a bucket setting in the <strong class="bold">Properties</strong> section labeled <strong class="bold">default encryption</strong>. Once you have turned this setting on, then any new object <a id="_idIndexMarker1548"/>that is uploaded into the bucket is automatically encrypted with either the Amazon-managed S3 key (by default) or the specified customer-managed S3 key. </li>
				<li>If you need to retroactively encrypt items in an S3 bucket, you can do so using the S3 batch process. Amazon S3 has its own ability to perform batch processing on objects within the buckets. If your internal guidance has changed, or an audit has found that a user (either internal or external) has been adding items to a bucket without encryption, then you can use S3 Batch Operations to remediate the situation. </li>
				<li>If you want to check which items are or are not encrypted in an S3 bucket, then you can run an S3 inventory report. </li>
			</ul>
			<p>Now that we have seen how KMS works smoothly with Amazon S3, especially in the case of Amazon-managed keys, we will now look at how to create and manage our own key, and the important differences between a customer-managed key and an Amazon-managed key. </p>
			<h2 id="_idParaDest-442"><a id="_idTextAnchor453"/>Creating and managing a customer-managed key in KMS </h2>
			<p>There may be cases where certain users or teams may need to have access to data and others should <a id="_idIndexMarker1549"/>not have the right to access it. This is one of <a id="_idIndexMarker1550"/>the ideal use cases for integrating a CMK <a id="_idIndexMarker1551"/>along with an IAM policy for <a id="_idIndexMarker1552"/>who can access the key. </p>
			<p>As we will see in this exercise, there is a separation of duties between key administrators and key users. Key administrators are the users who control the key access, including the ability to rotate and delete the key. There are also key users. These are the users and service roles that have the ability to use the key on a day-to-day basis. These are important concepts to understand as you both create and manage the keys in your account. There may be individuals and groups who need the ability to manage the keys but do not need access to data that is protected by the keys.</p>
			<p>In the following <a id="_idIndexMarker1553"/>exercise, we are going to create our <a id="_idIndexMarker1554"/>own customer-managed key using KMS. We <a id="_idIndexMarker1555"/>will also designate both key administrators <a id="_idIndexMarker1556"/>and key users before we are finished creating the key:</p>
			<ol>
				<li>Log on to the AWS Management Console and search for <strong class="source-inline">Key Management Service</strong> from the top search men<a id="_idTextAnchor454"/>u bar:<div id="_idContainer264" class="IMG---Figure"><img src="Images/Figure_19.3_B17405.jpg" alt="Figure 19.3 – The Key Management Service icon from the search menu&#13;&#10;" width="792" height="173"/></div><p class="figure-caption">Figure 19.3 – The Key Management Service icon from the search menu</p></li>
				<li>Once at KMS, we can now click on the orange <strong class="bold">Create a key</strong> button. </li>
				<li>Now on the <strong class="bold">Configure Key</strong> page, choose the <strong class="bold">Symmetric</strong> key type and click on the orange <strong class="bold">Next</strong> button at the bottom of the page. </li>
				<li>This should bring us to the <strong class="bold">Alias</strong> page. In the <strong class="bold">Alias</strong> box, use <strong class="source-inline">chapter19</strong> as the KMS key alias. We can use <strong class="source-inline">example key</strong> as the <strong class="bold">Description</strong>. Scroll down to the bottom of the page and click on the orange <strong class="bold">Next</strong> button:<div id="_idContainer265" class="IMG---Figure"><img src="Images/Figure_19.4_B17405.jpg" alt="Figure 19.4 – Adding the KMS key alias and description&#13;&#10;" width="498" height="389"/></div><p class="figure-caption">Figure 19.4 – Adding the KMS key alias and description</p></li>
				<li>Now it's time to choose key administrators. This is an important step that determines who can control the key access and who can delete the key, but not the people and groups who <a id="_idIndexMarker1557"/>can use the key. Since you have <a id="_idIndexMarker1558"/>most likely logged in with your <strong class="source-inline">devops</strong> user that we created at the beginning of our exercises, choose this <a id="_idIndexMarker1559"/>user, and if you have another <a id="_idIndexMarker1560"/>administrator account that you either use or would like to have access to the key, check the box next to that name as well. Once you have selected the names for the administrators, click the orange <strong class="bold">Next</strong> button at the bottom of the screen. </li>
				<li>We should now be on the <strong class="bold">Define key usage permissions</strong> page. And although this looks extremely similar to the previous page we were on, this is the page where we actually set which users and roles can use and access the key. This time, besides our <strong class="source-inline">devops</strong> user, let's add the developer user that we created previously, <strong class="source-inline">mariel</strong>, to the list of authorized users as well. Once you have made your selections, click the orange <strong class="bold">Next</strong> button at the bottom of the screen. </li>
				<li>On the <strong class="bold">Review</strong> page, scroll down and click the orange <strong class="bold">Finish</strong> button to create the key.</li>
			</ol>
			<p>Now that we have gone through the process of creating our CMK, let's see how we can use this key to keep our data secure via encryption. </p>
			<h2 id="_idParaDest-443"><a id="_idTextAnchor455"/>Adding encryption to data stores using our custom KMS key  </h2>
			<p>Let's now take a look at how we can use the CMK we just created to encrypt objects in an S3 bucket <a id="_idIndexMarker1561"/>that we have created <a id="_idIndexMarker1562"/>previously. For the examples shown, we will be using the bucket that we created back in <a href="B17405_04_Final_JM_ePub.xhtml#_idTextAnchor110"><em class="italic">Chapter 4</em></a>, <em class="italic">Amazon S3 Blob Storage</em>: </p>
			<ol>
				<li value="1">Log on to the AWS Management Console and navigate to <strong class="bold">S3 Service</strong>. Find the original bucket that you created back in <a href="B17405_04_Final_JM_ePub.xhtml#_idTextAnchor110"><em class="italic">Chapter 4</em></a>, <em class="italic">Amazon S3 Blob Storage</em>. In our case, it was a bucket named <strong class="source-inline">devopspro-beyond</strong>. Once you find it, click on the name of the bucket to enter it. </li>
				<li>Once inside the bucket, click on the top horizontal menu on the tab named <strong class="bold">Properties</strong>:<div id="_idContainer266" class="IMG---Figure"><img src="Images/Figure_19.5_B17405.jpg" alt="Figure 19.5 – The Properties menu item in the S3 horizontal menu &#13;&#10;" width="1197" height="94"/></div><p class="figure-caption">Figure 19.5 – The Properties menu item in the S3 horizontal menu </p></li>
				<li>Now displaying the properties items of the S3 bucket, scroll down until you find the <strong class="bold">Default encryption</strong> heading. Click on the white <strong class="bold">Edit</strong> button on the top right corner of the <strong class="bold">Default encryption</strong> box to enter the settings. </li>
				<li>You should now be on the page labeled <strong class="bold">Edit default encryption</strong>. Under the label of <strong class="bold">Server-side encryption</strong>, click on the radio button next to <strong class="bold">Enable</strong>. Once you have selected this radio button, another set of selections will appear below for <strong class="bold">Encryption key type</strong>. Choose the radio button next to the <strong class="bold">AWS Key Management Service key (SSE-KMS)</strong> option:<div id="_idContainer267" class="IMG---Figure"><img src="Images/Figure_19.6_B17405.jpg" alt="Figure 19.6 – Enabling the KMS key on an S3 bucket&#13;&#10;" width="1358" height="429"/></div><p class="figure-caption">Figure 19.6 – Enabling the KMS key on an S3 bucket</p></li>
				<li>Once the <strong class="bold">AWS Key Management Service key (SSE-KMS)</strong> option is selected, another <a id="_idIndexMarker1563"/>set of <a id="_idIndexMarker1564"/>options will appear below on the <strong class="bold">Edit default encryption</strong> page. Under the <strong class="bold">AWS KMS key</strong> heading, select the radio button next to the <strong class="bold">Choose from your AWS KMS keys</strong> label. This will unveil a dropdown where we can select the key named <strong class="source-inline">chapter19</strong> that we created in the previous hands-on exercise. Once selected, you can then scroll down to the bottom of the page and click the orange <strong class="bold">Save changes</strong> button. </li>
				<li>With our bucket set up for object encryption, click on the <strong class="bold">Objects</strong> menu item on the horizontal menu to be brought back to the main bucket page. Click on the orange <strong class="bold">Upload</strong> button, and on the <strong class="bold">Upload</strong> screen, click on the white <strong class="bold">Add files</strong> button. Choose any random file to upload to your bucket. Once your file has been queued to upload, click the orange <strong class="bold">Upload</strong> button.</li>
				<li>When your file completely uploads to the S3 bucket, you can click on the orange <strong class="bold">Close</strong> button. This will bring you back to the <strong class="bold">Objects</strong> page for the S3 bucket. Click on the name of the object and then scroll down to <strong class="bold">Server-side encryption settings</strong> to see that your object has been encrypted with your KMS key. <p class="callout-heading">Important Note</p><p class="callout">If you are done with your KMS key, then you might want to go back and schedule its deletion. KMS keys do not get deleted right away and have a minimum of seven days before they can be deleted. Encrypted objects whose key has been deleted will not be able to be accessed. </p></li>
			</ol>
			<p>With an <a id="_idIndexMarker1565"/>understanding of how to <a id="_idIndexMarker1566"/>protect our objects at rest using KMS under our belt, we will next move on to protecting data in transit using AWS Certificate Manager. </p>
			<h1 id="_idParaDest-444"><a id="_idTextAnchor456"/>Protecting data in transit with AWS Certificate Manager</h1>
			<p>When your external site presents a <strong class="bold">Transport Layer Security</strong> (<strong class="bold">TLS</strong>) certificate and uses the <a id="_idIndexMarker1567"/>secure HTTP protocol (HTTPS/443), customers <a id="_idIndexMarker1568"/>know that you <a id="_idIndexMarker1569"/>are protecting data they are sending to and from your systems in an encrypted manner:</p>
			<div>
				<div id="_idContainer268" class="IMG---Figure">
					<img src="Images/Figure_19.7_B17405.jpg" alt="Figure 19.7 – How SSL/TLS works from browser to client &#13;&#10;" width="526" height="307"/>
				</div>
			</div>
			<p class="figure-caption">Figure 19.7 – How SSL/TLS works from browser to client </p>
			<p>When you or <a id="_idIndexMarker1570"/>your <a id="_idIndexMarker1571"/>customers request a website that is presenting as HTTPS secured by an SSL/TLS certificate, the following steps take place:</p>
			<ol>
				<li value="1">The server attempts to connect to the website over the secure <strong class="source-inline">443</strong> port. That web server then identifies itself.</li>
				<li>The server then sends a copy of its SSL certificate.</li>
				<li>The client will then check the certificate to see whether it's been issued from a trusted authority. If it trusts the certificate, it then sends a message of acknowledgment back to the server. </li>
				<li>The server then issues a digitally signed acknowledgment that will start the SSL session.</li>
				<li>Data is then shared securely between the client and the server. </li>
			</ol>
			<p><strong class="bold">AWS Certificate Manager</strong> (<strong class="bold">ACM</strong>) is a server that can help you quickly and easily create, manage, and <a id="_idIndexMarker1572"/>deploy TLS certificates on AWS services. ACM also supports public certificates. ACM handles the hardest and most complicated parts of <strong class="bold">Private Key Infrastructure</strong> (<strong class="bold">PKI</strong>). This includes tasks such as creating the <a id="_idIndexMarker1573"/>certificate, certificate renewal, and issuing the certificate. </p>
			<p>ACM can quickly and easily provision the TLS certificates for use with external-facing AWS resources such as the following:</p>
			<ul>
				<li>Elastic Load Balancing </li>
				<li>AWS Elastic Beanstalk </li>
				<li>Amazon EC2 instances </li>
				<li>Amazon API Gateway </li>
				<li>Amazon CloudFront</li>
			</ul>
			<p>Any certificate that ACM creates is valid for 13 months (395 days). However, you cannot download the private key for an ACM certificate that you create. Once a certificate has been issued, you can neither add nor remove domain names from that certificate. You can create wildcard certificates (<strong class="source-inline">*.domain.com</strong>) or you will need to create a new certificate if a new domain is needed. </p>
			<p>When we talk about domains in the following paragraph, we are referring to domains registered with a registrar and being hosted on a DNS server or service such as Route 53. This many <a id="_idIndexMarker1574"/>times can be thought <a id="_idIndexMarker1575"/>of as the domain name. When first issuing a requested Amazon certificate for a domain, ACM must verify that you either own or control the domain for which you are requesting the certificate. This can be done in two ways. The first is via email verification. ACM will send out email messages to the three email addresses listed on the WHOIS database and you have up to 72 hours to validate by acting on that email. The second way for validation is via DNS validation. ACM creates two CNAME records for your domain and requests that you put those entries into your DNS database for validation. Once it sees those entries, the service knows that you are the owner of the domain name. </p>
			<h2 id="_idParaDest-445"><a id="_idTextAnchor457"/>The two functions that ACM can serve</h2>
			<p>We have explained the role of secure certificates mainly as they pertain to public-facing websites. Issuing these certificates is one of the critical roles that ACM plays. However, this is not the <a id="_idIndexMarker1576"/>only role that it can serve in your AWS environment. ACM can provide two separate services. The first is to manage, provision, and <a id="_idIndexMarker1577"/>renew enterprise-grade TLS certificates for use with services such as Elastic Load Balancing, API Gateway, and CloudFront, along <a id="_idIndexMarker1578"/>with other front-facing services. The second service that ACM provides <a id="_idIndexMarker1579"/>is being a private certificate authority. This allows you to issue secure and trusted private certificates for your applications and infrastructure for your workloads and organization. </p>
			<p>Now that we know what functions ACM can perform, we will go through a hands-on exercise of creating and provisioning a certificate using ACM and then using that provisioned certificate in a publicly available CloudFront distribution. </p>
			<h2 id="_idParaDest-446"><a id="_idTextAnchor458"/>Adding a certificate to Amazon CloudFront </h2>
			<p>With a solid <a id="_idIndexMarker1580"/>understanding of the ACM service, we will <a id="_idIndexMarker1581"/>now move on to the final hands-on exercise of this chapter. We will start off by creating a TLS certificate using ACM. Then, we will create a very simple CloudFront distribution and secure it for anyone who tries to connect to the distribution using our secure certificate. </p>
			<p>If you do not have a domain name for use, you can easily register one using the Amazon Route 53 service to complete this exercise at a very nominal cost. Otherwise, you can read through the steps of the following exercises to understand the process:</p>
			<ol>
				<li value="1">Log on to the AWS Management Console and search for the ACM service. Once it appears from <a id="_idIndexMarker1582"/>the drop-down menu, click on <a id="_idIndexMarker1583"/>the icon to be taken to the main service page. For the certificate to work with the CloudFront service, we need to create it in the <strong class="source-inline">us-east-1</strong> region. If you create the certificate in any other region, you will not be able to see it in the second part of this exercise. </li>
				<li>On the ACM main page, find the icon and heading that is labeled <strong class="bold">Provision certificates</strong>. Click on the blue <strong class="bold">Get started</strong> button under this heading.</li>
				<li>On the <strong class="bold">Request a certificate</strong> page, since we do not have a Private Certificate Authority available, there is only one option available to us. Keep this option selected and press the blue <strong class="bold">Request a certificate</strong> button at the bottom of the page. </li>
				<li>The first step when creating a certificate is to add domain names to the certificate. Unless you only want the certificate to be used for a single subdomain (for example, www), you can use an asterisk to serve as a wildcard for your entire domain. Type your wildcard domain in the textbox in the form of <strong class="source-inline">*.devopsandbeyond.com</strong> and then click on the blue <strong class="bold">Next</strong> button:<div id="_idContainer269" class="IMG---Figure"><img src="Images/Figure_19.8_B17405.jpg" alt="Figure 19.8 – Adding the wildcard domain name to our ACM-created certificate&#13;&#10;" width="741" height="373"/></div><p class="figure-caption">Figure 19.8 – Adding the wildcard domain name to our ACM-created certificate</p></li>
				<li>The next step will be validating that you actually own the domain. We are going to assume that you are managing your DNS via Route53 and will go for <strong class="bold">DNS validation</strong>. Keep the <strong class="bold">DNS validation</strong> option selected and then click the blue <strong class="bold">Next</strong> button. </li>
				<li>This will bring you to the <strong class="bold">Add tags</strong> page. Simply click the blue <strong class="bold">Review</strong> button at the bottom <a id="_idIndexMarker1584"/>of the page. When you are <a id="_idIndexMarker1585"/>brought to the <strong class="bold">Review</strong> page, after verifying that your domain was typed in correctly, press the blue <strong class="bold">Confirm and request</strong> button. </li>
				<li>You will then need to add the requested CNAME to your DNS file. Take the value and go to the Route53 service. Add the entry as a new CNAME record in your domain's Route53 hosted zone. You will most likely need to wait a few minutes for the values to propagate before you see <strong class="bold">Validation status</strong> turn green and say <strong class="bold">Success</strong>. Once this happens, you can click the blue <strong class="bold">Continue</strong> button at the bottom of the screen:<div id="_idContainer270" class="IMG---Figure"><img src="Images/Figure_19.9_B17405.jpg" alt="Figure 19.9 – Validation status showing Success after the DNS entry has been added &#13;&#10;" width="371" height="124"/></div><p class="figure-caption">Figure 19.9 – Validation status showing Success after the DNS entry has been added </p><p>With our certificate now created, we can now move on to creating a CloudFront distribution. Amazon CloudFront is the AWS native <strong class="bold">Content Distribution Network</strong> (<strong class="bold">CDN</strong>). CloudFront allows you to serve content using a single origin to many customers <a id="_idIndexMarker1586"/>all over the world simultaneously with much lower latency than if you were trying to serve the content from a single point of presence, such as a server or Auto Scaling group. </p></li>
				<li>We will now need to navigate to the CloudFront service from the top search bar on the AWS Management Console. Once you arrive on the service main page, click on the orange <strong class="bold">Create a CloudFront distribution</strong> button to start creating a new CloudFront distribution. </li>
				<li>The page heading should now be titled <strong class="bold">Create distribution</strong>. The first option under the <strong class="bold">Origin</strong> section allows you to choose an origin – this is where your content will reside. We will use the S3 bucket that we added our KMS key to in the earlier hands-on lesson in the chapter as our origin. The example bucket we have been using throughout this book has been named <strong class="source-inline">devopspro-beyond</strong>; however, your bucket will be named something different. Choose your origin bucket from the drop-down list. The origin will be suffixed by <strong class="source-inline">.s3.us-east-2.amazonaws.com</strong>. </li>
				<li>In the next textbox, <strong class="bold">Origin path</strong>, we will add a specific directory where we will upload the content for our origin. Enter <strong class="source-inline">/pages</strong> in the <strong class="bold">Origin path</strong> textbox. </li>
				<li>Allow the name created by CloudFront to remain and move on to the <strong class="bold">S3 bucket access</strong> section. Choose the <strong class="bold">Yes Use OAI</strong> option. This option will allow us to keep <a id="_idIndexMarker1587"/>our bucket private and <a id="_idIndexMarker1588"/>make users go through the CloudFront distribution, rather than trying to bypass the CDN and access the assets in the origin directly. Click on the white <strong class="bold">Create a new OAI</strong> button; you can keep the name that CloudFront provides. Then click the orange <strong class="bold">Create</strong> button. </li>
				<li>When the dialog window closes, under the <strong class="bold">Bucket policy</strong> heading, select the <strong class="bold">Yes, update the bucket policy</strong> option. </li>
				<li>Scroll down until you get to the <strong class="bold">Viewer</strong> option and ensure that the <strong class="screen-inline">Redirect HTTP to HTTPS</strong> value is selected. </li>
				<li>We can keep other options in place until we get down to the <strong class="bold">Settings</strong> heading. The first thing we want to do is optimize on costs, so under <strong class="bold">Price class</strong>, we want to select <strong class="bold">Use only North America and Europe</strong>.</li>
				<li>Now, we are about to install our custom certificate from ACM. Under the <strong class="bold">Custom SSL certificate –</strong> <em class="italic">optional</em> label, use the drop-down menu option to find the certificate you created in the first part of the exercise under the <strong class="bold">ACM certificates</strong> heading.  </li>
				<li>With your <a id="_idIndexMarker1589"/>certificate selected, scroll down <a id="_idIndexMarker1590"/>to the bottom of the page and click on the orange <strong class="bold">Create distribution</strong> button. </li>
				<li>While the CloudFront distribution is being created, make a note of the <strong class="bold">Distribution domain name</strong>; this is how you will access CloudFront without adding a Route53 alias:<div id="_idContainer271" class="IMG---Figure"><img src="Images/Figure_19.10_B17405.jpg" alt="Figure 19.10 – The CloudFront Distribution domain name &#13;&#10;" width="476" height="203"/></div><p class="figure-caption">Figure 19.10 – The CloudFront Distribution domain name </p><p>While the distribution is deploying, if you would like to test out the certificate, we need to go and perform a few more steps at the origin. Let's go back to S3 and get our origin ready to serve content. One of the first things we need is a simple webpage to serve. Take the following code and add it to a file named <strong class="source-inline">index.html</strong>; we will upload it to our S3 bucket in just a moment: </p><p class="source-code"><strong class="bold">&lt;html&gt; </strong></p><p class="source-code"><strong class="bold">&lt;head&gt; &lt;title&gt; Chapter 19 - Protecting Data in Flight and at Rest &lt;/title&gt; &lt;/head&gt; </strong></p><p class="source-code"><strong class="bold">&lt;p&gt; Protecting Transmission of data - &lt;b&gt; VPN &lt;/b&gt; &lt;/p&gt;</strong></p><p class="source-code"><strong class="bold">&lt;p&gt; Protecting Data at Rest - &lt;b&gt; KMS &lt;/b&gt; &lt;/p&gt;</strong></p><p class="source-code"><strong class="bold">&lt;p&gt; Protecting Data in Flight - &lt;b&gt; SSL / TLS certificates &lt;/b&gt; &lt;/p&gt;</strong></p><p class="source-code"><strong class="bold">&lt;/html&gt;</strong></p></li>
				<li>Navigate back to S3. Once there, find the bucket that you designated as the origin for your CloudFront distribution. Click on the name of this bucket to enter it. </li>
				<li>Once inside the bucket, we will need to click on the white <strong class="bold">Create folder</strong> button in the <a id="_idIndexMarker1591"/>upper right of the <strong class="bold">Objects</strong> screen. When the dialog box comes up, name the folder <strong class="source-inline">pages</strong>, just as we did in the <a id="_idIndexMarker1592"/>options for the CloudFront distribution. Click the orange <strong class="bold">Create folder</strong> button once you have named the folder.</li>
				<li>Click on the newly created pages directory and then click the orange <strong class="bold">Upload</strong> button. Click the white <strong class="bold">Add files</strong> button and then add the <strong class="source-inline">index.html</strong> file that we created at the beginning of this section. Once the index page has been added for upload, click the orange <strong class="bold">Upload</strong> button. </li>
			</ol>
			<p>We have just seen how to create and implement a secure certificate using ACM. Let's now review what we learned in this chapter. </p>
			<h1 id="_idParaDest-447"><a id="_idTextAnchor459"/>Summary</h1>
			<p>In this chapter, we looked at protecting your data both at rest and in transit in your Amazon account. We began truly at an account level, looking at how to implement encryption during the transmission of data to your VPC using secure VPN connections over an IPSec tunnel. After that, we took a look at KMS and the differences between an Amazon-managed key and a CMK. Finally, we looked at securing data in transit using ACM. We saw how easy ACM makes it to create and implement SSL and TLS certificates on several AWS services.  </p>
			<p>In the next chapter, we will look at how to enforce standards and compliance within your organization with two powerful automation tools offered by AWS: Systems Manager and Config. </p>
			<h1 id="_idParaDest-448"><a id="_idTextAnchor460"/>Review questions</h1>
			<ol>
				<li value="1">A new set of compliance regulations has come down from the security department in the company you are working for. They are now stating that all encryption keys must be rotated every 12 months without exceptions. Which one of the following options would not meet the proposed new guidelines?<p>a. Using imported key material with a CMK </p><p>b. Using an AWS-managed key </p><p>c. Using an AWS customer-managed symmetric CMK </p><p>d. Using an AWS customer-managed asymmetric CMK </p></li>
				<li>You have been brought into a company that is working with confidential data. However, they are transferring the data unencrypted, both on the Amazon administrative console and using the CLI. What steps can you take to immediately secure the transport of data using encryption?<p>a. Create a set of CMKs in KMS. Using envelope encryption, have each user encrypt each transaction before any CLI command. </p><p>b. Use ACM to create a certificate to create a secure login and encrypt transmissions to the Amazon administrative console. </p><p>c. Create a customer gateway and a VPN gateway on the primary VPC. Ensure that any other VPCs that need to be accessed by the development team are either peered or connected via a transit VPC connector.  </p><p>d. Have all users add a multi-factor authentication to their account to ensure secure communications via both the CLI and the AWS Management Console. </p></li>
			</ol>
			<h1 id="_idParaDest-449"><a id="_idTextAnchor461"/>Review answers</h1>
			<ol>
				<li value="1">b</li>
				<li>c</li>
			</ol>
		</div>
	</div></body></html>