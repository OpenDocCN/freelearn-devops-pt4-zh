- en: 'Chapter 20: Enforcing Standards and Compliance with System Manger''s Role and
    AWS Config'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第20章：通过Systems Manager的角色和AWS Config执行标准和合规性
- en: 'Systems Manager is a service comprising multiple individual capabilities grouped
    into five categories: Operations Management, Application Management, Change Management,
    Node Management, and Shared Resources. Learning to use this tool effectively can
    make you, as a DevOps professional, much more efficient, especially when implementing
    standards and checking for compliance in one or multiple AWS environments or accounts.
    And as automation and compliance demands increase from organizations, having a
    tool that can check for compliance, alert against discrepancies, and remediate
    violations can be essential in preventing environmental drift.'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: Systems Manager是一个由多个单独功能组成的服务，这些功能被分为五个类别：运营管理、应用管理、变更管理、节点管理和共享资源。学习如何有效使用这个工具，可以让你作为一个DevOps专业人员变得更加高效，特别是在实现标准和检查一个或多个AWS环境或账户中的合规性时。随着组织对自动化和合规性要求的增加，拥有一个可以检查合规性、对不一致性发出警报并修复违规行为的工具，对于防止环境漂移至关重要。
- en: 'In this chapter, we''re going to cover the following main topics:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将讨论以下主要内容：
- en: The various capabilities of AWS Systems Manager
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: AWS Systems Manager的各种功能
- en: Using runbooks in Systems Manager
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在Systems Manager中使用操作手册
- en: AWS Config essentials
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: AWS Config基础知识
- en: The various capabilities of AWS Systems Manager
  id: totrans-6
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: AWS Systems Manager的各种功能
- en: 'DevOps is a marriage of two responsibilities: development and operations. AWS
    **Systems Manager** (**SSM**) focuses on the operations part of those responsibilities,
    giving you a vast array of tools to use for everyday operations tasks. These tools
    range from creating predefined runbooks to quickly, easily, and repetitively performing
    functions on your instances, whether they''re Linux or Windows instances. Systems
    Manager can also provide you with an interface to track your resources or groups
    of resources from a common place.'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: DevOps是开发和运维两项职责的结合。AWS **Systems Manager** (**SSM**) 关注这些职责中的运维部分，为你提供了大量的工具，用于日常运营任务。这些工具涵盖了从创建预定义的操作手册，到在Linux或Windows实例上快速、轻松且重复地执行功能。Systems
    Manager还可以为你提供一个接口，以便在一个统一的地方跟踪你的资源或资源组。
- en: As an added benefit, Systems Manager not only helps with your instances in the
    AWS Cloud, but it can also help manage your servers on-premises by installing
    the lightweight agent on those servers and allowing that agent to communicate
    back to the AWS account.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 作为额外的好处，Systems Manager不仅有助于管理AWS云中的实例，还可以通过在本地服务器上安装轻量级代理来管理这些服务器，并允许该代理与AWS账户进行通信。
- en: Key features and benefits of Systems Manager
  id: totrans-9
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Systems Manager的关键特性和优势
- en: 'Systems Manager is not just one service; instead, it is a whole set of tools
    for you to use. You may not use all of its capabilities, but knowing them can
    help when you are looking to solve a problem quickly:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: Systems Manager不仅仅是一个服务；它是一个供你使用的完整工具集。你可能不会使用它的所有功能，但了解它们可以帮助你快速解决问题：
- en: '![Figure 20.1 – An overview of many of the critical components that make up
    Systems Manager'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 20.1 – 组成Systems Manager的许多关键组件的概览'
- en: '](img/Figure_20.1_B17405.jpg)'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_20.1_B17405.jpg)'
- en: Figure 20.1 – An overview of many of the critical components that make up Systems
    Manager
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 图 20.1 – 组成Systems Manager的许多关键组件的概览
- en: Now that we have looked at some of the capabilities that Systems Manager provides,
    let's dive deeper into managing our instances and nodes more effectively with
    it.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经了解了一些AWS Systems Manager的功能，让我们深入探讨如何更有效地使用它来管理实例和节点。
- en: Node management with Systems Manager
  id: totrans-15
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用Systems Manager进行节点管理
- en: Systems Manager provides many capabilities to operations team members, but there
    is a whole category of items that specifically fall into the category of **Node
    management**.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: Systems Manager为运维团队成员提供了许多功能，但有一类功能特别属于**节点管理**这一类别。
- en: We will look at some of the specialty services in AWS Config that have been
    created for the express purpose of node management.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将查看AWS Config中一些专门为节点管理目的创建的特殊服务。
- en: Fleet Manager
  id: totrans-18
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: Fleet Manager
- en: Knowing all the different instances that you are controlling at once can be
    an overwhelming task. SSM Fleet Manager provides you with a user interface to
    see all the instances in which you are in control. Fleet Manager also allows you
    to gather data from those instances to relay back without ever having to go into
    the servers or instances individually.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 同时了解您控制的所有不同实例可能是一项令人生畏的任务。SSM Fleet Manager为您提供了一个用户界面，让您查看所有在您控制下的实例。Fleet
    Manager还允许您收集这些实例的数据，并传递回去，无需逐个进入服务器或实例。
- en: Inventory
  id: totrans-20
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 清单
- en: If you need visibility into either your on-premises servers, your Cloud EC2
    instances, or both, then the **Inventory** capability of Systems Manager can be
    extremely useful for you.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您需要查看本地服务器、云EC2实例或两者的状态，那么Systems Manager的**清单**功能对您非常有用。
- en: Hybrid activations
  id: totrans-22
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 混合激活
- en: If you have servers that are not on the AWS cloud or on-premises, you can use
    SSM **Hybrid Activations** to manage both those devices, along with other EC2
    instances that need to be managed in a single management console. The hybrid activations
    capability helps walk you through the prerequisites required to create an activation
    on an on-premises server. This includes creating an IAM service role, ensuring
    that the operating system is compatible, and installing the Systems Manager agent.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您有不在AWS云或本地的服务器，您可以使用SSM **混合激活**来管理这些设备，以及需要在单一管理控制台中管理的其他EC2实例。混合激活功能帮助您了解创建本地服务器激活所需的前提条件。包括创建IAM服务角色，确保操作系统兼容，并安装Systems
    Manager代理。
- en: Session manager
  id: totrans-24
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 会话管理器
- en: Managing all the different PEM keys, for instance, especially when developers
    create their own keys, can be a burdensome task. **Session Manager** helps ease
    this burden by allowing authorized users to use a web-based console to perform
    commands without the need to have a copy of the key. Instead, you can find the
    name of the machine that you need to create a session remotely and then instantly
    start a session.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 管理所有不同的PEM密钥，尤其是在开发人员自己创建密钥时，可能是一个繁重的任务。**会话管理器**通过允许授权用户使用基于Web的控制台执行命令，无需复制密钥，从而帮助减轻这一负担。您只需找到您需要远程创建会话的机器名称，然后立即启动会话。
- en: We will go through an exercise that covers using the Session Manager capability
    later in this chapter.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 本章稍后我们将通过一个练习来讲解如何使用会话管理器功能。
- en: Run command
  id: totrans-27
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 运行命令
- en: With the **run command** capability of Systems Manager, you can securely update
    the configuration of your registered managed instances. **Command documents**
    are created for the run command to execute. Commands are then run for specified
    targets of managed instances using either instance IDs or tags.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 通过Systems Manager的**运行命令**功能，您可以安全地更新您注册的管理实例的配置。**命令文档**是为执行运行命令而创建的。然后，使用实例ID或标签，针对指定的管理实例运行命令。
- en: Tip
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 提示
- en: You should always test the run commands that you create on non-production or
    test instances. This way, you can make sure that the command is going to perform
    the way you expect before enacting the commands or servers taking on production
    traffic.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 您应始终在非生产或测试实例上测试您创建的运行命令。这样，您可以确保命令在执行之前会按预期执行，并且在生产流量到达服务器之前不会产生任何问题。
- en: State manager
  id: totrans-31
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 状态管理器
- en: 'Systems manager''s **State Manager** allows you to perform the following actions:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: Systems Manager的**状态管理器**允许您执行以下操作：
- en: You can configure network settings.
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您可以配置网络设置。
- en: You can have your instances join a Windows domain.
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您可以让您的实例加入Windows域。
- en: It allows you to install software at instance startup using bootstrap scripts.
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它允许您在实例启动时使用引导脚本安装软件。
- en: It lets you run scripts on Windows-, Linux-, or even macOS-managed instances
    throughout their life cycle.
  id: totrans-36
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它允许您在整个生命周期内，在Windows、Linux甚至macOS管理的实例上运行脚本。
- en: Patch manager
  id: totrans-37
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 补丁管理器
- en: If you are not running immutable infrastructure in your environment, then you
    should have a strategy to keep your instances up to date system patches. Patch
    manager allows you to add these system patches on a maintenance schedule.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您的环境中没有运行不可变基础设施，您应该有一个策略来保持您的实例系统补丁的最新状态。补丁管理器允许您在维护计划中添加这些系统补丁。
- en: Running remote commands on an EC2 instance
  id: totrans-39
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在EC2实例上运行远程命令
- en: Previously, if you wanted to run a remote command on an EC2 instance, then you
    had to create a PEM-encoded key. SSM Session Manager changes all of this as it
    allows you to log in to an instance using a web browser using a role that has
    the correct permissions instead of managing and rotating keys.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 以前，如果你想在 EC2 实例上运行远程命令，必须创建一个 PEM 编码的密钥。SSM 会话管理器改变了这一切，它允许你通过浏览器使用具有正确权限的角色登录实例，而不是管理和轮换密钥。
- en: Note
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: '**PEM** stands for **Privacy-Enhanced Mail**, but this is just extra knowledge,
    and knowing the definition of PEM will not be a requirement for the exam.'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: '**PEM**代表**隐私增强邮件**，但这只是额外的知识，了解 PEM 的定义并不是考试的要求。'
- en: 'We''ll see how this works in the following exercise. Before we can go about
    using Systems Manager to remotely access an instance, we need to set up an IAM
    role that will allow the SSM service permissions to access any instance that has
    that role. Luckily for us, AWS already has a managed IAM policy that contains
    all of the permissions that we need to accomplish this task; however, we still
    need to create a role that we can attach to our EC2 instance. Let''s get started:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的练习中我们将看到这一点如何运作。在使用 Systems Manager 远程访问实例之前，我们需要设置一个 IAM 角色，该角色将允许 SSM
    服务有权限访问任何具有该角色的实例。幸运的是，AWS 已经有一个托管的 IAM 策略，包含了我们完成此任务所需的所有权限；然而，我们仍然需要创建一个可以附加到
    EC2 实例的角色。让我们开始吧：
- en: 'Open your browser and go to the Amazon web console, navigating to the IAM service:
    [https://console.aws.amazon.com/iam/](https://console.aws.amazon.com/iam/).'
  id: totrans-44
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开浏览器，访问 Amazon Web 控制台，导航到 IAM 服务：[https://console.aws.amazon.com/iam/](https://console.aws.amazon.com/iam/)。
- en: From the left navigation bar, choose **Roles** and then press the blue **Create
    Role** button in the mainframe once it appears.
  id: totrans-45
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从左侧导航栏中选择**角色**，然后在出现的主框中按下蓝色的**创建角色**按钮。
- en: On the **Select type of trusted entity** page, make sure that **AWS service**
    is selected.![Figure 20.2 – Selecting AWS service as the type of entity when creating
    a role
  id: totrans-46
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**选择受信任实体类型**页面，确保选择了**AWS 服务**。![图 20.2 – 创建角色时选择 AWS 服务作为实体类型
- en: '](img/Figure_20.2_B17405.jpg)'
  id: totrans-47
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/Figure_20.2_B17405.jpg)'
- en: Figure 20.2 – Selecting AWS service as the type of entity when creating a role
  id: totrans-48
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 20.2 – 创建角色时选择 AWS 服务作为实体类型
- en: 'Then, from the list of common use cases, find **EC2** and click on it to select
    it. Once selected, you can click the blue **Next: Permissions** button located
    at the bottom right of the page.![Figure 20.3 – Common use cases when creating
    a role in IAM'
  id: totrans-49
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，从常见使用场景列表中，找到**EC2**并点击选择它。选择后，你可以点击页面右下角的蓝色**下一步：权限**按钮。![图 20.3 – 在创建 IAM
    角色时的常见使用场景
- en: '](img/Figure_20.3_B17405.jpg)'
  id: totrans-50
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/Figure_20.3_B17405.jpg)'
- en: Figure 20.3 – Common use cases when creating a role in IAM
  id: totrans-51
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 20.3 – 在创建 IAM 角色时的常见使用场景
- en: 'Now that you''re on the **Attach permissions policies** page, in the search
    box in the middle of the screen, search for the policy named *AmazonEC2RoleforSSM*.
    Select the box next to the policy once it appears in the search results. Once
    selected, you can click the blue **Next: Tags** button to continue.![Figure 20.4
    – Adding a managed permission policy to the IAM role'
  id: totrans-52
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在你已经进入了**附加权限策略**页面，在屏幕中间的搜索框中，搜索名为 *AmazonEC2RoleforSSM* 的策略。策略出现在搜索结果中后，选择其旁边的框。一旦选择了该策略，你可以点击蓝色的**下一步：标签**按钮继续。![图
    20.4 – 向 IAM 角色添加托管权限策略
- en: '](img/Figure_20.4_B17405.jpg)'
  id: totrans-53
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/Figure_20.4_B17405.jpg)'
- en: Figure 20.4 – Adding a managed permission policy to the IAM role
  id: totrans-54
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 20.4 – 向 IAM 角色添加托管权限策略
- en: 'On the **Add Tags** page, just select the **Next: Review** button at the bottom
    of the page since we are not adding tags to this role.'
  id: totrans-55
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**添加标签**页面，由于我们不会为此角色添加标签，只需选择页面底部的**下一步：审查**按钮即可。
- en: On the `Remote2EC2SSM`. You can change the role description if you like to something
    that is more fitting of what the role allows. Once you have made these updates,
    click the blue **Create Role** button at the bottom of the page. Great! Your role
    should now be created.![Figure 20.5 – Adding the role name and description
  id: totrans-56
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`Remote2EC2SSM`页面上，你可以根据需要更改角色描述，使其更符合该角色的功能。更新完成后，点击页面底部的蓝色**创建角色**按钮。太好了！你的角色现在应该已经创建完成。![图
    20.5 – 添加角色名称和描述
- en: '](img/Figure_20.5_B17405.jpg)'
  id: totrans-57
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/Figure_20.5_B17405.jpg)'
- en: Figure 20.5 – Adding the role name and description
  id: totrans-58
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 20.5 – 添加角色名称和描述
- en: With our role created, we can start creating a temporary EC2 instance that we
    will use for testing the capabilities of SSM.
  id: totrans-59
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 创建好角色后，我们可以开始创建一个临时的 EC2 实例，用于测试 SSM 的功能。
- en: Find the **Services** menu item on the left-hand side of the top menu. Click
    on the word **services** to bring up the drop-down menu, which will show all the
    AWS services. Click on **EC2**, which should be near the top, under the **Compute**
    heading, to be taken to the **EC2** service page.![Figure 20.6 – EC2 service page
  id: totrans-60
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在顶部菜单的左侧找到 **Services** 菜单项。点击 **services** 以弹出下拉菜单，显示所有 AWS 服务。点击 **EC2**，它应该靠近顶部，位于
    **Compute** 标题下方，进入 **EC2** 服务页面。![图 20.6 – EC2 服务页面
- en: '](img/Figure_20.6_B17405.jpg)'
  id: totrans-61
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/Figure_20.6_B17405.jpg)'
- en: Figure 20.6 – EC2 service page
  id: totrans-62
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 20.6 – EC2 服务页面
- en: Once you're on the **EC2** page, find the **Launch instance** section in the
    middle of the page. Click on the orange **Launch instance** button inside this
    section to begin launching your instance. When you click on that button, you will
    be presented with two options; choose the option labeled **Launch instance**.![Figure
    20.7 – Launching an EC2 instance from the main EC2 page
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 进入 **EC2** 页面后，在页面中间找到 **Launch instance** 部分。点击该部分中的橙色 **Launch instance**
    按钮开始启动实例。当你点击该按钮时，会出现两个选项；选择标有 **Launch instance** 的选项。![图 20.7 – 从主 EC2 页面启动
    EC2 实例
- en: '](img/Figure_20.7_B17405.jpg)'
  id: totrans-64
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/Figure_20.7_B17405.jpg)'
- en: Figure 20.7 – Launching an EC2 instance from the main EC2 page
  id: totrans-65
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 20.7 – 从主 EC2 页面启动 EC2 实例
- en: Now you should be on a page where you should be able to select the AMI that
    you want to use. Select any **Amazon Linux** or **Amazon Linux 2** version dated
    2017.09 or later as it will contain the AWS SSM agent already preinstalled. Click
    the blue **Select** button to choose your image.![Figure 20.8 – Amazon Linux 2
    on the AMI selection page
  id: totrans-66
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在你应该会看到一个页面，可以选择要使用的 AMI。选择任何 2017.09 或更晚版本的 **Amazon Linux** 或 **Amazon Linux
    2**，因为它已经预装了 AWS SSM 代理。点击蓝色的 **Select** 按钮选择镜像。![图 20.8 – 在 AMI 选择页面上的 Amazon
    Linux 2
- en: '](img/Figure_20.08_B17405.jpg)'
  id: totrans-67
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/Figure_20.08_B17405.jpg)'
- en: Figure 20.8 – Amazon Linux 2 on the AMI selection page
  id: totrans-68
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 20.8 – 在 AMI 选择页面上的 Amazon Linux 2
- en: 'We won''t need much computing power for our test, so we can use a **t2.small
    instance**. Click on the gray **Next: Configure Instance Details** button as we
    need to ensure that we attach our role to our instance.'
  id: totrans-69
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '我们的测试不需要太多计算能力，因此可以使用 **t2.small 实例**。点击灰色的 **Next: Configure Instance Details**
    按钮，因为我们需要确保将角色附加到实例上。'
- en: 'Once you''re on the `Remote2EC2SSM`, and choose this value for the field. Once
    you have done this, click on the gray **Next: Add Storage** button.![Figure 20.9
    – Choosing the Remote2EC2SSM role while configuring our EC2 instance'
  id: totrans-70
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '一旦进入 `Remote2EC2SSM`，并选择该字段的值。完成后，点击灰色的 **Next: Add Storage** 按钮。![图 20.9 –
    配置 EC2 实例时选择 Remote2EC2SSM 角色'
- en: '](img/Figure_20.9_B17405.jpg)'
  id: totrans-71
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/Figure_20.9_B17405.jpg)'
- en: Figure 20.9 – Choosing the Remote2EC2SSM role while configuring our EC2 instance
  id: totrans-72
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 20.9 – 配置 EC2 实例时选择 Remote2EC2SSM 角色
- en: There is nothing to change on the `name` as the key and `Remote` `Test` as the
    value. Make sure that you capitalized the *N* in Name, otherwise, it will not
    set the value of the name of the instance correctly and only set a tag and value
    pair. Once you have set the key-value pair, you can click on the blue **Review
    and Launch** button at the bottom of the page.![Figure 20.10 – Setting the Name
    for the instance using tags
  id: totrans-73
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 `name` 字段中无需更改内容，使用 `Remote` `Test` 作为值。确保将 **N** 大写，否则它不会正确设置实例名称的值，而只会设置标签和值对。设置好键值对后，可以点击页面底部的蓝色
    **Review and Launch** 按钮。![图 20.10 – 使用标签设置实例名称
- en: '](img/Figure_20.10_B17405.jpg)'
  id: totrans-74
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/Figure_20.10_B17405.jpg)'
- en: Figure 20.10 – Setting the name for the instance using tags
  id: totrans-75
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 20.10 – 使用标签设置实例名称
- en: On the **Review Instance Launch** page, click the blue **Launch** button at
    the bottom of the page. This will bring up a dialog about which key pair you would
    like to use. However, we are going to clear out the values from the top drop-down
    menu so that the value that is selected reads **Proceed without a key pair**.
    Click on the box to acknowledge that you are proceeding without a key pair, and
    then click the blue **Launch instances** button to start your EC2 instance.![Figure
    20.11 – Launching our EC2 instance without a keypair
  id: totrans-76
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 **Review Instance Launch** 页面上，点击页面底部的蓝色 **Launch** 按钮。这时会弹出一个对话框，询问你想使用哪个密钥对。不过，我们将清除顶部下拉菜单中的值，使其显示
    **Proceed without a key pair**。勾选框以确认你在没有密钥对的情况下继续，然后点击蓝色的 **Launch instances**
    按钮来启动 EC2 实例。![图 20.11 – 在没有密钥对的情况下启动我们的 EC2 实例
- en: '](img/Figure_20.11_B17405.jpg)'
  id: totrans-77
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/Figure_20.11_B17405.jpg)'
- en: Figure 20.11 – Launching our EC2 instance without a key pair
  id: totrans-78
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 20.11 – 在没有密钥对的情况下启动我们的 EC2 实例
- en: Now that our instance has started launching, we have finished all the prerequisites
    for this exercise. We can now move on to the Systems Manager service in the AWS
    Console to log in without the key and perform the command(s).
  id: totrans-79
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 现在我们的实例已经开始启动，我们已经完成了本练习的所有前置条件。我们现在可以转到AWS控制台中的系统管理器服务，登录而无需密钥，并执行命令。
- en: In the search bar at the top of the AWS Management Console, type in *Systems
    Manager* and click on the menu item when it appears in the list:![Figure 20.12
    – The Systems Manager service as it appears from searching on the AWS Management
    Console](img/Figure_20.12_B17405.jpg)
  id: totrans-80
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在AWS管理控制台顶部的搜索栏中，输入*系统管理器*，然后点击列表中出现的菜单项：![图 20.12 – 从AWS管理控制台搜索时显示的系统管理器服务](img/Figure_20.12_B17405.jpg)
- en: Figure 20.12 – The Systems Manager service as it appears from searching on the
    AWS Management Console
  id: totrans-81
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 20.12 – 从AWS管理控制台搜索时显示的系统管理器服务
- en: Once you're on the **Systems Manager** service page, find the **Node Management**
    heading on the left-hand menu. Under this heading, click on the menu item named
    **Session Manager**.
  id: totrans-82
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦你进入**系统管理器**服务页面，找到左侧菜单中的**节点管理**标题。在此标题下，点击名为**会话管理器**的菜单项。
- en: When the main **Sessions Manager** page appears, click on the orange **Start
    a session** button at the top right-hand side of the main window.
  id: totrans-83
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当主**会话管理器**页面出现时，点击主窗口右上方的橙色**开始会话**按钮。
- en: Now that we are on the `Remote Test` when we created the instance earlier. Click
    on the radio button next to the instance's name to select this instance and then
    click the orange **Start session** button to remotely access the instance without
    using a PEM key.
  id: totrans-84
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在我们已经进入了之前创建实例时的`Remote Test`。点击实例名称旁边的单选按钮选择该实例，然后点击橙色的**开始会话**按钮，远程访问该实例，而无需使用PEM密钥。
- en: A new tab or browser window will appear once the `ssm-user`. This is the user
    that the Systems Manager Sessions Manager connects to.
  id: totrans-85
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦`ssm-user`登录，新的标签页或浏览器窗口将会弹出。这是系统管理器会话管理器连接的用户。
- en: You just saw how Session Manager can make accessing instances much more accessible
    from an operations perspective. You no longer have to create and manage keys for
    your instances. However, let's talk about some of the issues that need to be taken
    into consideration when using Sessions Manager.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 你刚刚看到会话管理器如何从操作的角度使访问实例变得更加容易。你不再需要为实例创建和管理密钥。然而，让我们来讨论一些使用会话管理器时需要考虑的问题。
- en: Using runbooks in Systems Manager
  id: totrans-87
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 在系统管理器中使用运行手册
- en: Since we already have a managed instance up and running, we can create a runbook
    in AWS Systems Manager to see how easy it is to execute commands on one or a thousand
    instances, all with the single click of a mouse remotely.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们已经有一个托管实例正在运行，我们可以在AWS系统管理器中创建一个运行手册，看看如何轻松地在一个或一千个实例上执行命令，所有这些都只需通过单击鼠标即可远程完成。
- en: Before we start, the `clamav.json` scripting file, which we will use for our
    runbook, is going to be available in the `Chapter-20` folder of this book's GitHub
    repository. Since the file is not extremely long, we will also be showing it throughout
    this exercise as well.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们开始之前，我们将使用的`clamav.json`脚本文件将可以在本书GitHub仓库的`Chapter-20`文件夹中找到。由于文件不是特别长，我们将在本练习中也展示它。
- en: 'This exercise also builds upon the previous exercise, so if you wish to complete
    this exercise but did not do the *Running remote commands on an EC2 instance*
    exercise, then you will need to set up your environment by going through steps
    1 to 14 in the previous exercise. Let''s get started:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 本练习还建立在前一个练习的基础上，因此，如果你希望完成本练习但未进行过*在EC2实例上运行远程命令*的练习，你需要通过执行前一个练习中的第1到第14步来设置环境。让我们开始吧：
- en: If you have previously logged out of your AWS Management Console, log back in
    as your administrative user and navigate to the **Systems Manager** service, either
    through the top search bar or via the **Services** dropdown in the top left.
  id: totrans-91
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果你之前已经退出了AWS管理控制台，请以管理员用户重新登录，并通过顶部搜索栏或左上角的**服务**下拉菜单导航到**系统管理器**服务。
- en: We will need to create a document for Systems Manager to run. Although several
    predefined run documents are created by AWS, we will create a custom document.
    From the left-hand navigation menu of the **Systems Manager** service, under the
    **Shared Resources** header, click **Documents**.![Figure 20.13 – The Documents
    menu item on the Systems Manager service
  id: totrans-92
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们需要创建一个文档供系统管理器运行。虽然AWS已经创建了几个预定义的运行文档，但我们将创建一个自定义文档。在**系统管理器**服务的左侧导航菜单中，在**共享资源**标题下，点击**文档**。![图
    20.13 – 系统管理器服务中的文档菜单项
- en: '](img/Figure_20.13_B17405.jpg)'
  id: totrans-93
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/Figure_20.13_B17405.jpg)'
- en: Figure 20.13 – The Documents menu item on the Systems Manager service
  id: totrans-94
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 20.13 – 系统管理器服务中的文档菜单项
- en: Now that we're on the **Documents** page, we will need to find the orange **Create
    document** button at the top right-hand side. When you click on it, two options
    should appear. Choose the **Command or Session** option.![Figure 20.14 – The Create
    document button showing the two different options
  id: totrans-95
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在我们在**文档**页面上，我们需要找到右上角的橙色**创建文档**按钮。当你点击它时，会出现两个选项。选择**命令或会话**选项。![图 20.14
    – 显示两个不同选项的创建文档按钮
- en: '](img/Figure_20.14_B17405.jpg)'
  id: totrans-96
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/Figure_20.14_B17405.jpg)'
- en: Figure 20.14 – The Create document button showing the two different options
  id: totrans-97
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 20.14 – 显示两个不同选项的创建文档按钮
- en: Once the `Linux_ClamAV_Installer`.
  id: totrans-98
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦`Linux_ClamAV_Installer`被找到。
- en: '**Target type**: Leave this value blank.'
  id: totrans-99
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**目标类型**：保持此值为空。'
- en: '**Document**: **Command document**.'
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**文档**：**命令文档**。'
- en: '![Figure 20.15 – The Document details page when creating the document'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 20.15 – 创建文档时的文档详情页面'
- en: '](img/Figure_20.15_B17405.jpg)'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_20.15_B17405.jpg)'
- en: Figure 20.15 – The Document details page when creating the document
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 图 20.15 – 创建文档时的文档详情页面
- en: 'At the bottom of the **Create document** page will be the **Content** section.
    This is where we load the script that we want to run for our run command. You
    can either cut and paste the script from the **clamav.json** script that you downloaded
    at the beginning of this exercise, or you can type in the script, as shown here.
    Once the script is in the content box, press the orange **Create document** button:'
  id: totrans-104
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**创建文档**页面的底部是**内容**部分。这是我们加载要运行的脚本的地方。你可以直接从开始练习时下载的**clamav.json**脚本中剪切并粘贴脚本，或者手动输入脚本，如图所示。一旦脚本放入内容框中，点击橙色的**创建文档**按钮：
- en: '[PRE0]'
  id: totrans-105
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: After pressing the **Create document** button, you will be taken back to the
    main documents page. Here, you should see a green banner at the top of the page,
    confirming that your document was created successfully. If you would like to quickly
    and easily find the document that you just created, click on the middle tab of
    the top menu labeled **Owned by me**. At this point, you should be able to see
    your document.![Figure 20.16 – The notification showing that your document was
    created successfully
  id: totrans-106
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按下**创建文档**按钮后，你将被带回主文档页面。在这里，你应该看到页面顶部的绿色横幅，确认你的文档已成功创建。如果你想快速而轻松地找到刚刚创建的文档，点击顶部菜单中的中间标签**我拥有的**。此时，你应该能看到你的文档。![图
    20.16 – 显示文档成功创建的通知
- en: '](img/Figure_20.16_B17405.jpg)'
  id: totrans-107
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/Figure_20.16_B17405.jpg)'
- en: Figure 20.16 – The notification showing that your document was created successfully
  id: totrans-108
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 20.16 – 显示文档成功创建的通知
- en: With our document created, we can find the **Run Command** menu item underneath
    the **Node Management** heading from the left-hand set of menu options. Click
    on **Run Command** to be taken to the **Run Command** capability.
  id: totrans-109
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 文档创建完成后，我们可以在左侧菜单选项中找到**节点管理**标题下的**运行命令**菜单项。点击**运行命令**以进入**运行命令**功能。
- en: On the **Run Command** capability screen, click on the orange **Run command**
    button at the top right of the main window to start the process.
  id: totrans-110
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**运行命令**功能屏幕上，点击主窗口右上角的橙色**运行命令**按钮以开始该过程。
- en: For the command document to run, we are going to run the document that we just
    created. You can find it by typing `Linux` in the search box. Use a radio button
    to select an instance of the document. We will just leave the default version
    (1) selected since we only have one version of the document.![Figure 20.17 – Finding
    the document that we created based on a search term
  id: totrans-111
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为了让命令文档运行，我们将运行刚刚创建的文档。你可以通过在搜索框中输入`Linux`来找到它。使用单选按钮选择文档的一个实例。由于我们只有一个文档版本，所以我们将保留默认版本（1）。![图
    20.17 – 基于搜索词查找我们创建的文档
- en: '](img/Figure_20.17_B17405.jpg)'
  id: totrans-112
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/Figure_20.17_B17405.jpg)'
- en: Figure 20.17 – Finding the document that we created based on a search term
  id: totrans-113
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 20.17 – 基于搜索词查找我们创建的文档
- en: In the **Targets** section, we will choose our instances manually since the
    only tag we used when spinning up our instance was the name tag. When you click
    on **Choose instances manually**, if you don't see the instance, then type the
    name of your instance; that is, *Remote Test*. Choose the selection box next to
    the instance's name.![Figure 20.18 – Choosing the target instance to run the command
    on
  id: totrans-114
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**目标**部分，我们将手动选择我们的实例，因为我们在启动实例时使用的唯一标签是名称标签。当您点击**手动选择实例**时，如果看不到该实例，请输入实例的名称，即*远程测试*。选择实例名称旁边的选择框。![图
    20.18 – 选择要运行命令的目标实例
- en: '](img/Figure_20.18_B17405.jpg)'
  id: totrans-115
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/Figure_20.18_B17405.jpg)'
- en: Figure 20.18 – Choosing the target instance to run the command on
  id: totrans-116
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 20.18 – 选择要运行命令的目标实例
- en: For the `devopspro-beyond`. Once you have chosen your bucket, you can click
    the orange **Run** button at the bottom of the page.
  id: totrans-117
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于`devopspro-beyond`。一旦选择了您的存储桶，您可以点击页面底部的橙色**运行**按钮。
- en: Once you start the run command, you should be taken to a screen where you can
    see your instance and the status of *in progress* as the command runs.
  id: totrans-118
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦启动运行命令，您应该会看到一个屏幕，显示您的实例和命令运行状态为*进行中*。
- en: After a few minutes, you should see success after the command has run.
  id: totrans-119
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 几分钟后，您应该会看到命令运行成功。
- en: Now that we have learned how to run remote commands on multiple instances, let's
    look at some of the use cases for AWS Systems Manager.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经学习了如何在多个实例上运行远程命令，接下来我们来看看 AWS 系统管理器的一些使用案例。
- en: Use cases for Systems Manager
  id: totrans-121
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 系统管理器的使用案例
- en: Systems Manager can help with your day-to-day operations management tasks in
    numerous ways. Let's take a look at some real-world use cases for Systems Manager.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 系统管理器可以以多种方式帮助您处理日常的运营管理任务。让我们来看一些系统管理器的实际使用案例。
- en: You need to make sure that the EC2 instances running in your AWS account stay
    up to date with security patches.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要确保在 AWS 账户中运行的 EC2 实例保持最新的安全补丁。
- en: If you have a compliance or security requirement that all the security patches
    that are released must be installed in a specific timeframe, such as 7 days from
    release, then this can be a daunting task without automation. This is especially
    the case if you are not using immutable infrastructure and are maintaining long-running
    instances that need to be updated.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您有合规性或安全性要求，要求所有发布的安全补丁必须在特定时间框架内安装，例如从发布日起的 7 天内，那么在没有自动化的情况下，这将是一项艰巨的任务。如果您没有使用不可变基础设施，并且需要维护需要更新的长期运行实例，尤其如此。
- en: When using the **Maintenance Windows** service, which is part of SSM, you can
    assign a maintenance window to a group of resources that would be out of their
    primary task schedule and then combine this with the **Patch Manager** service
    to install the security patches. This combination works with both Linux and Windows
    operating systems. It will also work for on-premises servers that have the SSM
    agent installed.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 使用**维护窗口**服务时，该服务是 SSM 的一部分，您可以将维护窗口分配给一组资源，这些资源将在其主要任务计划之外运行，然后将其与**补丁管理器**服务结合使用，安装安全补丁。此组合适用于
    Linux 和 Windows 操作系统，也适用于已安装 SSM 代理的本地服务器。
- en: One of the keys to success in this is making sure that you have the correct
    tags on your instances so that you can group the resources according to tags.
    With Maintenance Windows, you can combine tags when making your resource group
    that only target the specific types of instances that you are planning to patch.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 成功的关键之一是确保您的实例上有正确的标签，这样您就可以根据标签将资源分组。通过维护窗口，您可以在创建资源组时组合标签，仅针对您计划修补的特定类型的实例进行操作。
- en: Now that we have learned how we can manage many of our operations tasks and
    help keep our resources in a compliant state using AWS Systems Manager, we will
    move on to the AWS Config service. With AWS Config, we will learn how we can constantly
    record the history of our environment, visually see what has changed, and even
    proactively remediate items that don't comply with the rules we have set for our
    account.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经学习了如何使用 AWS 系统管理器管理我们的许多操作任务，并帮助保持资源的合规状态，接下来我们将学习 AWS Config 服务。通过 AWS
    Config，我们将学习如何不断记录环境的历史，直观地查看发生了哪些变化，甚至主动修复不符合我们为账户设置的规则的项目。
- en: AWS Config essentials
  id: totrans-128
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: AWS Config 基础知识
- en: In most cases, the resources in an AWS account are constantly changing in one
    form or another. Instances are being started and stopped, along with being created
    and destroyed. Security settings are changing as users turn ports on and off to
    allow the correct protocols for communication.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 在大多数情况下，AWS 账户中的资源以某种形式不断变化。实例在启动和停止，同时也在创建和销毁。安全设置不断变化，用户通过启用和禁用端口来允许正确的通信协议。
- en: The AWS Config service allows you to gain a comprehensive view of what happens
    in your AWS account. It also lets you see how things change over time.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: AWS Config 服务使您能够全面了解 AWS 账户中发生的事情。它还允许您查看事物如何随时间变化。
- en: 'With the AWS Config service, the following capabilities are presented to you:'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 AWS Config 服务，您将获得以下功能：
- en: You can assess the AWS resource configurations to see whether they conform to
    the desired settings for the account.
  id: totrans-132
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您可以评估 AWS 资源配置，查看它们是否符合账户的期望设置。
- en: The ability to save the current configuration settings as a snapshot for supported
    resources.
  id: totrans-133
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将当前配置设置保存为受支持资源的快照的功能。
- en: You can retrieve the historical configuration for just one or even multiple
    supported resources.
  id: totrans-134
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您可以检索单个或多个受支持资源的历史配置。
- en: You can set up the ability to receive notifications when resources are created,
    deleted, or modified.
  id: totrans-135
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您可以设置接收通知的功能，当资源被创建、删除或修改时，您将收到通知。
- en: Gain a view of the relationships that exist between resources.
  id: totrans-136
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 获取对资源之间关系的视图。
- en: Another value that Config provides is that you can use common predefined rules
    or even write your own rules to check your environment for compliance.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: Config 提供的另一个价值是，您可以使用常见的预定义规则，甚至编写自己的规则来检查环境的合规性。
- en: Concepts to understand about AWS Config
  id: totrans-138
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 理解 AWS Config 的概念
- en: Before we dive into the AWS Config service, let's look at some of the key terms
    and concepts that will be discussed.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们深入了解 AWS Config 服务之前，让我们先看一些将要讨论的关键术语和概念。
- en: AWS Resources
  id: totrans-140
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: AWS 资源
- en: The entities that you create and manage either from the AWS Management Console,
    the CLI, or any of the SDKs available, are **AWS Resources**. These can include
    EC2 instances, EBS volumes, DynamoDB tables, RDS instances and security groups,
    S3 buckets, SNS topics, and much more. AWS Config uses the **Amazon Resource Name**
    (**ARN**) to identify each of the unique resources. For a complete list of supported
    resources, visit [https://docs.aws.amazon.com/config/latest/developerguide/resource-config-reference.html](https://docs.aws.amazon.com/config/latest/developerguide/resource-config-reference.html).
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 您通过 AWS 管理控制台、CLI 或任何可用的 SDK 创建和管理的实体是**AWS 资源**。这些可以包括 EC2 实例、EBS 卷、DynamoDB
    表、RDS 实例和安全组、S3 存储桶、SNS 主题等等。AWS Config 使用**Amazon 资源名称**（**ARN**）来标识每个唯一的资源。要查看完整的受支持资源列表，请访问[https://docs.aws.amazon.com/config/latest/developerguide/resource-config-reference.html](https://docs.aws.amazon.com/config/latest/developerguide/resource-config-reference.html)。
- en: Configuration Recorder
  id: totrans-142
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 配置记录器
- en: As you run the AWS Config service, the **Configuration Recorder** is what saves
    and stores the values and changes of the various supported AWS Resources as configuration
    items. Before it can start recording, however, the Configuration Recorder must
    be created and then started.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 当您运行 AWS Config 服务时，**配置记录器**会保存并存储各种受支持 AWS 资源的值和更改作为配置项。然而，在它开始记录之前，必须先创建并启动配置记录器。
- en: Configuration History
  id: totrans-144
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 配置历史
- en: When you want to understand what changes have been made to a particular supported
    AWS Resource and when they occurred, then you can use the **Configuration History**.
    The Configuration History is a cumulation of data (configuration items) for a
    specific resource over any period in which the configuration recorder has been
    running.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 当您想了解某个特定的受支持 AWS 资源发生了什么更改，以及这些更改发生的时间时，可以使用**配置历史**。配置历史是一个特定资源在配置记录器运行期间的所有数据（配置项）的累积。
- en: Configuration Snapshot
  id: totrans-146
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 配置快照
- en: Unlike the name somewhat implies, a **Configuration Snapshot** is not a graphical
    picture in time of configuration items. Instead, it is a code-based recording
    of how your supported resources and their different settings are used at a particular
    point in time. These snapshots can be saved in a designated S3 bucket so that
    they can be retrieved or compared with future or past configuration snapshots.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 与名称所暗示的有所不同，**配置快照**不是时间点的配置项的图形化展示。相反，它是一个基于代码的记录，记录了在特定时间点如何使用您的受支持资源及其不同的设置。这些快照可以保存到指定的
    S3 存储桶中，以便可以在未来或过去的配置快照之间进行检索或比较。
- en: Configuration Items
  id: totrans-148
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Point-in-time views for supported AWS resources are captured as **configuration
    items**. The information that's captured includes attributes, metadata, current
    configuration, relationships, and related events.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
- en: Now that we have an understanding of the concepts and pieces that AWS Config
    uses, let's take a deeper look at how AWS Config works.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
- en: Understanding how Config works
  id: totrans-151
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: After starting the service, AWS Config starts to scan for supported resources
    within the account. As it finds these resources, it produces a configuration item
    for each one.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
- en: As those resources change, a new configuration item is then generated and recorded
    by the config recorder.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
- en: '![Figure 20.19 – Understanding the workflow of AWS Config'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
- en: '](img/Figure_20.19_B17405.jpg)'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
- en: Figure 20.19 – Understanding the workflow of AWS Config
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
- en: If you have enabled rules for the Config service to evaluate, then the Config
    service will continuously check the configuration items against the rules. If
    an item does not meet the criteria of a rule, then the lambda that is associated
    with that rule will be triggered, and the associated action will be taken.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
- en: For example, if a company has enabled a mandate that all EBS data volumes must
    be encrypted, regardless of whether they are deployed from CloudFormation, the
    CLI, an SDK, or created by hand, then a simple rule in AWS could be created to
    send a notification to an SNS topic that contains an email group list once an
    offending volume has been found.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
- en: A more complex rule could be created that not only pushes out the notification
    to the SNS topic but also uses one of the AWS SDKs programmed in the corresponding
    lambda function for the rule, which would terminate any created EBS volume that
    was encrypted upon creation.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
- en: As your Config item history is compiled, you can view both the inventory of
    the resources that AWS has discovered, as well as view the compliance history
    for any particular AWS resource.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
- en: If you are using Config rules, then resources can be constantly checked whenever
    changes happen. They can also be set to be checked on timed intervals, such as
    every 12 or 24 hours.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
- en: Now that we have a good understanding of how AWS Config works, let's try it
    out for ourselves with the next exercise so that we can get some hands-on experience.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
- en: Standing up AWS Config – a practical example
  id: totrans-163
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: To see how the AWS Config service works, we will stand up a configuration recorder
    along with two rules that will check our account. Once the recorder has been stood
    up and then turned on, we can go back after a while to see its findings.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
- en: Note
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
- en: Since we are using a CloudFormation template to stand up our Config recorder,
    we can easily take it down once we are done with it. If you were to stand up the
    Config recorder from the AWS Management console, it would be challenging to take
    down the default Config recorder and reset everything back to zero if needed.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
- en: 'Before we begin, make sure that you have downloaded the CloudFormation template
    named `configTemplate.yml` from this book''s GitHub repository, under the `Chapter-20`
    folder:'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 在开始之前，确保你已经从本书的 GitHub 仓库中下载了名为 `configTemplate.yml` 的 CloudFormation 模板，位于
    `Chapter-20` 文件夹下：
- en: Open your browser and log in to your AWS account using the Administrator user.
    After logging in, navigate to the CloudFormation service.
  id: totrans-168
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开浏览器并使用管理员用户登录到你的 AWS 账户。登录后，进入 CloudFormation 服务。
- en: In the top right-hand corner, click on the **Create Stack** button. Once pressed,
    choose the **With new resources** option.
  id: totrans-169
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在右上角，点击**创建堆栈**按钮。点击后，选择**使用新资源**选项。
- en: Choose the following options on the `configTemplate.yml`.
  id: totrans-170
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 `configTemplate.yml` 中选择以下选项。
- en: After using these options, click on the orange **Next** button.
  id: totrans-171
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用这些选项后，点击橙色的**下一步**按钮。
- en: 'You will be presented with all the parameters on the `MaximumExecutionFrequency`:
    `One_Hour`'
  id: totrans-172
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你将看到关于 `MaximumExecutionFrequency` 的所有参数：`One_Hour`
- en: Once you have filled in these parameters, click the orange **Next** button.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 填写完这些参数后，点击橙色的**下一步**按钮。
- en: After clicking the initial **Next** button when creating the stack, you will
    be taken to the **Configure stack options** page. Just click the orange **Next**
    button at the bottom right of the page to continue.
  id: totrans-174
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在创建堆栈时点击初始的**下一步**按钮后，你将进入**配置堆栈选项**页面。只需点击页面右下角的橙色**下一步**按钮继续。
- en: Once you're on the **Review** page, at the bottom of the page, you will need
    to check the box in the **Capabilities** section, acknowledging that the stack
    may create IAM resources. Once you have done this, click the orange **Create Stack**
    button to start the creation of the Config recorder and rules via CloudFormation.
  id: totrans-175
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦进入**审核**页面，在页面底部，你需要勾选**能力**部分的框，确认堆栈可能会创建 IAM 资源。完成后，点击橙色的**创建堆栈**按钮，开始通过
    CloudFormation 创建 Config 记录器和规则。
- en: In less than 5 minutes, the resources should have been created, including the
    Configuration Recorder, a new S3 bucket to capture the configuration snapshots,
    and an SNS topic especially for notifications from the AWS Config service.
  id: totrans-176
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 不到 5 分钟，资源应已创建完成，包括配置记录器、新的 S3 桶用于捕捉配置快照，以及一个专门用于 AWS Config 服务通知的 SNS 主题。
- en: Now, use the search bar in the middle of the AWS Management Console to search
    for the Config service. Once the icon appears, click on it to be taken to that
    service:![Figure 20.20 – The AWS Config service icon from the search results
  id: totrans-177
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，在 AWS 管理控制台中间的搜索栏里搜索 Config 服务。当图标出现后，点击它进入该服务：![图 20.20 – 从搜索结果中看到的 AWS
    Config 服务图标
- en: '](img/Figure_20.20_B17405.jpg)'
  id: totrans-178
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/Figure_20.20_B17405.jpg)'
- en: Figure 20.20 – The AWS Config service icon from the search results
  id: totrans-179
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 20.20 – 从搜索结果中看到的 AWS Config 服务图标
- en: From the **AWS Config** dashboard, which should be the first screen you see
    as you are taken to the service, we will see our compliance status right away.
    From our CloudFormation template, we enabled two rules automatically. These rules
    on my demo account are already showing to be in compliance. However, if you did
    not put an MFA on your root account, then it may show that you are out of compliance
    with one or more of the Config rules.![Figure 20.21 – The compliance status on
    the AWS Config dashboard
  id: totrans-180
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从**AWS Config**仪表板开始，这是你进入该服务后看到的第一个屏幕，我们会立即看到我们的合规状态。在我们的 CloudFormation 模板中，我们自动启用了两条规则。这些规则在我的演示账户中已经显示符合合规要求。然而，如果你的根账户没有启用
    MFA，那么它可能会显示你未遵守一个或多个 Config 规则。![图 20.21 – AWS Config 仪表板上的合规状态
- en: '](img/Figure_20.21_B17405.jpg)'
  id: totrans-181
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/Figure_20.21_B17405.jpg)'
- en: Figure 20.21 – The compliance status on the AWS Config dashboard
  id: totrans-182
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 20.21 – AWS Config 仪表板上的合规状态
- en: To view the rules that we currently have in AWS Config, simply go to the **Rules**
    item via the left menu. Once we click on this item, we should see the names of
    the two rules that were loaded with the template.
  id: totrans-183
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要查看我们当前在 AWS Config 中的规则，只需通过左侧菜单进入**规则**项。一旦点击此项，我们应该看到通过模板加载的两条规则的名称。
- en: If we want to look at the resources in our account that AWS Config can check,
    we can go to the **Resources** menu item. Once **Resource Inventory** has loaded
    on the main screen, under the **Resource** category dropdown, change the selection
    to **AWS resources**. This will allow you to see the AWS items in your account
    that Config can keep track of.
  id: totrans-184
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果我们想查看 AWS Config 可以检查的我们账户中的资源，可以进入**资源**菜单项。加载完**资源清单**后，在**资源**类别的下拉菜单中，将选择项更改为**AWS
    资源**。这将允许你查看 AWS 账户中 Config 可以跟踪的项目。
- en: On any of these resources, click on the blue **Resource Identifier** button
    to be taken to the **Resource details** page. If you would like to see the timeline
    of how the resource has changed over time, go to the top-right corner of the **Resource
    details** pages. Here, you will see a button labeled **Resource Timeline**. Clicking
    on this button will bring up the timeline interface, showing how the resource
    has changed over time.
  id: totrans-185
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在任何这些资源上，点击蓝色的**资源标识符**按钮，将进入**资源详情**页面。如果你想查看资源随时间变化的时间线，请前往**资源详情**页面的右上角。这里，你会看到一个名为**资源时间线**的按钮。点击此按钮将打开时间线界面，显示资源随时间的变化。
- en: I would suggest that you leave the Config recorder up for a day or so while
    you make a few changes to different resources in your account. Remember to take
    down the Config recorder via the CloudFormation template; otherwise, you will
    incur the charges of the AWS Config service.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 我建议在你对账户中的不同资源进行一些更改时，可以将配置记录器保持开启一天左右。记得通过 CloudFormation 模板将配置记录器关闭；否则，你将承担
    AWS Config 服务的费用。
- en: Now that we have learned how to stand up a Config recorder and enable some rules
    in our AWS account, let's take a deeper look at what different types of rules
    are available from AWS Config.
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经学会了如何启动配置记录器并在 AWS 账户中启用一些规则，接下来让我们深入了解 AWS Config 提供的不同类型的规则。
- en: The Config rule structure
  id: totrans-188
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 配置规则结构
- en: AWS Config can constantly check the compliance of your AWS resources by using
    **Config rules**. These rules portray the ideal state of how your resources should
    be constructed.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: AWS Config 可以通过使用**配置规则**不断检查你的 AWS 资源是否符合合规要求。这些规则描述了你的资源应该如何构建的理想状态。
- en: You can use Config rules to help determine how your environment and resources
    conform to industry guidelines, internal best practices, and specified policies
    you need to enforce.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用配置规则来帮助确定你的环境和资源是否符合行业指南、内部最佳实践以及你需要执行的特定政策。
- en: 'Rules can be run on a few different types of triggers:'
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 规则可以基于几种不同类型的触发器运行：
- en: '**Configuration changes**: When the config service detects that a change has
    been made to the resource.'
  id: totrans-192
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**配置更改**：当配置服务检测到资源发生变化时。'
- en: '**Periodic checks**: The Config service runs on a regular schedule such as
    every 3 hours or every 24 hours, looking for changes to the resources.'
  id: totrans-193
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**定期检查**：配置服务按常规计划运行，例如每 3 小时或每 24 小时，检查资源是否发生变化。'
- en: Managed rules versus custom rules
  id: totrans-194
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 托管规则与自定义规则
- en: There are lots of predefined rules that have already been designed by Amazon
    to use on many of the most common use cases. These rules can be checking resources,
    such as whether EBS volumes are encrypted or whether certain ports have been opened
    to allow traffic to flow.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 有许多 Amazon 已经设计好的预定义规则，可以用于许多常见的使用场景。这些规则可以检查资源，例如 EBS 卷是否已加密，或者某些端口是否已打开以允许流量通过。
- en: These managed rules can be customized with extra items for remediation.
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 这些托管规则可以通过额外的修复项进行自定义。
- en: Custom rules can be created for any resource or policy that your organization
    needs checking and or enforcement on.
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 可以为任何需要检查和/或执行的资源或政策创建自定义规则。
- en: Using both managed and custom rules, you can automatically keep your organization
    in the state of compliance that it desires.
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 通过使用托管规则和自定义规则，你可以自动地将你的组织保持在其期望的合规状态。
- en: Now that we have learned how to use both Config and SSM to help keep our AWS
    account in compliance, let's review what we have learned in this chapter.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经学习了如何使用 Config 和 SSM 来帮助保持我们的 AWS 账户合规，接下来让我们回顾一下本章所学的内容。
- en: Summary
  id: totrans-200
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: In this chapter, we looked at some of the tools that can help make the operations
    part of our DevOps role easier. This included AWS Systems Manager, which, in and
    of itself, provides a variety of services to help you accomplish tasks. These
    range from being able to quickly create a session on a remote instance to creating
    repeatable processes and installing software or gathering files from an instance.
    We also learned that Systems Manager works with both compute instances in the
    cloud as well as servers on-premises.
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们讨论了一些可以帮助简化 DevOps 角色中操作部分的工具。这包括 AWS Systems Manager，它本身提供了多种服务来帮助你完成任务。这些任务包括能够快速在远程实例上创建会话、创建可重复的流程、安装软件或从实例收集文件。我们还了解到，Systems
    Manager 可以与云中的计算实例以及本地服务器配合使用。
- en: We also examined the AWS Config service. We saw how it can keep a timeline of
    the state of supported AWS resources. We also looked at how Config rules work
    and how they can be used to flag resources that don't meet the standards we have
    set for our organization.
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还研究了 AWS Config 服务。我们了解了它如何保留支持的 AWS 资源状态的时间线。我们还研究了 Config 规则的工作原理，以及它们如何用于标记不符合我们组织标准的资源。
- en: In the next chapter, we will look at using Amazon Inspector. This is a service
    that helps you proactively find security vulnerabilities in your account.
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将探讨使用 Amazon Inspector。这是一项帮助你主动发现账户中安全漏洞的服务。
- en: Questions
  id: totrans-204
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 问题
- en: You have been asked by a company to configure EC2 instances so that they can
    be managed by AWS Systems Manager. The company is using a distinct version of
    Linux for their base Amazon Machine Image. What actions will ensure that once
    the instance is launched from this AMI, it will be able to be found in the Session
    Manager console? (Choose two answers)
  id: totrans-205
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一家公司要求你配置 EC2 实例，以便它们可以通过 AWS Systems Manager 进行管理。该公司使用的是一种不同版本的 Linux 作为其基础的
    Amazon Machine Image。哪些操作能确保一旦从该 AMI 启动实例，它能够在 Session Manager 控制台中找到？（选择两个答案）
- en: Install the Systems Manager Agent as part of the base AMI.
  id: totrans-206
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将 Systems Manager Agent 安装为基础 AMI 的一部分。
- en: Create a key pair named `ssm-user` and use this key pair when launching the
    instance.
  id: totrans-207
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个名为 `ssm-user` 的密钥对，并在启动实例时使用该密钥对。
- en: Make sure that any Security Group that the instances are associated with allow
    traffic from port `22`.
  id: totrans-208
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保实例所关联的任何安全组允许来自端口 `22` 的流量。
- en: Add an instance role to any launched instance that allows Systems Manager permissions.
  id: totrans-209
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为任何已启动的实例添加一个实例角色，该角色允许 Systems Manager 权限。
- en: The company you have been working with is asking for a weekly report of the
    top five operating systems that are being used across the EC2 instances in the
    two regions where they are currently operating their production systems. What
    is the quickest and most cost-effective way to get them this information?
  id: totrans-210
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你正在为一家公司工作，该公司要求每周报告在两个区域内正在运行的 EC2 实例中使用的前五大操作系统。获取这些信息的最快且最具成本效益的方法是什么？
- en: Use Amazon Athena to gather the CloudTrail data about all running instances.
    Create a report in QuickSight that will display a graph and detailed data of the
    top five operating systems per region. Share this report with the stakeholders
    who have requested it.
  id: totrans-211
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 Amazon Athena 收集关于所有运行实例的 CloudTrail 数据。创建一个 QuickSight 报告，显示每个区域前五大操作系统的图表和详细数据。将此报告分享给请求的相关人员。
- en: Make sure all the instances have instance profiles that allow access by the
    Systems Manager service. Use Systems Manager Inventory to create a report that
    shows the top five operating systems for each region.
  id: totrans-212
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保所有实例具有允许 Systems Manager 服务访问的实例配置文件。使用 Systems Manager Inventory 创建一个报告，显示每个区域的前五大操作系统。
- en: Use the EC2 instances console to group all instances by operating systems. Create
    a report from the sorted data.
  id: totrans-213
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 EC2 实例控制台按操作系统对所有实例进行分组。从排序后的数据中创建报告。
- en: Create a lambda function that uses the CLI to call the operating system type
    of all EC2 instances. Have this output sent to an S3 bucket to be downloaded by
    the stakeholders.
  id: totrans-214
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个 Lambda 函数，使用 CLI 调用所有 EC2 实例的操作系统类型。将此输出发送到 S3 存储桶，由相关人员下载。
- en: The security department of an e-commerce company has put in force a new company
    policy that no web traffic may travel over non-secure HTTP, or port `80`. Any
    traffic that was previously allowed on port `80` must now be redirected to port
    `443` using a secure certificate. Any security groups found open to port `80`
    will be in violation of this new policy and suspended immediately. What is the
    best way to regularly monitor whether any security group is allowing traffic to
    enter port `80`?
  id: totrans-215
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一家电子商务公司的安全部门已执行一项新公司政策，规定任何 Web 流量不得通过不安全的 HTTP 或端口 `80` 传输。任何之前允许通过端口 `80`
    的流量，现在必须使用安全证书重定向到端口 `443`。任何发现开放端口 `80` 的安全组将违反此新政策并立即暂停。定期监控是否有任何安全组允许流量进入端口
    `80` 的最佳方法是什么？
- en: Use Trusted Advisor to scan for insecure security groups that have been created.
    Set up an SNS topic where Trusted Advisor can send the notifications.
  id: totrans-216
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 Trusted Advisor 扫描已创建的非安全安全组。设置一个 SNS 主题，让 Trusted Advisor 可以发送通知。
- en: Add a network ACL rule to all VPCs that blocks traffic from entering port `80`.
  id: totrans-217
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 向所有 VPC 添加一个网络 ACL 规则，阻止进入端口 `80` 的流量。
- en: Use CloudTrail logs to determine whether any security group has opened port
    `80`.
  id: totrans-218
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 CloudTrail 日志来确定是否有任何安全组开放了端口 `80`。
- en: Set up a rule in AWS Config that checks for traffic being allowed on port `80`
    on any security group. If a security group is found in violation, send a notification
    to the security department's SNS topic.
  id: totrans-219
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 AWS Config 中设置规则，检查是否有流量被允许通过端口`80`访问任何安全组。如果发现安全组违反此规则，请向安全部门的 SNS 主题发送通知。
- en: Review answers
  id: totrans-220
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 审查答案
- en: a and d
  id: totrans-221
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: a 和 d
- en: b
  id: totrans-222
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: b
- en: d
  id: totrans-223
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: d
