- en: 6\. Cost management for Azure solutions
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 6\. Azure 解决方案的成本管理
- en: In the previous chapter, we discussed tags, policies, and locks and how they
    can be leveraged from a compliance standpoint. Tags allow us to add metadata to
    our resources; they also help us in the logical management of resources. In the
    Azure portal, we can filter resources based on tags. If we assume there is a large
    number of resources, which is quite common in enterprises, filtering will help
    us to easily manage our resources. Another benefit of tags is that they can be
    used to filter our billing reports or usage reports in terms of tags. In this
    chapter, we are going to explore cost management for Azure solutions.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一章中，我们讨论了标签、策略和锁，以及如何从合规性的角度利用它们。标签允许我们为资源添加元数据，它们还帮助我们在资源的逻辑管理中发挥作用。在 Azure
    门户中，我们可以根据标签来筛选资源。如果假设有大量资源（这在企业中非常常见），筛选将帮助我们更轻松地管理资源。标签的另一个好处是它们可以用于根据标签来筛选我们的账单报告或使用报告。在本章中，我们将探讨
    Azure 解决方案的成本管理。
- en: The primary reason why corporations are moving to the cloud is to save on cost.
    There is no upfront cost for having an Azure subscription. Azure provides a pay-as-you-go
    subscription, where billing is based on consumption. Azure measures resource usage
    and provides monthly invoices. There is no upper limit for Azure consumption.
    As we are on a public cloud, Azure (like any other service provider) has some
    hard and soft limits on the number of resources that can be deployed. Soft limits
    can be increased by working with Azure Support. There are some resources that
    have a hard limit. The service limits can be found at [https://docs.microsoft.com/azure/azure-resource-manager/management/azure-subscription-service-limits](https://docs.microsoft.com/azure/azure-resource-manager/management/azure-subscription-service-limits),
    and the default limit varies based on the type of subscription you have.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 企业迁移到云端的主要原因是节省成本。订阅 Azure 不需要前期费用。Azure 提供了按需付费的订阅方式，计费是基于实际消耗的。Azure 会测量资源使用情况并提供每月账单。Azure
    消耗没有上限。作为一个公共云，Azure（像任何其他服务提供商一样）对可以部署的资源数量设定了硬性和软性限制。软性限制可以通过与 Azure 支持团队合作来增加。有些资源有硬性限制。服务限制可以在
    [https://docs.microsoft.com/azure/azure-resource-manager/management/azure-subscription-service-limits](https://docs.microsoft.com/azure/azure-resource-manager/management/azure-subscription-service-limits)
    查看，默认限制取决于您所拥有的订阅类型。
- en: It is important for companies to keep a close watch on Azure consumption and
    usage. Although they can create policies to set organizational standards and conventions,
    there is also a need to keep track of billing and consumption data. Moreover,
    they should employ best practices for consuming Azure resources so that the return
    is maximized. For this, architects need to know about Azure resources and features,
    their corresponding costs, and the cost/benefit analysis of features and solutions.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 对于公司来说，密切关注 Azure 的消耗和使用情况非常重要。尽管他们可以创建策略来设定组织标准和惯例，但同样需要跟踪账单和消耗数据。此外，他们还应该采用最佳实践来消耗
    Azure 资源，以最大化回报。为此，架构师需要了解 Azure 资源和功能，它们相应的费用，以及功能和解决方案的成本/效益分析。
- en: 'In this chapter, we will cover the following topics:'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将讨论以下内容：
- en: Azure offer details
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure 服务详情
- en: Billing
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 计费
- en: Invoicing
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 开具发票
- en: Usage and quotas
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用情况和配额
- en: Usage and Billing APIs
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用情况和计费 API
- en: Azure pricing calculator
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure 定价计算器
- en: Best practices for cost optimization
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 成本优化的最佳实践
- en: Let's go ahead and discuss each of these points.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们继续讨论每个要点。
- en: Azure offer details
  id: totrans-13
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Azure 服务详情
- en: 'Azure has different offers that you can purchase. So far, we have discussed
    pay-as-you-go, but there are others, such as **Enterprise Agreements** (**EAs**),
    Azure Sponsorship, and Azure in CSP. We will cover each of these as they are very
    important for billing:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 提供了不同的服务套餐可以购买。到目前为止，我们已经讨论了按需付费，但还有其他服务套餐，例如 **企业协议**（**EAs**）、Azure
    赞助和 CSP 中的 Azure。我们将逐一讨论这些内容，因为它们对计费非常重要：
- en: '**Pay-as-you-go**: This is a commonly known offering, where customers pay based
    on the consumption and the rates are available in the public-facing documentation
    of Azure. Customers receive an invoice every month for usage from Microsoft and
    they can pay via credit card or an invoice payment method.'
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**按需付费**：这是一种常见的服务方式，客户根据实际使用情况支付费用，相关的费率可以在 Azure 的公开文档中查看。客户每月都会收到来自微软的使用账单，并可以通过信用卡或账单支付方式付款。'
- en: '**EAs**: EAs entail a monetary commitment with Microsoft, which means that
    organizations sign an agreement with Microsoft and promise that they will use
    x amount of Azure resources. If the usage goes above the agreed amount, the customer
    will receive an overage invoice. Customers can create multiple accounts under
    an EA and have multiple subscriptions inside these accounts. There are two types
    of EA: Direct EA and Indirect EA. Direct EA customers have a direct billing relationship
    with Microsoft; on the other hand, with Indirect EA, the billing is managed by
    a partner. EA customers will get better offers and discounts because of the commitment
    they make with Microsoft. The EA is managed via a portal called the EA portal
    ([https://ea.azure.com](https://ea.azure.com)), and you need to have enrolment
    privileges to access this portal.'
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**EA**：EA 代表与 Microsoft 的货币承诺，意味着组织与 Microsoft 签署协议，并承诺使用一定数量的 Azure 资源。如果使用量超过约定的额度，客户将收到超额费用账单。客户可以在
    EA 下创建多个帐户，并在这些帐户中拥有多个订阅。EA 有两种类型：直接 EA 和间接 EA。直接 EA 客户与 Microsoft 之间有直接的账单关系；而在间接
    EA 中，账单由合作伙伴管理。EA 客户因与 Microsoft 的承诺而获得更好的优惠和折扣。EA 通过名为 EA 门户的门户管理（[https://ea.azure.com](https://ea.azure.com)），您需要拥有注册权限才能访问此门户。'
- en: '**Azure in CSP**: Azure in CSP is where a customer reaches out to a **Cloud
    Solution Provider** (**CSP**) partner, and this partner provisions a subscription
    for the customer. The billing will be completely managed by the partner; the customer
    will not have a direct billing relationship with Microsoft. Microsoft invoices
    the partner and the partner invoices the customer, adding their margin.'
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure 在 CSP 中**：Azure 在 CSP 中是指客户联系 **云解决方案提供商**（**CSP**）合作伙伴，由该合作伙伴为客户提供订阅。账单将完全由合作伙伴管理；客户与
    Microsoft 不会有直接的账单关系。Microsoft 向合作伙伴开具账单，合作伙伴再向客户开具账单，并加上其利润。'
- en: '**Azure Sponsorship**: Sponsorship is given by Microsoft to start-ups, NGOs,
    and other non-profit organizations to use Azure. The sponsorship is for a fixed
    term and a fixed amount of credit. If the term expires or credit gets exhausted,
    the subscription will be converted to a pay-as-you-go subscription. If organizations
    want to renew their sponsorship entitlement, they have to work with Microsoft.'
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure 赞助**：Microsoft 向初创公司、非政府组织（NGO）和其他非营利组织提供赞助，以使用 Azure。赞助是有固定期限和固定额度的信用。如果期限到期或信用用尽，订阅将转换为按需计费订阅。如果组织希望续订其赞助资格，必须与
    Microsoft 合作。'
- en: We have just outlined a few of Azure's offerings. The complete list is available
    at [https://azure.microsoft.com/support/legal/offer-details](https://azure.microsoft.com/support/legal/offer-details),
    which includes other offerings, such as Azure for Students, Azure Pass, and Dev/Test
    subscriptions.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 我们刚刚概述了 Azure 的部分产品。完整列表请参见 [https://azure.microsoft.com/support/legal/offer-details](https://azure.microsoft.com/support/legal/offer-details)，其中包括其他产品，如
    Azure 学生计划、Azure Pass 和 Dev/Test 订阅。
- en: Next, let's discuss billing in Azure.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们来讨论 Azure 中的账单。
- en: Understanding billing
  id: totrans-21
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 理解账单
- en: 'Azure is a service utility that has the following features:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 是一项具有以下特点的服务工具：
- en: No upfront costs
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 无需预付费用
- en: No termination fees
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 无解约费用
- en: Billing per second, per minute, or per hour depending on the type of resource
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 根据资源类型按秒、按分钟或按小时计费
- en: Payment based on consumption-on-the-go
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 按实际消费进行付费
- en: In such circumstances, it is very difficult to estimate the upfront cost of
    consuming Azure resources. Every resource in Azure has its own cost model and
    charge based on storage, usage, and time span. It is very important for management,
    administration, and finance departments to keep track of usage and costs. Azure
    provides usage and billing reporting capabilities to help upper management and
    administrators generate cost and usage reports based on multiple criteria.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，很难估算使用 Azure 资源的预付成本。Azure 中的每种资源都有自己的成本模型，并根据存储、使用情况和时间跨度收费。对于管理、行政和财务部门来说，跟踪使用情况和成本非常重要。Azure
    提供使用和账单报告功能，帮助高级管理人员和管理员根据多种标准生成成本和使用报告。
- en: 'The Azure portal provides detailed billing and usage information through the
    **Cost Management + Billing** feature, which can be accessed from the master navigation
    blade, as shown in *Figure 6.1*:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 门户通过 **成本管理 + 账单** 功能提供详细的账单和使用信息，该功能可以从主导航窗格访问，如 *图 6.1* 所示：
- en: '![Cost Management + Billing](img/B15432_06_01.jpg)'
  id: totrans-29
  prefs: []
  type: TYPE_IMG
  zh: '![Cost Management + Billing](img/B15432_06_01.jpg)'
- en: 'Figure 6.1: Cost Management + Billing service in the Azure portal'
  id: totrans-30
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 6.1：Azure 门户中的成本管理 + 账单服务
- en: Please note that if your billing is managed by a CSP, you will not have access
    to this feature. CSP customers can view their costs in the pay-as-you-go scheme
    if they transition their CSP legacy subscriptions to the Azure plan. We will discuss
    the Azure plan and the Modern Commerce platform later in the chapter.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，如果你的计费由 CSP 管理，你将无法访问此功能。CSP 客户可以在将其 CSP 传统订阅转换为 Azure 计划后，按需查看其成本。我们将在本章后续部分讨论
    Azure 计划和现代商务平台。
- en: '**Cost Management + Billing** shows all the subscriptions and the billing scopes
    you have access to, as shown in *Figure 6.2*:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: '**成本管理 + 计费**显示所有你有权限访问的订阅和计费范围，如*图 6.2*所示：'
- en: '![Billing details of all listed user subscriptions](img/B15432_06_02.jpg)'
  id: totrans-33
  prefs: []
  type: TYPE_IMG
  zh: '![所有列出的用户订阅的账单详情](img/B15432_06_02.jpg)'
- en: 'Figure 6.2: Billing overview of user subscriptions'
  id: totrans-34
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 6.2：用户订阅的计费概述
- en: 'The **Cost Management** section has several blades, such as:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: '**成本管理**部分有几个页面，例如：'
- en: '**Cost analysis** for analyzing the usage of a scope.'
  id: totrans-36
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**成本分析**用于分析某个范围内的使用情况。'
- en: '**Budgets** for settings budgets.'
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**预算**用于设置预算。'
- en: '**Cost alerts** for notifying administrators when the usage exceeds a certain
    threshold.'
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**成本警报**用于在使用超过某个阈值时通知管理员。'
- en: '**Advisor recommendations** for getting advice on how to make potential savings.
    We will discuss Azure Advisor in the last section of this chapter.'
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Advisor 推荐**用于获取如何实现潜在节省的建议。我们将在本章最后一部分讨论 Azure Advisor。'
- en: '**Exports** for automating usage exports to Azure Storage.'
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**导出**用于将使用数据自动导出到 Azure 存储。'
- en: '**Cloudyn**, which is a tool used by CSP partners to analyze costs, as they
    don''t have access to Cost Management.'
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Cloudyn** 是 CSP 合作伙伴用来分析成本的工具，因为他们无法访问成本管理。'
- en: '**Connectors for AWS** for connecting your AWS consumption data to Azure Cost
    Management.'
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**AWS 连接器**用于将你的 AWS 消耗数据连接到 Azure 成本管理。'
- en: 'The different options available in Azure Cost Management are shown in *Figure
    6.3*:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Azure 成本管理中提供的不同选项如*图 6.3*所示：
- en: '![List of services in the Azure Cost Management section in the Azure portal](img/B15432_06_03.jpg)'
  id: totrans-44
  prefs: []
  type: TYPE_IMG
  zh: '![Azure 门户中的 Azure 成本管理部分服务列表](img/B15432_06_03.jpg)'
- en: 'Figure 6.3: Cost Management overview'
  id: totrans-45
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 6.3：成本管理概述
- en: 'Clicking on the **Cost analysis** menu on this blade provides a comprehensive
    interactive dashboard, using which cost can be analyzed with different dimensions
    and measures:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 点击此页面上的 **成本分析** 菜单，可以获得一个全面的交互式仪表盘，使用它可以通过不同的维度和度量分析成本：
- en: '![Analysing subscription costs through the Cost Analysis option](img/B15432_06_04.jpg)'
  id: totrans-47
  prefs: []
  type: TYPE_IMG
  zh: '![通过成本分析选项分析订阅成本](img/B15432_06_04.jpg)'
- en: 'Figure 6.4: Analyzing subscription costs through the Cost analysis option'
  id: totrans-48
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 6.4：通过成本分析选项分析订阅成本
- en: The dashboard not only shows the current cost but also forecasts the cost and
    breaks it down based on multiple dimensions. **Service name**, **Location**, and
    **Resource group name** are provided by default, but they can be changed to other
    dimensions as well. There will be always a scope associated with every view. Some
    of the available scopes are billing account, management group, subscription, and
    resource group. You can switch the scope depending on the level you want to analyze.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 该仪表盘不仅显示当前成本，还预测成本，并根据多个维度进行拆分。默认提供**服务名称**、**位置**和**资源组名称**，但也可以更改为其他维度。每个视图始终会与一个范围相关联。可用的一些范围包括计费账户、管理组、订阅和资源组。你可以根据需要分析的层级切换范围。
- en: 'The **Budget** menu on the left allows us to set up the budget for better cost
    management and provides alerting features in case the actual cost is going to
    breach the budget estimates:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 左侧的**预算**菜单允许我们设置预算以更好地管理成本，并提供在实际成本即将超出预算估算时的警报功能：
- en: '![Creating a budget alert for cost management](img/B15432_06_05.jpg)'
  id: totrans-51
  prefs: []
  type: TYPE_IMG
  zh: '![为成本管理创建预算警报](img/B15432_06_05.jpg)'
- en: 'Figure 6.5: Creating a budget'
  id: totrans-52
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 6.5：创建预算
- en: Cost Management also allows us to fetch cost data from other clouds, such as
    AWS, within the current dashboards, thereby managing costs for multiple clouds
    from a single blade and dashboard. However, this feature is in preview at the
    time of writing. This connector will become chargeable after August 25, 2020.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 成本管理还允许我们在当前的仪表盘中获取来自其他云（如 AWS）的成本数据，从而在单一的仪表盘和页面中管理多个云的成本。然而，在写作时，此功能仍处于预览阶段。此连接器将于
    2020 年 8 月 25 日之后开始收费。
- en: 'You need to fill in your AWS role details and other details to pull the cost
    information, as shown in *Figure 6.5*. If you are unsure how to create the policy
    and role in AWS, refer to [https://docs.microsoft.com/azure/cost-management-billing/costs/aws-integration-set-up-configure#create-a-role-and-policy-in-aws](https://docs.microsoft.com/azure/cost-management-billing/costs/aws-integration-set-up-configure#create-a-role-and-policy-in-aws):'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: '您需要填写您的 AWS 角色详细信息及其他信息，以便提取成本信息，如*图 6.5*所示。如果您不确定如何在 AWS 中创建策略和角色，请参考[https://docs.microsoft.com/azure/cost-management-billing/costs/aws-integration-set-up-configure#create-a-role-and-policy-in-aws](https://docs.microsoft.com/azure/cost-management-billing/costs/aws-integration-set-up-configure#create-a-role-and-policy-in-aws):'
- en: '![Creating a connector to bring AWS cost and usage report data into Azure Cost
    Management](img/B15432_06_06.jpg)'
  id: totrans-55
  prefs: []
  type: TYPE_IMG
  zh: '![将 AWS 成本和使用报告数据导入 Azure 成本管理的连接器创建](img/B15432_06_06.jpg)'
- en: 'Figure 6.6: Creating an AWS connector in Cost Management'
  id: totrans-56
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 6.6：在成本管理中创建 AWS 连接器
- en: The cost reports can also be exported to a storage account on a scheduled basis.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 成本报告还可以根据计划定期导出到存储帐户中。
- en: Some of the cost analysis is also available in the **Subscriptions** blade.
    In the **Overview** section, you can see resources and their cost. Also, there
    is another graph, where you can see your current spend, forecast, and balance
    credit (if you are using a credit-based subscription).
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 部分成本分析也可以在**订阅**面板中查看。在**概览**部分，您可以看到资源及其成本。此外，还有另一张图表，您可以查看当前花费、预测花费以及余额信用（如果您使用的是基于信用的订阅）。
- en: '*Figure 6.7* shows cost information:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 6.7*显示了成本信息：'
- en: '![Overview of costs by resource for the subscription](img/B15432_06_07.jpg)'
  id: totrans-60
  prefs: []
  type: TYPE_IMG
  zh: '![按资源查看订阅的成本概览](img/B15432_06_07.jpg)'
- en: 'Figure 6.7: Cost analysis for the subscription'
  id: totrans-61
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 6.7：订阅的成本分析
- en: 'Clicking on any of the costs in *Figure 6.7* will redirect you to the **Cost
    Management** – **Cost Analysis** section. There are a lot of dimensions in Cost
    Management with which you can group the data for analysis. The available dimensions
    will vary based on the scope you have selected. Some of the commonly used dimensions
    are as follows:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 点击*图 6.7*中的任何一个成本项将会将您重定向到**成本管理** – **成本分析**部分。成本管理中有许多维度，您可以根据这些维度对数据进行分组分析。可用的维度将根据您选择的范围而有所不同。以下是一些常用的维度：
- en: Resource types
  id: totrans-63
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 资源类型
- en: Resource group
  id: totrans-64
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 资源组
- en: Tag
  id: totrans-65
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 标签
- en: Resource location
  id: totrans-66
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 资源位置
- en: Resource ID
  id: totrans-67
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 资源 ID
- en: Meter category
  id: totrans-68
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 计量类别
- en: Meter subcategory
  id: totrans-69
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 计量子类别
- en: Service
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 服务
- en: At the beginning of the chapter, we said that tags can be used for cost management.
    For example, let's say you have a tag called Department with values of IT, HR,
    and Finance. Tagging the resources appropriately will help you understand the
    cost incurred by each department. You can also download the cost report as a CSV,
    Excel, or PNG file using the **Download** button.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章开始时，我们提到过标签可以用于成本管理。例如，假设您有一个名为“部门”的标签，值为 IT、HR 和财务。正确地为资源打上标签将帮助您了解每个部门产生的成本。您还可以通过**下载**按钮将成本报告下载为
    CSV、Excel 或 PNG 文件。
- en: Additionally, Cost Management supports multiple views. You can create your own
    dashboard and save it. EA customers get the added benefit of the Cost Management
    connector or Power BI. With the connector, users can pull the usage statistics
    to Power BI and create visualizations.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，成本管理支持多种视图。您可以创建自己的仪表板并保存它。EA 客户还可以额外享受成本管理连接器或 Power BI 的优势。通过连接器，用户可以将使用统计数据拉取到
    Power BI 并创建可视化。
- en: Up to this point, we have been discussing how we can keep track of our usage
    using Cost Management. In the next section, we will explore how invoicing works
    for the services we have used.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我们一直在讨论如何使用成本管理来跟踪我们的使用情况。在接下来的部分，我们将探讨我们所使用的服务的计费方式。
- en: Invoicing
  id: totrans-74
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 开票
- en: Azure's billing system also provides information about invoices that are generated
    monthly.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 的计费系统还提供有关每月生成的发票的信息。
- en: Depending on the offer type, the method of invoicing may vary. For pay-as-you-go
    users, the invoices will be sent monthly to the account administrator. However,
    for EA customers, the invoice will be sent to the contact on the enrollment.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 根据优惠类型，计费方式可能会有所不同。对于按需付费用户，发票将每月发送给帐户管理员。然而，对于 EA 客户，发票将发送给注册时的联系人。
- en: 'Clicking on the **Invoices** menu brings up a list of all the invoices generated,
    and clicking on any of the invoices provides details about that invoice. *Figure
    6.8* shows how the invoices are shown in the Azure portal:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 点击**发票**菜单将显示所有生成的发票列表，点击任何一张发票将提供该发票的详细信息。*图 6.8*显示了如何在 Azure 门户中查看发票：
- en: '![A list of billed invoices and their details](img/B15432_06_08.jpg)'
  id: totrans-78
  prefs: []
  type: TYPE_IMG
  zh: '![账单发票及其详细信息列表](img/B15432_06_08.jpg)'
- en: 'Figure 6.8: List of invoices and their details'
  id: totrans-79
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图6.8：发票及其详细信息列表
- en: 'There are two types of invoices: one is for Azure services such as SQL, Virtual
    Machines, and Networking. Another type is for Azure Marketplace and Reservations.
    Azure Marketplace provides partner services from different vendors for customers.
    We will be talking about Azure Reservations later on.'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 发票有两种类型：一种是针对Azure服务，如SQL、虚拟机和网络的发票；另一种是针对Azure市场和预订的发票。Azure市场提供来自不同供应商的合作伙伴服务供客户选择。稍后我们将讨论Azure预订。
- en: By default, for a pay-as-you-go subscription, the account admin has access to
    the invoices. If they want, they can delegate access to other users, such as the
    organization's finance team, by choosing the **Access invoice** option in *Figure
    6.8*. Additionally, the account admin can opt for email addresses where they want
    to send out the copies of the invoices.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，对于按需付费订阅，账户管理员可以访问发票。如果需要，他们可以通过选择*图6.8*中的**访问发票**选项，将访问权限委托给其他用户，例如组织的财务团队。此外，账户管理员还可以选择希望将发票副本发送到的电子邮件地址。
- en: The **Email Invoice** option is not available for Support Plan now. Alternatively,
    you can visit the Accounts portal and download the invoice. Microsoft is slowly
    moving away from this portal, and most of the features are getting deprecated
    as they are integrated into the Azure portal.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: '**电子邮件发票**选项目前不适用于支持计划。您可以访问账户门户并下载发票。微软正在逐步淘汰该门户，大部分功能正在被集成到Azure门户中。'
- en: So far, we have discussed subscriptions and how invoicing is done. Something
    new that has been introduced by Microsoft is Modern Commerce. With this new commerce
    experience, the purchase process and experience has been simplified. Let's take
    a closer look at Modern Commerce and learn how it is different from the legacy
    platform that we have discussed so far.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我们已经讨论了订阅和发票处理的方式。微软推出的一个新概念是现代商务。通过这一新的商务体验，购买流程和体验得到了简化。让我们仔细看看现代商务，并了解它与我们迄今讨论的传统平台有何不同。
- en: The Modern Commerce experience
  id: totrans-84
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 现代商务体验
- en: If your organization is already working with Microsoft, you will know that there
    are multiple agreements involved for each offer, such as Web Direct, EAs, CSP,
    **Microsoft Service and Product Agreement** (**MSPA**), **Server Cloud Enrollments**
    (**SCE**), and so on. Along with this, each of them has its own portal; for example,
    EAs have the EA portal, CSP has the Partner Center portal, and Volume Licensing
    has its own portal too.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您的组织已经与微软合作，您会知道每个报价都有多个协议，例如Web Direct、EA、CSP、**微软服务与产品协议**（**MSPA**）、**服务器云注册**（**SCE**）等。除此之外，每个协议都有自己的门户；例如，EA有EA门户，CSP有合作伙伴中心门户，Volume
    Licensing也有自己的门户。
- en: Each offer comes with a different set of terms and conditions, and the customers
    need to go through them every time they make a purchase. The transition from one
    offer to another is not very easy as each offer has a different set of terms and
    conditions. Let's imagine that you already have an EA subscription and would like
    to convert it to a CSP subscription; you may have to delete some of the partner
    services as they are not supported in CSP. For each product, each offer will have
    different rules. From a customer standpoint, it's very hard to understand what
    supports what and how rules differ.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 每个报价都有不同的条款和条件，客户在每次购买时都需要了解这些条款和条件。从一个报价转换到另一个报价并不容易，因为每个报价的条款和条件各不相同。假设您已经有了EA订阅，并希望将其转换为CSP订阅；您可能需要删除一些合作伙伴服务，因为这些服务在CSP中不被支持。对于每个产品，每个报价都有不同的规则。从客户的角度来看，理解哪些支持哪些内容以及规则如何不同是非常困难的。
- en: Addressing this issue, Microsoft has recently issued a new agreement called
    **Microsoft Customer Agreement** (**MCA**). This will act as the basic terms and
    conditions. You can make amendments to it whenever required when you sign up for
    a new program.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 为了解决这个问题，微软最近发布了一项新的协议，称为**微软客户协议**（**MCA**）。该协议将作为基本条款和条件。每当您注册新项目时，您可以根据需要对其进行修改。
- en: 'For Azure, there will be three **Go-To-Market** (**GTM**) programs:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 对于Azure，将有三个**市场推广**（**GTM**）计划：
- en: '**Field Led**: Customers will interact directly with the Microsoft Accounts
    Team and the billing will be directly managed by Microsoft. Eventually, this will
    replace EAs.'
  id: totrans-89
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**以客户为主导**：客户将直接与微软账户团队互动，发票将由微软直接管理。最终，这将取代EA。'
- en: '**Partner Led**: This is equivalent to the Azure-in-CSP program, where a partner
    manages your billing. There are different partners across the world. A quick web
    search will help you find the partners around you. This program will replace the
    Azure-in-CSP program. As the first step to Modern Commerce, a partner will sign
    a **Microsoft Partner Agreement** (**MPA**) with Microsoft and transition their
    existing customers by making them sign the MCA. At the time of writing this book,
    many partners have transitioned their customers to Modern Commerce, and the new
    commerce experience is available in 139 countries.'
  id: totrans-90
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**合作伙伴主导**：这相当于 Azure-in-CSP 项目，其中合作伙伴管理你的账单。全球有不同的合作伙伴，快速搜索一下即可找到周围的合作伙伴。这个项目将取代
    Azure-in-CSP 项目。作为现代商务的第一步，合作伙伴将与微软签署 **微软合作伙伴协议**（**MPA**），并通过让他们的客户签署 MCA 来转换他们现有的客户。在撰写本书时，许多合作伙伴已经将他们的客户转移到现代商务，新商业体验已在
    139 个国家/地区提供。'
- en: '**Self Service**: This will be a replacement for Web Direct. It doesn''t require
    any involvement from the partner or the Microsoft Accounts Team. Customers can
    directly purchase from [microsoft.com](http://microsoft.com) and they will sign
    the MCA during the purchase.'
  id: totrans-91
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**自助服务**：这将取代 Web Direct。它不需要合作伙伴或微软账户团队的任何参与。客户可以直接从 [microsoft.com](http://microsoft.com)
    购买，并且在购买时签署 MCA。'
- en: In Azure, the billing will be done on the Azure Plan, and the billing will be
    always aligned with the calendar month. Buying an Azure Plan is very similar to
    buying any other subscription. The difference is that the MCA will be signed during
    the process.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Azure 中，账单将根据 Azure 计划进行，并且账单总是与日历月份对齐。购买 Azure 计划与购买其他订阅非常相似。不同之处在于，在过程中会签署
    MCA。
- en: Azure Plan can host multiple subscriptions, and it will act as a root-level
    container. All the usage is tied back to a single Azure Plan. All the subscriptions
    inside the Azure Plan will act as containers to host services, such as Virtual
    Machines, SQL Database, and Networking.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 计划可以托管多个订阅，并将作为根级容器。所有的使用情况都与单一的 Azure 计划相关联。Azure 计划中的所有订阅将作为容器来托管服务，如虚拟机、SQL
    数据库和网络服务。
- en: 'Some of the changes and advancements we could observe after the introduction
    of Modern Commerce are as follows:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以观察到在现代商务引入后的一些变化和进展如下：
- en: Eventually, the portals will be deprecated. For example, earlier EA customers
    were only able to download the enrollment usage information from the EA portal.
    Now Microsoft has integrated it into Azure Cost Management with a richer experience
    than the EA portal.
  id: totrans-95
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 最终，门户网站将被弃用。例如，之前的 EA 客户只能从 EA 门户下载注册使用信息。现在，微软已经将其集成到 Azure 成本管理中，提供比 EA 门户更丰富的体验。
- en: Pricing will be done in USD and billed in the local currency. If your currency
    is not USD, then the **foreign exchange** (**FX**) rate will be applied and is
    available in your invoice. Microsoft uses FX rates from Thomson Reuters, and these
    rates will be assigned on the first of every month. This value will be consistent
    throughout the month, irrespective of what the market rate is.
  id: totrans-96
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 定价将以美元（USD）进行，并以当地货币计费。如果你的货币不是美元，则将应用 **外汇**（**FX**）汇率，并会显示在发票中。微软使用来自 Thomson
    Reuters 的外汇汇率，这些汇率将在每个月的第一天进行分配。这个汇率在整个一个月内保持一致，无论市场汇率如何变化。
- en: CSP customers who transition to the new Azure Plan will be able to use Cost
    Management. Access to Cost Management opens a new world of cost tracking, as it
    provides access to all native Cost Management features.
  id: totrans-97
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 转到新 Azure 计划的 CSP 客户将能够使用成本管理。访问成本管理打开了一个全新的成本跟踪世界，因为它提供了所有原生的成本管理功能。
- en: All the subscriptions that we have discussed so far will eventually be moved
    to an Azure Plan, which is the future of Azure. Now that you understand the basics
    of Modern Commerce, let's discuss another topic that has a very important role
    when we are architecting solutions. Most services have limits by default; some
    of these limits can be increased while some are hard limits. When we are architecting
    a solution, we need to make sure that there is ample quota. Capacity planning
    is a vital part of architectural design. In the next section, you will learn more
    about limits on subscriptions.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止我们讨论的所有订阅最终都将迁移到 Azure 计划，这是 Azure 的未来。现在你已经理解了现代商务的基础，接下来让我们讨论一个在架构解决方案时起着非常重要作用的话题。大多数服务默认都有限制；其中一些限制可以增加，而有些是硬性限制。当我们在设计解决方案时，需要确保有足够的配额。容量规划是架构设计中的一个至关重要的部分。在下一节，你将了解更多有关订阅限制的信息。
- en: Usage and quotas
  id: totrans-99
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用情况和配额
- en: As mentioned in the previous section, capacity planning needs to be one of the
    first steps when we architect a solution. We need to verify whether the subscription
    has enough quota to accommodate the new resources we are architecting. If not,
    during the deployment, we may face issues.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，容量规划需要成为我们设计解决方案时的首要步骤之一。我们需要验证订阅是否有足够的配额来容纳我们设计的新资源。如果没有，在部署过程中可能会遇到问题。
- en: Each subscription has a limited quota for each resource type. For example, there
    could be a maximum of 10 public IP addresses provisioned with an MSDN Microsoft
    account. Similarly, all resources have a maximum default limit for each resource
    type. These resource type numbers for a subscription can be increased by contacting
    Azure Support or clicking on the **Request Increase** button in the **Usage**
    **+** **Quota** blade on the **Subscription** page.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 每个订阅对每种资源类型都有有限的配额。例如，使用MSDN Microsoft帐户时，最多可以分配10个公共IP地址。类似地，所有资源对每种资源类型都有一个最大默认限制。通过联系Azure支持或在**订阅**页面的**使用情况**
    **+** **配额**窗格中点击**请求增加**按钮，可以增加这些资源类型的配额。
- en: 'Considering the number of resources in each region, it''ll be a challenge to
    go through the list. The portal provides options to filter the dataset and look
    for what we want. In *Figure 6.9*, you can see that if we filter the location
    to **Central US** and set the resource provider to **Microsoft.Storage**, we can
    confirm which quotas are available for storage accounts:'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑到每个区域的资源数量，要浏览整个列表将是一个挑战。门户提供了筛选数据集并查找所需项的选项。在*图 6.9*中，您可以看到如果我们将位置筛选为**美国中部**并将资源提供者设置为**Microsoft.Storage**，我们可以确认存储帐户的可用配额：
- en: '![Checking usage and quota for a given location and resource provider](img/B15432_06_09.jpg)'
  id: totrans-103
  prefs: []
  type: TYPE_IMG
  zh: '![检查给定位置和资源提供者的使用情况和配额](img/B15432_06_09.jpg)'
- en: 'Figure 6.9: Usage and quota for a given location and resource provider'
  id: totrans-104
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 6.9：给定位置和资源提供者的使用情况和配额
- en: You can clearly see in *Figure 6.9* that we haven't created any storage accounts
    in Central US, and that leaves us with a quota of 250 accounts. If the solution
    we are architecting requires more than 250 accounts, we need to click on **Request
    Increase**, which would contact Azure Support.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 在*图 6.9*中，您可以清楚地看到我们在美国中部尚未创建任何存储帐户，这使得我们拥有250个帐户的配额。如果我们构建的解决方案需要超过250个帐户，则需要点击**请求增加**，这将联系Azure支持。
- en: This blade gives us the freedom to perform capacity planning prior to deployment.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 此窗格使我们能够在部署前进行容量规划。
- en: When filtering the report, we used the term **resource provider** and selected
    **Microsoft.Storage**. In the next section, will take a closer look at what this
    term means.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 在筛选报告时，我们使用了**资源提供者**一词并选择了**Microsoft.Storage**。在下一节中，我们将更详细地了解这个术语的含义。
- en: Resource providers and resource types
  id: totrans-108
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 资源提供者和资源类型
- en: Whether you are interacting with the Azure portal, filtering services, or filtering
    the billing usage report, you might need to work with resource providers and resource
    types. For example, when you are creating a virtual machine, you are interacting
    with the `Microsoft.Compute` resource provider and the `virtualMachines` resource
    type. The `{resource-provider}/{resource-type}`. So, the resource type for the
    virtual machine is `Microsoft.Compute/virtualMachines`. In short, resource providers
    help to create resource types.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 无论您是与Azure门户交互，筛选服务，还是筛选账单使用报告，您可能需要与资源提供者和资源类型打交道。例如，当您创建虚拟机时，您正在与`Microsoft.Compute`资源提供者和`virtualMachines`资源类型交互。其格式为`{resource-provider}/{resource-type}`。因此，虚拟机的资源类型是`Microsoft.Compute/virtualMachines`。简而言之，资源提供者帮助创建资源类型。
- en: Resource providers need to be registered with an Azure subscription. Resource
    types will not be available in a subscription if resource providers are not registered.
    By default, most providers are automatically registered; having said that, there
    will be scenarios where we must manually register.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 资源提供者需要在Azure订阅中注册。如果资源提供者没有注册，则资源类型将在订阅中不可用。默认情况下，大多数提供者会自动注册；不过，也会有一些情况需要我们手动注册。
- en: 'To get a list of providers that are available, the ones that are registered
    and the ones that are not registered, and to register non-registered providers
    or vice versa, the dashboard shown in *Figure 6.10* can be used. For this operation,
    you need to have the necessary roles assigned—Owner or Contributor roles will
    suffice. *Figure 6.10* shows what the dashboard looks like:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 要获取可用的提供商列表，包括已注册和未注册的提供商，并注册未注册的提供商或反之，可以使用 *图 6.10* 所示的仪表板。进行此操作时，您需要拥有必要的角色——Owner
    或 Contributor 角色即可。*图 6.10* 显示了仪表板的样子：
- en: '![List of registered and non-registered resource providers](img/B15432_06_10.jpg)'
  id: totrans-112
  prefs: []
  type: TYPE_IMG
  zh: '![已注册和未注册的资源提供商列表](img/B15432_06_10.jpg)'
- en: 'Figure 6.10: List of registered and non-registered resource providers'
  id: totrans-113
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 6.10：已注册和未注册的资源提供商列表
- en: In the previous section, we discussed how to download invoices and usage information.
    If you need to download the data programmatically and save it, then you can use
    APIs. The next section is all about Azure Billing APIs.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 在前一部分中，我们讨论了如何下载发票和使用信息。如果您需要通过编程方式下载数据并保存，您可以使用 API。下一部分将全面介绍 Azure 计费 API。
- en: Usage and Billing APIs
  id: totrans-115
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用情况和计费 API
- en: Although the portal is a great way to find usage, billing, and invoice information
    manually, Azure also provides the following APIs to programmatically retrieve
    details and create customized dashboards and reports. The APIs vary depending
    on the kind of subscription you are using. As there are many APIs, we will be
    sharing the Microsoft documentation with each API so that you can explore them
    all.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管门户是手动查找使用、计费和发票信息的好方法，但 Azure 还提供了以下 API，以便通过编程方式检索详细信息并创建定制的仪表板和报告。这些 API
    会根据您使用的订阅类型有所不同。由于 API 很多，我们将分享每个 API 的 Microsoft 文档，以便您可以逐一探索它们。
- en: Azure Enterprise Billing APIs
  id: totrans-117
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: Azure 企业计费 API
- en: 'EA customers have a dedicated set of APIs available for them to work with billing
    data. The following APIs use the API key from the EA portal for authentication;
    tokens from Azure Active Directory will not work with them:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: EA 客户有一组专门的 API 可供他们处理计费数据。以下 API 使用来自 EA 门户的 API 密钥进行身份验证；来自 Azure Active Directory
    的令牌无法与它们一起使用：
- en: '**Balance and Summary API**: As we discussed earlier, EA works with a monetary
    commitment, and it is very important to track the balance, overage, credit adjustments,
    and Azure Marketplace charges. Using this API, customers can pull the balance
    and summary for a billing period.'
  id: totrans-119
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**余额和摘要 API**：如前所述，EA 依赖于货币承诺，因此跟踪余额、超额费用、信用调整和 Azure Marketplace 费用非常重要。使用此
    API，客户可以提取计费期间的余额和摘要。'
- en: '**Usage Details API**: The Usage Details API will help you to get daily usage
    information about the enrollment with granularity down to the instance level.
    The response of this API will be like the usage report that can be downloaded
    from the EA portal.'
  id: totrans-120
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**使用详情 API**：使用详情 API 将帮助您获取关于注册的每日使用信息，精确到实例级别。此 API 的响应将类似于可以从 EA 门户下载的使用报告。'
- en: '**Marketplace Store Charge API**: This is a dedicated API for extracting the
    charges for Marketplace purchases.'
  id: totrans-121
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Marketplace 商店费用 API**：这是一个专门的 API，用于提取 Marketplace 购买的费用。'
- en: '**Price Sheet API**: Each enrollment will have a special price sheet, and discounts
    vary from customers to customers. The Price Sheet API can pull the price list.'
  id: totrans-122
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**价格表 API**：每个注册都会有一个特殊的价格表，折扣因客户而异。价格表 API 可以拉取价格列表。'
- en: '**Reserved Instance Details API**: We haven''t discussed Azure Reservations
    so far, but it will be discussed by the end of this chapter. Using this API, you
    can get usage information about the reservations and a list of the reservations
    in the enrollment.'
  id: totrans-123
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**预留实例详情 API**：到目前为止我们还没有讨论 Azure 预留实例，但本章末会进行讨论。使用此 API，您可以获取有关预留实例的使用信息以及注册中的预留实例列表。'
- en: 'Here is the link to the documentation for the EA APIs: [https://docs.microsoft.com/azure/cost-management-billing/manage/enterprise-api](https://docs.microsoft.com/azure/cost-management-billing/manage/enterprise-api).'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 这是 EA API 文档的链接：[https://docs.microsoft.com/azure/cost-management-billing/manage/enterprise-api](https://docs.microsoft.com/azure/cost-management-billing/manage/enterprise-api)。
- en: Let's take a look at the Azure Consumption APIs now.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 现在让我们来看一下 Azure 消费 API。
- en: Azure Consumption APIs
  id: totrans-126
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: Azure 消费 API
- en: 'Azure Consumption APIs can be used with EA as well as Web Direct (with some
    exceptions) subscriptions. This requires a token, which needs to be generated
    by authenticating against Azure Active Directory. Since these APIs also support
    EA, don''t confuse this token with the EA API key that we mentioned in the previous
    section. Here are the key APIs that are self-explanatory:'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 消耗 API 可以与 EA 和 Web Direct（有些例外）订阅一起使用。此 API 需要一个令牌，该令牌需要通过 Azure Active
    Directory 认证生成。由于这些 API 也支持 EA，请不要将此令牌与之前提到的 EA API 密钥混淆。以下是一些显而易见的关键 API：
- en: Usage Details API
  id: totrans-128
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用详情 API
- en: Marketplace Charges API
  id: totrans-129
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 市场费用 API
- en: Reservation Recommendations API
  id: totrans-130
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 预订推荐 API
- en: Reservation Details and Summary API
  id: totrans-131
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 预订详情和总结 API
- en: 'EA customers have additional support for the following APIs:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: EA 客户支持以下额外的 API：
- en: Price sheet
  id: totrans-133
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 价格表
- en: Budgets
  id: totrans-134
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 预算
- en: Balances
  id: totrans-135
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 余额
- en: 'Documentation is available here: [https://docs.microsoft.com/azure/cost-management-billing/manage/consumption-api-overview](https://docs.microsoft.com/azure/cost-management-billing/manage/consumption-api-overview).'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 文档可以在此处查看：[https://docs.microsoft.com/azure/cost-management-billing/manage/consumption-api-overview](https://docs.microsoft.com/azure/cost-management-billing/manage/consumption-api-overview)。
- en: 'Additionally, there is another set of APIs that can be only used by Web Direct
    customers:'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，还有一组仅可供 Web Direct 客户使用的 API：
- en: '**Azure Resource Usage API**: This API can be used with an EA or pay-as-you-go
    subscription to download the usage data.'
  id: totrans-138
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure 资源使用 API**：此 API 可以与 EA 或按需订阅一起使用，用于下载使用数据。'
- en: '**Azure Resource RateCard API**: This is only applicable to Web Direct; EAs
    are not supported. Web Direct customers can use this to download price sheets.'
  id: totrans-139
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure 资源价格表 API**：仅适用于 Web Direct，不支持 EA。Web Direct 客户可以使用此 API 下载价格表。'
- en: '**Azure Invoice Download API**: This is only applicable to Web Direct customers.
    It''s used to download invoices programmatically.'
  id: totrans-140
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure 发票下载 API**：仅适用于 Web Direct 客户。用于通过编程下载发票。'
- en: The names may look familiar, and the difference is only the endpoint that we
    are calling. For Azure Enterprise Billing APIs, the URL will start with `https://consumption.azure.com`,
    and for Azure Consumption APIs, the URL starts with `https://management.azure.com`.
    This is how you can differentiate them. In the next section, you will be seeing
    a new set of APIs that are specifically used by Cost Management.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 这些 API 的名称可能看起来很熟悉，区别仅在于我们调用的端点。对于 Azure 企业计费 API，URL 以 `https://consumption.azure.com`
    开头；对于 Azure 消耗 API，URL 以 `https://management.azure.com` 开头。这样你就可以区分它们。在接下来的部分，你将看到一组专门供成本管理使用的
    API。
- en: Azure Cost Management APIs
  id: totrans-142
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: Azure 成本管理 API
- en: 'With the introduction of Azure Cost Management, a new set of APIs are available
    for the customer to use. These APIs are the backbone of Cost Management, which
    we used in the Azure portal earlier. The key APIs are as follows:'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 随着 Azure 成本管理的引入，客户可以使用一组新的 API。这些 API 是成本管理的核心，我们之前在 Azure 门户中使用过。主要的 API 如下：
- en: '**Query Usage API**: This is the same API used by Cost Analysis in the Azure
    portal. We can customize the response with what we need using a payload. It''s
    very useful when we want a customized report. The date range cannot exceed 365
    days.'
  id: totrans-144
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**查询使用 API**：这是 Azure 门户中的成本分析使用的同一 API。我们可以通过负载自定义响应内容。当我们需要定制报告时，这个 API 非常有用。日期范围不能超过
    365 天。'
- en: '**Budgets API**: Budgets is another feature of Azure Cost Management, and this
    API lets us interact with the budgets programmatically.'
  id: totrans-145
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**预算 API**：预算是 Azure 成本管理的另一项功能，使用此 API 可以通过编程与预算进行交互。'
- en: '**Forecast API**: This can be used to get a forecast of a scope. The Forecast
    API is only available for EA customers now.'
  id: totrans-146
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**预测 API**：此 API 可用于获取范围的预测。预测 API 目前仅适用于 EA 客户。'
- en: '**Dimensions API**: Earlier, when we were discussing Cost Management, we said
    that Cost Management supports multiple dimensions based on the scope. If you would
    like to get the list of dimensions supported based on a specific scope, you can
    use this API.'
  id: totrans-147
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**维度 API**：之前在讨论成本管理时，我们提到过成本管理支持基于范围的多维度。如果你想根据特定的范围获取支持的维度列表，可以使用此 API。'
- en: '**Exports API**: Another feature of Cost Management is that we can automate
    the report export to a storage account. The Exports API can be used to interact
    with the export configuration, such as the name of the storage account, customization,
    frequency, and so on.'
  id: totrans-148
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**导出 API**：成本管理的另一个功能是我们可以自动将报告导出到存储帐户。导出 API 可用于与导出配置进行交互，如存储帐户的名称、定制化、频率等。'
- en: Check out the official documentation at [https://docs.microsoft.com/rest/api/cost-management](https://docs.microsoft.com/rest/api/cost-management).
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 查看官方文档：[https://docs.microsoft.com/rest/api/cost-management](https://docs.microsoft.com/rest/api/cost-management)。
- en: 'Since Modern Commerce is expanding MCA, there''s a whole new set of APIs that
    can be explored here: [https://docs.microsoft.com/rest/api/billing](https://docs.microsoft.com/rest/api/billing).'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 由于现代商务正在扩展 MCA，这里有一组全新的 API 可供探索：[https://docs.microsoft.com/rest/api/billing](https://docs.microsoft.com/rest/api/billing)。
- en: You may have noticed that we haven't mentioned CSP in any of these scenarios.
    In CSP, the customer doesn't have access to the billing as it's managed by a partner,
    hence the APIs are not exposed. However, a transition to an Azure Plan would let
    the CSP customer use the Azure Cost Management APIs to see the retail rates.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能注意到我们在这些场景中没有提到 CSP。在 CSP 中，客户无法访问账单，因为它由合作伙伴管理，因此 API 不对外开放。然而，迁移到 Azure
    计划将允许 CSP 客户使用 Azure 成本管理 API 查看零售价格。
- en: Any programming or scripting language can be used to use these APIs and mix
    them together to create complete comprehensive billing solutions. In the next
    section, we will be focusing on the Azure pricing calculator, which will help
    the customer or architect to understand the cost of a deployment.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 任何编程或脚本语言都可以用于调用这些 API，并将它们组合在一起，创建完整的综合账单解决方案。在下一部分中，我们将重点介绍 Azure 定价计算器，帮助客户或架构师了解部署成本。
- en: Azure pricing calculator
  id: totrans-153
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Azure 定价计算器
- en: 'Azure provides a cost calculator for users and customers to estimate their
    cost and usage. This calculator is available at [https://azure.microsoft.com/pricing/calculator](https://azure.microsoft.com/pricing/calculator):'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 提供了一个成本计算器，供用户和客户估算他们的成本和使用情况。该计算器可通过 [https://azure.microsoft.com/pricing/calculator](https://azure.microsoft.com/pricing/calculator)
    访问：
- en: '![Azure pricing calculator](img/B15432_06_11.jpg)'
  id: totrans-155
  prefs: []
  type: TYPE_IMG
  zh: '![Azure 定价计算器](img/B15432_06_11.jpg)'
- en: 'Figure 6.11: Azure pricing calculator'
  id: totrans-156
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 6.11：Azure 定价计算器
- en: 'Users can select multiple resources from the left menu, and they will be added
    to the calculator. In the following example, a virtual machine is added. Further
    configuration with regard to virtual machine region, operating system, type, tier,
    instance size, number of hours, and count should be provided to calculate costs:'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 用户可以从左侧菜单中选择多个资源，它们将被添加到计算器中。在以下示例中，添加了一个虚拟机。接下来，需要提供有关虚拟机区域、操作系统、类型、层级、实例大小、小时数和数量的更多配置，以便计算成本：
- en: '![Providing configuration details for calculating resource costs](img/B15432_06_12.jpg)'
  id: totrans-158
  prefs: []
  type: TYPE_IMG
  zh: '![提供配置详情以计算资源成本](img/B15432_06_12.jpg)'
- en: 'Figure 6.12: Providing configuration details to calculate resource costs'
  id: totrans-159
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 6.12：提供配置详情以计算资源成本
- en: 'Similarly, the cost for Azure Functions, which relates to virtual machine memory
    size, execution time, and executions per seconds, is shown in *Figure 6.13*:'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 同样，Azure Functions 的成本与虚拟机内存大小、执行时间和每秒执行次数相关，见 *图 6.13*：
- en: '![Calculating costs for Azure functions](img/B15432_06_13.jpg)'
  id: totrans-161
  prefs: []
  type: TYPE_IMG
  zh: '![计算 Azure Functions 的成本](img/B15432_06_13.jpg)'
- en: 'Figure 6.13: Calculating costs for Azure Functions'
  id: totrans-162
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 6.13：计算 Azure Functions 的成本
- en: 'Azure provides different levels and support plans:'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 提供不同的级别和支持计划：
- en: 'Default support: free'
  id: totrans-164
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 默认支持：免费
- en: 'Developer support: $29 per month'
  id: totrans-165
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 开发者支持：每月 $29
- en: 'Standard support: $300 per month'
  id: totrans-166
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 标准支持：每月 $300
- en: 'Profession direct: $1,000 per month'
  id: totrans-167
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 专业版直达：每月 $1,000
- en: To see a complete comparison of the support plans, please refer to [https://azure.microsoft.com/support/plans](https://azure.microsoft.com/support/plans).
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 要查看支持计划的完整对比，请参考：[https://azure.microsoft.com/support/plans](https://azure.microsoft.com/support/plans)。
- en: 'You can select the support that you want depending on your requirements. Finally,
    the overall estimated cost is displayed:'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以根据自己的需求选择所需的支持计划。最后，系统将显示总体估算成本：
- en: '![Cost estimation for a selected support plan](img/B15432_06_14.jpg)'
  id: totrans-170
  prefs: []
  type: TYPE_IMG
  zh: '![所选支持计划的成本估算](img/B15432_06_14.jpg)'
- en: 'Figure 6.14: Cost estimation for selected support plan'
  id: totrans-171
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 6.14：所选支持计划的成本估算
- en: It is important that architects understand every Azure feature used in their
    architecture and solution. The success of the Azure calculator depends on the
    resources that are selected and how they are configured. Any misrepresentation
    would lead to biased and incorrect estimates and would be different than the actual
    billing.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 架构师了解他们架构和解决方案中使用的每个 Azure 功能非常重要。Azure 计算器的成功取决于所选择的资源及其配置。任何错误的表示都会导致偏颇和不准确的估算，且与实际账单不同。
- en: We have reached the last section of this chapter. We have covered the basics
    of billing, and now it's time to learn the best practices. Following the best
    practices will help you achieve cost optimization.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经进入本章的最后一部分。我们已经涵盖了计费的基础知识，现在是时候学习最佳实践了。遵循最佳实践将帮助你实现成本优化。
- en: Best practices
  id: totrans-174
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 最佳实践
- en: Architects need to understand their architecture and the Azure components that
    are utilized. Based on the active monitoring, audits, and usage, they should determine
    the best offering from Microsoft in terms of SKU, size, and features. This section
    will detail some of the best practices to be adopted from a cost optimization
    perspective.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 架构师需要了解他们的架构和所使用的 Azure 组件。基于主动监控、审计和使用情况，他们应该确定微软在 SKU、大小和功能方面的最佳选择。本节将详细介绍一些从成本优化角度应采纳的最佳实践。
- en: Azure Governance
  id: totrans-176
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: Azure 治理
- en: 'Azure Governance can be defined as a set of processes or mechanisms that can
    be leveraged to maintain complete control over the resources deployed in Azure.
    Some of the key points are as follows:'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 治理可以定义为一套可以利用的过程或机制，用于保持对在 Azure 中部署的资源的完全控制。以下是一些关键要点：
- en: Set up a naming convention for all resource types and resource groups. Ensure
    that the naming convention is followed consistently and comprehensively across
    all resources and resource groups. This can be done by establishing Azure policies.
  id: totrans-178
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为所有资源类型和资源组设置命名规范。确保命名规范在所有资源和资源组中始终如一、全面地遵循。这可以通过建立 Azure 策略来实现。
- en: Set up a logical organization and multiple taxonomies for resources, resource
    groups, and subscriptions by applying tags to them. Tags categorize resources
    and can also help evaluate costs from different perspectives. This can be done
    by establishing Azure policies, and multiple policies can be combined into initiatives.
    These initiatives can be applied, which in turn will apply all policies for compliance
    checks and reporting.
  id: totrans-179
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过为资源、资源组和订阅应用标签，设置逻辑组织和多个分类法。标签对资源进行分类，还能帮助从不同角度评估成本。这可以通过建立 Azure 策略来实现，多个策略可以组合成计划。应用这些计划后，所有的策略将用于合规性检查和报告。
- en: Use Azure Blueprints instead of ARM templates directly. This will ensure that
    the deployment of new environments, resources, and resource groups can be standardized
    according to corporate standards, including naming conventions and the use of
    tags.
  id: totrans-180
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 Azure 蓝图，而不是直接使用 ARM 模板。这将确保新的环境、资源和资源组的部署可以按照企业标准进行标准化，包括命名规范和标签的使用。
- en: Compute best practices
  id: totrans-181
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 计算最佳实践
- en: 'Compute refers to services that help in the execution of services. Some of
    the best compute practices that Azure architects should follow for optimal utilization
    of resources and cost efficiency are as follows:'
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 计算指的是帮助执行服务的服务。Azure 架构师应遵循的一些最佳计算实践，以实现资源的最佳利用和成本效益，如下所示：
- en: Leverage Azure Advisor to see the available options to save costs on your virtual
    machines and to find out whether a virtual machine is underutilized. Advisor uses
    machine learning patterns and artificial intelligence to analyze your usage and
    provide recommendations. These recommendations play an important role in cost
    optimization.
  id: totrans-183
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 利用 Azure Advisor 查看节省虚拟机成本的可用选项，并找出虚拟机是否被低效使用。Advisor 使用机器学习模式和人工智能分析你的使用情况，并提供建议。这些建议在成本优化中起着重要作用。
- en: Use Azure **Reserved Instances** (**RI**). RIs can get you potential savings
    on compute costs by paying the cost of the virtual machine upfront or monthly.
    The term of the RI can be a year or three years. If you buy an RI, that will cut
    down the compute cost and you will only be seeing the disk, network, and license
    (if any) charges for a virtual machine. If you have five virtual machines, you
    can opt for five RIs to suppress the cost of compute completely. RIs automatically
    look for virtual machines with the matching SKU and attaches to it. Potential
    savings may vary from 20% to 40% depending on the size of the virtual machine.
  id: totrans-184
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 Azure **预留实例** (**RI**)。预留实例通过提前支付虚拟机费用（按月或一次性支付）为计算成本提供潜在节省。预留实例的期限可以是一年或三年。如果购买了预留实例，就可以降低计算成本，之后只需支付虚拟机的磁盘、网络和许可费用（如果有）。如果你有五个虚拟机，可以选择购买五个预留实例，从而完全压缩计算成本。预留实例会自动寻找与虚拟机匹配的
    SKU 并附加到它上面。潜在节省可能会根据虚拟机的大小有所不同，通常在 20% 到 40% 之间。
- en: Using **Azure Hybrid Benefit** (**AHUB**), you can use your own Windows Server
    or SQL licenses to reduce the license cost. Combining RIs and AHUB can give you
    immense savings.
  id: totrans-185
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 **Azure Hybrid Benefit**（**AHUB**），您可以使用自己的 Windows Server 或 SQL 许可证来降低许可证费用。结合
    RIs 和 AHUB 可以带来巨大的节省。
- en: Choose the best location for your compute services, such as virtual machines.
    Choose a location where all the Azure features are together in the same region.
    This will avoid egress traffic.
  id: totrans-186
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 选择最适合您的计算服务的区域，例如虚拟机。选择一个所有 Azure 功能都在同一区域的地点，这样可以避免外部流量。
- en: Choose the optimal size for virtual machines. A large virtual machine costs
    more than a small one, and a large virtual machine might not be required at all.
  id: totrans-187
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为虚拟机选择最佳的大小。大型虚拟机比小型虚拟机更贵，而且有时候大型虚拟机根本不需要。
- en: Resize virtual machines during times of demand and reduce their size when demand
    subsides. Azure releases new SKUs quite frequently. If a new size suits your needs
    better, then it must be used.
  id: totrans-188
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在需求高峰期间调整虚拟机大小，并在需求下降时缩小其规模。Azure 会频繁发布新的 SKU。如果新的大小更适合您的需求，就必须使用它。
- en: Shut down compute services during off-hours or when they are not needed. This
    is for non-production environments.
  id: totrans-189
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在非工作时间或不需要时关闭计算服务。这适用于非生产环境。
- en: Deallocate virtual machines instead of shutting them down. This will release
    all their resources, and the meter for their consumption will stop.
  id: totrans-190
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 取消分配虚拟机，而不是关闭它们。这将释放所有资源，并停止计量它们的消耗。
- en: Use dev/test labs for development and testing purposes. They provide policies,
    auto-shutdown, and auto-start features.
  id: totrans-191
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用开发/测试实验室进行开发和测试。它们提供策略、自动关机和自动启动功能。
- en: With virtual machine scale sets, start with a small number of virtual machines
    and scale out when demand increases.
  id: totrans-192
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用虚拟机规模集，从少量虚拟机开始，需求增加时再进行扩展。
- en: Choose the correct size (small, medium, or large) for application gateways.
    They are backed up by virtual machines and can help reduce costs.
  id: totrans-193
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为应用网关选择正确的大小（小型、中型或大型）。它们由虚拟机支持，可以帮助降低成本。
- en: Choose a Basic tier application gateway if the web application firewall is not
    needed.
  id: totrans-194
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果不需要 Web 应用防火墙，则选择基本层应用网关。
- en: Choose the correct tiers for VPN gateways (Basic VPN, Standard, High performance,
    and Ultra performance).
  id: totrans-195
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 选择正确的 VPN 网关层级（基本 VPN、标准、高性能和超高性能）。
- en: Reduce network traffic between Azure regions.
  id: totrans-196
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 减少 Azure 区域之间的网络流量。
- en: Use a load balancer with a public IP to access multiple virtual machines rather
    than assigning a public IP to each virtual machine.
  id: totrans-197
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用带有公共 IP 的负载均衡器来访问多个虚拟机，而不是为每个虚拟机分配公共 IP。
- en: Monitor virtual machines and calculate performance and usage metrics. Based
    on those calculations, determine whether you want to upscale or downscale your
    virtual machines. This could result in downsizing and reducing the number of virtual
    machines.
  id: totrans-198
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 监控虚拟机并计算性能和使用指标。根据这些计算，确定是否需要扩展或缩小虚拟机。这可能会导致缩小规模并减少虚拟机数量。
- en: Considering these best practices while architecting will inevitably lead to
    cost savings. Now that we have covered compute, let's take a similar approach
    to storage.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 在架构时考虑这些最佳实践将不可避免地带来成本节省。现在我们已经覆盖了计算部分，让我们采用类似的方法来处理存储。
- en: Storage best practices
  id: totrans-200
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 存储最佳实践
- en: 'Since we are hosting our applications in the cloud, Azure Storage will be used
    to store the data related to these applications. If we don''t follow the right
    practices, things may go wrong. Some of the best practices for storage are as
    follows:'
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们在云中托管应用程序，Azure 存储将用于存储与这些应用程序相关的数据。如果不遵循正确的实践，可能会导致问题。以下是一些存储的最佳实践：
- en: Choose an appropriate storage redundancy type (GRS, LRS, RA-GRS). GRS is costlier
    than LRS.
  id: totrans-202
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 选择适当的存储冗余类型（GRS、LRS、RA-GRS）。GRS 比 LRS 更贵。
- en: Archive storage data to the cool or archive access tier. Keep data that is frequently
    accessed in the hot tier.
  id: totrans-203
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将存储数据归档到冷存储或归档存取层。将经常访问的数据保存在热存储层。
- en: Remove blobs that are not required.
  id: totrans-204
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 删除不需要的 Blob。
- en: Delete virtual machine operating system disks explicitly after deleting virtual
    machines if they are not needed.
  id: totrans-205
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 删除虚拟机后，如果不再需要操作系统磁盘，请显式删除它们。
- en: Storage accounts should be metered based on their size, write, read, list, and
    container operations.
  id: totrans-206
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 存储账户应根据其大小、写入、读取、列出和容器操作进行计量。
- en: Prefer standard disks over premium disks; use premium disks only if your business
    requires it.
  id: totrans-207
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 优先选择标准磁盘而非高级磁盘；只有在业务需求时才使用高级磁盘。
- en: Using CDN and caching for static files instead of fetching them from storage
    every time.
  id: totrans-208
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 CDN 和缓存来处理静态文件，而不是每次都从存储中获取。
- en: Azure offers reserved capacity to save costs on blob data.
  id: totrans-209
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure 提供预留容量，以节省 Blob 数据的成本。
- en: Keeping these best practices handy will help you to architect cost-effective
    storage solutions. In the next section, we are going to discuss the best practices
    involved in the deployment of PaaS services.
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 随时掌握这些最佳实践有助于你架构出具有成本效益的存储解决方案。在接下来的章节中，我们将讨论部署 PaaS 服务时的最佳实践。
- en: PaaS best practices
  id: totrans-211
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: PaaS 最佳实践
- en: 'There are many PaaS services offered by Azure and if they are misconfigured,
    the chances are that you might end up with unexpected charges in the invoice.
    To avoid this scenario, you can leverage the following best practices:'
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 提供了许多 PaaS 服务，如果这些服务配置不当，可能会导致账单中出现意外费用。为了避免这种情况，你可以利用以下最佳实践：
- en: Choose an appropriate Azure SQL tier (Basic, Standard, Premium RS, or Premium)
    and appropriate performance levels.
  id: totrans-213
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 选择合适的 Azure SQL 层级（基本版、标准版、Premium RS 或 Premium）和合适的性能等级。
- en: Choose appropriately between a single database and an elastic database. If there
    are a lot of databases, it is more cost efficient to use elastic databases than
    single databases.
  id: totrans-214
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在单一数据库和弹性数据库之间做出合适选择。如果数据库数量较多，使用弹性数据库比单一数据库更具成本效益。
- en: Re-architect your solution to use PaaS (serverless or microservices with containers)
    solutions instead of IaaS solutions. These PaaS solutions take away maintenance
    costs and are available on a per-minute consumption basis. If you do not consume
    these services, there is no cost, despite your code and services being available
    around the clock.
  id: totrans-215
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将你的解决方案重新架构为使用 PaaS（无服务器或容器化的微服务）解决方案，而不是 IaaS 解决方案。这些 PaaS 解决方案可以消除维护成本，并且按每分钟消费计费。如果你不使用这些服务，即便你的代码和服务全天候可用，也不会产生费用。
- en: There are resource-specific cost optimizations, and it is not possible to cover
    all of them in a single chapter. You are advised to read the documentation related
    to each feature's cost and usage.
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 针对特定资源有成本优化，但无法在一个章节中涵盖所有内容。建议你阅读与每个功能相关的成本和使用文档。
- en: General best practices
  id: totrans-217
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 一般最佳实践
- en: 'So far, we have looked at service-specific best practices, and we will wind
    up this section with some general guidelines:'
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我们已经看过了服务特定的最佳实践，接下来我们将总结一些通用的指导原则：
- en: The cost of resources is different across regions. Try an alternate region,
    provided it's not creating any performance or latency issues.
  id: totrans-219
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 资源的成本在不同地区有所不同。尝试选择另一个区域，前提是它不会造成性能或延迟问题。
- en: EAs offer better discounts than other offers. You can speak to the Microsoft
    Account Team and see what benefits you can get if you sign up to an EA.
  id: totrans-220
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 企业协议（EA）提供的折扣优于其他优惠。你可以联系微软账户团队，了解签署 EA 后你可以获得哪些优惠。
- en: If Azure costs can be pre-paid, then you get discounts for all kinds of subscriptions.
  id: totrans-221
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果 Azure 成本可以预付，那么所有类型的订阅都可以享受折扣。
- en: Delete or remove unused resources. Figure out resources that are underutilized
    and reduce their SKU or size. If they aren't needed, delete them.
  id: totrans-222
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 删除或移除未使用的资源。找出那些使用率低的资源并减少它们的 SKU 或大小。如果不需要，删除它们。
- en: Use Azure Advisor and take its recommendations seriously.
  id: totrans-223
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 Azure Advisor，并认真对待其建议。
- en: As mentioned earlier, these are some generic guidelines and as you architect
    more solutions, you'll be able to create a set of best practices for yourself.
    But to begin with, you can consider these ones. Nevertheless, each component in
    Azure has its own best practices, and referring to the documentation while you
    are architecting will help you to create a cost-effective solution.
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，这些是一些通用的指导原则，随着你架构更多的解决方案，你将能够为自己制定一套最佳实践。但一开始，你可以考虑这些建议。尽管如此，Azure 中的每个组件都有其自身的最佳实践，架构设计时参考文档有助于你创建具有成本效益的解决方案。
- en: Summary
  id: totrans-225
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 总结
- en: In this chapter, we learned the importance of cost management and administration
    when working in a cloud environment. We also covered the various Azure pricing
    options and various price optimization capabilities that Azure offers. Managing
    a project's cost is paramount primarily because the monthly expense could be very
    low but could rise if the resources are not monitored periodically. Cloud architects
    should design their applications in a cost-effective manner. They should use appropriate
    Azure resources, appropriate SKUs, tiers, and sizes, and know when to start, stop,
    scale up, scale out, scale down, scale in, transfer data, and more. Proper cost
    management will ensure that the actual expense meets the budgetary expenses.
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们学习了在云环境中工作时，成本管理和管理的重要性。我们还讨论了各种 Azure 定价选项和 Azure 提供的各种价格优化功能。管理项目的成本至关重要，主要是因为每月的费用可能非常低，但如果没有定期监控资源，费用可能会增加。云架构师应该以成本效益的方式设计他们的应用程序。他们应该使用适当的
    Azure 资源、适当的 SKU、层级和大小，并且知道何时启动、停止、向上扩展、向外扩展、向下扩展、向内扩展、转移数据等。正确的成本管理将确保实际费用符合预算费用。
- en: In the next chapter, we will look at various Azure features related to data
    services, such as Azure SQL, Cosmos DB, and sharding.
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章，我们将介绍与数据服务相关的各种 Azure 功能，例如 Azure SQL、Cosmos DB 和分片。
