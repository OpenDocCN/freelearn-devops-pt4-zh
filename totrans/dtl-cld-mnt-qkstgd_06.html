<html><head></head><body><div id="sbo-rt-content"><div id="_idContainer078">
			<h1 id="_idParaDest-96"><em class="italic"><a id="_idTextAnchor178"/>Chapter 5</em>: Metrics, Events, and Tags</h1>
			<p>In the first part of the book, we discussed general monitoring concepts and how to get started with Datadog, including installing the Agent and navigating the main menu options on the Datadog UI, the main interface available to the end users. In the first chapter, we also discussed metrics as a central concept in all modern monitoring applications, being used to measure the health and the state of software systems. Also, we looked at tags as a means to group and filter metrics data and other information such as events generated by the monitoring systems, especially Datadog.</p>
			<p>In this chapter, we will explore in detail how metrics and tags, two important constructs that Datadog heavily depends on, are implemented. Metrics are the basic entities that are used for reporting monitoring information in Datadog. Datadog also uses tags to organize metrics and other types of monitoring information such as events and alerts. It is important to discuss metrics and tags together as appropriate tagging of metrics is very important to make sense out of the large volume of metrics time series data that will be available in a typical Datadog account.</p>
			<p>While metrics, a central concept in any monitoring system, help to measure the health of a system continuously, an event captures an incident that occurs in a system. The crashing of a process, the restarting of a service, and the reallocation of a container are examples of system events. A metric is measured at a specific time interval and there is a numeric value associated with it, but an event is not periodic in nature and provides only a status. Tagging can be used to organize, group, and search just for events that are used with metrics.</p>
			<p>In this chapter, we will discuss metrics, events, and tags in detail. Specifically, we will cover these topics:</p>
			<ul>
				<li>Understanding metrics in Datadog</li>
				<li>Tagging Datadog resources</li>
				<li>Defining custom metrics</li>
				<li>Monitoring event streams</li>
				<li>Searching events</li>
				<li>Event notifications</li>
				<li>Generating events</li>
				<li>Best practices</li>
			</ul>
			<h1 id="_idParaDest-97"><a id="_idTextAnchor179"/>Technical requirements</h1>
			<p>To try out the examples mentioned in this book, you need to have the following tools and resources:</p>
			<p>- A Datadog account and a user with admin-level access.</p>
			<p>- A Datadog Agent running at host level or as a microservice depending on the example, pointing to the Datadog account.</p>
			<h1 id="_idParaDest-98"><a id="_idTextAnchor180"/>Understanding metrics in Datadog</h1>
			<p>The health of a software system and the infrastructure it is running on are defined by a set of metrics and their threshold values. For example, on the infrastructure side, if the CPU usage on a machine is under <em class="italic">70%</em>, it might be considered healthy for a specific use case. When all <a id="_idIndexMarker307"/>such metrics that are used for monitoring an environment report values in the normal range, the entire environment can be considered healthy. By setting relevant thresholds for these metrics on monitors, issues can be reported as alerts. Datadog provides features to define metrics-based monitors and alerts.</p>
			<p>We saw in <a href="B16483_02_Final_VK_ePub.xhtml#_idTextAnchor115"><em class="italic">Chapter 2</em></a>, <em class="italic">Deploying Datadog Agent</em>, and <a href="B16483_03_Final_VK_ePub.xhtml#_idTextAnchor139"><em class="italic">Chapter 3</em></a>, <em class="italic">Datadog Dashboard</em>, that published metrics can be viewed and filtered using tags in <strong class="bold">Metrics Explorer</strong> in the Datadog UI, as in the following example:</p>
			<ol>
				<li>Navigate to <strong class="bold">Metrics</strong> | <strong class="bold">Metrics Explorer</strong> to bring up the <strong class="bold">Metrics Explorer</strong> window:<div id="_idContainer068" class="IMG---Figure"><img src="Images/Figure_5.1_B16483.jpg" alt="Figure 5.1 – Metrics Explorer&#13;&#10;" width="1650" height="587"/></div><p class="figure-caption">Figure 5.1 – Metrics Explorer</p></li>
				<li>In the <strong class="bold">Graph</strong> field, enter the name of the metric, in this case, <strong class="source-inline">docker.cpu.usage</strong>.</li>
				<li>In the <strong class="bold">Over</strong> field, tags can be used to filter the information. In this case, the value <strong class="source-inline">docker.cpu.usage</strong> makes the most sense for a specific container running on a host, unless you are interested in monitoring the average or total CPU usage by containers on one or more machines.</li>
				<li>By specifying the tags host and <strong class="source-inline">container_name</strong>, you can narrow down the scope to a specific container easily. You can also see that a time series graph is rendered on the right side of the window based on the metrics and filter conditions you selected on the left pane.</li>
			</ol>
			<p>The preceding <a id="_idIndexMarker308"/>example demonstrates how metrics and tags work in tandem to draw insights from a vast cache of time series metrics data published to Datadog. The metrics as implemented in Datadog are far more elaborate than the basic concepts we discussed in <a href="B16483_01_Final_VK_ePub.xhtml#_idTextAnchor014"><em class="italic">Chapter 1</em></a>, <em class="italic">Introduction to Monitoring</em>; let's look at some of the concepts related to metrics as they are defined in Datadog.</p>
			<h2 id="_idParaDest-99"><a id="_idTextAnchor181"/>Metric data</h2>
			<p>A metric data value is a <a id="_idIndexMarker309"/>measure of a metric at a point in time. For example, the <strong class="source-inline">system.memory.free</strong> metric tracks the free memory available on a host. Datadog measures that metric and reports the value periodically, and that value is the metric data value. A series of such measurements will generate a time series data stream, as seen plotted in the example in <em class="italic">Figure 5.1</em>.<a id="_idTextAnchor182"/></p>
			<h2 id="_idParaDest-100"><a id="_idTextAnchor183"/>Flush time interval</h2>
			<p>The Datadog processes <a id="_idIndexMarker310"/>values received for a metric during this time window and processes them based on the metric type<a id="_idTextAnchor184"/>.</p>
			<h2 id="_idParaDest-101"><a id="_idTextAnchor185"/>Metric type</h2>
			<p>The main <a id="_idIndexMarker311"/>metric types are count, rate, and gauge, and they differ in terms of how metric data points are processed to publish as metric values:</p>
			<ul>
				<li><strong class="bold">Count</strong>: The metric <a id="_idIndexMarker312"/>data received during the flush time interval is added up to be returned as a metric value.</li>
				<li><strong class="bold">Rate</strong>: The total <a id="_idIndexMarker313"/>of metric data received during the flush time interval is divided by the number of seconds in the interval to be returned as a metric value.</li>
				<li><strong class="bold">Gauge</strong>: The latest <a id="_idIndexMarker314"/>value received during the flush time interval is returned as the metric <a id="_idTextAnchor186"/>value.</li>
			</ul>
			<h2 id="_idParaDest-102"><a id="_idTextAnchor187"/>Metric unit</h2>
			<p>A metric type is a group of similar measurement units. For example, the bytes group is a type of storage <a id="_idIndexMarker315"/>and memory measurement and it consists of units such as bit, byte, kibibyte, mebibyte, gibibyte, and so on. The time group consists of units from a nanosecond to a week. A full list of metric units is available <a id="_idIndexMarker316"/>in the Datadog documentation (<a href="https://docs.datadoghq.com/developers/metrics/units/">https://docs.datadoghq.com/developers/metrics/units/</a>) for re<a id="_idTextAnchor188"/>ference.</p>
			<h2 id="_idParaDest-103"><a id="_idTextAnchor189"/>Query</h2>
			<p>A query returns values from a time series metric dataset, for the given filter conditions and a time <a id="_idIndexMarker317"/>window. For example, the time series data related to the <strong class="source-inline">system.memory.free</strong> metric will be reported for all the machines where the Datadog Agent runs.</p>
			<p>If you want to monitor the metric only for a specific host during the last one hour, the Datadog-defined <strong class="source-inline">host</strong> tag can be used to narrow down the machine to a specific host, and you can also specify a time range. The ways to specify the query parameters would depend on the interface that you would use to run the query. For example, you have seen how a query works in the <strong class="bold">Metrics Explorer</strong> window on the Datadog dashboard where those parameters are specified visually.</p>
			<p>Datadog identifies the following parts in a query:</p>
			<ul>
				<li><strong class="bold">Scope</strong>: By specifying the appropriate tags, the results of a query can be narrowed down. In the last example, the <strong class="source-inline">host</strong> tag set the scope to a single host.</li>
				<li><strong class="bold">Grouping</strong>: A metric such as <strong class="source-inline">system.disk.free</strong> would have more than one time series dataset for the same host, as one would be generated for each disk, and typically there would be multiple disks on a host. Assume that you are interested in monitoring the total disk space available on all the web hosts. If those hosts are tagged as web hosts using a custom tag such as <strong class="source-inline">host_type</strong> having the value <strong class="source-inline">web</strong>, then it could be used to set the scope and the <strong class="source-inline">host</strong> tag could be used for grouping.</li>
				<li><strong class="bold">Time aggregation and rollup</strong>: To display the data returned by a query, the data points are aggregated to accommodate them. Datadog returns about 150 data points for a time window. If the time window is large, the data points are aggregated into <a id="_idIndexMarker318"/>time buckets and that process is called rollup. The metrics that are available in Datadog out of the box are generated by integrations that are activated as part of installing the Datadog Agent. The main integrations in this category that provide metrics for infrastructure monitoring are the following:<p>A. <strong class="bold">System</strong>: Generates CPU-, load-, memory-, swap-, IO-, and uptime-related metrics, identified by the patterns such as <strong class="source-inline">system.cpu.*</strong>, <strong class="source-inline">system.load.*</strong>, and <strong class="source-inline">system.mem.*</strong></p><p>B. <strong class="bold">Disk</strong>: Generates disk storage-related metrics, identified by <strong class="source-inline">system.disk.*</strong></p><p>C. <strong class="bold">Directory</strong>: Generates directory- and files-related metrics, identified by the <strong class="source-inline">system.disk.directory.*</strong> pattern</p><p>D. <strong class="bold">Process</strong>: Generates process-specific compute metrics, identified by the <strong class="source-inline">system.processes.*</strong> pattern</p></li>
			</ul>
			<p>The <strong class="bold">integration</strong> pages on the Datadog UI provide a complete list of metrics available through these integrations. The metadata associated with a metric can be viewed and some of the settings can be edited in the <strong class="bold">Metrics Summary</strong> window:</p>
			<ul>
				<li>Navigate to <strong class="bold">Metrics</strong> | <strong class="bold">Metrics Summary</strong>, where all the metrics are listed. A specific metric can be searched using its name or tags associated with it. Look at the following screenshot for the example of searching for Redis metrics:</li>
			</ul>
			<div>
				<div id="_idContainer069" class="IMG---Figure">
					<img src="Images/Figure_5.2_B16483.jpg" alt="Figure 5.2 – Searching for Redis metrics in the Metrics Summary interface&#13;&#10;" width="1650" height="1202"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.2 – Searching for Redis metrics in the Metrics Summary interface</p>
			<ul>
				<li>The metadata <a id="_idIndexMarker319"/>of a specific metric can be viewed by clicking on any metric of interest. In the following screenshot, the summary of the <strong class="source-inline">redis.mem.used</strong> metric is provided:</li>
			</ul>
			<div>
				<div id="_idContainer070" class="IMG---Figure">
					<img src="Images/Figure_5.3_B16483.jpg" alt="Figure 5.3 – Summary of the redis.mem.used metric&#13;&#10;" width="1650" height="1036"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.3 – Summary of the redis.mem.used metric</p>
			<p>Using the <strong class="bold">Edit</strong> button on this window, the description and flush time interval of the metric can <a id="_idIndexMarker320"/>be changed. It also provides the source hosts and the tags available for filtering. In this section, we have seen how the ideas of metrics are implemented in Datadog in general and how they can be viewed on the dashboard in different ways. In the next section, we will discuss tags, a construct that is used with metrics and other <a id="_idTextAnchor190"/>resources.</p>
			<h1 id="_idParaDest-104"><a id="_idTextAnchor191"/>Tagging Datadog resources</h1>
			<p>In the previous sections of this chapter, we have touched upon the concept of tags as a means of <a id="_idIndexMarker321"/>grouping and filtering metrics. While the use of tags is similar to that of keywords, labels, or hashtags on other systems, it is important to learn how tags are applied to metrics. Tags can be applied to other Datadog resources such as events and monitors as well. However, we will focus on how they are applied and used while working with metrics in the followi<a id="_idTextAnchor192"/>ng section.</p>
			<h2 id="_idParaDest-105"><a id="_idTextAnchor193"/>Defining tags</h2>
			<p>The following <a id="_idIndexMarker322"/>are the main rules and best practices for defining a tag:</p>
			<ul>
				<li>A tag should start with a letter and can contain the following characters: alphanumeric, underscores, minuses, colons, periods, and slashes.</li>
				<li>A tag should be in lowercase letters. If uppercase letters are used, they will be converted into lowercase. The auto-conversion of the case can create confusion, and so it is advisable to define tags only in lowercase.</li>
				<li>A tag can be up to 200 characters long.</li>
				<li>The common pattern of a tag is in <strong class="source-inline">&lt;KEY&gt;:&lt;VALUE&gt;</strong> format, which prepares a tag to be used in different parts of a query as we saw earlier. There are reserved keywords for tags, such as <strong class="source-inline">host</strong>, <strong class="source-inline">process</strong>, and <strong class="source-inline">env</strong>, that Datadog associates special meanings with, and their use should be in line with the relat<a id="_idTextAnchor194"/>ed meanings.</li>
			</ul>
			<h2 id="_idParaDest-106"><a id="_idTextAnchor195"/>Tagging methods</h2>
			<p>Datadog offers <a id="_idIndexMarker323"/>multiple ways to tag metrics. However, the following two methods are the most common:</p>
			<ul>
				<li>From the Datadog Agent configuration file</li>
				<li>From the configuration files of integrations</li>
			</ul>
			<p>Both of these methods are done at the Datadog Agent level. The tagging can also be done from the Datadog UI, using the Datadog API, and as part of DogStatsD integration.</p>
			<p>In the Datadog Agent config file, <strong class="source-inline">datadog.yml</strong>, the config item tags can be used to add tags as follows:</p>
			<p class="source-code">tags: ["KEY1:VALUE1", "KEY2:VALUE2"]</p>
			<p>Here's an alternative way:</p>
			<p class="source-code">tags:</p>
			<p class="source-code">    - "KEY1:VALUE1"</p>
			<p class="source-code">    - "KEY2:VALUE2"</p>
			<p>The latter <a id="_idIndexMarker324"/>syntax is preferred in configuration files for better<a id="_idTextAnchor196"/> readability.</p>
			<h2 id="_idParaDest-107"><a id="_idTextAnchor197"/>Customizing host tag</h2>
			<p>We have come across the use of the system-defined <strong class="source-inline">host</strong> tag already, which is very useful in <a id="_idIndexMarker325"/>filtering the metrics data. It is set by default based on the host name of the machine where the Datadog Agent runs, but it can be customized by setting the <strong class="source-inline">hostname</strong> config item <a id="_idTextAnchor198"/>in <strong class="source-inline">datadog.yml</strong>.</p>
			<h2 id="_idParaDest-108"><a id="_idTextAnchor199"/>Tagging integration metrics</h2>
			<p>An integration <a id="_idIndexMarker326"/>generates a published list of metrics and those could be tagged by configuring the <strong class="source-inline">tags</strong> config item for the integration:</p>
			<p class="source-code">tags:</p>
			<p class="source-code">    - "KEY1:VALUE1"</p>
			<p class="source-code">    - "KEY2:VALUE2"</p>
			<p>For example, for the Redis integration, this change is done in <strong class="source-inline">/etc/datadog-agent/conf.d/redisdb.d/config.yaml</strong>.</p>
			<p>In addition to tags applied from the configuration files, some integrations also supply tags by inheriting them from the source applications and platforms. The best example is the extraction of AWS tags by Datadog integrations for related<a id="_idTextAnchor200"/> AWS services.  </p>
			<h2 id="_idParaDest-109"><a id="_idTextAnchor201"/>Tags from microservices</h2>
			<p>If the Datadog Agent is deployed in a containerized environment, tags from related applications <a id="_idIndexMarker327"/>such as Docker and Kubernetes are collected automatically. More tags can be extracted by setting the following environment variables:</p>
			<ul>
				<li><strong class="source-inline">DD_TAGS</strong>: Host-level tags can be set using this environment variable.</li>
				<li><strong class="source-inline">DD_DOCKER_LABELS_AS_TAGS</strong>: To publish Docker labels as tags.</li>
				<li><strong class="source-inline">DD_DOCKER_ENV_AS_TAGS</strong>: To publish <a id="_idIndexMarker328"/>Docker environment variables as tags.</li>
				<li><strong class="source-inline">DD_KUBERNETES_POD_LABELS_AS_TAGS</strong>: To publish p<a id="_idTextAnchor202"/>od labels as tags.</li>
			</ul>
			<h2 id="_idParaDest-110"><a id="_idTextAnchor203"/>Filtering using tags</h2>
			<p>In a Datadog account, times series data for one metric can originate from multiple sources. For example, there can be multiple time series data streams for the <strong class="source-inline">system.disk.free</strong> metric <a id="_idIndexMarker329"/>from just one host, as that data series is generated for each disk on a host. Therefore, data may have to be grouped in ways that make sense in most situations, and we have already seen how tags are used in <strong class="bold">Metrics Explorer</strong> and queries to filter data and extract logical groups of metrics data.</p>
			<p>The use of tagging goes beyond just filtering metrics. The tags could also be applied to other Datadog resources for filtering and grouping, as is done with metrics data. The following are the main Datadog resources that could be tagged:</p>
			<ul>
				<li>Events</li>
				<li>Dashboards</li>
				<li>Infrastructure: mainly hosts, containers and processes</li>
				<li>Monitors</li>
			</ul>
			<p>The use of tags in Datadog is widespread, and the preceding list covers only the important resources. When the count of a specific resource type such as events is very large, it's impossible to trace a specific instance without the help of a tag. For example, the events associated with a specific type of host could be pulled by tagging those events suitably.</p>
			<p>Wherever there is a need to look for a subset of information, tags are used as the keywords to search for related resources and metrics data. That means the monitoring data that has been published to Datadog must be tagged well so that subsets of that data can be extracted easily.</p>
			<p>Datadog and <a id="_idIndexMarker330"/>the various third-party product integrations it provides generate the bulk of the metrics that we use in real life. In the next section, we will discuss custom metrics and how they can be p<a id="_idTextAnchor204"/>ublished to Datadog.</p>
			<h1 id="_idParaDest-111"><a id="_idTextAnchor205"/>Defining custom metrics</h1>
			<p>You have <a id="_idIndexMarker331"/>already seen that metrics are defined, and the related times series data is generated, by these methods: </p>
			<ul>
				<li>By enabling core infrastructure integrations with the installation of the Datadog Agent</li>
				<li>By enabling platform and application integrations provided by Datadog</li>
			</ul>
			<p>Custom tags can be associated with the preceding set of metrics by defining them in the relevant configuration files. Some integrations also offer to inherit tags from source applications and platforms.</p>
			<p>In addition to this group of metrics that are available out of the box or that can be enabled easily, there are multiple options available in Datadog to define custom metrics and tags. This is one of the features that makes Datadog a powerful monitoring platform that can be fine-tuned for your specific requirements.</p>
			<p>The following <a id="_idIndexMarker332"/>properties need to be set for a custom metric:</p>
			<ul>
				<li><strong class="bold">Name</strong>: A name should not be more than 200 characters long, should begin with a letter, and should contain only alphanumeric characters, underscores, and periods. Unlike tags, metric names are case-sensitive.</li>
				<li><strong class="bold">Value and timestamp</strong>: The metric value is published with a timestamp.</li>
				<li><strong class="bold">Metric type</strong>: As discussed earlier, the main types are count, rate, and gauge.</li>
				<li><strong class="bold">Interval</strong>: This sets the flush time interval for the metric.</li>
				<li><strong class="bold">Tags</strong>: The tags specifically set for this metric.</li>
			</ul>
			<p>There are multiple ways to submit custom metrics:</p>
			<ul>
				<li><strong class="bold">Datadog Agent checks</strong>: The Datadog Agent can be configured to run custom scripts <a id="_idIndexMarker333"/>as checks, and that interface can be leveraged to publish custom metrics. We will learn more about implementing custom checks in <a href="B16483_08_Final_VK_ePub.xhtml#_idTextAnchor248"><em class="italic">Chapter 8</em></a>, <em class="italic">Integrating with Platform Components</em>.</li>
				<li><strong class="bold">Datadog REST API</strong>: Datadog resources can be viewed, created, and managed using the <a id="_idIndexMarker334"/>REST API Datadog provides. The custom metrics and tags can be handled that way as well. This is mainly useful when Datadog is not running close to a software system that needs to be monitored using Datadog. We will learn how to use the Datadog REST API in <a href="B16483_09_Final_VK_ePub.xhtml#_idTextAnchor261"><em class="italic">Chapter 9</em></a>, <em class="italic">Using the Datadog REST API</em>.</li>
				<li><strong class="bold">DogStatsD</strong>: This is <a id="_idIndexMarker335"/>a Datadog implementation of the StatsD interface available for publishing monitoring metrics. We will discuss this more in <a href="B16483_10_Final_VK_ePub.xhtml#_idTextAnchor302"><em class="italic">Chapter 10</em></a>, <em class="italic">Working with Monitoring Standards</em>.</li>
				<li><strong class="bold">PowerShell</strong>: This provides <a id="_idIndexMarker336"/>an option to submit metrics from Microsoft platforms.</li>
			</ul>
			<p>The Datadog UI has a dashboard for the event stream, and we will see how the events are listed on it and what event details are published. In a large-scale environment, the event stream <a id="_idIndexMarker337"/>volume can be quite large, and you may have to search for events of interest. While events are largely informational, it might make sense to be notified about certain categories of events, such as the stopping of an important service. Events are usually generated by Datadog, but Datadog also offers the feature to generate custom events as an integration option.</p>
			<p>Let's see how Datadog handles events out of the box using its event stream dashboard.</p>
			<h1 id="_idParaDest-112"><a id="_idTextAnchor206"/>Monitoring event streams</h1>
			<p>The events <a id="_idIndexMarker338"/>generated by Datadog or posted by applications provide a log of activities happening in the application system in general, especially at the infrastructure and system level, such as one-off issues with a host or a service restarting. On the Datadog UI, the even stream dashboard lists the latest events and can be viewed as follows.</p>
			<p>Click on the <strong class="bold">Events</strong> menu and pick a time window in the <strong class="bold">Show</strong> field to view the events for a specific time period. The event stream dashboard would look as follows:</p>
			<div>
				<div id="_idContainer071" class="IMG---Figure">
					<img src="Images/Figure_5.4_B16483.jpg" alt="Figure 5.4 – Event stream dashboard&#13;&#10;" width="624" height="323"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.4 – Event stream dashboard</p>
			<p>The events <a id="_idIndexMarker339"/>listed on the event stream are classified and can be filtered on the dashboard as follows:</p>
			<ul>
				<li><strong class="bold">By source</strong>: On the left pane of the dashboard, the <strong class="bold">FROM</strong> section lists the sources of the events.</li>
				<li><strong class="bold">By Priority</strong>: On the left pane of the dashboard, the <strong class="bold">PRIORITY</strong> section lists the priorities.</li>
				<li><strong class="bold">By Severity</strong>: On the left pane of the dashboard, the <strong class="bold">STATUS</strong><em class="italic"> </em>section lists the severity of the events.</li>
			</ul>
			<p>By selecting one or more event types described here, the events listed on the event stream dashboard can be filtered to see the specific ones you need to look at. The related events are aggregated if the <strong class="bold">Aggregate related events</strong> option is checked on the dashboard as in the following screenshot:</p>
			<div>
				<div id="_idContainer072" class="IMG---Figure">
					<img src="Images/Figure_5.5_B16483.jpg" alt="Figure 5.5 – The Aggregate related events option on the event stream dashboard&#13;&#10;" width="1650" height="298"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.5 – The Aggregate related events option on the event stream dashboard</p>
			<p>In the next <a id="_idIndexMarker340"/>section, we will see how specific events can be located on the event stream dashboard.</p>
			<h1 id="_idParaDest-113"><a id="_idTextAnchor207"/>Searching events</h1>
			<p>In a large-scale environment where the Datadog Agent runs on several hundred hosts monitoring a variety of microservices and applications running on them, there will be scores of events <a id="_idIndexMarker341"/>published to the event stream dashboard every minute. In such a situation, manually looking through the event stream is not viable, and standard search methods have to be used to locate events of interest. Datadog provides multiple options for searching and filtering to get the correct set of events.</p>
			<p>As we have seen in the previous section, you can specify a time window in the <strong class="bold">Show</strong> field to look at events only from a specific time period. As shown in the following screenshot, the time window can be specified in a variety of ways:</p>
			<div>
				<div id="_idContainer073" class="IMG---Figure">
					<img src="Images/Figure_5.6_B16483.jpg" alt="Figure 5.6 – Time window options to filter events&#13;&#10;" width="514" height="187"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.6 – Time window options to filter events</p>
			<p>The time can be specified as follows:</p>
			<ul>
				<li>By selecting fixed buckets of minutes, hours, or days in the past.</li>
				<li>By entering custom time windows as shown in the screenshot; a Unix timestamp can be used with this option.</li>
			</ul>
			<p>There is a full text search option available, which you can use to look for events using keywords. In the following example, the <strong class="source-inline">ntp</strong> keyword is used to list only the related events:</p>
			<div>
				<div id="_idContainer074" class="IMG---Figure">
					<img src="Images/Figure_5.7_B16483.jpg" alt="Figure 5.7 – Searching events using a keyword&#13;&#10;" width="1650" height="907"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.7 – Searching events using a keyword</p>
			<p>A keyword search <a id="_idIndexMarker342"/>can be saved for future use. Click on the downward arrow in the keyword search field to view the save option, as shown in the following screenshot:</p>
			<div>
				<div id="_idContainer075" class="IMG---Figure">
					<img src="Images/Figure_5.8_B16483.jpg" alt="Figure 5.8 – Saving a keyword search of events&#13;&#10;" width="647" height="96"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.8 – Saving a keyword search of events</p>
			<p>While the last example does a simple, full text search, the Datadog query language can be used to do more complex searches, and some of the important constructs that you can use are the following:</p>
			<ul>
				<li><strong class="bold">Filters</strong>: In the previous section, we saw that the event sources are listed under the <strong class="bold">FROM</strong> section <a id="_idIndexMarker343"/>on the dashboard. They could be specified using this query format.<p><strong class="source-inline">sources</strong>:<strong class="source-inline">&lt;source_name_1&gt;</strong>, <strong class="source-inline">&lt;source_name_2&gt;</strong>: In this case, the search will be run for events from <strong class="source-inline">source_name_1</strong> or <strong class="source-inline">source_name_2</strong>.</p><p>Similarly, you can specify tags, hosts, status (error, warning, or success), and priority (low or normal) as the filters in the query.</p></li>
				<li><strong class="bold">Boolean operators</strong>: The <strong class="source-inline">OR</strong>, <strong class="source-inline">AND</strong>, and <strong class="source-inline">NOT</strong> Boolean operators can be used to combine <a id="_idIndexMarker344"/>basic search conditions. See the following examples:<p><strong class="source-inline">ntp</strong> <strong class="source-inline">OR</strong> <strong class="source-inline">nagios</strong> will search for either one of the <strong class="source-inline">ntp</strong> and <strong class="source-inline">nagios</strong> keywords.</p><p><strong class="source-inline">tags:region:us-west-2 AND environment:production</strong> will look for events tagged with the key values <strong class="source-inline">region:us-west-2</strong> and <strong class="source-inline">environment:production</strong>.</p><p><strong class="source-inline">* NOT "ntp"</strong> will list all the events that do not contain the <strong class="source-inline">ntp</strong> keyword.</p></li>
			</ul>
			<p>Now let's see how we can get notified of events.</p>
			<h1 id="_idParaDest-114"><a id="_idTextAnchor208"/>Notifications for events </h1>
			<p>The normal way to monitor events is to search using the event stream dashboard if some issue <a id="_idIndexMarker345"/>occurs in the infrastructure or application system, looking for some clues as to the root cause. Events are not very useful in terms of proactive monitoring because you get to know about the issue only after the issue happens. However, notifying others about some of the events might be useful. Also, filing a support ticket based on an event is possible, by notifying the Datadog support.</p>
			<p>Use the <strong class="bold">Add comment</strong> link available with the event to send a notification as in the following example:</p>
			<div>
				<div id="_idContainer076" class="IMG---Figure">
					<img src="Images/Figure_5.9_B16483.jpg" alt="Figure 5.9 – Notifications for events&#13;&#10;" width="1650" height="857"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.9 – Notifications for events</p>
			<p>As you can see, an event notification can be sent to individual emails, <strong class="bold">all</strong>, and <strong class="bold">Datadog Support</strong>. All the Datadog users in the organization will be notified of the event if <strong class="bold">all</strong> is chosen. A support <a id="_idIndexMarker346"/>ticket will be created if <strong class="bold">Datadog Support</strong> is selected.</p>
			<p>The event stream is integrated with the following integrations, using which the event details can be forwarded to the related tools:</p>
			<ul>
				<li><strong class="bold">Slack</strong>: Post a <a id="_idIndexMarker347"/>notification to a <strong class="bold">Slack</strong> channel by specifying the address in this format: <strong class="source-inline">@slack-&lt;slack_account&gt;-&lt;slack-channel&gt;</strong>.</li>
				<li><strong class="bold">Webhook</strong>: Send a <a id="_idIndexMarker348"/>notification to a <strong class="bold">webhook</strong> by just specifying <strong class="source-inline">@webhook_name</strong>. (<strong class="source-inline">webhook_name</strong> must be configured in Datadog for this to work, and we will see how to do this in <a href="B16483_09_Final_VK_ePub.xhtml#_idTextAnchor261"><em class="italic">Chapter 9</em></a>, <em class="italic">Using the Datadog REST API</em>.)</li>
				<li><strong class="bold">Pagerduty</strong>: By specifying <strong class="source-inline">@pagerduty</strong>, the event <a id="_idIndexMarker349"/>details can be forwarded as an alert to <strong class="bold">PagerDuty</strong>.</li>
			</ul>
			<p>In the next section, we will see how custom events are created and added to the event stream.</p>
			<h1 id="_idParaDest-115"><a id="_idTextAnchor209"/>Generating events</h1>
			<p>Thus far, we have <a id="_idIndexMarker350"/>discussed how to view, search, and escalate events that are generated by Datadog. As with metrics and tags, custom events can be created as well in Datadog. The primary use of this feature is to use the event stream dashboard as <a id="_idIndexMarker351"/>a communication hub for <strong class="bold">Site Reliability Engineering</strong> (<strong class="bold">SRE</strong>) and production engineering teams.</p>
			<p>A common scenario is deploying to an environment monitored by Datadog. During deployment, multiple services and processes will be restarted, and there will be a large volume of events. Posting a deployment as an event with details might help to alleviate the concerns of any other teams monitoring the environment but not actively participating in the deployment process.</p>
			<p>An event can <a id="_idIndexMarker352"/>be posted from the event stream dashboard as a status update. Look at the following example:</p>
			<div>
				<div id="_idContainer077" class="IMG---Figure">
					<img src="Images/Figure_5.10_B16483.jpg" alt="Figure 5.10 – Posting a custom event&#13;&#10;" width="1650" height="494"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.10 – Posting a custom event</p>
			<p>As with creating and managing other Datadog resources, events can be generated programmatically using the Datadog API. This enables standalone programs to post into the event stream. In the previous example, the status update was posted directly on the event stream dashboard. In a more automated environment, the deployment orchestration process, a <strong class="bold">Jenkins job</strong>, or an <strong class="bold">Ansible playbook</strong> could do the same using the API.</p>
			<p>The API to post an event is at <a href="https://api.datadoghq.com/api/v1/events">https://api.datadoghq.com/api/v1/events</a>, and the main attributes in its payload are the following:</p>
			<ul>
				<li><strong class="source-inline">alert_type</strong>: Values can be <strong class="source-inline">error</strong>, <strong class="source-inline">warning</strong>, <strong class="source-inline">info</strong>, or <strong class="source-inline">success</strong>.</li>
				<li><strong class="source-inline">priority</strong>: Values can be <strong class="source-inline">normal</strong> or <strong class="source-inline">low</strong>.</li>
				<li><strong class="source-inline">source_type_name</strong>: The list of sources is available at <a href="https://docs.datadoghq.com/integrations/faq/list-of-api-source-attribute-value/">https://docs.datadoghq.com/integrations/faq/list-of-api-source-attribute-value/</a>.</li>
				<li><strong class="source-inline">tags</strong>: Tags applied to the event for filtering and grouping.</li>
				<li><strong class="source-inline">text</strong>: Body of the event.</li>
				<li><strong class="source-inline">title</strong>: Title of the event.</li>
			</ul>
			<p>We will learn <a id="_idIndexMarker353"/>how to use the Datadog API in detail in <a href="B16483_09_Final_VK_ePub.xhtml#_idTextAnchor261"><em class="italic">Chapter 9</em></a>, <em class="italic">Using the Datadog REST API</em>. Posting an event to the event stream using the Datadog API will be done there as an example.</p>
			<p>Now, let's look at the best practices around defining and using <a id="_idTextAnchor210"/>metrics, events, and tags in Datadog.</p>
			<h1 id="_idParaDest-116"><a id="_idTextAnchor211"/>Best practices</h1>
			<p>The following are the best practices related to creating and maintaining metrics and tags:</p>
			<ul>
				<li>Make sure that all the tags available through various integrations are enabled. This mainly involves inheriting tags from source platforms such as public cloud services, Docker, and Kubernetes. When complex applications are part of your environment, it is better to have more tags to improve traceability.</li>
				<li>Add more tags from the Datadog Agent and integrations to partition your metrics data easily and to track the environment, services, and owners efficiently.</li>
				<li>Have a namespace schema for your custom metrics using periods so that they can be grouped and located easily – for example, <strong class="source-inline">mycompany.app1.role1.*</strong>.</li>
				<li>Format the names and values of metrics and tags according to the guidelines. Datadog silently makes changes to names and values if their format is not compliant. Such altered names could cause confusion on the ground as they will be different from the expected values.</li>
				<li>If some incident happens and not much information is available immediately from monitoring alerts, query the event stream for clues.</li>
				<li>Post custom messages from the dashboard that might help with some ongoing activity, such as a deployment, especially if you operate in a distributed team environment.</li>
				<li>Consider posting events to the event stream from automation processes if they will have some impact on the resources that Datadog monitors.</li>
				<li>Use the notification option to raise tickets with Datadog Support if an<a id="_idTextAnchor212"/> event warrants any digging by them.</li>
			</ul>
			<h1 id="_idParaDest-117"><a id="_idTextAnchor213"/>Summary</h1>
			<p>Metrics are central to a modern monitoring system and Datadog is no exception. Datadog offers a rich set of options to generate and use metrics. Though tags have general-purpose uses across all Datadog resources, their main use is to group and filter massive amounts of metrics data.</p>
			<p>In this chapter, we learned how metrics and tags are defined and how metrics and other resources are grouped and searched for using tags. Besides Datadog-defined metrics and tags, there are multiple ways to add custom metrics and tags, and some of those methods were discussed in this chapter.</p>
			<p>An event is an activity in the infrastructure or in the application system that Datadog monitors. Datadog captures and lists such events on the event stream dashboard. Events can be searched for in multiple ways, including by using keywords and tags. Events can be forwarded to different channels such as email, Slack, and PagerDuty.</p>
			<p>In the next chapter, we will see how monitoring events are managed in Datadog. We will also learn how they are searched for and how custom events can be published. </p>
		</div>
	</div></body></html>