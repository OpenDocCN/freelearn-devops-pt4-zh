- en: '*Chapter 7*: Monitors and Alerts'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '*第7章*：监控和警报'
- en: In the last chapter, we learned how infrastructure is monitored using Datadog.
    The modern, cloud-based infrastructure is far more complex and virtual than the
    data center-based, bare-metal compute, storage, and network infrastructure. Datadog
    is designed to work with cloud-centric infrastructure, and it meets most of the
    infrastructure monitoring needs out of the box, be it a bare-metal or public cloud-based
    infrastructure.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一章中，我们学习了如何使用 Datadog 监控基础设施。现代的基于云的基础设施比基于数据中心的裸机计算、存储和网络基础设施更加复杂和虚拟。Datadog
    旨在与以云为中心的基础设施一起工作，并且能够满足大多数基础设施监控需求，无论是裸机还是公有云基础设施。
- en: A core requirement of any monitoring application is to notify you about an ongoing
    issue. Ideally, before that issue results in a service outage. In previous chapters,
    we discussed metrics and how they are generated, viewed, and charted on dashboards.
    An important use of metrics is to predict an upcoming issue. For example, by tracking
    the `system.disk.free` metric on a storage device, it is easy to notify when it
    reaches a certain point. By combining the `system.disk.total` metric to that equation,
    it's also possible to track the available storage as a percentage.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 任何监控应用程序的核心需求之一是通知你正在发生的问题。理想情况下，应该在问题导致服务中断之前就被通知。在之前的章节中，我们讨论了度量标准以及它们如何生成、查看和在仪表盘上绘制。度量标准的一个重要用途是预测即将发生的问题。例如，通过跟踪存储设备上的`system.disk.free`度量标准，可以轻松在它达到某个阈值时发出通知。将`system.disk.total`度量标准结合到这个公式中，还可以按百分比跟踪可用存储。
- en: A monitor typically tracks a time-series value of a metric, and it sends out
    a notification when the metric value is abnormal with reference to a threshold
    during a specified time window. The notification that it sends out is called a
    warning or alert notification. Such notifications are commonly referred to as
    alerts. Thresholds for warning and critical statuses are set on the monitor. For
    example, from the disk storage metrics mentioned earlier, the percentage of free
    storage available can be calculated. The warning threshold could be set at 30
    percent and the critical threshold could be set at 20 percent.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 监控通常跟踪度量标准的时间序列值，当度量标准值在指定时间窗口内超出阈值时，会发送通知。它发送的通知称为警告或警报通知。这些通知通常被称为警报。警告和严重状态的阈值在监控中设置。例如，从之前提到的磁盘存储度量标准中，可以计算出可用存储的百分比。警告阈值可以设置为30%，而严重阈值可以设置为20%。
- en: 'In this chapter, we will learn about monitors and alerts and how they are implemented
    in Datadog, in detail. Specifically, we will cover the following topics:'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 本章中，我们将详细学习监控和警报以及它们在 Datadog 中的实现方式。具体来说，我们将覆盖以下主题：
- en: Setting up monitors
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置监控
- en: Managing monitors
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 管理监控
- en: Distributing notifications
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 分发通知
- en: Configuring downtime
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置停机时间
- en: Technical requirements
  id: totrans-9
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: 'To try out the examples mentioned in this book, you need to have the following
    tools installed and resources available:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 为了尝试本书中提到的示例，你需要安装以下工具并准备好相关资源：
- en: A Datadog account and a user with admin-level access.
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个 Datadog 账户和一个具有管理员权限的用户。
- en: A Datadog Agent running at host level or as a microservice depending on the
    example, pointing to the Datadog account.
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 根据示例，Datadog Agent 在主机级别运行或作为微服务，指向 Datadog 账户。
- en: Setting up monitors
  id: totrans-13
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置监控
- en: 'In a generic monitoring system, a monitor is usually tied to metrics or events,
    and Datadog covers these and much more. There are multiple monitor types based
    on the data sources defined in Datadog. Some of the most important ones include
    the following:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 在通用的监控系统中，监控通常与度量标准或事件相关联，Datadog 覆盖了这些以及更多内容。根据 Datadog 中定义的数据源，有多种监控类型。以下是一些最重要的类型：
- en: '**Metric**: As mentioned at the beginning of this chapter, metrics are the
    most common type of information used to build monitors. A metric type monitor
    is based on the user-defined thresholds set for the metric value.'
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**度量标准**：如本章开始时提到的，度量标准是用于构建监控的最常见信息类型。度量标准类型的监控基于为度量值设置的用户定义阈值。'
- en: '**Event**: This monitors the system events tracked by Datadog.'
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**事件**：监控 Datadog 跟踪的系统事件。'
- en: '**Host**: This checks whether the Datadog agent on the host reports into the
    Datadog **Software as a Service** (**SaaS**) backend.'
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**主机**：检查主机上的 Datadog 代理是否已报告到 Datadog **软件即服务** (**SaaS**) 后端。'
- en: '**Live process**: This monitors whether a set of processes at the operating
    system level are running on one or a group of hosts.'
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**实时进程**：此监控器检查操作系统级别的一组进程是否在一个或一组主机上运行。'
- en: '**Process check**: This monitors whether a process tracked by Datadog is running
    on one or a group of hosts.'
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**进程检查**：此监控器检查 Datadog 跟踪的进程是否在一个或一组主机上运行。'
- en: '**Network**: These monitors check on the status of the TCP/HTTP endpoints.'
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**网络**：这些监控器检查 TCP/HTTP 端点的状态。'
- en: '**Custom check**: These monitors are based on the custom checks run by the
    Datadog agent.'
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**自定义检查**：这些监控器基于 Datadog 代理运行的自定义检查。'
- en: Now, we will look at how monitors of these types are created and what sort of
    instrumentation needs to be done to support them on the Datadog agent side.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们将了解这些类型的监控器是如何创建的，以及需要在 Datadog 代理端支持它们的什么样的仪器设置。
- en: 'To create a new monitor, on the Datadog dashboard, navigate to **Monitors**
    | **New Monitor**, as shown in the following screenshot:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 要创建一个新的监控器，在 Datadog 仪表盘中，导航到 **Monitors** | **New Monitor**，如以下截图所示：
- en: '![Figure 7.1 – The New Monitor menu item'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 7.1 – 新监控器菜单项'
- en: '](img/Figure_7.1_B16483.jpg)'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_7.1_B16483.jpg)'
- en: Figure 7.1 – The New Monitor menu item
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.1 – 新监控器菜单项
- en: 'It will provide the option to select the monitor type, as shown in *Figure
    7.2*. In this example, we will create a metric type monitor:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 它会提供选择监控器类型的选项，如 *图 7.2* 所示。在此示例中，我们将创建一个度量类型的监控器：
- en: '![Figure 7.2 – Choosing a metric type monitor'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 7.2 – 选择度量类型的监控器'
- en: '](img/Figure_7.2_B16483.jpg)'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_7.2_B16483.jpg)'
- en: Figure 7.2 – Choosing a metric type monitor
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.2 – 选择度量类型的监控器
- en: 'By clicking on this option, you will get to an elaborate form where all the
    information needed for the monitor will be provided to create it. As there are
    several options available when setting up a monitor, this form is rather long.
    We will view it in the following screenshots:'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 单击此选项后，您将进入一个详细的表单，其中提供创建监控器所需的所有信息。由于设置监控器时有多个选项可用，因此此表单相当长。我们将在接下来的截图中查看它：
- en: '![Figure 7.3 – The New Monitor form – selecting the detection method and metric'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 7.3 – 新监控器表单 – 选择检测方法和度量标准'
- en: '](img/Figure_7.3_B16483.jpg)'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_7.3_B16483.jpg)'
- en: Figure 7.3 – The New Monitor form – selecting the detection method and metric
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.3 – 新监控器表单 – 选择检测方法和度量标准
- en: The first step is to select the detection method. In this example, as shown
    in *Figure 7.3*, the detection method is selected as **Threshold Alert**. This
    is the usual detection method in which the metric value is compared with a static
    threshold value to trigger an alert.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 第一步是选择检测方法。如 *图 7.3* 所示，选择了 **阈值告警** 作为检测方法。这是常用的检测方法，其中度量值与静态阈值进行比较，从而触发告警。
- en: 'The following list highlights other detection methods that are available:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 以下列表突出了其他可用的检测方法：
- en: '**Change Alert**: This compares the current metric value with a past value
    in the time series.'
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**变更告警**：此方法将当前的度量值与时间序列中的过去值进行比较。'
- en: '**Anomaly Detection**: This detects any abnormality in the metric time series
    data based on past behavior.'
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**异常检测**：此方法根据过去的行为检测度量时间序列数据中的任何异常。'
- en: '**Outliers Alert**: This alerts you about the unusual behavior of a member
    in a group. For example, increased usage of memory on a specific host in a cluster
    of hosts grouped by a tag.'
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**异常值告警**：当组内某成员的行为异常时会触发告警。例如，集群中特定主机的内存使用量增加。'
- en: '**Forecast Alert**: This is similar to a threshold alert; however, a forecasted
    metric value is compared with the static threshold.'
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**预测告警**：这与阈值告警类似；然而，预测的度量值与静态阈值进行比较。'
- en: The selection of the monitor type is important, as the behavior and use of a
    monitor largely depend on the type of monitor.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 选择监控器类型非常重要，因为监控器的行为和使用在很大程度上取决于监控器的类型。
- en: Important note
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 重要说明
- en: Note that only the threshold alert is a standard method that you can find in
    other monitoring systems; the rest of them are Datadog-specific. Usually, some
    customization will be needed to implement these detection methods in a generic
    monitoring system, which Datadog supports out of the box.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，只有阈值告警是您可以在其他监控系统中找到的标准方法，其它方法都是 Datadog 特有的。通常，在通用监控系统中实现这些检测方法需要一些自定义设置，而
    Datadog 则开箱即用地支持这些方法。
- en: 'In the second step, the metric used for the monitor is selected, and filter
    conditions are added using tags to define the scope of the monitor. Let''s take
    a look at each field, in this section, to understand all of the available options:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 在第二步中，选择用于监视器的度量标准，并使用标签添加过滤条件以定义监视器的范围。让我们逐一查看这一部分的每个字段，以了解所有可用选项：
- en: '**Metric**: The metric used for the monitor is selected here. It should be
    one of the metrics that is reported by the Datadog agent.'
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**度量标准**：在此选择用于监视器的度量标准。它应该是Datadog代理报告的度量标准之一。'
- en: '`host` and `device_name` tags, the monitor is defined specifically for a disk
    partition on a host.'
  id: totrans-46
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`host`和`device_name`标签，监视器专门为主机上的磁盘分区定义。'
- en: '**excluding**: Tags could be selected here to exclude more entities explicitly.'
  id: totrans-47
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**排除**：在此处可以选择标签，以明确排除更多实体。'
- en: If the filter condition (set in the `system.disk.free` values from multiple
    hosts and devices, one of the aggregate functions, `average`, `maximum`, `minimum`,
    or `sum`, will be selected to specify which value can be used for metric value
    comparisons. Picking the correct aggregate function and tags for grouping is important.
    If the filter condition returns only one value already, then this setting is irrelevant.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 如果过滤条件（从多个主机和设备的`system.disk.free`值中设置），将选择聚合函数之一，如`average`（平均值）、`maximum`（最大值）、`minimum`（最小值）或`sum`（总和），用于指定可用于度量值比较的值。选择正确的聚合函数和标签进行分组非常重要。如果过滤条件已经只返回一个值，那么此设置将不相关。
- en: The alert triggered by this monitor could be configured as **Simple Alert**
    or **Multi Alert** (in *Figure 7.3*, **Simple Alert** is selected). When the scope
    of the monitor is a single source, such as a storage device on a host, a simple
    alert is chosen. If there are multiple sources involved and the **Simple Alert**
    option is chosen for the monitor, an aggregated alert notification is sent out
    for all the sources, and an alert notification that is specific to each source
    is sent out if the **Multi Alert** option is chosen.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 由此监视器触发的警报可以配置为**简单警报**或**多源警报**（在*图7.3*中，选择了**简单警报**）。当监视器的范围是单一源时，例如主机上的存储设备，选择简单警报。如果涉及多个源并且选择了监视器的**简单警报**选项，则会为所有源发送聚合警报通知；如果选择**多源警报**选项，则会针对每个源单独发送警报通知。
- en: 'In this section of the form, the configurations mentioned earlier are all done
    under the **Edit** tab. By clicking on the **Source** tab, you can view the configurations
    you have done in the underlying Datadog definition language, as shown in the following
    example:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 在表单的这一部分，之前提到的配置都在**编辑**标签下完成。通过点击**源**标签，可以查看您在底层Datadog定义语言中所做的配置，如下所示：
- en: '[PRE0]'
  id: totrans-51
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'In the third part of this form, primarily, threshold values and related configurations
    for the monitor are set, as shown in the following screenshot:'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 在此表单的第三部分，主要设置监视器的阈值和相关配置，如下图所示：
- en: '![Figure 7.4 – The New Monitor form – Set alert conditions'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: '![图7.4 – 新建监视器表单 – 设置警报条件'
- en: '](img/Figure_7.4_B16483.jpg)'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_7.4_B16483.jpg)'
- en: Figure 7.4 – The New Monitor form – Set alert conditions
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 图7.4 – 新建监视器表单 – 设置警报条件
- en: In Datadog terminology, an alert indicates a critical status, and a warning
    is termed as such. In the sample monitor, we are building the **Alert threshold**,
    which is set at 0.5 GB, and the **Warning threshold**, which is set at 1 GB. This
    means that you will get a warning notification when the free space on the disk
    falls to 1 GB, and you will receive a notification with a critical status when
    the free space on the disk falls to 0.5 GB. The warning and alert statuses not
    only differ in terms of the content of the notifications triggered by the monitor,
    but the response to the alerts could also be configured differently. We will look
    at how that can be done later when we learn about configuring alert notifications.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 在Datadog术语中，警报表示一个关键状态，警告被称为警告。在示例监视器中，我们正在构建**警报阈值**，该阈值设置为0.5 GB，**警告阈值**设置为1
    GB。这意味着当磁盘上的空闲空间降至1 GB时，您将收到警告通知；当磁盘上的空闲空间降至0.5 GB时，您将收到一个关键状态的通知。警告和警报状态不仅在监视器触发的通知内容上有所不同，而且对警报的响应也可以进行不同的配置。稍后当我们学习如何配置警报通知时，我们将看到如何完成此操作。
- en: Let's look at other options that could be set in the section of the form.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看在表单这一部分中可以设置的其他选项。
- en: 'At the top of the section, in the first line itself, you can configure three
    items, as follows:'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一部分的顶部，在第一行本身，您可以配置以下三个项目：
- en: '`above`, `or equal to`, `below`, or `below or equal to`. In our example, we
    need to pick `below`, as the objective of the monitor is to check whether the
    free storage on the disk goes below the certain threshold values that have been
    set.'
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`高于`、`或等于`、`低于` 或 `低于或等于`。在我们的示例中，我们需要选择 `低于`，因为监控的目标是检查磁盘上的可用存储是否低于已设定的某个阈值。'
- en: '`1 minute` to `1 day`, and there is also a **custom** option. Metric values
    from this time window are checked with reference to the nature of the occurrence
    setting.'
  id: totrans-60
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`1分钟` 到 `1天`，还有一个**自定义**选项。此时间窗口中的度量值将根据事件设置的性质进行检查。'
- en: '`on average`, `at least once`, `at all times`, or `in total`. As the options
    suggest, the metric values from the specified time window are checked for possible
    issues, warnings, or alerts, based on this setting.'
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`平均而言`、`至少一次`、`始终` 或 `总计`。正如选项所示，基于此设置，将检查指定时间窗口中的度量值是否存在潜在问题、警告或告警。'
- en: The monitor is marked as recovered from either the warning or alert state when
    the related conditions are no longer satisfied. However, you can add optional
    thresholds that are specific to recovery using **Alert recovery threshold** and
    **Warning recovery threshold**.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 当相关条件不再满足时，监控器会被标记为从警告或告警状态恢复。然而，您可以使用**告警恢复阈值**和**警告恢复阈值**来添加特定于恢复的可选阈值。
- en: The data window can be chosen as **Require** or **Do not require**. If **Require**
    is selected, the monitor will wait for a full window of data to run the checks.
    This option must be selected if the source is expected to report metric values
    regularly. Select **Do not require** if the expectation is to run the checks with
    whatever data points are available during the data window specified on the monitor.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 数据窗口可以选择为**需要**或**不需要**。如果选择**需要**，则监控器将等待完整的数据窗口，以运行检查。如果预期源将定期报告度量值，则必须选择此选项。如果期望根据监控器上指定的数据窗口中的可用数据点来运行检查，则选择**不需要**。
- en: Besides the **warning** and **alert** notifications, the monitor can also report
    on missing data. If the **Notify** option is selected, a notification will be
    sent by the monitor when the metric values are not reported during the specified
    time window in minutes. This option is chosen when the sources are expected to
    report metric values during normal operational conditions, and a **no data** alert
    indicates some issue in the application system monitored by Datadog. If the sources
    selected in the monitor are not expected to report metric values regularly, choose
    the **Do not notify** option. The no data alert could be set to resolve automatically
    after a specified time window. Usually, this is set to **Never** unless there
    is a special case of it being automatically resolved.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 除了**警告**和**告警**通知外，监控器还可以报告缺失的数据。如果选择**通知**选项，则当度量值在指定时间窗口内未报告时，监控器将发送通知。当预期源在正常操作条件下报告度量值时选择此选项，而**无数据**警告表示Datadog监控的应用系统存在问题。如果监控器中选择的源预期不会定期报告度量值，则选择**不通知**选项。无数据警告可以设置为在指定的时间窗口后自动解决。通常，这个设置为**从不**，除非有特殊情况需要自动解决。
- en: Using the **Delay evaluation** option, the metric values used to evaluate various
    thresholds set in the monitor can be offset by a specified number of seconds.
    For example, if a 60-second evaluation delay is specified, at 10:00, the checks
    for the monitor will be run on the data reported from 9:54 to 9:59 for a 5-minute
    data window. In a public cloud environment, Datadog recommends as much as a 15-minute
    delay to reliably ensure that the metric values are available.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 使用**延迟评估**选项，可以将用于评估监控器中设置的各种阈值的度量值延迟指定秒数。例如，如果指定了60秒的评估延迟，则在10:00时，监控器的检查将在9:54到9:59报告的数据上进行，数据窗口为5分钟。在公共云环境中，Datadog建议使用最长15分钟的延迟，以可靠地确保度量值可用。
- en: 'Based on the thresholds set for the monitor, the live status is charted at
    the top of the form, and the following screenshot shows how the sample monitor
    depicts the status it determined:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 根据为监控器设置的阈值，实时状态将在表单顶部进行绘制，以下截图展示了示例监控器如何显示其确定的状态：
- en: '![Figure 7.5 – The New Monitor form – the thresholds chart'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: '![图7.5 – 新监控器表单 – 阈值图表'
- en: '](img/Figure_7.5_B16483.jpg)'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_7.5_B16483.jpg)'
- en: Figure 7.5 – The New Monitor form – the thresholds chart
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 图7.5 – 新监控器表单 – 阈值图表
- en: The light yellow area of the chart shows the range for the warning threshold,
    and the light purple area indicates the critical (alert) threshold. The bold blue
    line above these areas tracks the current value of the metric, and of course,
    it is well above the danger zone. While building a new monitor interactively,
    this chart is helpful to set realistic thresholds on the monitor.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 图表的浅黄色区域表示警告阈值范围，浅紫色区域表示临界（警报）阈值。蓝色粗线在这些区域上方，跟踪度量值的当前值，当然，它远高于危险区。通过交互式构建新监控时，这张图表对于设置实际的阈值非常有帮助。
- en: 'In the fourth section of the **New Monitor** form, the notification to be sent
    out when a warning or critical (alert) state is triggered by the monitor. It is
    presented with a template, as shown in the following screenshot:'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 在**新监控**表单的第四部分中，当监控触发警告或临界（警报）状态时，需要发送的通知。它以模板形式呈现，如下截图所示：
- en: '![Figure 7.6 – The New Monitor form – the notification template'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 7.6 – 新监控表单 – 通知模板'
- en: '](img/Figure_7.6_B16483.jpg)'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_7.6_B16483.jpg)'
- en: Figure 7.6 – The New Monitor form – the notification template
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.6 – 新监控表单 – 通知模板
- en: 'The notification can have a title and body, just like an email message. Template
    variables and conditionals could also be used to make them dynamic. The following
    screenshot indicates what an actual notification template might look like:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 通知可以有标题和正文，就像电子邮件一样。模板变量和条件语句也可以用于使它们动态化。以下截图显示了实际通知模板的可能样式：
- en: '![Figure 7.7 – The New Monitor form – an example notification'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 7.7 – 新监控表单 – 示例通知'
- en: '](img/Figure_7.7_B16483.jpg)'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_7.7_B16483.jpg)'
- en: Figure 7.7 – The New Monitor form – an example notification
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.7 – 新监控表单 – 示例通知
- en: 'In the example notification shown in *Figure 7.7*, you can see how template
    and tag variables and conditionals are used in the notification message. With
    the use of `is_warning` and `is_alert` messages, a message specific warning or
    alert could be sent out. Let''s take a look at some of the important variables
    and conditionals that can be used in the message:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 在*图 7.7*中显示的示例通知中，可以看到如何在通知消息中使用模板、标签变量和条件语句。通过使用`is_warning`和`is_alert`消息，可以发送特定于警告或警报的消息。我们来看看一些可以在消息中使用的重要变量和条件语句：
- en: '`Value`: This is the metric value that will trigger the alert.'
  id: totrans-80
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Value`：这是将触发警报的度量值。'
- en: '`threshold`: This is the threshold for triggering an alert that the metric
    value is compared against.'
  id: totrans-81
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`threshold`：这是触发警报的阈值，用于与度量值进行比较。'
- en: '`warn_threshold`: This is similar to the threshold but set for triggering a
    warning.'
  id: totrans-82
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`warn_threshold`：这与阈值类似，但用于触发警告。'
- en: '`last_triggered_at`: This details the time when the alert was triggered in
    UTC.'
  id: totrans-83
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`last_triggered_at`：这是警报触发的时间，采用UTC时间。'
- en: If the `TAG_KEY.name` in the notification message. Click on the **Use message
    template variables** help link to know which tags are available for use.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 如果通知消息中的`TAG_KEY.name`。点击**使用消息模板变量**帮助链接，了解可以使用哪些标签。
- en: 'Using conditionals, custom notifications can be sent out based on the nature
    of the alert triggered. In the example message template in *Figure 7.7*, you can
    see that part of the message is specific to a warning or an alert. The following
    is a list of the main conditionals that can be used in the message template:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 使用条件语句时，可以根据触发的警报类型发送自定义通知。在*图 7.7*中的示例消息模板中，可以看到消息的一部分是针对警告或警报的。以下是可以在消息模板中使用的主要条件语句列表：
- en: '`is_alert`: This is used if the notification is triggered by an alert.'
  id: totrans-86
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`is_alert`：当通知由警报触发时使用此字段。'
- en: '`is_warning`: This is used if the notification is triggered by a warning.'
  id: totrans-87
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`is_warning`：当通知是由警告触发时使用。'
- en: '`is_no_data`: This is used if the notification is triggered as a result of
    reporting no metric data.'
  id: totrans-88
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`is_no_data`：当通知因报告没有度量数据而触发时使用此字段。'
- en: '`is_recovery`: This is used if the notification is triggered when a warning,
    alert, or no data state is recovered to normal.'
  id: totrans-89
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`is_recovery`：当警告、警报或无数据状态恢复为正常时，触发通知时使用此字段。'
- en: Please refer to the Datadog documentation for a full set of template variables
    and how they are used at [https://docs.datadoghq.com/monitors/notifications](https://docs.datadoghq.com/monitors/notifications).
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 请参考Datadog文档，了解完整的模板变量集及其使用方法，网址为[https://docs.datadoghq.com/monitors/notifications](https://docs.datadoghq.com/monitors/notifications)。
- en: The notification message could be formatted as well, and the details of the
    markdown format can be viewed by following the **Markdown Formatting Help** link
    on the form.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 通知消息也可以进行格式化，Markdown格式的详细信息可以通过表单上的**Markdown格式帮助**链接查看。
- en: The recipients of the notification can be specified using *@*, as mentioned
    in the example template. Usually, an email address or distribution list follows
    *@*. The notification message can be tested by clicking on the **Test Notifications**
    button at the bottom of the form, as shown in *Figure 7.9*. You should see a pop-up
    window where one or more test scenarios can be selected, and the test messages
    will be sent out to recipients accordingly.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 通知的接收者可以使用`*@*`进行指定，如示例模板中所示。通常，`*@*`后面会跟着电子邮件地址或分发列表。可以通过点击表单底部的**测试通知**按钮来测试通知消息，如*图7.9*所示。你应该看到一个弹出窗口，可以选择一个或多个测试场景，测试消息将根据选定的场景发送给接收者。
- en: You can tag a new monitor to help with searching for and grouping monitors later.
    The tag `monitor-type` with a value `infra` has been added to the sample monitor
    by typing in the tag key and value in the **Tags** field.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以为新监控器添加标签，以便后续搜索和分组监控器。通过在**标签**字段中输入标签键和值，标签`monitor-type`及其值`infra`已被添加到示例监控器中。
- en: 'The `renotify if the monitor has not been resolved` option must be used for
    escalating an issue if no action is taken to resolve the state in the application
    system that triggered the alert. An additional message template must be added
    to the monitor if the renotify option is selected, as shown in the following screenshot:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 必须使用`如果监控器未解决则重新通知`选项，以便在没有采取任何措施解决触发告警的应用系统状态时升级问题。如果选择了重新通知选项，则必须向监控器添加附加的消息模板，如下图所示：
- en: '![Figure 7.8 – The New Monitor form – alert escalation template'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: '![图7.8 – 新监控器表单 – 告警升级模板'
- en: '](img/Figure_7.8_B16483.jpg)'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_7.8_B16483.jpg)'
- en: Figure 7.8 – The New Monitor form – alert escalation template
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 图7.8 – 新监控器表单 – 告警升级模板
- en: 'In the final part of the **New Monitor** form, the notification rules are configured,
    as shown in *Figure 7.9*:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 在**新监控器**表单的最后部分，如*图7.9*所示，配置了通知规则：
- en: '![Figure 7.9 – The New Monitor form – the Notify your team and Save monitor'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: '![图7.9 – 新监控器表单 – 通知团队并保存监控器'
- en: '](img/Figure_7.9_B16483.jpg)'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_7.9_B16483.jpg)'
- en: Figure 7.9 – The New Monitor form – the Notify your team and Save monitor
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 图7.9 – 新监控器表单 – 通知团队并保存监控器
- en: The recipient list specified by *@* in the message template in section *4* automatically
    shows up in this section and vice versa.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 在*第4*节的消息模板中由`*@*`指定的收件人列表会自动显示在这一部分，反之亦然。
- en: It is possible to configure the monitor to notify the alert recipients of any
    changes with the monitor definition itself using the **alert recipients when this
    alert is modified** option.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 可以配置监控器，在监控器定义本身发生更改时通知告警接收者，使用**当此告警被修改时通知告警接收者**选项。
- en: Access to edit the monitor can also be restricted using the **editing this monitor
    to its creator or administrators** option.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 还可以使用**仅限创建者或管理员编辑此监控器**选项来限制对监控器的编辑权限。
- en: The monitor we built in the preceding example is a metric type monitor, which
    is the most common type of monitor available on all monitoring platforms, including
    Datadog. The creation of all of these kinds of monitors is similar, and so, we
    will not look at every step that is needed to set up the remaining monitor types.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在前面的示例中构建的监控器是一个度量类型的监控器，这是所有监控平台（包括Datadog）上最常见的监控器类型。这些监控器的创建方式相似，因此我们不会逐一查看设置其余监控器类型所需的每个步骤。
- en: 'Let''s take a look at the main features of other monitor types and the scenarios
    in which they might be useful:'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们来看看其他监控器类型的主要特性，以及它们可能有用的场景：
- en: '`host` tag.'
  id: totrans-107
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`host`标签。'
- en: '**Event**: In this monitor type, Datadog provides a keyword-based search of
    events during a time window and allows you to set warning and alert thresholds
    based on the number of events found in the search result. Setting up an event
    monitor would be useful if it was also possible to track an issue based on the
    event descriptions posted to Datadog.'
  id: totrans-108
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**事件**：在此监控器类型中，Datadog提供基于关键字的事件搜索，时间窗口内的事件，并允许你根据搜索结果中的事件数量设置警告和告警阈值。如果可以根据发布到Datadog的事件描述来跟踪问题，则设置事件监控器会很有用。'
- en: '`&&`), OR (`||`), and NOT (`!`). For example, if a, b, and c are existing monitors,
    you can create a composite monitor using the following condition:'
  id: totrans-109
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`&&`)，或者（`||`），和非（`!`）。例如，如果a、b和c是现有的监控器，你可以使用以下条件创建一个复合监控器：'
- en: '[PRE1]'
  id: totrans-110
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: This monitor will trigger when either `a` or `b` triggers and `c` doesn't.
  id: totrans-111
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 当 `a` 或 `b` 触发且 `c` 不触发时，此监控器将触发。
- en: '`sshd`, and the alert threshold, `below 1`, are enough to set up the monitor.'
  id: totrans-112
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`sshd` 和警报阈值 `below 1` 足以设置监控器。'
- en: '`process.up`; however, it''s more organized. The processes to be monitored
    using this type of monitor must be defined in the `conf.d/process.yaml` file on
    the Datadog agent side.'
  id: totrans-113
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`process.up`；但它更有条理。要使用这种类型的监控器监控的进程，必须在 Datadog 代理端的 `conf.d/process.yaml`
    文件中定义。'
- en: '`conf.d/tcp_check.d/conf.yaml` file, and the HTTP checks are defined in the
    `conf.d/http_check.d/conf.yaml` file. The HTTP check also covers SSL certificate-related
    verifications for an HTTPS URL.'
  id: totrans-114
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`conf.d/tcp_check.d/conf.yaml` 文件中的定义了 TCP 检查，HTTP 检查则在 `conf.d/http_check.d/conf.yaml`
    文件中定义。HTTP 检查还涵盖了 HTTPS URL 的 SSL 证书相关验证。'
- en: The network checks return `OK`, `WARN`, or `CRITICAL`. The threshold is set
    for how many such status codes must be returned consecutively for the monitor
    to trigger a warning or alert.
  id: totrans-115
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 网络检查返回 `OK`、`WARN` 或 `CRITICAL`。设置阈值，以确定需要连续返回多少个此类状态代码，才能触发警告或警报。
- en: '**Integration**: Third-party applications, such as Docker and NGINX, provide
    integrations with Datadog that are available out of the box, and they only need
    to be enabled when required. Once enabled and configured by the Datadog agent,
    the integrations will publish domain-specific metrics and status check results
    into Datadog, and these will be available to monitors of this type.'
  id: totrans-116
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**集成**：如 Docker 和 NGINX 等第三方应用程序提供与 Datadog 的集成，这些集成开箱即用，只需在需要时启用。启用并由 Datadog
    代理配置后，这些集成将把特定领域的度量指标和状态检查结果发布到 Datadog，并且这些结果将可供此类型的监控器使用。'
- en: When a monitor of this kind is created, either the integration-specific metric
    or a status check can be used as the source of information to be tracked by the
    monitor.
  id: totrans-117
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 创建这种类型的监控器时，可以使用集成特定的度量指标或状态检查作为监控器跟踪的信息源。
- en: '**Custom Check**: When a certain status cannot be checked using various information
    reported by a Datadog agent out of the box with or without some configuration
    changes, or by the use of integrations, custom scripts can be written and deployed
    with the Datadog agent. We will discuss the details of doing that in [*Chapter
    8*](B16483_08_Final_VK_ePub.xhtml#_idTextAnchor248)*, Integrating with Platform
    Components*.'
  id: totrans-118
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**自定义检查**：当无法使用 Datadog 代理报告的各种信息（无论是否进行配置更改）或通过集成来检查某一状态时，可以编写自定义脚本并与 Datadog
    代理一起部署。我们将在[*第 8 章*](B16483_08_Final_VK_ePub.xhtml#_idTextAnchor248)《与平台组件集成》中讨论如何做到这一点的详细信息。'
- en: This monitor type is similar to the integration monitor, in which a custom check
    is selected for the status check.
  id: totrans-119
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这种监控器类型类似于集成监控器，其中选择了一个自定义检查作为状态检查。
- en: '**Watchdog**: A Watchdog monitor will report on any abnormal activity in the
    system monitored by Datadog. Datadog provides various problem scenarios that cover
    both computational infrastructures and integrations.'
  id: totrans-120
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**看门狗**：看门狗监控器会报告由 Datadog 监控的系统中的任何异常活动。Datadog 提供了各种问题场景，涵盖计算基础设施和集成。'
- en: We have looked at how to set up new monitors at great length, and we have also
    reviewed different types of monitors that can cater to all possible requirements
    you might have. In the next section, we will learn how these monitors can be maintained
    in a large-scale environment, where some automation might also be required.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经详细讲解了如何设置新监控器，并回顾了能够满足您所有可能需求的不同类型的监控器。在下一部分中，我们将学习如何在大规模环境中维护这些监控器，并且可能需要一些自动化。
- en: Managing monitors
  id: totrans-122
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 管理监控器
- en: 'By navigating to **Monitors** | **Manage Monitors** on the Datadog dashboard,
    you can list all of the existing monitors, as shown in the following screenshot:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 通过在 Datadog 仪表板上导航至 **Monitors** | **Manage Monitors**，您可以列出所有现有的监控器，如下截图所示：
- en: '![Figure 7.10 – List of monitors'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 7.10 – 监控器列表'
- en: '](img/Figure_7.10_B16483.jpg)'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_7.10_B16483.jpg)'
- en: Figure 7.10 – List of monitors
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.10 – 监控器列表
- en: As shown in *Figure 7.10*, a number of options are available to either mute
    or resolve the monitor. By muting a monitor, you can stop the monitor from triggering
    a warning or alert. Additionally, a monitor can be marked as resolved without
    waiting for the underlying issue to be resolved and the status to be reflected
    in Datadog.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 如*图 7.10*所示，有多种选项可以静音或解决监控器。通过静音监控器，您可以停止监控器触发警告或警报。此外，监控器可以在不等待底层问题解决和状态在 Datadog
    中反映的情况下标记为已解决。
- en: 'Besides the obvious **Edit** and **Delete** options, a monitor can be cloned
    using the **Clone** option, as shown in the following screenshot, and it could
    be modified to make a new monitor that could use some features of the source monitor:'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 除了明显的**编辑**和**删除**选项外，还可以使用**克隆**选项来克隆一个监控器，如下图所示，并且可以对其进行修改，创建一个新的监控器，该监控器可以使用源监控器的一些功能：
- en: '![Figure 7.11 – Cloning a monitor'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 7.11 – 克隆监控器'
- en: '](img/Figure_7.11_B16483.jpg)'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_7.11_B16483.jpg)'
- en: Figure 7.11 – Cloning a monitor
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.11 – 克隆监控器
- en: The definition of a monitor can be exported into JSON format and maintained
    in a source code control system as a backup or as a template to derive similar
    monitors from later.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 监控器的定义可以导出为 JSON 格式，并可以作为备份或模板保存在源代码控制系统中，以便以后派生出类似的监控器。
- en: 'To export the definition, open the monitor in **Edit window** and use the **Export
    Monitor** button at the very bottom of the form. A window will pop up, as shown
    in the following screenshot, and you can copy the code using the **Copy** button:'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 要导出定义，打开监控器的**编辑窗口**，并使用表单底部的**导出监控器**按钮。一个窗口将弹出，如下图所示，你可以使用**复制**按钮复制代码：
- en: '![Figure 7.12 – Exporting the monitor into JSON'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 7.12 – 将监控器导出为 JSON'
- en: '](img/Figure_7.12_B16483.jpg)'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_7.12_B16483.jpg)'
- en: Figure 7.12 – Exporting the monitor into JSON
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.12 – 将监控器导出为 JSON
- en: In the **New Monitor** workflow, using the **Import Monitor from JSON** option,
    a new monitor can be created from the JSON. This provides a textbox where the
    monitor definition in JSON format can be inputted, and, if successful, it will
    take you to the **New Monitor** form prefilled with the details from the JSON.
    Additional modifications can be done before the monitor is saved. The JSON for
    any new monitors created using this method is developed by modifying the JSON
    exported from a similar monitor.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 在**新监控器**工作流中，使用**从 JSON 导入监控器**选项，可以从 JSON 创建一个新的监控器。此选项提供一个文本框，可以在其中输入监控器的
    JSON 格式定义。如果成功，它将带你进入预填充了 JSON 中详细信息的**新监控器**表单。在保存监控器之前，可以进行额外的修改。使用此方法创建的任何新监控器的
    JSON 是通过修改从类似监控器导出的 JSON 来开发的。
- en: Earlier, we learned how alert notifications can be forwarded to email addresses
    and distribution lists by adding them to the message template using an *@* sign.
    In the next section, we will explore how notifications can be distributed to a
    wide range of communication platforms.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 之前，我们已经了解了如何通过在消息模板中添加*@*符号，将警报通知转发到电子邮件地址和分发列表中。在接下来的章节中，我们将探讨如何将通知分发到广泛的通信平台。
- en: Distributing notifications
  id: totrans-139
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 分发通知
- en: Let's recap some of the concepts that we have discussed in this chapter to reiterate
    the related workflows. A monitor triggers a warning or an alert when some threshold
    or state that the monitor is tracking in the system has been reached. Notifications
    about this change in status, from **OK** to **Warning** or **Alert**, and then
    recovering back to **OK**, can be sent out to different communication platforms
    such as email, Slack, Jira, and PagerDuty. These notifications can also be posted
    to any system that supports Webhooks.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们回顾一下本章讨论的一些概念，以重申相关的工作流程。当监控器跟踪的系统中的某个阈值或状态达到时，监控器会触发警告或告警。关于此状态变化的通知，从**正常**到**警告**或**告警**，然后恢复到**正常**，可以发送到不同的通信平台，如电子邮件、Slack、Jira
    和 PagerDuty。这些通知也可以发布到任何支持 Webhooks 的系统。
- en: We have already learned that just by prefixing a personal or group email address
    with *@*, the notifications could be forwarded to them. It's always a best practice
    to forward these notifications to a group email or a distribution list, as they
    must be addressed by someone on the team.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经了解了，只需在个人或群组电子邮件地址前加上*@*，通知就可以转发给他们。最好将这些通知转发到群组邮箱或分发列表中，因为它们必须由团队中的某个人处理。
- en: 'The integrations with other tools facilitate the distribution and escalation
    of alert notifications for systematic tracking and the closure of issues. Let''s
    take a look at some of the important tools:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 与其他工具的集成可以促进警报通知的分发和升级，以便进行系统跟踪并解决问题。我们来看看一些重要的工具：
- en: '**Jira**: Atlassian''s Jira is a popular issue tracking tool. By enabling this
    integration, a Jira ticket can be created for every alert notification the monitors
    generate. Additionally, the creation of the Jira ticket is tracked in Datadog
    as an event.'
  id: totrans-143
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Jira**：Atlassian 的 Jira 是一款流行的问题跟踪工具。通过启用此集成，每次监控器生成警报通知时，都可以为其创建一个 Jira
    工单。此外，Jira 工单的创建过程会在 Datadog 中作为事件进行跟踪。'
- en: '**PagerDuty**: Tools such as PagerDuty are used by support teams to escalate
    issues systematically. An alert notification needs to be distributed to the right
    resource in order to triage the related issue, and if that person is not available,
    another resource must be notified or the issue has to be escalated. PagerDuty
    is good at taking care of such tasks, and it can be configured to implement complex
    escalation needs.'
  id: totrans-144
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**PagerDuty**：像 PagerDuty 这样的工具被支持团队用来系统地升级问题。需要将警报通知分发到正确的资源，以便对相关问题进行分类，如果该人员不可用，则必须通知其他资源，或者将问题升级。PagerDuty
    擅长处理这类任务，并且可以配置以满足复杂的升级需求。'
- en: '**Slack**: IRC-style team communication platforms such as **Slack** have been
    very popular, and they cover many messaging requirements that email used to address
    before. Once integrated, many Datadog tasks, such as muting monitors, can be initiated
    from a Slack channel. These options are available in addition to the core feature
    of forwarding the alert notifications to Slack channels.'
  id: totrans-145
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Slack**：类似 IRC 的团队通信平台，如**Slack**，非常流行，并且覆盖了许多曾由电子邮件处理的消息传递需求。一旦集成，许多 Datadog
    任务，如静音监控，可以从 Slack 渠道启动。这些选项除了将警报通知转发到 Slack 渠道的核心功能外，还可以使用。'
- en: '**Webhooks**: While Datadog supports integrations with popular issue tracking
    and communication platforms such as PagerDuty, Jira, and Slack, it also provides
    a custom integration option using **w****ebhooks**. If specified in the alert
    notification template, a webhook will post alert-related JSON data into the target
    application. It''s up to that application to consume the alert data and take any
    action based on that. In [*Chapter 8*](B16483_08_Final_VK_ePub.xhtml#_idTextAnchor248),
    *Integrating with Platform Components*, we will learn, in detail, how webhooks
    are set up in Datadog for integration with other applications.'
  id: totrans-146
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Webhooks**：虽然 Datadog 支持与流行的缺陷跟踪和通信平台，如 PagerDuty、Jira 和 Slack 的集成，但它也提供了一个使用**Webhooks**的自定义集成选项。如果在警报通知模板中指定，Webhook
    将把警报相关的 JSON 数据发布到目标应用程序。由该应用程序决定如何消费警报数据并根据这些数据采取行动。在[*第 8 章*](B16483_08_Final_VK_ePub.xhtml#_idTextAnchor248)，《与平台组件集成》中，我们将详细学习如何在
    Datadog 中设置 Webhooks，以便与其他应用程序集成。'
- en: Monitors can send out lots of notifications via multiple channels based on the
    integrations in place, and it might be necessary to mute the monitors at times,
    in situations such as maintenance or deployment. In the next section, you will
    learn how that can be accomplished.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 监控工具可以通过已配置的集成渠道发送大量通知，有时可能需要静音监控，例如在维护或部署期间。在下一节中，你将学习如何实现这一点。
- en: Configuring downtime
  id: totrans-148
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置停机时间
- en: Using the options provided by Datadog, a group of monitors can be muted during
    a scheduled period. Typically, such downtime is needed when you make a change
    to the computing infrastructure or deploy some code. Until such changes are completed,
    and the impacted environments are stabilized, it might not make much sense to
    monitor the software system in production. Additionally, by disabling the monitors,
    you can avoid receiving alert notifications in emails, texts, and even phone calls
    depending on what integrations are in place.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 Datadog 提供的选项，可以在预定时间段内静音一组监控。通常，当你对计算基础设施进行更改或部署代码时，需要此类停机时间。在这些更改完成并且受影响的环境稳定之前，监控生产中的软件系统可能没有太大意义。此外，通过禁用监控，你可以避免根据现有集成接收电子邮件、短信，甚至电话的警报通知。
- en: 'To schedule downtime, navigate to **Monitors** | **Manage Downtime**, and you
    should see a form, as shown in the following screenshot, where the existing scheduling
    will be listed:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 要安排停机时间，请导航到**监控** | **管理停机时间**，你将看到一个表单，如下图所示，其中将列出现有的调度：
- en: '![Figure 7.13 – Managing monitor downtime'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 7.13 – 管理监控停机时间'
- en: '](img/Figure_7.13_B16483.jpg)'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_7.13_B16483.jpg)'
- en: Figure 7.13 – Managing monitor downtime
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.13 – 管理监控停机时间
- en: 'By clicking on the **Schedule Downtime** button, you can add a new downtime
    schedule, as follows:'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 通过点击**安排停机时间**按钮，你可以添加新的停机时间安排，如下所示：
- en: '![Figure 7.14 – Scheduling a new downtime'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 7.14 – 安排新的停机时间'
- en: '](img/Figure_7.14_B16483.jpg)'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_7.14_B16483.jpg)'
- en: Figure 7.14 – Scheduling a new downtime
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.14 – 安排新的停机时间
- en: 'The following options are available for scheduling a downtime:'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 以下选项可用于安排停机时间：
- en: The downtime can be defined for all monitors or a group of monitors identified
    by names or tags.
  id: totrans-159
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 停机时间可以为所有监控或通过名称或标签标识的监控组定义。
- en: The downtime can be one-time or recurring. A recurring downtime is useful when
    some of the services being monitored will be unavailable periodically, such as
    some applications that are shut down during the weekend.
  id: totrans-160
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 停机可以是一次性的，也可以是定期的。定期停机在一些服务会周期性不可用时非常有用，例如一些在周末关闭的应用程序。
- en: A notification message template and recipient list can be specified, similar
    to alert notifications, to send out notifications about the downtime.
  id: totrans-161
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可以像警报通知一样指定通知消息模板和接收人列表，用于发送有关停机的通知。
- en: We have looked at the process of configuring the downtime of a monitor, and
    that concludes this chapter. Next, let's take a look at the best practices related
    to setting up and maintaining monitors and alerts.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经看过了配置监控停机的过程，本章到此结束。接下来，让我们看看与设置和维护监控及警报相关的最佳实践。
- en: Best practices
  id: totrans-163
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 最佳实践
- en: 'Now, let''s review the best practices related to monitors and alerts:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们回顾一下与监控和警报相关的最佳实践：
- en: Define a comprehensive list of monitors that will cover all aspects of the working
    of the software system that Datadog is monitoring.
  id: totrans-165
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 定义一个全面的监控列表，涵盖 Datadog 监控的软件系统的各个方面。
- en: It's possible that you might only be using Datadog to address a certain part
    of the monitoring requirement, and, in that case, make sure that the monitors
    defined cover your area of focus.
  id: totrans-166
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你可能只使用 Datadog 来处理某一部分的监控需求，在这种情况下，确保所定义的监控涵盖你关注的领域。
- en: To avoid alert fatigue, make sure that all alert notifications are actionable,
    and the remediation steps are documented in the notification itself or in a runbook.
    Continue fine-tuning the thresholds and data window size until you start getting
    credible alert notifications. If monitors are too sensitive, they can start generating
    noise.
  id: totrans-167
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为了避免警报疲劳，确保所有警报通知都是可操作的，并且修复步骤已经在通知本身或运行手册中记录。继续微调阈值和数据窗口大小，直到你开始收到可靠的警报通知。如果监控过于敏感，可能会产生噪声。
- en: If any amount of fine-tuning is not enough to tame a monitor from sending out
    too many alerts, consider deleting it, and plan to monitor the related scenario
    in some other reasonable way.
  id: totrans-168
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果任何微调都不足以减少监控发送过多警报的情况，考虑删除该监控，并计划以其他合理的方式监控相关场景。
- en: Integrate monitors with your company's choice of tools for incident tracking,
    escalation, and team communication. Email notifications must be a backup, and
    those notifications must be sent out to user groups and not individuals. Email
    alerts should also serve as a historical record that can be used as evidence for
    postmortems (or the **Root Cause Analysis** or **RCA** of production incidents)
    and third-party audits such as those required for **SOC 2 Type** 2 compliance.
  id: totrans-169
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将监控与公司选择的事故跟踪、升级和团队沟通工具集成。电子邮件通知必须作为备用，并且这些通知必须发送给用户组而不是个人。电子邮件警报还应该作为历史记录，用作事后分析（或**根本原因分析**或**RCA**）和第三方审计的证据，例如那些要求**SOC
    2 Type** 2 合规的审计。
- en: Back up monitors as code by exporting out the JSON definition and maintaining
    it inside a source control system such as Git. If possible, maintain monitors
    in a code repository by defining monitors in Terraform or Ansible or Datadog's
    JSON format.
  id: totrans-170
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过导出 JSON 定义并将其保存在源代码管理系统（如 Git）中，以代码的形式备份监控。尽可能通过在 Terraform、Ansible 或 Datadog
    的 JSON 格式中定义监控，来将监控保存在代码库中。
- en: Socialize the downtime feature and practice it while doing maintenance. Without
    that, the alert notifications can become a nuisance, and the credibility of the
    monitoring system itself can take a hit.
  id: totrans-171
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在进行维护时，普及停机功能并实践它。如果没有这个，警报通知可能会变得恼人，而且监控系统本身的可信度可能会受到影响。
- en: Summary
  id: totrans-172
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: In this chapter, you have learned how to create a new Datadog monitor based
    on the variety of information available in Datadog about the software system and
    the infrastructure that Datadog monitors. Additionally, we learned how those monitors
    could be maintained manually or maintained as code using the options available.
    We looked at different methods available to integrate the monitors with communication
    tools to distribute the alert notifications widely. Finally, you learned how the
    downtime feature could be used effectively during maintenance and shutdown periods.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一章中，你已经学会了如何基于 Datadog 中有关软件系统和基础设施的各种信息创建新的 Datadog 监控器。此外，我们还学习了如何通过现有的选项手动维护这些监控器，或者将其作为代码进行维护。我们探讨了将监控器与通信工具集成的不同方法，以便广泛分发警报通知。最后，你学会了如何在维护和停机期间有效地使用停机时间功能。
- en: We already discussed a number of third-party tools in the context of using or
    monitoring them with Datadog. In the next chapter, we will learn how such integrations
    are used in Datadog and how custom integrations can be rolled out.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经在使用或监控 Datadog 时讨论了多个第三方工具。在下一章中，我们将学习这些集成如何在 Datadog 中使用，以及如何推出自定义集成。
