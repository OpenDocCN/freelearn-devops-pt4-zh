<html><head></head><body><div id="sbo-rt-content"><div id="_idContainer143">
			<p><a id="_idTextAnchor301"/></p>
			<h1 id="_idParaDest-171"><em class="italic"><a id="_idTextAnchor302"/>Chapter 10</em>: Working with Monitoring Standards</h1>
			<p>You have already seen how Datadog-supplied integrations and REST APIs are useful in extending Datadog's features. In this chapter, we will explore more options available for extending these features that are essentially an implementation of standards in the monitoring space, and how they can be used for rolling out your custom monitoring requirements.</p>
			<p>These are the topics that are covered in this chapter:</p>
			<ul>
				<li>Monitoring networks using SNMP</li>
				<li>Consuming application metrics using JMX</li>
				<li>Working with the DogStatsD interface</li>
			</ul>
			<h1 id="_idParaDest-172"><a id="_idTextAnchor303"/>Technical requirements</h1>
			<p>To try out the examples mentioned in this book, you need to have the following tools installed and resources available:</p>
			<ul>
				<li>An <strong class="bold">Ubuntu 18.04</strong> environment with a Bash shell. The examples might work on other Linux distributions also, but suitable changes must be made to the Ubuntu-specific commands.</li>
				<li>A Datadog account with admin-level access.</li>
				<li>The Datadog Agent running at the host level or as a microservice, depending on the example, pointing to the Datadog account.</li>
				<li>curl.</li>
				<li><strong class="bold">Python 2.7</strong>, <strong class="bold">Python 3.8</strong>, or higher</li>
			</ul>
			<h1 id="_idParaDest-173"><a id="_idTextAnchor304"/>Monitoring networks using SNMP</h1>
			<p><strong class="bold">Simple Network Management Protocol</strong> (<strong class="bold">SNMP</strong>) is a protocol for managing equipment <a id="_idIndexMarker565"/>within a network. It has been used to track the devices in networks and their performance, and vendors have <a id="_idIndexMarker566"/>adopted it as the standard for publishing related data.  Even though in a public cloud environment the requirement for networking monitoring is minimal to nil, in a large-scale operational environment, setting up a colocation to connect to a customer <a id="_idIndexMarker567"/>or managing some physical network equipment internally is always possible. Plugging in that equipment to the existing Datadog platform could be handy, instead of rolling out a different monitoring solution for that.</p>
			<p>On SNMP-enabled devices, the agent collects the performance metrics from the devices and stores <a id="_idIndexMarker568"/>them in a <strong class="bold">Management Information Base</strong> (<strong class="bold">MIB</strong>) for network monitoring tools to consume. <strong class="source-inline">snmpwalk</strong> is a popular command-line tool that is used to scan devices for such data. Datadog integrates with SNMP and an agent can be configured to scan multiple network devices to collect metrics.</p>
			<p>As it's not easy to find a network device for testing, especially when you are in a cloud environment, we will run the SNMP service on a virtual machine and look at the metrics using <strong class="source-inline">snmpwalk</strong>. Also, the steps to enable SNMP integration in Datadog will be explained using that environment.</p>
			<p>You need an Ubuntu host to try out the following SNMP tutorial. These steps were tested on an AWS EC2 <a id="_idIndexMarker569"/>node running <strong class="bold">Ubuntu 18.04</strong>:</p>
			<ol>
				<li>Install the SNMP packages:<p class="source-code">$ sudo apt-get install snmpd snmp snmp-mibs-downloader</p></li>
				<li>Edit <strong class="source-inline">/etc/snmp/snmp.conf</strong> and comment out the configuration for <strong class="source-inline">mibs</strong>.</li>
				<li>Restart the SNMP daemon:<p class="source-code">$ sudo /etc/init.d/snmpd restart</p></li>
				<li>These <a id="_idIndexMarker570"/>steps are enough to have an SNMP service up and running locally and <a id="_idIndexMarker571"/>you can use <strong class="source-inline">snmpwalk</strong> to scan the service:</li>
			</ol>
			<p class="source-code">$ snmpwalk -mALL -v2c -cpublic localhost  2&gt;/dev/null</p>
			<p class="source-code">SNMPv2-MIB::sysObjectID.0 = OID: NET-SNMP-TC::linux</p>
			<p class="source-code">DISMAN-EVENT-MIB::sysUpTimeInstance = Timeticks: (346799) 0:57:47.99</p>
			<p class="source-code">SNMPv2-MIB::sysContact.0 = STRING: Me &lt;me@example.org&gt;</p>
			<p class="source-code">SNMPv2-MIB::sysName.0 = STRING: ip-172-31-31-12</p>
			<p class="source-code">SNMPv2-MIB::sysLocation.0 = STRING: Sitting on the Dock of the Bay</p>
			<p class="source-code">SNMPv2-MIB::sysServices.0 = INTEGER: 72</p>
			<p class="source-code">SNMPv2-MIB::sysORLastChange.0 = Timeticks: (2) 0:00:00.02</p>
			<p class="source-code">SNMPv2-MIB::sysORID.1 = OID: SNMP-MPD-MIB::snmpMPDCompliance</p>
			<p class="source-code">SNMPv2-MIB::sysORID.2 = OID: SNMP-USER-BASED-SM-MIB::usmMIBCompliance</p>
			<p class="source-code">SNMPv2-MIB::sysORUpTime.1 = Timeticks: (1) 0:00:00.01</p>
			<p class="source-code">HOST-RESOURCES-MIB::hrSystemUptime.0 = Timeticks: (760881) 2:06:48.81</p>
			<p class="source-code">HOST-RESOURCES-MIB::hrSystemDate.0 = STRING: 2021-1-31,6:53:37.0,+0:0</p>
			<p class="source-code">HOST-RESOURCES-MIB::hrSystemInitialLoadDevice.0 = INTEGER: 393216</p>
			<p class="source-code">HOST-RESOURCES-MIB::hrSystemNumUsers.0 = Gauge32: 1</p>
			<p class="source-code">HOST-RESOURCES-MIB::hrSystemProcesses.0 = Gauge32: 103</p>
			<p class="source-code">HOST-RESOURCES-MIB::hrSystemMaxProcesses.0 = INTEGER: 0</p>
			<p><em class="italic">(This output is only an excerpt.)</em></p>
			<p>As you can see in the sample output, different system performance metrics are available in the scanning result. Let's look at the command-line options used for <strong class="source-inline">snmpwalk</strong>. Similar information is needed to enable the Datadog SNMP integration also:</p>
			<ul>
				<li>The <strong class="source-inline">-mALL</strong> option directs <strong class="source-inline">snmpwalk</strong> to look at all the MIBs available. On the Ubuntu host, those files are stored under the <strong class="source-inline">/usr/share/snmp/mibs</strong> directory.</li>
				<li><strong class="source-inline">-v2c</strong> points to the version of the SNMP protocol to be used. There are three versions and in Datadog it defaults to <strong class="source-inline">v2</strong>, the same as what's used here.</li>
				<li><strong class="source-inline">-cpublic</strong> indicates that the community string used for the scan is <strong class="source-inline">public</strong>. A community string in <strong class="source-inline">v1</strong> and <strong class="source-inline">v2</strong> of the SNMP protocol is like a passphrase. In <strong class="source-inline">v3</strong>, that is replaced with credential-based authentication.</li>
			</ul>
			<p>Now, let's <a id="_idIndexMarker572"/>see how the SNMP integration in Datadog can be configured to access the SNMP <a id="_idIndexMarker573"/>service running on the Ubuntu host:</p>
			<ol>
				<li value="1">Set up <strong class="source-inline">conf.yaml</strong> by copying it from the example file:<p class="source-code">$ cd /etc/datadog-agent/conf.d/snmp.d</p><p class="source-code">$ cp conf.yaml.example conf.yaml</p></li>
				<li>Edit <strong class="source-inline">conf.yaml</strong> and enable the following: under the <strong class="source-inline">instances</strong> section, point <strong class="source-inline">ip_address</strong> to <strong class="source-inline">127.0.0.1</strong>, which corresponds to localhost.</li>
				<li>Set <strong class="source-inline">community_string</strong> to <strong class="source-inline">public</strong>.</li>
				<li>Add two custom tags so the metrics published by SNMP integration can easily be tracked:<p class="source-code">tags:</p><p class="source-code">       - integration:snmp</p><p class="source-code">       - metrics-type:ubuntu-snmp</p></li>
				<li>Restart the Datadog Agent for these changes to take effect. Check the status and <a id="_idIndexMarker574"/>verify that the Datadog Agent can query the SNMP service locally by running <a id="_idIndexMarker575"/>the following:</li>
			</ol>
			<p class="source-code">$ sudo datadog-agent status</p>
			<p class="source-code">    snmp (3.5.3)</p>
			<p class="source-code">    ------------</p>
			<p class="source-code">      Instance ID: snmp:98597c6009cbe92e [OK]</p>
			<p class="source-code">      Configuration Source: file:/etc/datadog-agent/conf.d/snmp.d/conf.yaml</p>
			<p class="source-code">      Total Runs: 96</p>
			<p class="source-code">      Metric Samples: Last Run: 2, Total: 192</p>
			<p class="source-code">      Events: Last Run: 0, Total: 0</p>
			<p class="source-code">      Service Checks: Last Run: 1, Total: 96</p>
			<p class="source-code">      Average Execution Time : 7ms</p>
			<p class="source-code">      Last Execution Date : 2021-01-31 08:16:21.000000 UTC</p>
			<p class="source-code">      Last Successful Execution Date : 2021-01-31 08:16:21.000000 UTC</p>
			<p>The metrics that get published to Datadog from this integration could be looked up in the <strong class="bold">Metrics Explorer</strong>, as in the following screenshot:</p>
			<div>
				<div id="_idContainer136" class="IMG---Figure">
					<img src="Images/Figure_10.1_B16483.jpg" alt="Figure 10.1 – Looking up metrics from the SNMP integration&#13;&#10;" width="1636" height="666"/>
				</div>
			</div>
			<p class="figure-caption">Figure 10.1 – Looking up metrics from the SNMP integration</p>
			<p>Multiple network devices can be specified under the <strong class="source-inline">instances</strong> section of the SNMP integration <a id="_idIndexMarker576"/>configuration file and the metrics could be differentiated using appropriate tags. The Datadog Agent can be configured to scan an entire network subnet for devices that are <a id="_idIndexMarker577"/>SNMP-enabled. For the details and configuration, consult the official documentation at <a href="https://docs.datadoghq.com/network_performance_monitoring/devices/setup">https://docs.datadoghq.com/network_performance_monitoring/devices/setup</a>.</p>
			<p>In the next section, we will discuss <strong class="bold">JMX</strong>, which is an important area related to the monitoring of Java applications, and you will learn how Datadog is integrat<a id="_idTextAnchor305"/>ed with it.</p>
			<h1 id="_idParaDest-174"><a id="_idTextAnchor306"/>Consuming application metrics using JMX </h1>
			<p><strong class="bold">Java Management Extensions</strong> (<strong class="bold">JMX</strong>) is a Java technology that Java applications can use to publish <a id="_idIndexMarker578"/>their operational statistics. JMX <a id="_idIndexMarker579"/>has additional features that help with managing the application overall, but we are <a id="_idIndexMarker580"/>focused only on its ability to expose application metrics that could be used for monitoring. Datadog provides support for collecting those metrics.</p>
			<p>Typically, a JMX-compliant <a id="_idIndexMarker581"/>client application such as <strong class="bold">JConsole</strong> could be used to consume the metrics published by JMX and view them. As it's common for Java applications to publish operational metrics using JMX, most modern monitoring platforms provide options to integrate with JMX, and Datadog is no exception.</p>
			<p>Rolling out application-level monitoring is inherently challenging as it relies on publishing custom metrics that track the health and performance of the application. As some customization is needed in the application and monitoring tool to publish and consume custom metrics, such efforts are not easy to implement and so the monitoring is minimal to nil in many organizations where the scope of monitoring is usually limited to <a id="_idIndexMarker582"/>infrastructure and platform monitoring features that are available out of the box. In Java <a id="_idIndexMarker583"/>applications, it's much easier to publish metrics using JMX, instead of building API endpoints for monitoring. Datadog makes the usage of JMX much easier by providing specific integrations for popular Java-based <a id="_idIndexMarker584"/>platform components such as <strong class="bold">Cassandra</strong> and <strong class="bold">Tomcat</strong> that <a id="_idIndexMarker585"/>publish operational metrics via JMX, in addition to providing a general-purpose JMX integration. You will learn about both features in this section with th<a id="_idTextAnchor307"/>e help of examples.</p>
			<h2 id="_idParaDest-175"><a id="_idTextAnchor308"/>Cassandra as a Java application</h2>
			<p><strong class="bold">Apache Cassandra</strong> is a highly scalable NoSQL database system that can manage both structured and <a id="_idIndexMarker586"/>unstructured data across multiple data centers and cloud <a id="_idIndexMarker587"/>regions. It can run on commodity hardware with a highly resilient design.</p>
			<p>In production, Cassandra is run on a cluster of machines that might span multiple data centers for reliability. To demonstrate its JMX features, we will run it in a single node using a binary <strong class="bold">tarball</strong> installable <a id="_idIndexMarker588"/>that you can download from <a href="https://cassandra.apache.org/download/">https://cassandra.apache.org/download/</a>, where you can also pick up the latest stable version:</p>
			<ol>
				<li value="1">The selected tarball can be downloaded as in the following sample command:<p class="source-code">$ curl -OL https://apache.claz.org/cassandra/3.11.9/apache-cassandra-3.11.9-bin.tar.gz</p></li>
				<li>Extract the tarball and change the directory to where it's extracted:<p class="source-code">$ tar xzf apache-cassandra-3.11.9-bin.tar.gz</p><p class="source-code">$ cd apache-cassandra-3.11.9</p></li>
				<li>Make sure <strong class="bold">Java 8</strong> is available in the environment. If not, install it. On an Ubuntu host, this can be done by installing from a package, as follows:<p class="source-code">$ sudo apt install openjdk-8-jre-headless -y</p></li>
				<li>Start the Cassandra service as follows:</li>
			</ol>
			<p class="source-code">$ bin/cassandra</p>
			<p>That's pretty much it if everything goes smoothly and if this instance is not intended for use with an application. You could use this service for testing Datadog's JMX support.</p>
			<p>Now, let's look <a id="_idIndexMarker589"/>at the runtime details of Cassandra and the corresponding <strong class="bold">JVM</strong> to understand how JMX is configured to work. To see the status of the Cassandra service, you can use <strong class="source-inline">nodetool</strong>, and you could also look at the log for any issues:</p>
			<p class="source-code">$ bin/nodetool status</p>
			<p class="source-code">Datacenter: datacenter1</p>
			<p class="source-code">=======================</p>
			<p class="source-code">Status=Up/Down</p>
			<p class="source-code">|/ State=Normal/Leaving/Joining/Moving</p>
			<p class="source-code">--  Address    Load       Tokens       Owns (effective)  Host ID                               Rack</p>
			<p class="source-code">UN  127.0.0.1  70.71 KiB  256          100.0%            03262478-23a3-4bd4-97f1-bc2c837ad650  rack1</p>
			<p class="source-code">      $ tail -f logs/system.log</p>
			<p class="source-code">INFO  [main] 2021-01-29 06:05:27,118 CassandraDaemon.java:650 - Startup complete</p>
			<p class="source-code">INFO  [OptionalTasks:1] 2021-01-29 06:05:36,893 CassandraRoleManager.java:372 - Created default superuser role 'cassandra'</p>
			<p>One important thing to note here is the way the Cassandra Java application was started up, enabling JMX. If you look at the Java command line, the following options can be found:</p>
			<ul>
				<li><strong class="source-inline">-Dcassandra.jmx.local.port=7199</strong>: This specifies on which port the JMX service is available for the client applications, such as a monitoring tool to consume data. You will see later that this port is used in client configurations so the client applications can locate the service.</li>
				<li><strong class="source-inline">-Dcom.sun.management.jmxremote.authenticate=false</strong>: This option indicates whether the JMX service can be accessed remotely.</li>
				<li><strong class="source-inline">-Dcom.sun.management.jmxremote.password.file=/etc/cassandra/jmxremote.password</strong>: This is the authentication.</li>
			</ul>
			<p>We have looked <a id="_idIndexMarker590"/>at how Datadog can be configured to consume application metrics via the JMX interface using the example of Cassandra in this section. You will learn more about JMX-based integrat<a id="_idTextAnchor309"/>ion in the next section.</p>
			<h2 id="_idParaDest-176"><a id="_idTextAnchor310"/>Using Cassandra integration</h2>
			<p>We have seen that the Cassandra service is started up with the JMX service enabled and have made <a id="_idIndexMarker591"/>it available on port <strong class="source-inline">7199</strong>. Datadog takes it from there and provides an integration with Cassandra that consumes the monitoring information available via the JMX interface.</p>
			<p>To enable Cassandra integration, you need to follow these standard steps:</p>
			<ol>
				<li value="1">On the Cassandra host, there should also be a Datadog Agent running. Under the <strong class="source-inline">/etc/datadog-agent/conf.d/cassandra.d</strong> directory, use the example configuration file to set up the configuration file for Cassandra integration:<p class="source-code">$ cp conf.yaml.example conf.yaml</p><p>The configuration file copied from the example is good to enable the integration. Note that port <strong class="source-inline">7199</strong> and the metrics specified in the configuration file for collecting data are compatible with the JMX. Also, the nature of this integration is very clear from the following setting in the configuration file:</p><p class="source-code">init_config:</p><p class="source-code">  ## @param is_jmx - boolean - required</p><p class="source-code">  ## Whether or not this file is a configuration for a JMX integration</p><p class="source-code">  #</p><p class="source-code">  is_jmx: true</p></li>
				<li>After setting <a id="_idIndexMarker592"/>up the configuration file, restart the Datadog Agent service:<p class="source-code">$ sudo service datadog-agent restart</p></li>
				<li>Check the status of the Cassandra integration, specifically that listed under the <strong class="source-inline">JMXFetch</strong> section:</li>
			</ol>
			<p class="source-code">$ sudo datadog-agent status</p>
			<p class="source-code">========</p>
			<p class="source-code">JMXFetch</p>
			<p class="source-code">========</p>
			<p class="source-code">  Initialized checks</p>
			<p class="source-code">  ==================</p>
			<p class="source-code">    cassandra</p>
			<p class="source-code">      instance_name : cassandra-localhost-7199</p>
			<p class="source-code">      message : &lt;no value&gt;</p>
			<p class="source-code">      metric_count : 230</p>
			<p class="source-code">      service_check_count : 0</p>
			<p class="source-code">      status : OK</p>
			<p>The metrics fetched by this integration can be looked up in the <strong class="bold">Metrics Explorer</strong>. For example, see how one of the metrics fetched from the JMX interface is looked up and charted on the <strong class="bold">Metrics Explorer</strong>:</p>
			<div>
				<div id="_idContainer137" class="IMG---Figure">
					<img src="Images/Figure_10.2_B16483.jpg" alt="Figure 10.2 – A Cassandra metric listed on the Metrics Explorer&#13;&#10;" width="1626" height="668"/>
				</div>
			</div>
			<p class="figure-caption">Figure 10.2 – A Cassandra metric listed on the Metrics Explorer</p>
			<p>In this case, you don't <a id="_idIndexMarker593"/>need to know anything about JMX to consume monitoring data that is published <a id="_idTextAnchor311"/>through the JMX interface.</p>
			<h2 id="_idParaDest-177"><a id="_idTextAnchor312"/>Accessing the Cassandra JMX interface</h2>
			<p>Datadog can also be configured to consume metrics from the <strong class="bold">Cassandra JMX</strong> interface <a id="_idIndexMarker594"/>using the generic JMX integration instead of <a id="_idIndexMarker595"/>the specific Cassandra integration used earlier. Datadog uses this generic method to consume JMX metrics from a third-party application for which there is no Datadog integration available. That approach is also applicable to your own Java application if it publishes application metrics via JMX:</p>
			<ol>
				<li value="1">Before the generic JMX integration is enabled, disable the Cassandra integration by renaming the <strong class="source-inline">conf.yaml</strong> configuration file at <strong class="source-inline">/etc/datadog-agent/conf.d/cassandra.d</strong> to <strong class="source-inline">conf.yaml.BAK</strong>.</li>
				<li>Make the <strong class="source-inline">conf.yaml</strong> configuration file from the example file, <strong class="source-inline">conf.yaml.example</strong>, available at <strong class="source-inline">/etc/datadog-agent/conf.d/jmx.d</strong>.<p>You can <a id="_idIndexMarker596"/>verify that the JMX port specified in the configuration file is <strong class="source-inline">7199</strong>:</p><p class="source-code">instances:</p><p class="source-code">  -</p><p class="source-code">    ## @param host - string - optional - default: localhost</p><p class="source-code">    ## JMX host to connect to.</p><p class="source-code">    #</p><p class="source-code">    host: localhost</p><p class="source-code">    ## @param port - integer - required</p><p class="source-code">    ## JMX port to connect to.</p><p class="source-code">    #</p><p class="source-code">    port: 7199</p></li>
				<li>Add these tags to the configuration file so you can filter the metrics later using them:<p class="source-code">             tags:</p><p class="source-code">                 - integration:jmx</p><p class="source-code">                 - metrics-type:default</p></li>
				<li>Restart the Datadog Agent to have the JMX integration enabled:<p class="source-code">$ sudo service datadog-agent restart</p></li>
				<li>Check the status of <strong class="source-inline">JMXFetch</strong> to make sure that the integration is working as expected:</li>
			</ol>
			<p class="source-code">$ sudo datadog-agent status</p>
			<p class="source-code">========</p>
			<p class="source-code">JMXFetch</p>
			<p class="source-code">========</p>
			<p class="source-code">  Initialized checks</p>
			<p class="source-code">  ==================</p>
			<p class="source-code">    jmx</p>
			<p class="source-code">      instance_name : jmx-localhost-7199</p>
			<p class="source-code">      message : &lt;no value&gt;</p>
			<p class="source-code">      metric_count : 27</p>
			<p class="source-code">      service_check_count : 0</p>
			<p class="source-code">      status : OK</p>
			<p class="source-code">  Failed checks</p>
			<p class="source-code">  =============</p>
			<p class="source-code">    no checks</p>
			<p>Note that <a id="_idIndexMarker597"/>Cassandra was mentioned under the <strong class="source-inline">JMXFetch</strong> status in the previous example and this time it is <strong class="source-inline">jmx</strong> instead.</p>
			<p>With the JMX integration working, you will be able to look up any default JMX metrics in the <strong class="bold">Metrics Explorer</strong> as in the following screenshot:</p>
			<div>
				<div id="_idContainer138" class="IMG---Figure">
					<img src="Images/Figure_10.3_B16483.jpg" alt="Figure 10.3 – Default metrics from the Cassandra JMX interface&#13;&#10;" width="1639" height="705"/>
				</div>
			</div>
			<p class="figure-caption">Figure 10.3 – Default metrics from the Cassandra JMX interface</p>
			<p>To collect the application-specific metrics from the JMX interface, those metrics should be specified explicitly in the configuration file for JMX integration as follows:</p>
			<p class="source-code"> conf:</p>
			<p class="source-code">  - include:</p>
			<p class="source-code">      domain: org.apache.cassandra.db</p>
			<p class="source-code">      type:</p>
			<p class="source-code">         - Caches</p>
			<p>This is just a <a id="_idIndexMarker598"/>sample set of the metrics available. Cassandra publishes a large set of metrics that you can look up in <strong class="source-inline">/etc/datadog-agent/conf.d/cassandra.d/metrics.yaml</strong>. The point to note here is that for Datadog to collect application metrics from the JMX interface, they must be indicated in the configuration file as you have done in the sample.</p>
			<p>Also, set the value of the <strong class="source-inline">metrics-type</strong> tag to <strong class="source-inline">cassandra</strong> for the easy filtering of metrics collected by Datadog from this example. As usual, for these configuration changes to take effect, you need to restart the Datadog Agent.</p>
			<p>You will be able to look up the new metrics collected by Datadog on the <strong class="bold">Metrics Explorer</strong>, as in the following screenshot:</p>
			<div>
				<div id="_idContainer139" class="IMG---Figure">
					<img src="Images/Figure_10.4_B16483.jpg" alt="Figure 10.4 – Application metrics specific to Cassandra&#13;&#10;" width="1624" height="674"/>
				</div>
			</div>
			<p class="figure-caption">Figure 10.4 – Application metrics specific to Cassandra</p>
			<p>The details <a id="_idIndexMarker599"/>of how Datadog integrates with JMX are <a id="_idIndexMarker600"/>available in the official documentation at <a href="https://docs.datadoghq.com/integrations/java">https://docs.datadoghq.com/integrations/java</a>. If you plan to configure Datadog for consuming metrics from your Java applications, that is a good starting point.</p>
			<p>In the next section, you will learn about StatsD, a popular monitoring standar<a id="_idTextAnchor313"/>d, and how Datadog supports it.</p>
			<h1 id="_idParaDest-178"><a id="_idTextAnchor314"/>Working with the DogStatsD interface</h1>
			<p><strong class="bold">StatsD</strong> is an <a id="_idIndexMarker601"/>open source project for publishing application metrics, originally conceived by <a id="_idIndexMarker602"/>the photo-sharing website <strong class="bold">Flickr</strong>. It went <a id="_idIndexMarker603"/>through multiple implementations and its latest version is a Node.js application. The StatsD code and documentation can be found at <a href="https://github.com/statsd/statsd">https://github.com/statsd/statsd</a>.</p>
			<p>The StatsD service typically runs on port <strong class="source-inline">8125</strong> and listens for statistics sent over UDP or TCP. By default, StatsD listens on the UDP port and sends aggregates to charting and monitoring applications such as Graphite. Datadog bundles this service as DogStatsD and it's available out of the box as a UDP service running on port <strong class="source-inline">8125</strong>, where the Datadog Agent runs.</p>
			<p>The status of the DogStatsD service can be checked for in the <strong class="source-inline">datadog-agent status</strong> output on the host where the Datadog Agent is running, and it would look like the following:</p>
			<p class="source-code">=========</p>
			<p class="source-code">DogStatsD</p>
			<p class="source-code">=========</p>
			<p class="source-code">  Event Packets: 0</p>
			<p class="source-code">  Event Parse Errors: 0</p>
			<p class="source-code">  Metric Packets: 5,107,230</p>
			<p class="source-code">  Metric Parse Errors: 0</p>
			<p class="source-code">  Service Check Packets: 0</p>
			<p class="source-code">  Service Check Parse Errors: 0</p>
			<p class="source-code">  Udp Bytes: 329,993,779</p>
			<p class="source-code">  Udp Packet Reading Errors: 0</p>
			<p class="source-code">  Udp Packets: 5,107,231</p>
			<p class="source-code">  Uds Bytes: 0</p>
			<p class="source-code">  Uds Origin Detection Errors: 0</p>
			<p class="source-code">  Uds Packet Reading Errors: 0</p>
			<p class="source-code">  Uds Packets: 0</p>
			<p>The preceding <a id="_idIndexMarker604"/>steps describe the process to access JMX metrics from a Java application. While some applications, such as Cassandra, provide application-specific integration to access JMX metrics, this generic integration is enough to consume JMX<a id="_idTextAnchor315"/> metrics from any Java application.</p>
			<h2 id="_idParaDest-179"><a id="_idTextAnchor316"/>Publishing metrics</h2>
			<p>Custom metric <a id="_idIndexMarker605"/>values can be published to the Datadog backend using various means so that they can be used in monitors and dashboards. As an example, an arbitrary metric value can be sent to the DogStatsD service running on localhost as in the following example:</p>
			<p class="source-code">$ echo "testdogstatsd:2|c" | nc -u -w0 127.0.0.1 8125</p>
			<p>The test metric value sent to the DogStatsD service will be consumed by Datadog as a backend application and that metric value can be looked up in the <strong class="bold">Metrics Explorer</strong>, as in the following screenshot:</p>
			<div>
				<div id="_idContainer140" class="IMG---Figure">
					<img src="Images/Figure_10.5_B16483.jpg" alt="Figure 10.5 – Looking up a metric value sent via DogStatsD in the Metrics Explorer&#13;&#10;" width="1650" height="624"/>
				</div>
			</div>
			<p class="figure-caption">Figure 10.5 – Looking up a metric value sent via DogStatsD in the Metrics Explorer</p>
			<p>Values for a <a id="_idIndexMarker606"/>variety of metric types, such as <strong class="bold">count</strong>, <strong class="bold">gauge</strong>, <strong class="bold">set</strong>, and <strong class="bold">histogram</strong>, can be posted to the Datadog backend using the DogStatsD interface. The following Python code example demonstrates how such a time series dataset could be published:</p>
			<p class="source-code"># post-metric-dogstatsd.py </p>
			<p class="source-code">import time</p>
			<p class="source-code">import random</p>
			<p class="source-code">from datadog import initialize, statsd</p>
			<p class="source-code">options = {</p>
			<p class="source-code">    'statsd_host':'127.0.0.1',</p>
			<p class="source-code">    'statsd_port':8125</p>
			<p class="source-code">}</p>
			<p class="source-code">initialize(**options)</p>
			<p class="source-code">while(1):</p>
			<p class="source-code">  # Get a random number to mimic the outdoor temperature.</p>
			<p class="source-code">  temp = random.randrange(50,70)</p>
			<p class="source-code">  statsd.gauge('statsd_test.outdoor_temp', temp, tags=["metric-source:dogstatsd"]</p>
			<p class="source-code">  )</p>
			<p class="source-code">  time.sleep(10)</p>
			<p>The program basically picks a random number between <strong class="source-inline">50</strong> and <strong class="source-inline">70</strong> and posts it as the outdoor temperature with the tag <strong class="source-inline">metric-source:dogstatsd</strong>. It runs in an infinite loop with a wait of <em class="italic">10</em> seconds for posting the metric each time, mimicking a time series dataset.</p>
			<p>An important <a id="_idIndexMarker607"/>thing you should note here is that there is no authentication required to post data. As long as the DogStatsD service port (by default <strong class="source-inline">8125</strong>) is open on the host where the Datadog Agent (DogStatsD is part of the Datadog Agent) runs, the preceding sample program can post the metrics. While this offers flexibility, it could also be a security hole if the network where the Datadog Agents run is not hardened.</p>
			<p>The data posted into the Datadog backend can be looked up in the <strong class="bold">Metrics Explorer</strong> using the metric name and tags if needed, as shown in the following screenshot:</p>
			<div>
				<div id="_idContainer141" class="IMG---Figure">
					<img src="Images/Figure_10.6_B16483.jpg" alt="Figure 10.6 – Time series metric values posted via the DogStatsD interface&#13;&#10;" width="1643" height="678"/>
				</div>
			</div>
			<p class="figure-caption">Figure 10.6 – Time series metric values posted via the DogStatsD interface</p>
			<p>StatsD is a general-purpose interface for publishing only metrics. However, the implementation by Datadog, DogStatsD, has extensions to support Datadog-specific resources such <a id="_idIndexMarker608"/>as events and service checks. Those additional features would be useful if DogStatsD were used as a hub for posting status and updates to the Datadog backend from your integration, especially if your application uses DogStatsD as the primary channel to publish monitoring <a id="_idTextAnchor317"/>information into the Datadog backend.</p>
			<h2 id="_idParaDest-180"><a id="_idTextAnchor318"/>Posting events</h2>
			<p>Posting an <a id="_idIndexMarker609"/>event to the Datadog events stream is simple and is illustrated in the following Python program:</p>
			<p class="source-code"># post-event-dogstatsd.py </p>
			<p class="source-code">from datadog import initialize, statsd</p>
			<p class="source-code">options = {</p>
			<p class="source-code">    'statsd_host':'127.0.0.1',</p>
			<p class="source-code">    'statsd_port':8125</p>
			<p class="source-code">}</p>
			<p class="source-code">initialize(**options)</p>
			<p class="source-code">title = "An event testing DogStatsD API"</p>
			<p class="source-code">text = "The DogStatsD API works fine! Just wanted to confirm it."</p>
			<p class="source-code">tags = ["event-source:dogstatsd-test"]</p>
			<p class="source-code">statsd.event(title, text, alert_type='info', tags=tags)</p>
			<p>This program <a id="_idIndexMarker610"/>will post an event to the events stream as shown in the following screenshot:</p>
			<div>
				<div id="_idContainer142" class="IMG---Figure">
					<img src="Images/Figure_10.7_B16483.jpg" alt="Figure 10.7 – Event posted by DogStatsD integration&#13;&#10;" width="1299" height="300"/>
				</div>
			</div>
			<p class="figure-caption">Figure 10.7 – Event posted by DogStatsD integration</p>
			<p>If you'd like to keep the StatsD interface more generic so other compatible monitoring applications can also consume metrics from it, it's better to use it only for publishing metrics following the StatsD standard. For publishing Datadog-specific resources, it's better to use the Datadog API.</p>
			<p>You have learned about three different monitoring standards, very different but very powerful options to roll out comprehensive monitoring solutions, and next, let's see what t<a id="_idTextAnchor319"/>he best practices related to them are.</p>
			<h1 id="_idParaDest-181"><a id="_idTextAnchor320"/>Best practices</h1>
			<p>Now, let's look at the best practices in making use of monitoring standards and the support provided by Datadog:</p>
			<ul>
				<li>When monitoring network devices using SNMP integration, the number of metrics that you must handle can be overwhelming. So, it's important to identify a few key metrics that can track performance and proactively identify issues, and implement monitors using those.</li>
				<li>JMX can be used to manipulate the workings of the application and such things shouldn't be implemented on the monitoring infrastructure side because monitoring is essentially a <em class="italic">ready-only</em> activity. In other words, monitoring applications won't initiate any corrective actions usually because monitoring is not considered part of the application system and the non-availability of a monitoring tool should not hamper the workings of the main application it monitors.</li>
				<li>StatsD is designed to handle only metrics that can be consumed by applications such as Datadog. It's better to publish only metrics via DogStatsD if there are multiple monitoring tools in your environment and Datadog is just one of them, to maintain the flexibility of moving data between multiple systems.</li>
				<li>As DogStatsD doesn't require any authentication besides access to the service port, the environment where DogStatsD runs, a host or container, should be secured well so no unauthori<a id="_idTextAnchor321"/>zed posting of information can happen.</li>
			</ul>
			<h1 id="_idParaDest-182"><a id="_idTextAnchor322"/>Summary</h1>
			<p>In this chapter, you have learned about three important monitoring standards, SNMP, JMX, and StatsD, that help with integrating network devices and custom applications in Datadog. As these are general-purpose standards, they are supported by most of the popular monitoring tools. The general pattern of using these standards is to stick with the standard features and not to use the extensions as the former approach would make your monitoring friendly with other monitoring tools as well.</p>
			<p>In the next chapter, the last chapter of the integration part of the book, we will discuss how integration is handled directly from custom applications. There are both official and community-developed programming libraries available to integrate applications directly with Datadog. We will explore how some of those libraries and the Datadog REST APIs are used to integrate custom applications with Datadog.</p>
		</div>
	</div></body></html>