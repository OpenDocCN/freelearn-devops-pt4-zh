<html><head></head><body>
		<div id="_idContainer083">
			<h1 id="_idParaDest-129"><em class="italic"><a id="_idTextAnchor131"/>Chapter 11</em>: Understanding Security in DevOps</h1>
			<p>You can't talk about the cloud, modern apps, and—for that matter—digital transformation without talking about security. A popular term is <em class="italic">security by design</em>. But even security by design needs to be embedded in the enterprise architecture. It also applies to the DevOps cycle: DevOps needs to have <em class="italic">security by design</em>. Before we can discuss this and principles such as zero-trust, we need to get a good understanding of security first and how it's impacting the DevOps practice. This chapter provides an introduction to security in DevOps. </p>
			<p>After completing this chapter, you will have learned why it's important to include security in the enterprise architecture and how an architect can collect and assess risks, and be able to identify what specific risks are in DevOps. You will also learn about setting security controls and what the main topics are that need to be addressed in DevSecOps.  </p>
			<p>In this chapter, we're going to cover the following main topics:</p>
			<ul>
				<li>Embedding security in enterprise architecture</li>
				<li>Understanding security risks in DevOps</li>
				<li>Getting DevSecOps-savvy</li>
				<li>Defining requirements and metrics</li>
			</ul>
			<h1 id="_idParaDest-130"><a id="_idTextAnchor132"/>Embedding security in enterprise architecture</h1>
			<p>It's a topic<a id="_idIndexMarker592"/> you can read about practically<a id="_idIndexMarker593"/> every day: businesses that have been hit by some sort of hack or attack. The smallest hole in a system will be found by criminals and exploited. Currently (in 2021), the most <em class="italic">popular</em> attacks are the following:</p>
			<ul>
				<li>Ransomware</li>
				<li>Phishing </li>
				<li>Denial of service</li>
			</ul>
			<p>The first two, ransomware and phishing, really exploit holes in the defense layer of enterprises. The last is basically about bombing a system so heavily with traffic that the system eventually collapses. All three are fairly easy to execute. In fact, you can buy software and even services that will launch an attack on the targeted address. And no, you don't have to go to the dark web for that. It's out there, in the open, on the <em class="italic">normal</em> internet. </p>
			<p>How can an enterprise protect itself from these attacks? First of all, it's important to realize that the IT of any enterprise has become more complex, as we have seen in previous chapters. IT systems are no longer only in one privately owned data center, but it has become an ecosystem using the public cloud, private stacks in privately owned data <a id="_idIndexMarker594"/>centers or<a id="_idIndexMarker595"/> colocations, <strong class="bold">Platform as a Service</strong> (<strong class="bold">PaaS</strong>), and <strong class="bold">Software as a Service</strong> (<strong class="bold">SaaS</strong>). Security must be intrinsic in every service that an enterprise uses. </p>
			<p>The<a id="_idIndexMarker596"/> four traditional principles of enterprise <a id="_idIndexMarker597"/>security are as follows:</p>
			<ul>
				<li>Prevention</li>
				<li>Detection</li>
				<li>Correction</li>
				<li>Direction</li>
			</ul>
			<p>The first three are about detecting security issues, correcting them with mitigating actions, but obviously, it's better if issues can be prevented—hence, prevention is priority one. Direction is about guidelines and guardrails: enterprises defining policies and security standards to keep all systems secure. That's where the fifth principle comes in: consistency. In an enterprise with various divisions, clusters, and teams, you need to ensure that security is implemented in every corner of that enterprise. You can't have one division or team not adhering to the enterprise's security. In other words: the strength of the chain is defined by the weakest link.</p>
			<p>So, where do we start with enterprise security? Enterprise architecture frameworks can help to get <a id="_idIndexMarker598"/>you started. An example is <strong class="bold">Sherwood Applied Business Security Architecture</strong> (<strong class="bold">SABSA</strong>), which offers a methodology to define security architecture. It consists of six layers, as shown in the following figure:</p>
			<div>
				<div id="_idContainer080" class="IMG---Figure">
					<img src="image/B17492_11_001.jpg" alt="Figure 11.1 – The SABSA model for security architecture&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 11.1 – The SABSA model for security architecture</p>
			<p><strong class="bold">Information Systems Audit and Control Association</strong> (<strong class="bold">ISACA</strong>) combines SABSA with<a id="_idIndexMarker599"/> the generally more<a id="_idIndexMarker600"/> known <strong class="bold">Control Objectives for Information and Related Technology</strong> (<strong class="bold">COBIT</strong>) five principles. These five principles are as follows:</p>
			<ul>
				<li>Meeting the needs of the stakeholders of the enterprise</li>
				<li>Covering <a id="_idIndexMarker601"/>the enterprise end <a id="_idIndexMarker602"/>to end</li>
				<li>Applying a single integrated framework</li>
				<li>Enabling a holistic approach</li>
				<li>Separating governance from management </li>
			</ul>
			<p>The combination of SABSA and COBIT leads to a top-down approach to define the architecture for the entire enterprise. The enterprise architect will have to execute at a minimum the following steps, in cooperation with the chief security architect:</p>
			<ol>
				<li>Identify the business goals: This is the first stage in enterprise architecture. Enterprise architecture always starts with the business strategy, goals, and objectives. </li>
				<li>Identify the business risks.</li>
				<li>Identify the required controls to manage risks. </li>
				<li>Design and implement these controls, for instance, the following:<p>- Security governance processes</p><p>- Access controls</p><p>- Incident management processes</p><p>- Certificate management processes</p></li>
				<li>Design physical architecture for, among others, used platforms, networks, operating systems, and datastores. The physical architecture should also include the cloud platforms and services such as PaaS and SaaS and DevOps practices such as CI/CD.</li>
				<li>Validate<a id="_idIndexMarker603"/> business and physical<a id="_idIndexMarker604"/> architecture to the compliancy and security standards and protocols the enterprise must adhere to.</li>
				<li>Define and implement operation architecture, for example, the following:<p>- Configuration management</p><p>- Monitoring</p><p>- Logging</p><p>- Change management</p><p class="callout-heading">Note</p><p class="callout">The preceding provided list is not meant to be exhaustive. In the <em class="italic">Further reading</em> section, we included a link to the ISACA journal about enterprise security architecture. In that journal, you will find more detail on the steps as described, using SABSA and COBIT. </p></li>
			</ol>
			<p>An important topic in defining the security architecture is understanding risks. What are the risks, which systems are at risk, and what is the impact on the enterprise and its business? DevOps<a id="_idIndexMarker605"/> brings along its own risks. We<a id="_idIndexMarker606"/> will discuss this in the next section.</p>
			<h1 id="_idParaDest-131"><a id="_idTextAnchor133"/>Understanding security risks in DevOps</h1>
			<p>There's a<a id="_idIndexMarker607"/> classic cartoon on the internet. It shows a boxing ring. The speaker announces an immense set of security tools and rules in the left corner of the ring. Then, in the right corner, he announces Dave: a nerdy-looking guy, wearing a shirt saying <em class="italic">human error</em>. The message: you can have every security system in the world, but it won't stop human error. And development is still mainly work done by humans. Humans make mistakes. Is that the biggest risk in DevOps or are there other specific risks that need attention? We will discuss this in this section.</p>
			<p>To answer the question of whether DevOps implies specific risks, yes. Implementing DevOps without paying attention to security will definitively increase the risk of attacks, simply by raising the attack surface of systems. There are three main topics that need to be addressed:</p>
			<ul>
				<li><strong class="bold">Access management</strong>: DevOps teams likely use code repositories that are manually accessed either by developers or by tools. Code needs to be protected, even when operating in open source mode, and code is shared so that more developers can contribute to the code. Even in that case, companies would want to regulate access to code so that it doesn't get out into the open, or worse, malicious code is injected. <p>You need a role-based access model to the code repositories: who has read rights and write rights and who has full access—and for what reason? </p><p>Keep track of the accounts. For example, GitHub companies can have internal repositories that only assigned staff—or tools—of that company can have access to. Within that internal repository, the administrator delegates the roles. Credentials are set according to the security policies of the company. A recommended way to keep access control is to implement <strong class="bold">privileged access management</strong> (<strong class="bold">PAM</strong>). </p><p>Because <a id="_idIndexMarker608"/>of DevOps, teams will have to create more privileged accounts that are shared—either manually or automatically—among developers and tools. These accounts also involve service accounts, encryption keys, SSH keys, and API certificates that are all kept in the repositories. Unauthorized access to these repositories is disastrous. </p><p>A PAM solution offers a way to authorize and audit any activity in the DevOps cycle. Most of these solutions use key vaults to keep access details secured and to authenticate and authorize users before they can actually access repositories. </p></li>
				<li><strong class="bold">Missing guardrails and guidelines for a DevOps way of working and tools</strong>: Access <a id="_idIndexMarker609"/>to code is one thing; the next thing is: what do we do with that code? It's very unlikely that enterprises would allow DevOps teams to just commit and push new code to production. First of all, the enterprise or chief architect—in most larger enterprises, there will be a group of leading architects—really needs to think of the preferred toolset. <p>It's important that every DevOps team uses that toolset instead of implementing tools of their own choice, however tempting it might be. The issue is that DevOps toolsets do not have a common standard for security policies, such as access control. That is something that the enterprise itself needs to establish and implement, which is easier if you go with one toolset.  </p><p>The same applies to the way of working: that needs to be consistent throughout the entire enterprise; we can't stress that enough. All of this has to be defined in a preferred technology list and DevOps guardrails and principles. Typically, there will be a master branch. New code will first be pushed to a separate branch—often referred to as the feature branch—where it's tested. After the validated, positive test results, the code is merged to the master. The master code or main branch is again stored in the repository. That principle is shown in the following figure:</p></li>
			</ul>
			<div>
				<div id="_idContainer081" class="IMG---Figure">
					<img src="image/B17492_11_002.jpg" alt="Figure 11.2 – Principle of merging new code&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 11.2 – Principle of merging new code</p>
			<p>The guardrails define when code is pulled from the repository, how it's committed to feature branches, and how it's tested and eventually released for merging with the master. </p>
			<ul>
				<li><strong class="bold">Focus on the development process and velocity, neglecting security</strong>: DevOps is all about gaining speed in development. That should never be an excuse to neglect security. In the following section, we will illustrate that with a real-life example.</li>
			</ul>
			<p> To summarize, DevOps<a id="_idIndexMarker610"/> security is about three topics:</p>
			<ul>
				<li><strong class="bold">Traceability</strong>: Track every action in the DevOps cycle and pipelines.</li>
				<li><strong class="bold">Auditability</strong>: Ensure that systems that are developed in DevOps are compliant with the security standards of the enterprise and the industry frameworks that the enterprise is submitted to. <a href="B17492_13_ePub_RK.xhtml#_idTextAnchor159"><em class="italic">Chapter 13</em></a>, <em class="italic">Working with DevSecOps Using Industry Security Frameworks</em>, talks about that in more detail. </li>
				<li><strong class="bold">Visibility</strong>: Have solid monitoring systems in place.</li>
			</ul>
			<p>Now we have a good understanding of the security risks in DevOps. In the next section, we will discuss how to get started with DevSecOps. </p>
			<h1 id="_idParaDest-132"><a id="_idTextAnchor134"/>Getting DevSecOps-savvy</h1>
			<p>Security starts <a id="_idIndexMarker611"/>with access to the repositories, the source of code where the DevOps cycle begins. As we've learned so far, we want to automate as much as we can in development, testing, and deployment. Next, by adopting DevOps, businesses want to speed up the development and deployment of new applications and features. Speed and agility might lead to security risks, because code is not sufficiently tested or, worse, it's pushed to production without applying the proper security policies to gain time. Let's illustrate that with a real-life example.</p>
			<p>Developers fork code from the repository and start working on that code. At a certain stage, it needs to be pushed to designated infrastructure to run that code. In development, the code runs fine, since it's not interfacing yet with production systems. As soon as the code is ready to release in production, it will need to establish those connections. Commonly, in enterprises, specific routing and firewall ports need to be opened to allow for that connectivity and transfer of traffic. </p>
			<p>Firewall rules and, more specifically, opening ports and assigning firewall rules are typically not done automatically; security engineers will want to assess the requests before they approve for settings to be implemented. In a lot of cases, this is really slowing down the whole DevOps and agile process. But in almost every enterprise this is the practice: security <a id="_idIndexMarker612"/>being the last stop before final deployment and not embedded in the DevOps cycle. Bypassing this is, however, a bad idea. It will increase the attack surface of code and systems. </p>
			<p>Bottom line: security must be embedded in DevOps—it makes development and deployment a shared responsibility of developers, operators, and security engineers. Security is not just the responsibility of the security team, but of the whole DevOps team. </p>
			<h2 id="_idParaDest-133"><a id="_idTextAnchor135"/>Starting points for DevSecOps</h2>
			<p>Security<a id="_idIndexMarker613"/> scanning starts as soon as code is pulled from repositories. The first thing to do is to have a <strong class="bold">role-based access control</strong> (<strong class="bold">RBAC</strong>) model <a id="_idIndexMarker614"/>applied to the repository. RBAC defines who has access and to what level. Is an identity allowed to only view code, or is full access granted to pull code, change code, and add code to the repository? Be aware that this doesn't necessarily have to be a person. DevOps tools are <em class="italic">identities</em> too and you need to think of the required access to these tools.  </p>
			<p>Throughout the DevOps cycle, code is constantly reviewed and scanned and tested on vulnerabilities. A very simple example is if connectivity to the internet is prohibited from an application and the code shows a pointer to port <strong class="source-inline">80</strong>, it might be flagged as a risk. It might be allowed if an application is relying on a service to which it connects through the internet, but then that needs to be verified against the security policies. Scanning, testing, and validation need to be done as early in the development process as possible. Also, here, the shift-left principle applies. </p>
			<p>The greatest benefit of embedding security in DevOps is the fact that we can also have automation to do checks and even apply patches and fixes as soon as a vulnerability is discovered or acknowledged. For instance, if a new release of a code base contains patches for <strong class="bold">Common Vulnerabilities and Exposures</strong> (<strong class="bold">CVEs</strong>), this can be injected into the <a id="_idIndexMarker615"/>security baseline and integrated with security testing procedures. Code is automatically checked against this new baseline. Software can execute tests, validate whether code is compliant, and if the code does not pass, flag in the case of issues or trigger automated remediation by installing the patches. This doesn't only apply to application code, but <a id="_idIndexMarker616"/>certainly also for the used infrastructure, operating systems, and middleware. </p>
			<h2 id="_idParaDest-134"><a id="_idTextAnchor136"/>DevSecOps using containers</h2>
			<p>Another<a id="_idIndexMarker617"/> example: a growing number of enterprises work with<a id="_idIndexMarker618"/> containers for code distribution. Just like virtual machines, containers also need to be compliant with security policies. Enterprises will likely use hardened containers, setting policies for the following:</p>
			<ul>
				<li><strong class="bold">Hardened host operating systems</strong>: Often, these are Linux operating systems that protect the host from breaches by infected containers. Examples are security packages that are applied to Linux hosts, such as SELinux and seccomp; these<a id="_idIndexMarker619"/> Linux distributions allow <strong class="bold">Mandatory Access Control</strong> (<strong class="bold">MAC</strong>) to<a id="_idIndexMarker620"/> the kernel <a id="_idIndexMarker621"/>settings. Enterprises can opt to develop their own <strong class="bold">Linux Security Modules</strong> (<strong class="bold">LSMs</strong>).</li>
				<li><strong class="bold">Container runtime security policies</strong>: Setting specific permissions for mounting containers, privileged containers, disabling SSH in containers, settings for binding ports, and exposing ports.</li>
			</ul>
			<p>The following figure shows the principle of CVE-based security scanning for containers:</p>
			<div>
				<div id="_idContainer082" class="IMG---Figure">
					<img src="image/B17492_11_003.jpg" alt="Figure 11.3 – Concept of Docker security scanning&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 11.3 – Concept of Docker security scanning</p>
			<p>The scan is done with the data from the CVE database. This can be data coming from, for example, <strong class="bold">National Institute of Standards and Technology</strong> (<strong class="bold">NIST</strong>), MITRE, or suppliers <a id="_idIndexMarker622"/>such as Microsoft who also issue CVE notifications for their products and services. After<a id="_idIndexMarker623"/> the scan, Docker <em class="italic">signs</em> the image that is pulled from the repository. For <a id="_idIndexMarker624"/>this, it uses Docker Notary, which verifies the image and prevents developers from using images that are not signed.</p>
			<p>We now have hardened, validated containers with specific privileges set. Now, the next most important thing is to control the settings; once the privileges to a container are set, there should be no way to alter these privileges. Containers should not be able to gain new privileges; otherwise, they are not hardened. In Docker, there's a simple way to check and set this. Using the following command, you can list all the security settings for containers:</p>
			<p class="source-code">docker ps --quiet --all | xargs docker inspect --format 'SecurityOpt={{ .HostConfig.SecurityOpt }}' SecurityOpt=[label=disable]</p>
			<p>It will return messages on hardening of the containers, creation of separate partitions for containers, and audit configuration for Docker files and directories.</p>
			<p>Next, set the no new privileges option:</p>
			<p class="source-code">docker run &lt;run-options&gt; --security-opt=no-new-privileges &lt;image&gt; &lt;cmd&gt;</p>
			<p>Obviously, these settings need to be continuously evaluated. DevSecOps is—as with DevOps—a repeatable, continuous process, aiming for continuous improvement. This means that goals, requirements, newly identified risks, and controls to mitigate these risks need to <a id="_idIndexMarker625"/>be assessed and addressed as enterprises adopt<a id="_idIndexMarker626"/> DevSecOps. We will discuss this in the final section of this chapter. </p>
			<h1 id="_idParaDest-135"><a id="_idTextAnchor137"/>Defining requirements and metrics</h1>
			<p>In the first <a id="_idIndexMarker627"/>section of this chapter, we discussed the steps that an architect must take to define enterprise security. In this section, we will explain how requirements and metrics can be collected, validated, and translated into controls and KPIs. </p>
			<h2 id="_idParaDest-136"><a id="_idTextAnchor138"/>Business goals</h2>
			<p>We've talked about <a id="_idIndexMarker628"/>this in <a href="B17492_01_ePub_RK.xhtml#_idTextAnchor013"><em class="italic">Chapter 1</em></a>, <em class="italic">Defining the Reference Architecture for Enterprise DevOps</em>, but obviously, it's important to understand the goals a business wants to achieve. What markets are they in, how do they serve customers in these markets, and what is the product portfolio? It does make a huge difference if a business is operating in financial products or healthcare. Their markets define the risk level. The risk for a bank or an investment company could be mainly financial, whereas for healthcare, the biggest risk could be involving the life of patients. The goals will be different too: an investment company might have the goal to support as many businesses with funds, whereas healthcare companies will have the goal to cure people with specific solutions. So, the business and the goals will set the business attributes. </p>
			<h2 id="_idParaDest-137"><a id="_idTextAnchor139"/>Business attributes</h2>
			<p>Attributes<a id="_idIndexMarker629"/> can be the availability of systems, the accuracy of data, and the privacy of customers. Next to the type of business and the goals, regulations will set levels of these attributes. Financial institutions will have to adhere to financial national and international regulations such as <strong class="bold">Sarbanes-Oxley</strong> (<strong class="bold">SOx</strong>) and <a id="_idIndexMarker630"/>healthcare providers to the <strong class="bold">Health Insurance Portability and Accountability Act</strong> (<strong class="bold">HIPAA</strong>), as an example. Be<a id="_idIndexMarker631"/> aware that these regulations<a id="_idIndexMarker632"/> are audited. We will talk about this in <a href="B17492_13_ePub_RK.xhtml#_idTextAnchor159"><em class="italic">Chapter 13</em></a>, <em class="italic">Working with DevSecOps Using Industry Security Frameworks</em>.  </p>
			<h2 id="_idParaDest-138"><a id="_idTextAnchor140"/>Risks</h2>
			<p>Based on the<a id="_idIndexMarker633"/> business goals and the attributes, we can define the risks. What will be a major threat to the business if a certain event occurs? If you think about availability, it could be the situation that an enterprise doesn't have a means to execute a failover if crucial systems stop for any reason. And how can the enterprise recover from major outages? Not having redundant systems can be a risk, just like vulnerabilities in applications that can be exploited by criminals. The MITRE ATT&amp;CK framework can help in identifying risks; it will also be discussed in <a href="B17492_13_ePub_RK.xhtml#_idTextAnchor159"><em class="italic">Chapter 13</em></a>, <em class="italic">Working with DevSecOps Using Industry Security Frameworks</em>.   </p>
			<h2 id="_idParaDest-139"><a id="_idTextAnchor141"/>Controls</h2>
			<p>The next <a id="_idIndexMarker634"/>step is to define risk controls. Examples can be the following:</p>
			<ul>
				<li>Create a business continuity plan that caters to disaster recovery.</li>
				<li>Implement <a id="_idIndexMarker635"/>a <strong class="bold">public key infrastructure</strong> (<strong class="bold">PKI</strong>) with identity stores and vaults to ensure the privacy of users.</li>
				<li>Implement application firewalls with specific firewall rules to protect critical systems.  </li>
				<li>Set controls to manage, update, and upgrade all of the preceding: maintaining the business continuity plans, managing the security policies, and evaluating the firewall settings on a regular basis.</li>
			</ul>
			<p>Validate that these controls are linked with the attributes and the applied security frameworks for auditing. For every control, there has to be a rationale that can be verified in audits. </p>
			<p>The good news is that enterprises do not have to think about these controls all by themselves. The <strong class="bold">Center of Internet Security</strong> (<strong class="bold">CIS</strong>) has defined controls for a lot of IT domains: the<a id="_idIndexMarker636"/> CIS Controls framework. The basic CIS Controls include controlled use of privileged access, secure configuration of all IT system assets (including containers), and control of network ports, protocols, and services. For Azure, AWS, GCP, as well as for container platforms such as Kubernetes, CIS has defined specific controls.  </p>
			<p>CIS, MITRE, and other frameworks and how they impact DevOps will be further discussed in<a id="_idIndexMarker637"/> later chapters, but first, we will learn what a DevSecOps architecture should include. That's the topic for the next chapter.</p>
			<h1 id="_idParaDest-140"><a id="_idTextAnchor142"/>Summary</h1>
			<p>This chapter provided an introduction to integrating security into DevOps, discussing the concept of DevSecOps. We've discussed the importance of security in enterprise architecture and how this is also driving security in enterprise DevOps. We've learned about the main security risks that are involved in adopting DevOps, and we had a closer look at securing containers as one of the most used technologies in DevOps practices. With that, we defined some critical starting points for adopting DevSecOps. </p>
			<p>In the final section, we learned how to collect and assess risks from business goals and business attributes, introducing commonly used security controls frameworks such as the frameworks by CIS. With some examples, we explored the various steps that an architect needs to take to have a security standard that can also be applied to DevOps.</p>
			<p>In the next chapter, we will explore the architecture of DevSecOps in more detail, before we start integrating security policies and industry frameworks with a DevOps way of working. </p>
			<h1 id="_idParaDest-141"><a id="_idTextAnchor143"/>Questions</h1>
			<ol>
				<li value="1">Name the four traditional principles of enterprise security.</li>
				<li>What does Docker use to validate signed containers?</li>
				<li>True or false: Security should not hinder speed and agility in DevOps.</li>
			</ol>
			<h1 id="_idParaDest-142"><a id="_idTextAnchor144"/>Further reading</h1>
			<ul>
				<li>ISACA journal about enterprise security architecture using SABSA and COBIT: <a href="https://www.isaca.org/resources/isaca-journal/issues/2017/volume-4/enterprise-security-architecturea-top-down-approach ">https://www.isaca.org/resources/isaca-journal/issues/2017/volume-4/enterprise-security-architecturea-top-down-approach</a></li>
				<li>CIS website: <a href="http://cissecurity.org">cissecurity.org</a></li>
			</ul>
		</div>
	</body></html>