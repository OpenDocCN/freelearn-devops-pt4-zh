<html><head></head><body>
        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Docker - Using Docker with Vagrant</h1>
                
            
            <article>
                
<p class="calibre2">In this chapter, we will learn how to provision a Vagrant machine using Docker. This is not to be confused with the Docker provider, which is used to power and manage Vagrant machines. We currently use the VirtualBox provider for this.</p>
<p class="calibre2">We'll dive deep into the Docker provisioner and see what is available within Vagrant when using Docker. Specifically, you'll learn about the following topics:</p>
<ul class="calibre10">
<li class="calibre11">Understanding Docker</li>
<li class="calibre11">Key components of Docker (Docker Hub, containers, and images)</li>
<li class="calibre11">How to find and pull in an image from the Docker Hub</li>
<li class="calibre11">Basic usage such as running a container</li>
<li class="calibre11">The Docker-specific configuration within Vagrant</li>
</ul>
<p class="calibre2">By the end of this chapter, you should have a good understanding of what Docker is and how it can be used as a provisioner with Vagrant.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Understanding Docker</h1>
                
            
            <article>
                
<p class="calibre2"><span class="calibre6">You've probably heard of Docker—even if you've never used it. It's incredibly popular at the moment and is being used/adopted by many companies. Docker is a tool that allows you to manage your applications using a type of virtualization known as containerization. Applications are bundled into containers and can be hosted in the cloud or using your own hardware. There are various tools used to manage Docker containers such as Docker Swarm and Kubernetes.</span></p>
<p class="calibre2">Docker was released in March 2015 by Solomon Hykes. Its current release is 18.06.1 and it is written using the Go programming language. It can run on Windows, Linux, and macOS.</p>
<p class="calibre2"/>
<p class="calibre2">Docker belongs to the same virtualization family as Vagrant, VMWare, and VirtualBox. It also belongs to the same provisioning and infrastructure family as Chef, Puppet, and Ansible.</p>
<p class="calibre2">There are many benefits from using Docker over other virtualization software. It's mainly a lightweight and faster alternative because it runs in a different way from traditional virtual machines.</p>
<p class="calibre2">Docker uses the Docker Engine, which sits on top of the operating system and shares components such as the host OS kernel, libraries, and binaries (which are read-only). This means that containers can be started fast and are small in size. Traditional virtualization uses a hypervisor that sits on top of the operating system; this in turn creates whole new OSes with their own libraries and binaries. The advantage of this is that you can package up a whole system, but this also means that it can be slow and large in terms of file size. Of course, both alternatives have their benefits, depending on your requirements.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Key components of Docker</h1>
                
            
            <article>
                
<p class="calibre2">When talking about Docker, there are a few main components that you will hear mentioned. Let's learn more about each one in the following subsections.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Containers</h1>
                
            
            <article>
                
<p class="calibre2">A container is portable, lightweight, and a package of software that has everything needed to run an application. A container runs on the Docker Engine and shares the host operating system's kernel between other containers. A container is basically a running instance of a Docker image.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Images</h1>
                
            
            <article>
                
<p class="calibre2">A Docker image is a file that is made up of different layers. These layers include tools, dependencies, and system libraries, which are then used to create a container. There are often base images that available to use, such as the Ubuntu one. You can use multiple images to separate your application, for example, having an image for your web server (Nginx) and another for your database (MySQL).</p>
<p class="calibre2"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Registry</h1>
                
            
            <article>
                
<p class="calibre2">Docker offers a hosted registry called Docker Hub. It allows you to browse, pull, and store Docker images. You can think of it like the Vagrant Cloud, which offers hosting for Vagrant boxes along with other features such as downloading and searching boxes. We'll learn more about Docker Hub in the following section.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Service</h1>
                
            
            <article>
                
<p class="calibre2">In Docker, services can be thought of as groupings of specific application logic. Services are often containers in production and help manage your Docker setup. There are specific tools that are used to manage and orchestrate Docker, such as Docker Swarm and Kubernetes. When you reach a certain scale or require more control, then these tools are useful.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Using the Docker Hub to find Docker images</h1>
                
            
            <article>
                
<p class="calibre2">Docker Hub is Docker's online, hosted registry for Docker images. It allows you to search, pull, and store images in the cloud. It's similar to Hashicorp's Vagrant Cloud or the Chef Supermarket. You can access the Hub by visiting its website at <a href="https://hub.docker.com/" class="calibre9">https://hub.docker.com/</a><a href="https://hub.docker.com/" class="calibre9">.</a></p>
<p class="calibre2">Docker Hub also offers some really interesting features, including the following:</p>
<ul class="calibre10">
<li class="calibre11">Build and test your images</li>
<li class="calibre11">It links to Docker Cloud, which allows you to deploy your images to your hosts</li>
<li class="calibre11">Workflow/pipeline automation</li>
<li class="calibre11">A centralized resource for container discovery</li>
<li class="calibre11">User accounts</li>
<li class="calibre11">Public and private registries</li>
</ul>
<p class="calibre2">Let's take a look at the Docker Hub and use the search facility to find an image:</p>
<ol class="calibre13">
<li value="1" class="calibre11">Visit the website at <a href="https://hub.docker.com/" class="calibre9">https://hub.docker.com/</a>.</li>
<li value="2" class="calibre11">Click on the <span>Explore</span> link in the top right menu.</li>
<li value="3" class="calibre11">You'll now see the <span>Explore</span> screen, which lists the top official repositories.</li>
</ol>
<ol start="4" class="calibre13">
<li value="4" class="calibre11">In the top left, there is a search bar. Let's search for <kbd class="calibre12">memcached</kbd> and view the results:</li>
</ol>
<p class="cdpaligncenter1"><img class="alignnone55" src="../images/00127.jpeg"/></p>
<p class="calibre56">We can see that it found <span class="calibre6">1169</span> repositories, and the top one is the official repository, with over 1 thousand stars and 10 million pulls.</p>
<ol start="5" class="calibre13">
<li value="5" class="calibre11">You can now filter the search results by clicking on the drop-down that has the <span>All</span> value selected:</li>
</ol>
<p class="cdpaligncenter1"><br class="calibre5"/>
<img class="alignnone56" src="../images/00128.jpeg"/></p>
<ol start="6" class="calibre13">
<li value="6" class="calibre11">Let's click the top result and learn more about the official <span>memcached</span> repository:</li>
</ol>
<p class="cdpaligncenter1"><img class="alignnone57" src="../images/00129.jpeg"/></p>
<p class="cdpalignleft3">Here, you can see lots of information related to this image. There is a <span class="calibre6">Short Description</span> and a <span class="calibre6">Full Description</span>. The <span class="calibre6">Full Description</span> has information regarding how to use the image, licensing, and different versions that are available. To the right, you can see the <span class="calibre6">Docker Pull Command</span>, which is <kbd class="calibre12">docker pull memcached</kbd>. This is the command that you can run to pull an image down so that you can use it with your installation of Docker.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Basic usage – running a container</h1>
                
            
            <article>
                
<p class="calibre2">We won't delve too deeply into running Docker as a separate tool. Our focus in this chapter is on using Docker to provision a Vagrant machine, which it does inside Vagrant during the boot up process. We will learn a few basic Docker commands—mainly those that are used during provisioning—to give you a better understanding of what is happening. </p>
<p class="calibre2">If you are unsure of what specific command you need or would like to learn more, then you can run the <kbd class="calibre12">docker</kbd> command, which will list all available commands. This will show you the usage, command options, management commands, and general commands.</p>
<div class="packt_infobox">Please note: you must have Docker installed to run these commands, or you will get an error.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">pull</h1>
                
            
            <article>
                
<p class="calibre2">To pull an image down from the Docker Hub, you can use the <kbd class="calibre12">docker pull</kbd> command. An example of this command would be pulling down the <kbd class="calibre12">nginx</kbd> image by running the following:</p>
<pre class="calibre17"><strong class="calibre1">docker pull nginx</strong></pre>
<p class="calibre2">This will result in an output similar to the one shown in the following screenshot:</p>
<p class="cdpaligncenter1"><img class="alignnone58" src="../images/00130.jpeg"/></p>
<p class="calibre2">We can then check to make sure that this image is available by running the <kbd class="calibre12">docker images</kbd> command:</p>
<p class="cdpaligncenter1"><img class="alignnone59" src="../images/00131.jpeg"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">run</h1>
                
            
            <article>
                
<p class="calibre2">To start a new container, you can use the <kbd class="calibre12">docker run</kbd> command. An example of this command would be running the <kbd class="calibre12">nginx</kbd> image:</p>
<pre class="calibre17"><strong class="calibre1">docker run nginx</strong></pre>
<p class="calibre2">This will start the Nginx container. You won't see anything on the screen apart from the command:</p>
<p class="cdpaligncenter1"><img class="alignnone60" src="../images/00132.jpeg"/></p>
<p class="calibre2">If you open another tab in your Terminal and run the <kbd class="calibre12">docker ps -a</kbd> command, you will see any active running containers. In the following screenshot, you'll see our Docker container:</p>
<p class="cdpaligncenter1"><img class="alignnone61" src="../images/00133.jpeg"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">stop</h1>
                
            
            <article>
                
<p class="calibre2">To stop a Docker container, you can use the<span class="calibre6"> </span><kbd class="calibre12">docker stop</kbd><span class="calibre6"> </span>command. <span class="calibre6">An example of this command would be running the following:</span></p>
<pre class="calibre17"><strong class="calibre1">docker stop sleepy_dijkstra</strong></pre>
<p class="calibre2"><span class="calibre6">We have passed in the <kbd class="calibre12">sleepy_dijkstra</kbd> container name from the preceding example. We have found the image name by running </span><kbd class="calibre12">docker ps -a</kbd><span class="calibre6">. If we now run the </span><kbd class="calibre12">docker ps -a</kbd><span class="calibre6"> command, we'll see that the status is <kbd class="calibre12">Exited (0) 3 seconds ago</kbd>. In the following screenshot, you'll be able to see the two commands and their output:</span></p>
<p class="cdpaligncenter1"><img class="alignnone62" src="../images/00134.jpeg"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">start</h1>
                
            
            <article>
                
<p class="calibre2">This command is used to start a previously stopped Docker container. To do this, you can use the <kbd class="calibre12">docker start</kbd> command. An example of this command would be running the following:</p>
<pre class="calibre17"><strong class="calibre1">docker start sleepy_dijkstra</strong></pre>
<p class="calibre2"/>
<p class="calibre2">We have passed in the <kbd class="calibre12">sleepy_dijkstra</kbd> container name from the preceding example. We have found the image name by running <kbd class="calibre12">docker ps -a</kbd>. If we now run the <kbd class="calibre12">docker ps -a</kbd> command, we'll see that the status is <kbd class="calibre12">Up 4 seconds</kbd>. In the following screenshot, you'll be able to see the two commands and their output:</p>
<p class="cdpaligncenter1"><img class="alignnone63" src="../images/00135.jpeg"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">search</h1>
                
            
            <article>
                
<p class="calibre2">You can search the Docker Hub from the command line using the <kbd class="calibre12">docker search</kbd> command. <span class="calibre6">An example of this command would be searching for <kbd class="calibre12">ubuntu</kbd> by using the following command:</span></p>
<pre class="calibre17"><strong class="calibre1">docker search ubuntu</strong></pre>
<p class="calibre2"><span class="calibre6">This will result in an output similar to the one shown in the following screenshot:</span></p>
<p class="cdpaligncenter1"><img class="alignnone64" src="../images/00136.jpeg"/></p>
<p class="calibre2">Similar to searching on the Docker Hub website, you will be presented with a list of search results. These are ordered by the highest, starting at the top. You'll see the image name, description, star count, and whether it's official. You can then pull an image down using the <kbd class="calibre12">docker pull [imagename]</kbd> command.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Using Docker to provision a Vagrant machine</h1>
                
            
            <article>
                
<p class="calibre2">Now that we've learned a bit about Docker, we can get to the fun part! In this section, we will go through an example of using Docker to provision a Vagrant machine. One thing to note is that Vagrant will attempt to install Docker so that you don't have to. Interestingly, Docker is run within the Vagrant machine, not on your host machine. You'll see this as you will be able to SSH into the Vagrant machine and run Docker commands.</p>
<p class="calibre2">Let's get started and provision our Vagrant machine using Docker:</p>
<ol start="1" class="calibre13">
<li value="1" class="calibre11">To begin, run the <kbd class="calibre12">vagrant init -m</kbd> command to create a minimal Vagrantfile.</li>
<li value="2" class="calibre11">In our Vagrantfile, let's add in a provision block:</li>
</ol>
<pre class="calibre59"> Vagrant.configure("2") do |config|<br class="title-page-name"/>     config.vm.box = "ubuntu/xenial64"<br class="title-page-name"/>     config.vm.network "forwarded_port", guest: 80, host: 8081<br class="title-page-name"/>     config.vm.provision "docker" do |doc|<br class="title-page-name"/>         doc.run "nginx", args: "-p 80:80"<br class="title-page-name"/>     end<br class="title-page-name"/> end</pre>
<p class="calibre56">We've set a few default values to get started. We are using the <kbd class="calibre12">"ubuntu/xenial64"</kbd> box and we specify that the networking should use a port forwarder from the host (<kbd class="calibre12">8081</kbd>) to the guest (<kbd class="calibre12">80</kbd>).</p>
<p class="calibre56">In the provision block, we are setting <kbd class="calibre12">docker</kbd> to be our provisioner. We are using the <kbd class="calibre12">run</kbd> option and passing in the <kbd class="calibre12">"nginx"</kbd> image. Alongside the run option, we are passing in the <kbd class="calibre12">args</kbd> option and setting the value to <kbd class="calibre12">"-p 80:80"</kbd>, which tells Docker to publish the container's port to the host machine. This is why we are setting the port forwarding to the guest <kbd class="calibre12">port 80</kbd>. Due to this, we can access the Docker container:</p>
<ol start="3" class="calibre13">
<li value="3" class="calibre11">Now, let's run the <kbd class="calibre12">vagrant up</kbd> command to get the machine started. During the provisioning stage, you should see something similar to the following screenshot:</li>
</ol>
<p class="cdpaligncenter1"><img class="alignnone65" src="../images/00137.jpeg"/></p>
<p class="calibre2"/>
<p class="calibre2"/>
<p class="calibre56">There are a few steps here. First, it runs the <kbd class="calibre12">docker </kbd>provisioner, and then installs Docker onto the machine. Once installed, it will start the Docker containers (this is what we specified by using the <kbd class="calibre12">run </kbd>option in the Vagrantfile) and you'll see the container output as <kbd class="calibre12">-- Container: nginx</kbd>.</p>
<ol start="4" class="calibre13">
<li value="4" class="calibre11">To test whether everything was successful, we can open a browser and visit the following link: <kbd class="calibre12">http://localhost:8081</kbd>. This should connect us to the container using Vagrant's port forwarding:</li>
</ol>
<p class="cdpaligncenter1"><img class="alignnone66" src="../images/00138.jpeg"/></p>
<p class="calibre56">In the preceding screenshot, we can see Nginx's default welcome page. This is great news and means everything is working as it should.</p>
<ol start="5" class="calibre13">
<li value="5" class="calibre11">We can also SSH into the Vagrant machine and access Docker through the Terminal. Run the <kbd class="calibre12">vagrant ssh</kbd> command to gain access.</li>
<li value="6" class="calibre11">Once in the machine, run the <kbd class="calibre12">docker ps -a</kbd> command to list any actively running containers:</li>
</ol>
<p class="cdpaligncenter1"><img class="alignnone67" src="../images/00139.jpeg"/></p>
<p class="calibre56">In the preceding screenshot, we can see the <kbd class="calibre12">nginx </kbd>container running.</p>
<p class="calibre2">Congratulations! You have successfully provisioned a Vagrant machine using Docker. It's a fairly straightforward process, but can be very powerful. If you use Docker for other parts of the application lifestyle, then you can now try using it for development.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Docker-specific configuration in Vagrant</h1>
                
            
            <article>
                
<p class="calibre2">When it comes to the Docker-specific options in the Vagrantfile, there are none that are required. If do not enter any options, then Vagrant will simply attempt to install Docker—unless you already have it installed.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Images</h1>
                
            
            <article>
                
<p class="calibre2">If you want Docker to use specific images, then you can pass in an array of image names. In your Vagrantfile, an example would be as follows:</p>
<pre class="calibre17">Vagrant.configure("2") do |config|<br class="title-page-name"/>     config.vm.provision "docker", images: ["nginx"]<br class="title-page-name"/> end</pre>
<p class="calibre2">This would attempt to pull down the <kbd class="calibre12">nginx</kbd> image. There are other options that can be used to handle images: <kbd class="calibre12">build_image</kbd> and  <kbd class="calibre12">pull_images</kbd>; we will cover these in the following sections.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">build_image</h1>
                
            
            <article>
                
<p class="calibre2">As well as running and pulling down images, you can actually build an image before it is then used as part of provisioning and its process. The build is done on the Vagrant guest machine and must be available for Docker to access. It runs the <kbd class="calibre12">docker build</kbd> command, so all you have to do is pass in the location of the Dockerfile.</p>
<p class="calibre2">An example of using this in a Vagrantfile would be as follows:</p>
<pre class="calibre17">Vagrant.configure("2") do |config|<br class="title-page-name"/>     config.vm.provision "docker" do |dock|<br class="title-page-name"/>         dock.build_image "/vagrant/provision"<br class="title-page-name"/>     end<br class="title-page-name"/> end</pre>
<p class="calibre2">Here, we are using the <kbd class="calibre12">dock.build_image</kbd> key inside the provision block to set the directory (where our Dockerfile is located).</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">args</h1>
                
            
            <article>
                
<p class="calibre2">With the <kbd class="calibre12">build_images</kbd> key, there is an additional parameter called <kbd class="calibre12">args</kbd>. This allows you to pass in arguments that will be run as part of the <kbd class="calibre12">docker build</kbd> command. The value will be passed as a string.</p>
<p class="calibre2">To add in the <kbd class="calibre12">--pull</kbd> flag (which always attempts to pull in the latest version of the image) into the build process, the Vagrantfile might look as follows:</p>
<pre class="calibre17">Vagrant.configure("2") do |config|<br class="title-page-name"/>     config.vm.provision "docker" do |dock|<br class="title-page-name"/>         dock.build_image "/vagrant/provision", args: "--pull"<br class="title-page-name"/>     end<br class="title-page-name"/> end</pre>
<p class="calibre2">In order to pass in multiple parameters/flags, just add them into the string. There is no need to use an array.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">pull_images</h1>
                
            
            <article>
                
<p class="calibre2">Another way to handle images during provisioning is to use the <kbd class="calibre12">pull_images</kbd> option in your Vagrantfile. This option will attempt to pull the images from the Docker registry and use those.</p>
<p class="calibre2">An example Vagrantfile would be as follows:</p>
<pre class="calibre17">Vagrant.configure("2") do |config|<br class="title-page-name"/>     config.vm.provision "docker" do |dock|<br class="title-page-name"/>         dock.pull_images "nginx"<br class="title-page-name"/>         dock.pull_images "mysql"<br class="title-page-name"/>     end<br class="title-page-name"/> end</pre>
<p class="calibre2">This code attempts to pull down the <kbd class="calibre12">nginx</kbd> and <kbd class="calibre12">mysql</kbd> images. The  <kbd class="calibre12">pull_images</kbd> option can be used multiple times and will append them, while the <kbd class="calibre12">images</kbd> option can only be used once.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">run</h1>
                
            
            <article>
                
<p class="calibre2">The <kbd class="calibre12">run</kbd> option is used in the Vagrantfile to start and run specific Docker containers. This is done during the <kbd class="calibre12">vagrant up</kbd> process. It runs the <kbd class="calibre12">docker run</kbd> command to achieve this.</p>
<p class="calibre2">Here's how it would be used in a Vagrantfile:</p>
<pre class="calibre17">Vagrant.configure("2") do |config|<br class="title-page-name"/>     config.vm.provision "docker" do |dock|<br class="title-page-name"/>         dock.run "nginx"<br class="title-page-name"/>     end<br class="title-page-name"/> end</pre>
<p class="calibre2">In the preceding example, we are instructing the Docker provisioner to run the <kbd class="calibre12">nginx</kbd> container. You can use the <kbd class="calibre12">run</kbd> option multiple times, but if you use the same image, then you must define seperate names/identifiers for them. The following is an example of using the <kbd class="calibre12">nginx</kbd> image twice with different names:</p>
<pre class="calibre17">Vagrant.configure("2") do |config|<br class="title-page-name"/>     config.vm.provision "docker" do |dock|<br class="title-page-name"/>         dock.run "load-balancer", image: "nginx"<br class="title-page-name"/>         dock.run "web-server", image: "nginx"<br class="title-page-name"/>     end<br class="title-page-name"/> end</pre>
<p class="calibre2">One can be identified as the load balancer and the other as the web server. You can choose the names here, but I find that descriptive ones are usually the best and easiest to understand.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">image</h1>
                
            
            <article>
                
<p class="calibre2">This is actually the default value when using the <kbd class="calibre12">run</kbd> option, and it's the first parameter you pass, for example, the image name. It can, however, be passed as an option, such as in the preceding example, when you wish to run two of the same images.</p>
<p class="calibre2">An example within the provision block of your Vagrantfile would be as follows:</p>
<pre class="calibre17"><strong class="calibre1">dock.run "lb1", image: "nginx"</strong></pre>
<p class="calibre2">In the preceding example, we are referencing the <kbd class="calibre12">run</kbd> option and also the <kbd class="calibre12">image</kbd> option. The image we have chosen is <kbd class="calibre12">nginx</kbd>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">cmd</h1>
                
            
            <article>
                
<p class="calibre2">This <kbd class="calibre12">cmd</kbd> option allows you to pass in a command that will be run within the container. If this value is omitted, then the container's default value will be used. This could be the <kbd class="calibre12">cmd</kbd> value, which is supplied in the Dockerfile.</p>
<p class="calibre2">An example within the provision block of your Vagrantfile would be as follows:</p>
<pre class="calibre17"><strong class="calibre1">dock.run "ubuntu", cmd: "echo $HOME"</strong></pre>
<p class="calibre2">In the preceding example, we are referencing the <kbd class="calibre12">run</kbd> option and the <kbd class="calibre12">cmd</kbd> option. The <kbd class="calibre12">cmd</kbd> option will simply run that command within the container. It just accesses the <kbd class="calibre12">$HOME</kbd> environment variable, which is the user's home path directory.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">args</h1>
                
            
            <article>
                
<p class="calibre2">Using the <kbd class="calibre12">args</kbd> option allows you to pass in arguments to the <kbd class="calibre12">docker run</kbd> command. This is similar to the additional <kbd class="calibre12">args</kbd> option that's used in the <kbd class="calibre12">build_image</kbd> section. This can be useful if you require something more granular than the general command. </p>
<p class="calibre2"><span class="calibre6">An example within the provision block of your Vagrantfile would be as follows:</span></p>
<pre class="calibre17"><strong class="calibre1">dock.run "ubuntu", args: "--name ubuntumain"</strong></pre>
<p class="calibre2">In the preceding example, we are referencing the <kbd class="calibre12">run</kbd> command and the <kbd class="calibre12">args</kbd> option. The <kbd class="calibre12">args</kbd> option will pass in the parameter to the <kbd class="calibre12">docker run</kbd> command when necessary. In our example, it is passing the <kbd class="calibre12">--name</kbd> flag with a value of <kbd class="calibre12">ubuntumain</kbd>. This will be the name of the container.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">auto_assign_name</h1>
                
            
            <article>
                
<p class="calibre2">Using the <kbd class="calibre12">auto_assign_name</kbd> option allows you to automatically name the Docker containers. It works by essentially passing the <kbd class="calibre12">--name</kbd> flag and a value. This is enabled by default, and the value is true. One thing to note is that any slashes in the image name (for example, <kbd class="calibre12">base/archlinux</kbd>) will be replaced with dashes so that the image will become <kbd class="calibre12">base-archlinux</kbd>. The name is selected by the first argument of the run.</p>
<p class="calibre2">In the following example we are setting the <kbd class="calibre12">run</kbd> option value to <kbd class="calibre12">nginx</kbd> so that the container will automatically be named to <kbd class="calibre12">nginx</kbd>. The only way to override this is to set the <kbd class="calibre12">auto_assign_name</kbd> value to <kbd class="calibre12">false</kbd>, which we will do:</p>
<pre class="calibre17"><strong class="calibre1">dock.run "nginx", auto_assign_name: false</strong></pre>
<p class="calibre2"/>
<p class="calibre2"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">deamonize</h1>
                
            
            <article>
                
<p class="calibre2"><span class="calibre6">This option allows you to deamonize the containers. The default value for this option is true. It passes the <kbd class="calibre12">-d</kbd> flag into the <kbd class="calibre12">docker run</kbd> command. If you do not want to deamonize the containers, then you can set the value to false.</span></p>
<p class="calibre2"><span class="calibre6">An example within the provision block of your Vagrantfile would be as follows:</span></p>
<pre class="calibre17"><strong class="calibre1">dock.run "nginx", deamonize: false</strong></pre>
<p class="calibre2">In the preceding example, we are using the <kbd class="calibre12">run</kbd> option and the <kbd class="calibre12">deamonize</kbd> option. The deamonize option is passing the false value to let Docker know that we do not want it to run as a deamon, so the <kbd class="calibre12">-d</kbd> flag will not be passed to Docker.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">restart</h1>
                
            
            <article>
                
<p class="calibre2">This option allows you to set the restart policy for the container. The default value is <kbd class="calibre12">always</kbd>, but it also supports <kbd class="calibre12">no</kbd>, <kbd class="calibre12">unless-stopped</kbd>, and <kbd class="calibre12">on-failure</kbd> . This option can be useful if you have a specific requirement and need control over the restart policy for one or more of your containers.</p>
<p class="calibre2"><span class="calibre6">An example within the provision block of your Vagrantfile would be as follows:</span></p>
<pre class="calibre17"><strong class="calibre1">dock.run "nginx", restart: "no"</strong></pre>
<p class="calibre2">In the preceding example, we are using the <kbd class="calibre12">run</kbd> option and the <kbd class="calibre12">restart</kbd> option. The restart option is passing the <kbd class="calibre12">no</kbd> value, which tells Docker not to restart when a container exits.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">post_install_provisioner</h1>
                
            
            <article>
                
<p class="calibre2">Using the <kbd class="calibre12">post_install_provisioner</kbd> option offers you an easy way to run a provisioner once the original provisioner has run. This sounds a little confusing, but it essentially allows you to create a new provision block within the Docker one. You could use Docker as your main provisioner and then, inside, use a shell provisioner which runs when the Docker one has finished.</p>
<p class="calibre2"/>
<p class="calibre2"/>
<p class="calibre2">An example Vagrantfile would look like this:</p>
<pre class="calibre17">Vagrant.configure("2") do |config|<br class="title-page-name"/>    config.vm.box = "ubuntu/xenial64"<br class="title-page-name"/>    config.vm.network "forwarded_port", guest: 80, host: 8081<br class="title-page-name"/>    config.vm.provision "docker" do |dock|<br class="title-page-name"/>        dock.post_install_provision "shell", inline:"touch /vagrant/index.html &amp;&amp; echo '&lt;h1&gt;Hello World!&lt;/h1&gt;' &gt; /vagrant/index.html"<br class="title-page-name"/>        dock.run "nginx",<br class="title-page-name"/>            args: "-p 80:80 -v '/vagrant:/usr/share/nginx/html'"<br class="title-page-name"/>    end<br class="title-page-name"/>end</pre>
<p class="calibre2">The preceding code will run the <kbd class="calibre12">nginx</kbd> Docker image and then use the shell provisioner. The shell provisioner will run a script inside the Vagrant machine that simply changes the content in the default landing page of Nginx.</p>
<p class="calibre2">When you run the preceding example, you should be able to visit <kbd class="calibre12">http://localhost:8081</kbd> on your host machine (once the provisioning has completed) and see a large <kbd class="calibre12">Hello World!</kbd> message.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Summary</h1>
                
            
            <article>
                
<p class="calibre2">In this chapter, we have learned about Docker and how it can be used to configure a Vagrant machine. We have also learned how Docker works, how to use Docker Hub, and the various Docker-specific Vagrantfile options that are available. You should now be able to experiment with Docker as a provider.</p>
<p class="calibre2">In <a target="_blank" href="part0286.html#8GO0S0-d86fec2f29de42f086efd11bc5538d9c" class="calibre9">Chapter 13</a>, <em class="calibre16">Puppet <span class="calibre6">–</span> Using Puppet to Provision a Vagrant Box</em>, you will learn how to use Puppet to provision a Vagrant machine. We'll focus on the two main supported types—Puppet Apply and Puppet Agent.</p>


            </article>

            
        </section>
    </body></html>