- en: Setting Up a Test Environment
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The best way to learn is by doing. This chapter will help you quickly spin up
    an environment for testing so that you can safely experiment without worrying
    too much. It will provide several configuration examples and tips on how to get
    things running. This type of environment will also be used throughout this book
    in several different scenarios.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
- en: 'In brief, the following topics will be covered in this chapter:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
- en: Code organization
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Machine requirements
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Spinning up a new environment
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Code organization
  id: totrans-6
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: While the examples and code listings in this book can be used directly without
    any supporting material, a companion Git repository is also provided to help you
    with the setup process and the automation of test environments so that you can
    follow along easily.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
- en: 'In this section, we''re going to explore how that repository is organized,
    explain some choices that are made in terms of the automation of the test environments,
    and give some pointers on how to customize them:'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  id: totrans-9
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'The root structure of the repository shown here should be fairly easy to understand:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
- en: One directory per chapter that needs its own test environment (aptly named `chapter`,
    followed by the chapter number)
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A `cache` directory, which will hold downloaded packages so that rebuilding
    test environments becomes as fast as possible
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A `utils` directory, where default versions and parameters of the test environments
    can be found (and changed if wanted), along with some helper functions
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Next, we are going to drill down and have a closer look at each of these, like
    so:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  id: totrans-15
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'In the `utils` directory, the following files can be found:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
- en: '`defaults.sh`: Here, the versions of each component in the Prometheus stack
    (such as Prometheus itself, along with exporters and Alertmanager, among others)
    that will be used in the test environments can be found.'
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`vagrant_defaults.rb`: This file controls a couple of tunable parameters for
    the virtual machines that are used to run the test environments, like the amount
    of RAM each virtual machine will have, which base image to use, and what the environment''s
    internal network will look like.'
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`helpers.sh`: This is a shell library that''s used by the provisioning scripts
    with some helper functions to manage the downloading and caching of archives:'
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE2]'
  id: totrans-20
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'While each test environment will differ in some ways between chapters, the
    basic structure will remain the same:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
- en: A `Vagrantfile` to describe how many virtual machines are needed for the test
    environment, along with how to configure and provision them
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A `configs` directory to house configuration files that will be used in the
    provision step
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A `provision` directory with scripts to download, install, and configure each
    of the Prometheus components that are required for the current test environment
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'We can see an example of this by looking at the tree structure for this chapter:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  id: totrans-26
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: The `configs` directory has sub-directories for each of the components that's
    used in this chapter. The `provision` directory follows the same model, with an
    added `hosts.sh` shell script to automate the management of `/etc/hosts` file
    on the guests.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
- en: 'By now, the question of *Why not just use configuration management?* might
    have risen in the minds of some. All the provisioning automation was done in a
    shell for a couple of reasons:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
- en: This was a conscious effort to expose every detail, not abstract them away.
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Shell scripting is the lowest common denominator of automation in Unix-like
    systems.
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The purpose of this book is to focus on the inner workings of Prometheus, not
    the specific implementation of a given configuration management tool.
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Machine requirements
  id: totrans-32
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The machine requirements for this setup can comfortably run on a modern laptop,
    as long it has CPU virtualization extensions enabled and its operating system
    is compatible with the software requirements. All the software requirements that
    are covered here were thought-out. We will be using free and open source software,
    so no extra cost should be necessary when you try out the test environments.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
- en: Hardware requirements
  id: totrans-34
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The minimal requirements for the host deploying the provided examples are as
    follows:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
- en: At least 2 CPU cores
  id: totrans-36
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: At least 4 GB of memory
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: At least 20 GB of free disk space
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: With these specifications, you should be able to spin up the test environment
    without encountering any issues.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
- en: Regarding connectivity, the host machine should have internet access and the
    ability to resolve external DNS records. The provision scripts will have to download
    dependencies during their execution, though most of the dependencies will be cached
    locally to avoid being downloaded in every deployment.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
- en: 'The default network for the example environment is `192.168.42.0/24`, and the
    following diagram illustrates the configuration you would get when running this
    chapter''s example:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/326e5b7a-81c1-4e5e-8eda-b3893b98753c.png)'
  id: totrans-42
  prefs: []
  type: TYPE_IMG
- en: 'Figure 3.1: Virtual network configuration'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
- en: When launching a test environment, the subnet `192.168.42.0/24` will be used.
    Each environment belongs to a specific chapter, and should be destroyed before
    switching to a new one. If you encounter a conflict with your local address space,
    you can change the test environment subnet by editing the NETWORK option in the
    provided `./utils/vagrant_defaults.rb` file.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
- en: Recommended software
  id: totrans-45
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The environment was tested using the following software, and so the standard
    disclaimer applies: although other versions within their respective major releases
    might work without additional changes, care should be taken when using versions
    that are different from the ones we''ve recommended:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
- en: '| Software | Version |'
  id: totrans-47
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  id: totrans-48
  prefs: []
  type: TYPE_TB
- en: '| VirtualBox | 6.0.4 |'
  id: totrans-49
  prefs: []
  type: TYPE_TB
- en: '| Vagrant | 2.2.4 |'
  id: totrans-50
  prefs: []
  type: TYPE_TB
- en: '| Minikube | 1.0.1 |'
  id: totrans-51
  prefs: []
  type: TYPE_TB
- en: '| kubectl | 1.14.1 |'
  id: totrans-52
  prefs: []
  type: TYPE_TB
- en: 'Regarding supported operating systems, all the tests were conducted using the
    following versions of Linux and macOS:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
- en: Ubuntu 18.04 LTS (Bionic Beaver)
  id: totrans-54
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: macOS 10.14.3 (Mojave)
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Other operating systems/distributions might be able to run the test environments,
    although it's not ensured.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
- en: VirtualBox
  id: totrans-57
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Oracle VirtualBox is a free and open source hypervisor, which runs on all major
    operating systems (macOS, Linux, and Windows). It allows you to not only launch
    virtual machine images, but also create virtual networks and mount host filesystem
    paths into the guests, among other features. This software requires hardware virtualization
    to be enabled.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
- en: You can find all the installation files for VirtualBox at [https://www.virtualbox.org/wiki/Downloads ](https://www.virtualbox.org/wiki/Downloads)
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
- en: Vagrant
  id: totrans-60
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: HashiCorp Vagrant allows for the creation of portable environments. In the context
    of this book, it will become the interface with VirtualBox, allowing for the launch
    and configuration of virtual machines. In our examples, we chose to use Chef Bento
    as the virtual machine image, as recommended by HashiCorp.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
- en: You can find all the installation files for Vagrant at [https://www.vagrantup.com/downloads.html](https://www.vagrantup.com/downloads.html)
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
- en: Minikube
  id: totrans-63
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Minikube is the easiest way to test Kubernetes locally. We will be using Minikube
    in conjunction with VirtualBox to guarantee that the examples in this book behave
    the same way across operating systems.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
- en: You can find all the installation information for Minikube at [https://kubernetes.io/docs/tasks/tools/install-minikube/#install-minikube](https://kubernetes.io/docs/tasks/tools/install-minikube/#install-minikube).
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
- en: kubectl
  id: totrans-66
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The client tool for interacting with the Kubernetes API is called **kubectl**,
    and is fundamental for some of the examples in this book.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
- en: You can find all the installation information for kubectl at [https://kubernetes.io/docs/tasks/tools/install-minikube/#install-kubectl](https://kubernetes.io/docs/tasks/tools/install-minikube/#install-kubectl).
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
- en: Spinning up a new environment
  id: totrans-69
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: After you have ensured that all the required software is available on your host,
    you may proceed with one or both of the following walkthroughs.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
- en: Automated deployment walkthrough
  id: totrans-71
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: This method will abstract all the deployment and configuration details, allowing
    you to have a fully running test environment with only a couple of commands. You'll
    still be able to connect to each of the guest instances and change configurations.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
- en: 'The steps to spin up the environment are as follows:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
- en: 'Clone this book''s repository:'
  id: totrans-74
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE4]'
  id: totrans-75
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Step into the newly created directory and chapter number:'
  id: totrans-76
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE5]'
  id: totrans-77
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Spin up this chapter''s test environment:'
  id: totrans-78
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE6]'
  id: totrans-79
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: The first run will take a few minutes because the Vagrant image and some of
    the software dependencies will have to be downloaded. After this setup process,
    subsequent runs will be much faster since all those assets will be kept in the
    cache.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
- en: 'Now, you can run `vagrant status`. You will be presented with the following
    output:'
  id: totrans-81
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE7]'
  id: totrans-82
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Prometheus
  id: totrans-83
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'You can find the Prometheus HTTP endpoint at `http://192.168.42.10:9090/targets`:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/949b676e-24f7-4732-be42-a6f2f78522cf.png)'
  id: totrans-85
  prefs: []
  type: TYPE_IMG
- en: 'Figure 3.2: Prometheus HTTP endpoint – showing all configured targets'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
- en: Grafana
  id: totrans-87
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: You can find the Grafana HTTP endpoint at `http://192.168.42.11:3000`.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
- en: 'Grafana''s default credentials are as follows:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
- en: '| **Username** | **Password** |'
  id: totrans-90
  prefs: []
  type: TYPE_TB
- en: '| `admin` | `admin` |'
  id: totrans-91
  prefs: []
  type: TYPE_TB
- en: 'You''ll be greeted by two automatically provisioned dashboards. We''ll have
    an entire chapter dedicated to Grafana and dashboards later in this book, in [Chapter
    10](02331a85-bad1-4a4f-b56e-150b69b46edb.xhtml), *Discovering and Creating Grafana
    Dashboards*:'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/509dc02d-bdad-4b95-b34a-5a64b0a83e46.png)'
  id: totrans-93
  prefs: []
  type: TYPE_IMG
- en: 'Figure 3.3: An automatically provisioned Grafana dashboard'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
- en: Alertmanager
  id: totrans-95
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: You can find the Alertmanager HTTP endpoint at `http://192.168.42.12:9093`.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
- en: 'We also configured an always-firing alert on Prometheus and a custom Alertmanager
    integration via webhook so that you can start to get a feel for how both are related.
    We''ll go into much more detail on Alertmanager in a different chapter, but for
    now, you may look at the logs that the example alert generates in the code repository
    root at `./cache/alerting.log`:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/ac51788e-a403-430a-adfe-b3fdc06f5926.png)'
  id: totrans-98
  prefs: []
  type: TYPE_IMG
- en: 'Figure 3.4: Alertmanager – firing an example alert'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
- en: Cleanup
  id: totrans-100
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'When you''ve finish testing, just make sure that''s you''re inside `chapter03`
    and execute the following:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  id: totrans-102
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Don't worry too much – you can easily spin up the environment again if you so
    desire.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
- en: Advanced deployment walkthrough
  id: totrans-104
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Using this method, the guest virtual machines will be spun up but no provision
    will take place, so you''ll need to set up the environment yourself with a hands-on
    approach. We won''t go into detailed explanations of the available configuration
    files and command-line arguments – those will be thoroughly explored in the following
    chapters. So, as a high-level overview, for each software component, we are going
    to do the following:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
- en: Set up basic networking between the virtual machines in the environment
  id: totrans-106
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Create an individual system user
  id: totrans-107
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Download and install the software
  id: totrans-108
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Create support files and directories
  id: totrans-109
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Start the daemon
  id: totrans-110
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'To start, clone this book''s repository:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Step into the newly created directory and chapter number and run Vagrant without
    provisioning the guest instances. This will leave you with just off-the-shelf
    virtual machines:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  id: totrans-114
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: After all the guests have started, we will continue by configuring our instances
    one by one.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
- en: Prometheus
  id: totrans-116
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Perform the following steps:'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
- en: 'Log in to the Prometheus guest instance:'
  id: totrans-118
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE11]'
  id: totrans-119
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'Inside the guest instance, drop to the root:'
  id: totrans-120
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE12]'
  id: totrans-121
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Add all the guests'' addresses to the instance host''s file:'
  id: totrans-122
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE13]'
  id: totrans-123
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Create a new system user:'
  id: totrans-124
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE14]'
  id: totrans-125
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'Go into `/tmp` and download the Prometheus archive:'
  id: totrans-126
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE15]'
  id: totrans-127
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'Uncompress the archive:'
  id: totrans-128
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE16]'
  id: totrans-129
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'Place every file in its correct location:'
  id: totrans-130
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE17]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'Add a `systemd` unit file for the Prometheus service:'
  id: totrans-132
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE18]'
  id: totrans-133
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'Enable and start the Prometheus service:'
  id: totrans-134
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE19]'
  id: totrans-135
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: You should now have the Prometheus HTTP endpoint available on your host.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
- en: 'Exit the root account and then the Vagrant user account:'
  id: totrans-137
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE20]'
  id: totrans-138
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: Grafana
  id: totrans-139
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Perform the following steps:'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
- en: 'Log in to the Grafana guest instance:'
  id: totrans-141
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE21]'
  id: totrans-142
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'Inside the guest instance, drop to the root:'
  id: totrans-143
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE22]'
  id: totrans-144
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'Add all the guests'' addresses to the instance host''s file:'
  id: totrans-145
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE23]'
  id: totrans-146
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'Go into `/tmp` and download the Grafana package:'
  id: totrans-147
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE24]'
  id: totrans-148
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'Install the package and all dependencies:'
  id: totrans-149
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE25]'
  id: totrans-150
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'Place all the provided configurations on their correct location:'
  id: totrans-151
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE26]'
  id: totrans-152
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'Enable and start the Grafana service:'
  id: totrans-153
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE27]'
  id: totrans-154
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: You should now have the Grafana HTTP endpoint available on your host.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
- en: 'Exit the root account and then the Vagrant user account:'
  id: totrans-156
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE28]'
  id: totrans-157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: Alertmanager
  id: totrans-158
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Perform the following steps:'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
- en: 'Log in to the Alertmanager guest instance:'
  id: totrans-160
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE29]'
  id: totrans-161
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'Inside the guest instance, drop to the root:'
  id: totrans-162
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE30]'
  id: totrans-163
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'Add all the guests'' addresses to the instance host''s file:'
  id: totrans-164
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE31]'
  id: totrans-165
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'Create a new system user:'
  id: totrans-166
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE32]'
  id: totrans-167
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'Go into `/tmp` and download the Alertmanager archive:'
  id: totrans-168
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE33]'
  id: totrans-169
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'Uncompress the archive:'
  id: totrans-170
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE34]'
  id: totrans-171
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'Place every file in its correct location:'
  id: totrans-172
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE35]'
  id: totrans-173
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'Add a `systemd` unit file for the Alertmanager service:'
  id: totrans-174
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE36]'
  id: totrans-175
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'Enable and start the Alertmanager service:'
  id: totrans-176
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE37]'
  id: totrans-177
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: You should now have the Alertmanager HTTP endpoint available on your host.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
- en: 'Exit the root account and then the Vagrant user account:'
  id: totrans-179
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE38]'
  id: totrans-180
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: Node Exporter
  id: totrans-181
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'To ensure that system-level metrics will be collected, Node Exporter must be
    installed in all three virtual machines. To log in to each virtual machine, use
    the commands that we explored in the previous sections:'
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
- en: 'Inside the guest instance, drop to the root:'
  id: totrans-183
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE39]'
  id: totrans-184
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'Create a new system user:'
  id: totrans-185
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE40]'
  id: totrans-186
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: 'Go into `/tmp` and download the Node Exporter archive:'
  id: totrans-187
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE41]'
  id: totrans-188
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: 'Place every file in its correct location:'
  id: totrans-189
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE42]'
  id: totrans-190
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: 'Add a `systemd` unit file for the Node Exporter service:'
  id: totrans-191
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE43]'
  id: totrans-192
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: 'Enable and start the Node Exporter service:'
  id: totrans-193
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE44]'
  id: totrans-194
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: 'Exit the root account and then the Vagrant user account:'
  id: totrans-195
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE45]'
  id: totrans-196
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: Validating your test environment
  id: totrans-197
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'After running through these steps, you''ll be able to validate your environment
    by using the following endpoints on your host machine:'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
- en: '| **Service** | **Endpoint** |'
  id: totrans-199
  prefs: []
  type: TYPE_TB
- en: '| Prometheus | `http://192.168.42.10:9090` |'
  id: totrans-200
  prefs: []
  type: TYPE_TB
- en: '| Grafana | `http://192.168.42.11:3000` |'
  id: totrans-201
  prefs: []
  type: TYPE_TB
- en: '| Alertmanager | `http://192.168.42.12:9093` |'
  id: totrans-202
  prefs: []
  type: TYPE_TB
- en: Summary
  id: totrans-203
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: With a test environment at your disposal, you can now inspect, change, and validate
    configurations without worrying about breaking things. Throughout this book, this
    approach to testing will be used extensively, because nothing beats experimenting
    when learning new skills.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
- en: In the next chapter, we'll go over the fundamentals of Prometheus metrics. The
    test environment we just built will be helpful to demonstrate them.
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
- en: Questions
  id: totrans-206
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: What are the recommended tools to set up a reproducible test environment?
  id: totrans-207
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Where can you change the default versions of the Prometheus components for the
    test environment?
  id: totrans-208
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: What is the default subnet that's used on all examples?
  id: totrans-209
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: At a high level, what are the steps to get a Prometheus instance up and running?
  id: totrans-210
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Node Exporter is installed on every guest instance. How can you quickly validate
    if all of them are exposing metrics correctly?
  id: totrans-211
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In our test environment, where can you find the alert log?
  id: totrans-212
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How can you create a clean test environment from scratch?
  id: totrans-213
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Further reading
  id: totrans-214
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '**Bash manual**: [https://www.gnu.org/software/bash/manual/html_node/index.html](https://www.gnu.org/software/bash/manual/html_node/index.html)'
  id: totrans-215
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Bash 手册**: [https://www.gnu.org/software/bash/manual/html_node/index.html](https://www.gnu.org/software/bash/manual/html_node/index.html)'
- en: '**Recommended Vagrant boxes**: [https://www.vagrantup.com/docs/boxes.html](https://www.vagrantup.com/docs/boxes.html)'
  id: totrans-216
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**推荐的 Vagrant 镜像**: [https://www.vagrantup.com/docs/boxes.html](https://www.vagrantup.com/docs/boxes.html)'
