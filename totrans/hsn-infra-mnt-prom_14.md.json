["```\ncd ./chapter11/\n```", "```\nvagrant global-status\nvagrant up\n```", "```\nvagrant status\n```", "```\nCurrent machine states:\n\nprometheus running (virtualbox)\nalertmanager01 running (virtualbox)\nalertmanager02 running (virtualbox)\nalertmanager03 running (virtualbox)\n\nThis environment represents multiple VMs. The VMs are all listed\nabove with their current state. For more information about a specific\nVM, run `vagrant status NAME`.\n```", "```\nvagrant destroy -f\n```", "```\nvagrant@prometheus:~$ cat /etc/prometheus/prometheus.yml\nglobal:\n external_labels:\n dc: dc1\nalerting:\n alertmanagers:\n - static_configs:\n - targets:\n - alertmanager01:9093\n - alertmanager02:9093\n - alertmanager03:9093\n...\n```", "```\n  alert_relabel_configs:\n  - source_labels: [environment]\n    regex: development\n    action: drop\n```", "```\nglobal:\n  smtp_smarthost: 'mail.example.com:25'\n  smtp_from: 'example@example.com'\n...\n```", "```\nroute:\n  receiver: operations\n  group_by: ['alertname', 'job']\n  group_wait: 30s\n  group_interval: 5m\n  repeat_interval: 4h\n\n  routes:\n  - match_re:\n      job: (checkoutService|paymentService)\n    receiver: yellow-squad-email\n    routes:\n    - match:\n        severity: pager\n      receiver: yellow-squad-pager\n...\n```", "```\ninhibit_rules:\n  - source_match:\n      job: 'icmp'\n    target_match_re:\n      alertname: (AlertmanagerDown|NodeExporterDown)\n    equal: ['base_instance']\n```", "```\nroute:\n  receiver: operations\n...\nreceivers:\n- name: 'operations'\n  webhook_configs:\n  - url: 'http://127.0.0.1:5001'\n...\n```", "```\ntemplates:\n  - /etc/alertmanager/templates/*.tmpl\n```", "```\nvagrant ssh alertmanager02\n```", "```\nvagrant@alertmanager02:~$ amtool alert --alertmanager.url http://alertmanager02:9093\nAlertname Starts At Summary \ndeadmanswitch 2019-03-31 14:49:45 UTC \nInstanceDown 2019-03-31 15:48:30 UTC\n```", "```\nvagrant@alertmanager02:~$ amtool alert add alertname=\"ExampleAlert\" example=\"amtool\" --alertmanager.url http://alertmanager02:9093\n```", "```\nvagrant@alertmanager02:~$ amtool alert --alertmanager.url http://alertmanager02:9093\nAlertname Starts At Summary \ndeadmanswitch 2019-03-31 14:49:45 UTC \nInstanceDown 2019-03-31 15:48:30 UTC \nExampleAlert 2019-03-31 15:55:00 UTC \n```", "```\nvagrant@alertmanager01:~$ amtool alert add --help\n```", "```\nvagrant@alertmanager02:~$ amtool silence --alertmanager.url http://alertmanager02:9093\nID Matchers Ends At Created By Comment\n```", "```\nvagrant@alertmanager02:~$ amtool silence add 'example=\"amtool\"' --comment \"ups\" --alertmanager.url http://alertmanager02:9093\n1afa55af-306a-408e-b85c-95b1af0d7169\n\nvagrant@alertmanager02:~$ amtool silence --alertmanager.url http://alertmanager02:9093\nID Matchers Ends At Created By Comment \n1afa55af-306a-408e-b85c-95b1af0d7169 example=amtool 2019-03-31 16:58:08 UTC vagrant ups\n```", "```\nvagrant@alertmanager02:~$ amtool alert --alertmanager.url http://alertmanager02:9093\nAlertname Starts At Summary \ndeadmanswitch 2019-03-31 14:49:45 UTC \nInstanceDown 2019-03-31 15:48:30 UTC\n```", "```\nvagrant@alertmanager02:~$ amtool silence expire 1afa55af-306a-408e-b85c-95b1af0d7169 --alertmanager.url http://alertmanager02:9093\n\nvagrant@alertmanager02:~$ amtool silence --alertmanager.url http://alertmanager02:9093\nID Matchers Ends At Created By Comment\n```", "```\nvagrant@alertmanager02:~$ amtool check-config /etc/alertmanager/alertmanager.yml \nChecking '/etc/alertmanager/alertmanager.yml' SUCCESS\nFound:\n - global config\n - route\n - 1 inhibit rules\n - 8 receivers\n - 1 templates\n  SUCCESS\n```", "```\nvagrant@alertmanager02:~$ amtool config --alertmanager.url http://alertmanager02:9093\nglobal:\n  resolve_timeout: 5m\n  http_config: {}\n  smtp_from: example@example.com\n  smtp_hello: localhost\n  smtp_smarthost: example.com:25\n  smtp_require_tls: true\n  slack_api_url: <secret>\n...\n```", "```\nvagrant@alertmanager02:~$ amtool config routes --alertmanager.url http://alertmanager02:9093\nRouting tree:\n.\n└── default-route receiver: operations\n    ├── {job=~\"^(?:^(?:(checkoutService|paymentService))$)$\"} receiver: yellow-squad-email\n    │ └── {severity=\"pager\"} receiver: yellow-squad-pager\n    ├── {job=\"firewall\"} receiver: purple-squad-email\n    │ ├── {severity=\"slack\"} receiver: purple-squad-slack\n    │ └── {severity=\"pager\"} receiver: purple-squad-pager\n    └── {alertname=~\"^(?:^(?:(AlertmanagerDown|NodeExporterDown))$)$\"} receiver: violet-squad-slack\n        └── {severity=\"pager\"} receiver: violet-squad-pager\n```", "```\nvagrant@alertmanager02:~$ amtool config routes test 'job=\"checkoutService\"' --config.file /etc/alertmanager/alertmanager.yml \nyellow-squad-email\n```", "```\ncd ./chapter11/provision/kubernetes/\n```", "```\nminikube status\nminikube delete\n```", "```\nminikube start \\\n  --cpus=2 \\\n  --memory=3072 \\\n  --kubernetes-version=\"v1.14.0\" \\\n  --vm-driver=virtualbox\n```", "```\nkubectl apply -f ./bootstrap/\n\nkubectl rollout status deployment/prometheus-operator -n monitoring\n```", "```\nkubectl apply -f ./prometheus/\n\nkubectl rollout status statefulset/prometheus-k8s -n monitoring\n```", "```\nkubectl apply -f ./services/\n\nkubectl get servicemonitors --all-namespaces\n```", "```\nkubectl apply -f ./alertmanager/alertmanager-serviceaccount.yaml\n```", "```\nkubectl apply -f ./alertmanager/alertmanager-configuration.yaml\n```", "```\nglobal:\n\nroute:\n  receiver: \"null\"\n  group_by:\n    - job\n  group_interval: 3m\n  repeat_interval: 3h\n  routes:\n    - match:\n        alertname: deadmanswitch\n      receiver: \"null\"\n\nreceivers:\n  - name: \"null\"\n```", "```\nkubectl apply -f ./alertmanager/alertmanager-deploy.yaml\n```", "```\n...\nkind: Alertmanager\n...\nspec:\n  baseImage: quay.io/prometheus/alertmanager\n...\n  replicas: 3\n...\n```", "```\nkubectl rollout status statefulset/alertmanager-k8s -n monitoring\n```", "```\nkubectl apply -f ./alertmanager/alertmanager-service.yaml\n\nkubectl apply -f ./alertmanager/alertmanager-servicemonitor.yaml\n```", "```\nkubectl apply -f ./alertmanager/alerting-rules.yaml\n```", "```\n...\nkind: PrometheusRule\n...\nspec:\n  groups:\n  - name: exporter-down\n    rules:\n    - alert: AlertmanagerDown\n      annotations:\n        description: Alertmanager is not being scraped.\n        troubleshooting: https://github.com/kubernetes-monitoring/kubernetes-mixin/blob/master/runbook.md\n      expr: |\n        absent(up{job=\"alertmanager-service\",namespace=\"monitoring\"} == 1)\n      for: 5m\n      labels:\n        severity: page\n...\n```", "```\nminikube service alertmanager-service -n monitoring\n\nminikube service prometheus-service -n monitoring\n```", "```\nminikube delete\n```", "```\nglobal:\n  smtp_smarthost: 'smtp.gmail.com:587'\n  smtp_from: 'alertmanager@example.com'\n  smtp_auth_username: 'alertmanager@example.com'\n  smtp_auth_identity: 'alertmanager@example.com'\n  smtp_auth_password: '<generated_token>'\n\nroute: \n  receiver: 'default'\n\nreceivers:\n- name: 'default'\n  email_configs:\n  - to: 'squad@example.com'\n```", "```\nglobal:\n  slack_api_url: 'https://hooks.slack.com/services/TOKEN'\n\nroute:\n  receiver: 'default'\n\nreceivers:\n- name: 'default'\n  slack_configs:\n  - channel: '#alerting'\n```", "```\nglobal:\n  pagerduty_url: 'https://events.pagerduty.com/v2/enqueue'\n\nroute:\n  receiver: 'default'\n\nreceivers:\n- name: 'default'\n  pagerduty_configs:\n  - service_key: 'PAGERDUTYSQUADTOKENEXAMPLE'\n```", "```\nglobal:\n\nroute:\n  receiver: 'default'\n\nreceivers:\n- name: 'default'\n  webhook_configs:\n  - url: 'http://127.0.0.1:5001'\n```", "```\nglobal:\n\nroute:\n  receiver: 'null'\n\nreceivers:\n- name: 'null'\n```", "```\n  - alert: deadmanswitch\n    expr: vector(42)\n```", "```\n    {\n        \"labels\": {\n            \"alertname\": \"deadmanswitch\",\n            \"dc\": \"dc1\"\n        },\n        \"annotations\": {},\n        \"startsAt\": \"2019-04-02T19:11:30.04754979Z\",\n        \"endsAt\": \"2019-04-02T19:14:30.04754979Z\",\n        \"generatorURL\": \"http://prometheus:9090/graph?g0.expr=vector%2842%29&g0.tab=1\"\n    }\n```", "```\nglobal:\n  slack_api_url: 'https://hooks.slack.com/services/TOKEN'\n\nroute:\n  receiver: 'default'\n\nreceivers:\n- name: 'default'\n  slack_configs:\n  - channel: '#alerting'\n```", "```\n...\nreceivers:\n- name: default\n  slack_configs:\n  - send_resolved: false\n    http_config: {}\n    api_url: <secret>\n    channel: '#alerting'\n    username: '{{ template \"slack.default.username\" . }}'\n    color: '{{ if eq .Status \"firing\" }}danger{{ else }}good{{ end }}'\n    title: '{{ template \"slack.default.title\" . }}'\n    title_link: '{{ template \"slack.default.titlelink\" . }}'\n    pretext: '{{ template \"slack.default.pretext\" . }}'\n    text: '{{ template \"slack.default.text\" . }}'\n...\n```", "```\n{{ define \"slack.default.username\" }}{{ template \"__alertmanager\" . }}{{ end }}\n```", "```\n{{ define \"__alertmanager\" }}AlertManager{{ end }}\n```", "```\nroute:\n  group_by: [alertname, job]\n  receiver: null\n  routes:\n  - match:\n      severity: slack\n    receiver: purple-squad-slack\n```", "```\nreceivers:\n- name: null\n- name: purple-squad-slack\n  slack_configs:\n  - api_url: 'https://hooks.slack.com/TOKEN'\n    channel: '#alerting'\n    title: >\n      [{{ .Alerts | len }}x ALERT{{ if gt (len .Alerts.Firing) 1 }}S{{end}}] {{ .CommonLabels.alertname }}\n```", "```\n    text: >\n      :link: <{{ .CommonAnnotations.troubleshooting }}/{{ .CommonLabels.alertname }}|Troubleshooting Guide>\n```", "```\n      {{ range .Alerts }}\n```", "```\n       *Description:* {{ .Annotations.description }}\n      *Details:*\n```", "```\n        {{- range .Labels.SortedPairs }}\n```", "```\n          {{- if ne .Name \"severity\"}}\n        • *{{ .Name }}:* `{{ .Value }}`\n          {{- end}}\n      {{- end }}\n      {{ end }}\n```", "```\n- name: violet-squad-slack\n  slack_configs:\n  - channel: '#violet-squad-alerts'\n    title: '{{ template \"slack.example.title\" . }}'\n    text: '{{ template \"slack.example.text\" . }}'\n```", "```\n/etc/alertmanager/templates/example.tmpl\n```"]