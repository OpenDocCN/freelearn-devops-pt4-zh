<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Configuring GitLab Using the Web UI</h1>
                </header>
            
            <article>
                
<p>After installing GitLab in the previous chapter, you probably have a running instance. But how can you manage it? You need to know how to configure the software. This chapter will explain how this is achieved for the different kinds of GitLab installations that are available.</p>
<p><span>The following topics will be</span> covered in this chapter:</p>
<ul>
<li>Configuring GitLab settings at the instance level</li>
<li><span>Configuring GitLab settings at the group level</span></li>
<li><span>Configuring GitLab settings at the project level</span></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Technical requirements</h1>
                </header>
            
            <article>
                
<p>To manage omnibus installs, you need to use a central configuration file called <kbd>gitlab.rb</kbd>. You need to create it yourself or copy an example of one. A template of this configuration file is available at<span> </span><a href="https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/files/gitlab-config-template/gitlab.rb.template">https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/files/gitlab-config-template/gitlab.rb.template</a><span>. Please note that it isn't</span><span> updated after upgrades. We will quote and discuss parts of this file in this chapter.</span></p>
<p><span>To follow along with the instructions in this chapter, please download this book's GitHub repository, along with the examples that are available, at <a href="https://github.com/PacktPublishing/Mastering-GitLab-12/tree/master/Chapter03" target="_blank">https://github.com/PacktPublishing/Mastering-GitLab-12/tree/master/Chapter03</a></span>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Configuring GitLab settings at the instance level</h1>
                </header>
            
            <article>
                
<p>When you log on to GitLab as an administrator, you will notice a tool icon in the top right of the menu:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/2ccf761b-fefa-477e-987b-a5a08950436d.png" style="width:37.17em;height:2.42em;"/></p>
<p>When you click on that, the administrator page will load, which you can use to access instance-level settings. The base page provides an overview of active projects, users, and groups:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/7d888b66-8dd0-49fc-b6d2-78a41cfa2bc6.png"/></p>
<p>On the left-hand side, there are several global administration options. <span>Let's go through them.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Menu options</h1>
                </header>
            
            <article>
                
<div>
<p><span> The options are grouped, and some items can even be expanded:</span></p>
</div>
<ul>
<li><strong>Dashboard</strong>: <span class="packt_screen">Dashboard</span> gives you some insight into the number of projects, users, and groups that are in your GitLab instance. You can create new ones from this screen. There is also other interesting information in the form of statistics, where you can get an overview of active features and installed components. If you enabled exposing instance information to GitLab, it will also mention whether you should upgrade your instance to a newer version of GitLab.</li>
<li><strong>Projects</strong>: In the <span class="packt_screen">Projects</span> <span>pane, you can search for projects and create new ones. For the search option, there are some filters available.</span></li>
<li><strong>Users</strong>: The <span class="packt_screen">Users</span> <span>pane offers the same functionality as the <span class="packt_screen">Projects</span> pane, that is, searching for users with advanced filtering and being able to create new users.</span></li>
<li><strong>Groups</strong>: The <span class="packt_screen">Groups</span> <span>pane is identical to the previous panes in terms of its features, but without fancy filters.</span></li>
<li><strong>Jobs</strong>: The <span class="packt_screen">Jobs</span> <span>pane offers you insight into <strong>continuous integration/continuous deployment</strong> (<strong>CI/CD</strong>) jobs that are pending, running, or finished.</span></li>
<li><strong>Runners</strong>: In this section of the administration page, options and views on CI/CD GitLab runners are available.</li>
<li><strong>Gitaly servers</strong>: By default, there is only one Gitaly server, and it is shown here. However, there could be more, depending on your setup.</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Monitoring</h1>
                </header>
            
            <article>
                
<p>The monitoring section offers interesting bits of information that are needed so that you can administer your GitLab instance:</p>
<ul>
<li><strong>System information</strong>: CPU, memory, and other metrics.</li>
<li><strong>Background Jobs</strong>: <span>GitLab integrated the Sidekiq statistics gem into the application, and it can be viewed here.</span></li>
<li><strong>Logs</strong>: In this section, you can view 2,000 lines of information from the most important GitLab log files (unicorn, gitlab-shell, Sidekiq, and so on).</li>
<li><strong>Health check</strong>: This is a very interesting page for sysadmins. Here, you will find endpoints that will give some insight into the health of the running GitLab instance. There is also a token present, which you will need to send as a parameter if your monitoring software wants to scrape the page.</li>
<li><strong>Requests Profiles</strong>: This is only interesting to developers or testers. Here, you can send a header to GitLab for use in request profiling.</li>
<li><strong>Audit Log</strong>: If you have an enterprise license, you can find audit events here and filter them.</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Messages</h1>
                </header>
            
            <article>
                
<p>Your GitLab instance has a facility where you can send messages to all of your users. These broadcasts can come in handy if you want to inform your users about system-wide events, such as upgrades and scheduled downtime. The following is the <span class="packt_screen">Admin</span> page, which you can find in the side menu:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/4d90914a-7196-472f-b056-86141f929f6a.png" style="width:61.08em;height:27.92em;"/></p>
<p>After you've scheduled a new message, it can be reused later as well:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/4cdaf1a2-47c0-4923-bf66-6f7f7a7369e7.png" style="width:55.33em;height:6.08em;"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">System hooks</h1>
                </header>
            
            <article>
                
<p>GitLab can perform HTTP POST requests on the system level and act on several events.</p>
<p>A standard event is raised when you're creating a new project or user. Additionally, it can send other types of events as well. Just add a destination URL and (optionally) a secret token:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/59cee896-832f-4840-b83d-652c5787bb75.png" style="width:57.17em;height:45.83em;"/></p>
<p>When you have configured your system hook, there is a drop-down list with a test to check whether it works by calling the URL.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Plugins</h1>
                </header>
            
            <article>
                
<p>On this page, you also have the option to configure installed <strong>plugins</strong>. This basically fires a locally installed program instead of calling a URL with parameters.</p>
<p>It requires you to place the plugin code in <kbd>/opt/gitlab/embedded/service/gitlab-rails/plugins</kbd>, and it has to be written in a certain way. After installation, the plugin can be run as a hook.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Applications</h1>
                </header>
            
            <article>
                
<p><span>In this section of the ad</span><span>ministration page, you have the option to register third-party applications in order to use GitLab as an OAuth authorization provider.</span></p>
<p><span><strong>Open Authorization </strong>(<strong>OAuth</strong>) is an open standard for authorization. Users can give a program or website access to their private data that's kept on another website without revealing their username and password.</span></p>
<p><span>To register an application, you need to provide a name, callback URL, and set a few options.</span></p>
<p>Trusted <span>means that a token is exchanged based on the already validated resource owner's credentials. The user authorization step is subsequently skipped for this application when it's used.</span></p>
<p><span>Some other scopes are also defined that allow a given application to perform various actions. These are as follows:</span></p>
<ul>
<li><span><strong>API</strong>: </span>Grants complete read and write access to the API, including all groups and projects.</li>
<li><span><kbd>read_user</kbd>: </span>Grants read-only access to the authenticated user's profile through the <kbd>/user</kbd> API endpoint, which includes username, public email, and full name. It also grants access to read-only API endpoints under <kbd>/users</kbd>.</li>
<li><span><kbd>sudo</kbd>: </span>Grants permission to perform API actions as any user in the system when authenticated as an admin user.</li>
<li><span><kbd>read_repository</kbd>: </span>Grants read-only access to repositories on private projects using Git over HTTP (not using the API).</li>
<li><span><kbd>openid</kbd>: </span>Grants permission to authenticate with GitLab using OpenID Connect. It also gives read-only access to the user's profile and group memberships.</li>
</ul>
<div class="packt_infobox"><span>You can also revoke registration if you wish to. </span><span>GitLab uses <strong>doorkeeper-gem</strong>, which can be found at <a href="https://github.com/doorkeeper-gem/doorkeeper">https://github.com/doorkeeper-gem/doorkeeper</a>, to provide this functionality.</span></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Abuse reports</h1>
                </header>
            
            <article>
                
<p class="mce-root"><span>There are several places in the GitLab web interface where, as a user, you can file and report abuse. You can find buttons to file a report in the following sections:</span></p>
<ul>
<li><span>Comments</span></li>
<li><span>Issues and merge requests</span></li>
<li><span>The profile page of a user (refer to the following screenshot):</span></li>
</ul>
<p class="CDPAlignCenter CDPAlign"><img src="assets/1c6164f0-bbd8-4302-bb42-d0fe3ac50493.png" style="width:52.92em;height:19.83em;"/></p>
<p><span>When you click the</span> <span class="packt_screen">Report abuse</span> <span>button, the following form will appear:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/33ea7bb0-ff63-4757-b3f3-a38b51b32041.png" style="width:44.42em;height:19.92em;"/></p>
<p class="mce-root"><span>If you click on the <span class="packt_screen">Send report</span></span> button, an <span>administrator will be notified, and he or she will find the abuse report in the <span class="packt_screen">Abuse Reports</span> section of the administration pages:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/19541d11-32e8-4c59-a16f-5cbead45818b.png" style="width:52.08em;height:15.83em;"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">License</h1>
                </header>
            
            <article>
                
<p class="mce-root">If you are using GitLab Enterprise Edition, this is the place where you manage your license. You can either upload a file or insert the appropriate license key. You can browse to GitLab to buy a new license.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Kubernetes</h1>
                </header>
            
            <article>
                
<p>In this section, you can add an instance-wide Kubernetes cluster, which will be used to create deployment environments. We will discuss this option in <a href="8e2b1a18-2d76-4c74-8e3f-869f2d009577.xhtml">Chapter 11</a>, <em>The Release and Configure Phase</em><span class="cdp-organizer-chapter-title"><span class="cdp-organize-title-label">.</span></span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Push rules</h1>
                </header>
            
            <article>
                
<p>In this section, you can define all kinds of rules that will allow or disallow Git pushes:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/609ec937-9b85-44ab-8f0d-b2803356ec62.png" style="width:52.33em;height:31.33em;"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Geo</h1>
                </header>
            
            <article>
                
<p>When you have an Enterprise license and want to configure replicas of your GitLab instance, this is the place to use. We will discuss Geo in <a href="">Chapter 22</a>, <em>Using Geo to Create Distributed Read-Only Copies of GitLab</em>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Deploy Keys</h1>
                </header>
            
            <article>
                
<div>
<p><span>In this section, you can register SSH keys, which are known as <strong>Global Shared Deploy keys</strong>. They allow read-only or read-write (if enabled) access to be configured on any repository in the entire GitLab installation. When the administrator has registered them here, you can assign them in your project, as shown in the following screenshot:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/2a88f541-69d3-4602-9799-bd445766f8fe.png" style="width:54.50em;height:37.33em;"/></p>
<p><span>This feature can be used by a remote CI/CD server to check out code.</span></p>
</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Service templates</h1>
                </header>
            
            <article>
                
<div>
<p><span>Project services allow you to integrate GitLab with other third-party applications. They resemble plugins that you can find in other systems. They allow for a lot of freedom in terms of adding functionality to GitLab. In the <span class="packt_screen">Service Templates</span> section, you can edit information for predefined templates. The repository owners then have to configure less information if they want to enable a service integration for their repository.</span></p>
</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Appearance</h1>
                </header>
            
            <article>
                
<div>
<p><span>You can define some cosmetic aspects of your GitLab instance on the <span class="packt_screen">Appearance settings</span> page:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/e7e66511-b9e3-4b5d-8299-a98f4dd4c3e8.png" style="width:49.33em;height:45.67em;"/></p>
<p><span>If, for example, you want to greet your users with a nice logo on the front page, you can change the logo by uploading a new one. You can do this by clicking the <span class="packt_screen">Choose File</span> button near the <span class="packt_screen">Logo</span> section. After you have done this, log out. You will be redirected to the front page:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/39cfe443-7cc6-4a49-8193-15bea1975c06.png" style="width:53.25em;height:27.33em;"/></p>
</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Settings</h1>
                </header>
            
            <article>
                
<p>This section has a lot of detailed options, all of which we will discuss here.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">General</h1>
                </header>
            
            <article>
                
<div>
<p><span>This part of the administration panel deals with settings that are not easily put into a group.</span></p>
</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Visibility and access controls</h1>
                </header>
            
            <article>
                
<p>Here, you define the default authorizations and permissions for users. There are three basic options. For instance, you can make projects private, which means that only you or people you grant access to can see when you create a new project. The internal level means only logged-in users can see your project (read-only). Public is the widest access level and allows anyone to see your project (but not write to it). The same authorizations can be set for snippets and groups. You can also determine what sources can be imported.</p>
<p>There are a lot of import modules available, but maybe you want to limit those. Another import option is to allow projects to be exported. There are several functions that can help users with this. If this isn't something you would like to cater for, then you can disable it here. GitLab supports both Git client access protocols (SSH and HTTP). You can also disable them i<span>n this section if you want to. Finally, you can control what kind of SSH keys can be used for Git SSH. Is RSA too insecure? Just disable it.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Account and limit</h1>
                </header>
            
            <article>
                
<p>In this section, you can set options <span><span>such as </span></span>session expiration (the default is 20 minutes), project limits, and maximum attachment sizes. The default project limit is set to 100,000, while the maximum size of a repository is not set by default. The attachment size is 10 MB. You can also enable Gravatars for accounts, which means that an image that is uploaded to <kbd>gravatar.com</kbd> can function as your personal icon. GitLab can act as an OAuth backend, and you can allow normal users to register new applications by using it.</p>
<p>You can also configure the way new users are handled. They can be defined as external users. This means that new users can only access specific projects that they are granted access to. They can't create new projects. Optionally, you can define exceptions for that rule with a regular expression. The final option is to enable a prompt to let users know that they haven't uploaded public SSH keys yet.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Diff limits</h1>
                </header>
            
            <article>
                
<p>In this section, you can set the maximum size a diff patch can get to before it cannot be displayed in the normal diff view. If this size is reached, a link to a blob view will be presented.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Sign-up restrictions</h1>
                </header>
            
            <article>
                
<p>In a default installation, a form is available on the GitLab login page so that you can sign up if you don't have an account. You can disable the signup pages here, as well as edit a whitelist and blacklist to deny access to certain domains upfront. You can also specify whether you want an email to be sent after the signup procedure. </p>
<p>Some text will be shown to the user after signup has completed.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Sign-in restrictions</h1>
                </header>
            
            <article>
                
<p>These settings cover the following restrictions:</p>
<ul>
<li>Enable or disable logging in to the web interface with a password (without it, you need a third-party authentication provider such as Google)</li>
<li>Enable or disable password authentication for Git over HTTPS (without it, a personal access token is needed)</li>
<li>Enable or disable two-factor authentication (with a grace period that determines how long a user can wait during configuration)</li>
</ul>
<p>It is possible to use a hardware token device as a second factor, as you can see in the following screenshot (this only works in Chrome):</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/8b28e596-ce8f-43b6-8e23-2d73f30b818a.png" style="width:21.58em;height:10.83em;"/></p>
<p>You can also choose to use a code generator app such as Google Authentication:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/2aef2208-d8f5-4499-adc4-2ec6f903e98a.png" style="width:23.25em;height:16.25em;"/></p>
<p>You can also set a home page URL here, which is where non-logged-in users will be redirected to. In the same way, you can define an after-sign-out path, where users will be led to when they sign out.</p>
<p>Finally, it's also possible to set a standard sign-in text to be visible on the login page.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Terms of service and privacy policy</h1>
                </header>
            
            <article>
                
<p>If you use GitLab for an organization that uses strict terms, you can make sure that your users accept a policy that you can enter here, in a nice markdown-formatted text box.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">External authentication</h1>
                </header>
            
            <article>
                
<p>For some installations, it could be crucial to let external systems have more influence on the access policies in GitLab. For this, you can specify an external authorization service that checks the user's information and the classification label that has been given to a project. Based on that query, access may or may not be granted. If you enable this, all the pages that use cross-project data won't work anymore (such as snippets and activity).</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Web Terminal</h1>
                </header>
            
            <article>
                
<p>This is a recent feature, and is where you can access a terminal via a web browser (part of a pipeline). Here, you can set a timeout on the session time for this terminal. Keeping it to zero means that it will try the session indefinitely.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Web IDE</h1>
                </header>
            
            <article>
                
<p><strong>Web IDE</strong> is a feature that is also new and in full development. This book is actually typed in it, and it works better than most web editors. The main option that you can control from the settings page is the feature toggle, which allows client-side JavaScript projects to enable live preview functionality using CodeSandbox.</p>
<div class="packt_infobox">For more information about project access, go to <a href="https://codesandbox.io">https://codesandbox.io</a>.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Integrations</h1>
                </header>
            
            <article>
                
<p>One of the ways to advance GitLab as a product is to offer several ways to integrate with other products. This also aligns with the Unix and open source philosophy of creating small, interoperable utilities. On a technical level, there are three ways to accomplish this:</p>
<ul>
<li>Using webhooks (event mechanisms, asynchronous, and so on. For more information, go to <a href="https://gitlab.com/gitlab-org/gitlab-ce/blob/master/doc/web_hooks/web_hooks.md">https://gitlab.com/gitlab-org/gitlab-ce/blob/master/doc/web_hooks/web_hooks.md</a>).</li>
<li>Using the GitLab API (proactively get information from GitLab).</li>
<li>Using project integration (running from a repository in GitLab). In the settings, four options are available: Elasticsearch, <span>PlantUML, Snowplow, </span>and the ability to view third-party offers.</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Elasticsearch</h1>
                </header>
            
            <article>
                
<p>Only available in Enterprise edition, this search engine integration feature is really powerful, but is a subject on its own. It offers a full-text search option for GitLab so that you can search for text throughout your source code repositories. You will need to install the search program, which has a HTTP web interface on another server, and specify the connection settings (the URL):</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/e91d2dba-efc8-41a7-af2c-3297cc0fbe3a.png" style="width:46.08em;height:25.58em;"/></p>
<p>You can also limit what will be indexed:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/ffc70aaf-e34c-4233-8686-cc6bf582e6c5.png" style="width:49.50em;height:7.50em;"/></p>
<p>Another option is to connect to an Elasticsearch instance that you are running in the Amazon cloud. You can specify connection settings here as well if you have this set up:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/6c0670b2-2482-4935-a197-213da9e423ce.png" style="width:51.17em;height:24.75em;"/></p>
<p>You can find more information on this at <a href="http://elastic.co">http://elastic.co</a>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">PlantUML</h1>
                </header>
            
            <article>
                
<p>Here, you can define the URL for PlantUML (this is an API integration).</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Third-party offers</h1>
                </header>
            
            <article>
                
<p>This setting lets you opt out of third-party offerings. An example of such an offer would be to get free Google Cloud credits so that you can use Google's Kubernetes platform.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Snowplow</h1>
                </header>
            
            <article>
                
<p>Again, Snowplow is an Enterprise feature. Some companies want to track custom events in GitLab. With Snowplow, you can use this big data platform to collect and analyze data. If you enable this integration, you have to provide a collector URI, a site ID, and a cookie domain.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Repository</h1>
                </header>
            
            <article>
                
<p>Here, you will find options that are generic for all repositories.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Repository mirror</h1>
                </header>
            
            <article>
                
<p>With GitLab, you can create repository mirrors. This means that, after an initial synchronization, the content (and metadata, if possible) is kept up to date with the remote source. The sync job will be triggered automatically and will time out after 15 minutes. This setting determines whether a user can set up mirrors. If it's disabled, only administrators can perform this task.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Repository storage</h1>
                </header>
            
            <article>
                
<p>The most important settings handle the way storage is used. Instead of using folder structures with names, you can use hashed values as directory names for projects. This way, when you're moving projects, the folder isn't moved on an OS level <span>–</span> the reference to the hash is changed in the database instead. Keeping a hash-based reference tree and searching is much faster than traversing a folder tree by name.</p>
<p>Secondly, you can specify alternate storage locations where new projects are stored. If there is more than one location, it will alternate between them in no particular order. The location that shows up in the chooser depends on what storage paths were defined in <kbd>gitlab.rb</kbd> (for omnibus installations) or <kbd>gitlab.ym</kbd> (source-based setups).</p>
<p>The settings for the storage circuit breaker are found here as well. This is used to handle failures of the underlying storage GitLab uses. When you're using network filesystems such as <strong>Network File System</strong> (<strong>NFS</strong>), locking issues can occur, which eventually make the whole system hang indefinitely.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Repository maintenance</h1>
                </header>
            
            <article>
                
<p class="mce-root">Git has a special integrity checking feature called <strong>fsck</strong>. Just like the <strong>Filesystem Consistency Check</strong> (<span><strong>fsck</strong></span>) <span>for filesystems, </span>it can verify a structure and tell us whether it's compromised. The name of this Git function was chosen because Git was initially built as a filesystem. A filesystem is classed as a graph model, and Git implements this as tree and blob objects. Because all of the items are check-summed, fsck can verify the integrity of the objects and their relations. This graph is depicted in the following diagram:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/077503b3-5e09-436d-a4ac-fbd39a0f452d.png" style="width:25.33em;height:18.92em;"/></p>
<p>Changes between files in a repository are saved as deltas and packed together in pack files, which are then compressed. This also happens to other objects in the repository hierarchy. In short, this means that the graph model has been enhanced to make Git operations faster and more efficient on your computer, and to save disk space. Sometimes, after <kbd>commit --amend</kbd> or <kbd>git rebase</kbd>, objects such as commits become unreachable (there's no parent SHA). All the preceding use cases are candidates for the Git garbage collection function: <kbd>git gc</kbd> (<a href="https://git-scm.com/docs/git-gc">https://git-scm.com/docs/git-gc</a>). It is recommended to run this function on your Git repositories regularly.</p>
<p>In the GitLab settings, you can control the two ways in which Git is being used on the GitLab server in order to maintain repository hierarchies. The first option is that you can enable periodic repository checks with <kbd>git fsck</kbd>. Letting GitLab do this ensures that you can spot and possibly repair disk corruption issues you wouldn't easily find normally if you were to process all the files.</p>
<p>GitLab can also do housekeeping. It should run periodically to prevent the corruption of repositories. Unfortunately, it can also generate false alarms.</p>
<p>The second option is that you can control the way housekeeping is done on the server in order to make Git repositories more efficient and fast. You can enable and control when <kbd>git gc</kbd> is performed on the GitLab server. Another option for <kbd>git pack</kbd> operations is to let them use bitmap indexes. This could result in much faster cloning (but more disk space being used). The parameters for housekeeping are the amount of times a repository is pushed before <kbd>git repack</kbd> (incremental), <kbd>git repack</kbd> (full), and <kbd>git gc</kbd> is performed.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Templates</h1>
                </header>
            
            <article>
                
<p>From GitLab 11.x onward, you can define a special directory that will provide templates for all of GitLab. You can also create your own. </p>
<p>The custom project templates settings let you specify which group is the default group so that you can provide templates.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">CI/CD</h1>
                </header>
            
            <article>
                
<div>
<p><span>This page contains several configuration options for <strong>Continuous Integration</strong></span> (<span><strong>CI</strong></span>) <span>and <strong>Continuous Deployment</strong></span> (<span><strong>CD</strong></span>) <span>using GitLab.</span></p>
</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Auto DevOps settings</h1>
                </header>
            
            <article>
                
<p>As of GitLab 11.3, Auto DevOps is automatically enabled for all projects. When the build process is triggered for a project and a pipeline is created, the <span>Auto DevOps</span> feature will be disabled for the project if the pipeline fails. If an alternative <kbd>.gitlab-ci.yml</kbd> file is located in the project, it will use that instead. You can override the default <span>Auto DevOps</span> settings here and disable them:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/619698e3-c5b5-41d2-aea1-7e1d87c4366b.png" style="width:39.58em;height:14.58em;"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Shared runner settings</h1>
                </header>
            
            <article>
                
<p>One of the key components of CI/CD is the runners. In this section, you can enable shared runners for all new projects, which means that any shared runner could end up building your code. There is a security aspect to this because shared runners could exist that aren't using a stateless mechanism. They could be running your job, and not clean up the artifacts, and get a new build job. This is probably is not what you want. Your data could be compromised by another build project.</p>
<p>Therefore, another option is to set some warning text for shared runners that communicate so that you can ensure your shared runners are under control:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/cdbb17a7-029b-4779-bb28-de411d1b8cd7.png" style="width:22.42em;height:9.00em;"/></p>
<p>When runners build artifacts, the results can be uploaded and viewed after the pipeline has finished. You may want to set a certain limit on the size of the combined artifacts that get uploaded as a ZIP file to the GitLab CI.</p>
<p>You can also specify how long artifacts should stay available after the build. This is controlled by the default artifact expiration time:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/4d30dea2-2733-4748-b89b-4d70f35310f1.png" style="width:51.75em;height:13.25em;"/></p>
<p><span>When an artifact reaches this age, it is deleted in the periodic expiration task. As we can see in the following screenshot, it runs every hour:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/fcb1e5d7-89a8-447e-aede-30f5c65f3e9b.png"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Container registry</h1>
                </header>
            
            <article>
                
<p>GitLab can also function as a container registry. By this, we mean it can store images that you create on your workstation or inside of GitLab runner pipelines. In this section of the admin area, you can specify how long an authorization token remains valid. The default is five minutes.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Reporting</h1>
                </header>
            
            <article>
                
<p>Most people have an easy time identifying or explaining the term reporting. I personally don't understand how GitLab grouped certain options under this subject. To me, the first one, that is, spam and anti-bot protection, should belong to a security or privacy part of the settings.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Spam and anti-bot protection</h1>
                </header>
            
            <article>
                
<p>GitLab is able to use reCAPTCHA and Akismet to handle abusive traffic. If you enable this setting, you need a site key and a private key, both of which can be generated at <a href="http://www.google.com/recaptcha">http://www.google.com/recaptcha</a>. In this way, you raise another barrier against spammers creating users in an automated way. If you register, you have to prove you are a human by answering specific questions<a href="http://www.google.com/recaptcha">.</a></p>
<p>In a similar manner, Akismet can help you protect your issues in GitLab from spammers. With the advent of weblogs and the possibility to comment, a new spam technique emerged called comment spam. Spammers try to influence readers with massive amounts of comments. Akismet was established as an extra check (GitLab calls its API) to prevent automated comments (issues in GitLab).</p>
<p>As an extra security measure, there's the option to restrict simultaneous logins from multiple IPs. You can even set a maximum number of IPs a user can connect from by using an IP expiration time.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Abuse reports</h1>
                </header>
            
            <article>
                
<p>Here, you can set an email address that abuse reports can be sent to. The option to create an abuse report is scattered throughout GitLab.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Error reporting and logging</h1>
                </header>
            
            <article>
                
<p>In general, there are numerous log files for all kinds of services that GitLab is running. In this section, you can specify logging and reporting for clients (also known as browsers). The GitLab frontend JavaScript application that runs in your browser has the option to use Sentry (<a href="https://sentry.io/welcome/">https://sentry.io/welcome/</a>). By using this, you can monitor and proactively catch errors from your users and act accordingly.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Metrics and profiling</h1>
                </header>
            
            <article>
                
<p>Administrators or owners of a GitLab system like to know how their system is performing <span>– n</span>ot only at an OS level, but also in terms of functionality. For instance, information about how long certain operations take to complete is very important. These metrics are available in GitLab, but you need to do some configuration to make these numbers available. There are several ways to retrieve this data from GitLab, and it's here where you can specify details about sources of information.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Metrics – InfluxDB</h1>
                </header>
            
            <article>
                
<p>The first system that can operate as a backend store for metrics is InfluxDB. This is a special kind of database that stores time series data. Before you can use this feature, you will have to set up this database on a separate server. It is too heavy to run on the same GitLab machine. Instructions on how to configure this can be found at <a href="https://docs.gitlab.com/ee/administration/monitoring/performance/influxdb_configuration.html">https://docs.gitlab.com/ee/administration/monitoring/performance/influxdb_configuration.html</a>. When you enable InfluxDB metrics, it will set up a <strong>User Datagram Protocol</strong> (<strong>UDP)</strong> stream to the InfluxDB host that will carry all kinds of event information. You can fine-tune the connection pool size, the connection timeout, and so on to make sure that you don't generate too much data. After changing this setting, you will have to restart.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Metrics – Prometheus</h1>
                </header>
            
            <article>
                
<p class="mce-root">The preferred time series database for GitLab as of 2018 is Prometheus. Its scraping endpoint for GitLab can be enabled here. You will need to restart GitLab after you change it. A Prometheus server is bundled in <kbd>omnibus-gitlab</kbd> itself.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Profiling – Performance Bar</h1>
                </header>
            
            <article>
                
<p>Sometimes, you like to know how GitLab's performance is when it's running in a browser, or you want to see which part of a GitLab request takes the most time to complete. Enter <kbd>Profiling-Performance Bar</kbd>, which you can enable for certain groups. Once the <span class="packt_screen">Performance Bar</span> is enabled, you will need to press the <em>P</em> + <em>B</em> keyboard shortcut to actually display it:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/2362cbed-bcb8-4d50-ae74-423de3368fbf.png"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Usage statistics</h1>
                </header>
            
            <article>
                
<p>In this section of the settings, you can enable or disable two sets of information that can be collected by GitLab by default. You can also choose to only let the information be viewable by instance admins. These types of information are as follows:</p>
<ul>
<li>Version check (you will see <span class="packt_screen">Update ASAP</span> in the overview when a new version is available)</li>
<li>Usage ping (to improve GitLab and its user experience)</li>
<li>Can share data to the public or only admins</li>
<li>Check the <span class="packt_screen">Preview payload</span> button to view other data that's shared in this ping</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Pseudonymizer data collection</h1>
                </header>
            
            <article>
                
<p class="mce-root">When enabled, this option will make sure that GitLab writes anonymized information to a comma-separated values file. This file will then be uploaded to the S3 storage bucket that you specify in your configuration files (<kbd>gitlab.rb</kbd> for omnibus-gitlab installs and <kbd>gitlab.yml</kbd> for source-based installs).</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Network</h1>
                </header>
            
            <article>
                
<div>
<p><span>In this section, you can control some of the options that influence network performance and communication.</span></p>
</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Performance optimization</h1>
                </header>
            
            <article>
                
<p>Here, you can disable writing to an authorized keys file and let GitLab read authorized keys straight from the database instead of via a file. This helps speed up the authorization phase of Git SSH.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">User and IP rate limits</h1>
                </header>
            
            <article>
                
<p>Here, you can throttle for web and API requests. You also have the option to make a difference between authenticated and anonymous requests.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Outbound requests</h1>
                </header>
            
            <article>
                
<p>By default, webhooks that are created in the system aren't allowed to go out of the local IP subnet. With this option, you can allow hooks to go out.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Geo</h1>
                </header>
            
            <article>
                
<p>In this section, you can set some Geo preferences, such as the timeout after which the communication with a secondary instance is considered lost. Another setting that's available allows you to list the IPs and networks that can connect and pretend they are secondaries.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Preferences</h1>
                </header>
            
            <article>
                
<p>These settings are general and are related to different subjects.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Email</h1>
                </header>
            
            <article>
                
<p>In the email section, you can make emails come straight from originators, who, for instance, create issues or merge requests. The second option you can control is whether GitLab sends emails in HTML format.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Help page</h1>
                </header>
            
            <article>
                
<p>You can also customize the way the <span class="packt_screen">Help page</span> for GitLab is presented. There's the option to provide some custom text, which will be displayed on top of the <span class="packt_screen">Help page</span>:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/3f80655e-d342-44a9-802f-06f12a3509b8.png" style="width:21.58em;height:18.83em;"/></p>
<p>The following is a screenshot of the standard <span class="packt_screen">Help page</span>:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/82b14fc7-d66b-4cb1-977a-ab8a693d00c9.png" style="width:68.08em;height:31.58em;"/></p>
<p>Let's make some changes by adding <kbd>This is a help page.</kbd>:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/a309208b-fa26-4cb6-99d6-dbe4b2195721.png" style="width:21.58em;height:8.67em;"/></p>
<p> <span><span>The result</span></span> will be as follows:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/93508fe6-c4c6-43e6-8e93-c102fcc531e5.png"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Pages</h1>
                </header>
            
            <article>
                
<p>If you use the GitLab Pages feature, you can specify the maximum size of pages. You can set it to zero if you want the size to be unlimited. You can also allow users to prove that they own a domain before you serve a page for it:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/2274c441-ac4e-4229-a902-6aea84c6e0a7.png" style="width:61.17em;height:15.67em;"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Real-time features</h1>
                </header>
            
            <article>
                
<p>The GitLab web interface gives you the option to poll for real-time events, like it does when you press the <span class="packt_screen">Merge</span> button on a merge request. You can set a multiplier for this here so that it polls less often (or more often, depending on what you want).</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Gitaly</h1>
                </header>
            
            <article>
                
<p>Regarding Gitaly, you can control some of its timings here. If Gitaly is being slow, you'll want it to time out for certain requests, because otherwise the operation can bring down the whole GitLab instance. Since Gitaly is the interface to the repositories, think of filesystems or nodes not responding. Very bad things can happen when locks occur or when network issues prevent data transfers. It's better to know when to cut the cord.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Localization</h1>
                </header>
            
            <article>
                
<p>This is a big section of the settings since there are many localization settings for software products. The only one that is exposed in this screen is <span class="packt_screen">Default first day of the week</span>:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/3ccb3951-f817-425a-9b7e-7c4e8e79832a.png" style="width:58.33em;height:14.83em;"/></p>
<p>This depends on your geographical location.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Configuring GitLab settings at the group level</h1>
                </header>
            
            <article>
                
<p class="mce-root">The admin area is only accessible <span><span>to </span></span>users with the admin role, but other roles can configure settings too. If you, as a user, have been granted permission to <em>add groups</em>, you can change the settings of the groups you have created. If you navigate to <span class="packt_screen">Your Groups</span> from the top-level menu, you can access the settings from the left-hand side menu.</p>
<p class="mce-root">Here, you will see a submenu with the items that you can configure. It looks a lot like the UI in the admin area but is, of course, scoped to the group:</p>
<p class="mce-root CDPAlignCenter CDPAlign"><img src="assets/b96a6026-b04a-485d-b27b-1bc2bc759d2b.png" style="width:10.08em;height:18.08em;"/></p>
<p class="mce-root">In GitLab 12.0, a new interesting feature has been added to the <span class="packt_screen">General</span> pane for group settings: <span class="packt_screen">Restrict address by IP address</span>. It is an Enterprise feature and, by using it, you can make sure that certain IP addresses aren't allowed to access group content. In the following screenshot, you can see that <kbd>192.168.1.0/24</kbd> is the only IP range that's allowed to see the group content:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/f1de42c1-253a-4619-88ac-0912e4c3bee8.png" style="width:56.17em;height:16.08em;"/></p>
<p>For instance, you don't want software to be downloaded from a VPN.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Configuring GitLab settings at the project level</h1>
                </header>
            
            <article>
                
<p>In the previous sections, we saw that we can adjust the settings at the instance level in the admin area, as well as at the group level. There are also options for setting an individual project. If you browse to one of your projects, you will see a <span class="packt_screen">Settings</span> menu on the left:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/008edc22-0300-41eb-8667-e98777842fbc.png" style="width:10.08em;height:23.33em;"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">General</h1>
                </header>
            
            <article>
                
<p>The <span class="packt_screen">General</span> menu provides some specific settings that aren't found anywhere else. Let's look at the most important ones.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Naming, topics, avatar</h1>
                </header>
            
            <article>
                
<p>Under the <span class="packt_screen">General</span> settings, you can find the </p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/b9ee3626-c2c3-4519-9b4c-491e8cafea9a.png" style="width:39.25em;height:40.33em;"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Visibility, project features, permissions</h1>
                </header>
            
            <article>
                
<p>A very important part of these settings is the <span class="packt_screen">Visibility, project features, permissions</span> sections. You can enable or disable certain features, as well as determine who is allowed to do what:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/ed56e6d5-79b8-48b6-96db-0fe2cf91d687.png" style="width:48.50em;height:33.00em;"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Merge requests</h1>
                </header>
            
            <article>
                
<p class="mce-root">For an individual project, you can define merge request behavior. For example, you can define how GitLab will execute merges on the server. For every executed merge request, there is a Git session on the server running the same Git binary that you have on your workstation. For instance, you can specify that the server side never does a merge commit:</p>
<p class="mce-root"/>
<p class="CDPAlignCenter CDPAlign"><img src="assets/caf84dff-6f27-4d6f-81c1-1d2396c19382.png" style="width:45.58em;height:49.50em;"/></p>
<p class="mce-root">In version 12.0 of GitLab, the concept of merge trains was added. If you enable this, all the merges must pass in sequence, and your merge will be a part of this train. The merges only succeed as a whole, and this use case is common in Enterprise environments where different teams work on the same product. In future versions, this feature will be enabled by default.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<div>
<p><span>In this chapter, we discussed how to configure an existing GitLab application instance via the web interface.</span><span> The administration pages of GitLab give you a lot of control over your instance. After going through those pages, we explained the various items that can be managed.</span></p>
<p>In the next chapter, we will take a look at configuring GitLab through a regular Terminal interface without a web browser. </p>
</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Questions</h1>
                </header>
            
            <article>
                
<ol>
<li>What icon is used to represent the administration section?</li>
<li>Which three items feature prominently on the admin dashboard?</li>
<li>What is the maximum size of an uploaded logo image?</li>
<li>Which metrics backend can be configured?</li>
<li>What product is used to enable live preview functionality?</li>
<li>What UML tool can be integrated with GitLab?</li>
<li>What mechanism is used to prevent network storage from hanging GitLab?</li>
<li>What process can help preserve repository integrity?</li>
<li>Which CI/CD feature is enabled by default?</li>
<li>What value has to be set in GitLab Pages to enable unlimited size?</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Further reading</h1>
                </header>
            
            <article>
                
<ul>
<li><span><em>Getting Started with Kubernetes - Third Edition</em></span>, by<span><em> </em><em>Jesse White</em> and <em>Jonathan Baier</em>: <a href="https://www.packtpub.com/in/virtualization-and-cloud/getting-started-kubernetes-third-edition">https://www.packtpub.com/in/virtualization-and-cloud/getting-started-kubernetes-third-edition</a></span></li>
<li><em>Develop and Operate Microservices on Kubernetes</em>, by<em> Martin Helmich</em>: <a href="https://www.packtpub.com/virtualization-and-cloud/develop-and-operate-microservices-kubernetes-video">https://www.packtpub.com/virtualization-and-cloud/develop-and-operate-microservices-kubernetes-video</a></li>
<li><em>Docker Cookbook - Second Edition</em>, by<em> Neependra K Khare</em>, <span><em>Jeeva S. Chelladhurai</em>, and <em>Ken Cochrane</em>: <a href="https://www.packtpub.com/in/virtualization-and-cloud/docker-cookbook-second-edition">https://www.packtpub.com/in/virtualization-and-cloud/docker-cookbook-second-edition</a></span></li>
</ul>


            </article>

            
        </section>
    </body></html>