<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Moving Repositories from TFS</h1>
                </header>
            
            <article>
                
<p><span><strong>Team Foundation Server</strong> (<strong>TFS</strong>) is the collaboration platform and foundation of Microsoft's <strong>Application Life Cycle Management</strong> (<strong>ALM</strong>) solution, which comes with code version management (including package management (NuGet, Maven, and so on)), work item management, extensive reporting and dashboard capabilities, automated build and release management, and test management. Through extensive integration with development tools such as Visual Studio, TFS is used to communicate and collaborate with the process of designing, building (continuous integration), testing, and deploying (continuous delivery) the software, which should ultimately be used to increase productivity and team output, improve quality, and gain more insight into the application life cycle.</span></p>
<p><span>In this chapter, we will compare TFS to Git, and then we will migrate a TFS repository to Git that is in the old TFVC (Team Foundation Version Control) format. Note that, nowadays, Microsoft has  standardized on Git for version management, so TFVC is not widely used anymore.</span></p>
<p>In this chapter, we will cover the following topics:</p>
<ul>
<li class="mce-root"><span> TFS versus Git</span></li>
<li><span> The git-tfs tool</span></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Technical requirements</h1>
                </header>
            
            <article>
                
<p><span>To follow along with the instructions in this chapter, please download this book's GitHub repository, along with the examples, from <a href="https://github.com/PacktPublishing/Mastering-GitLab-12/tree/master/Chapter08" target="_blank">https://github.com/PacktPublishing/Mastering-GitLab-12/tree/master/Chapter08</a></span>.</p>
<p class="mce-root">The other requirements for this chapter are as follows:</p>
<ul>
<li>Git: <a href="http://git-scm.org">http://git-scm.org</a></li>
<li>Azure DevOps account: <a href="https://azure.microsoft.com/nl-nl/services/devops/">https://azure.microsoft.com/nl-nl/services/devops/</a></li>
</ul>
<ul>
<li>Git-tfs: <a href="https://github.com/git-tfs/git-tfs">https://github.com/git-tfs/git-tfs</a></li>
<li>GitLab account: (<a href="https://gitlab.com">https://gitlab.com</a> or on premise)</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">TFS versus Git</h1>
                </header>
            
            <article>
                
<p>Microsoft created TFS as a product to help teams create software.</p>
<p>It has the following features:</p>
<ul>
<li>Source code management</li>
<li>Requirements management</li>
<li>Lab management</li>
<li>Reporting</li>
<li>Project management (for Agile software and waterfall development)</li>
<li>Automated builds</li>
<li>Testing</li>
<li>Release management capabilities</li>
</ul>
<div>
<p><span>The solution was created to help across the entire life cycle of the product (ALM). It can cooperate with several <strong>Integrated Development Environments</strong> (<strong>IDEs</strong>), but works best with Microsoft's own Visual Studio, which nowadays is multiplatform.</span></p>
</div>
<p>It has been around for some time, but currently the focus is on getting customers to use the Cloud version of TFS: Azure DevOps. You get all the features of TFS on premise, but it is much more scalable.</p>
<p>For source code management, two different kinds of repositories are supported. Originally, the default was <strong>Team Foundation Version Control</strong> (<strong>TFVC</strong>), which resembles SVN and is very much a centralized <strong>Version Control System</strong> (<span><strong>VCS</strong>)</span><span>. The other choice is Git. Over the past few years, Git has been adopted as the default VCS within Microsoft. You probably won't find a team that does</span>n't <span>use Git within Microsoft (well, maybe the team that's responsible for TFS).</span></p>
<p>If you want to migrate your TFS Git repository to GitLab, it's very easy. For instance, you can move a repository to a new one in an on-premise GitLab:</p>
<pre><strong> cd existing_repo</strong><br/><strong> git remote rename origin old-origin</strong><br/><strong> git remote add origin https://gitlab.example.com/me/newprojectingitlab.git</strong><br/><strong> git push -u origin --all</strong><br/><strong> git push -u origin --tags</strong></pre>
<p>Migrating a TFVC project takes a bit more effort, which I will explain later. First, let me explain the differences between TFVC and Git. We will start with the most important one: whether it is centralized or decentralized.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Centralized or decentralized</h1>
                </header>
            
            <article>
                
<p>The basic design of TFVC is that of a centralized repository on a server with authorized clients connecting to it to exchange information. Git's distributed nature is the complete opposite, with no central authority by default and the possibility to freely push and pull changes with others. Of course, you can create a central server that harbors a copy of the Git repository that everyone agrees is the newest version. This difference can be seen in the following diagram. The Git repository can exist in a local TFS or the Azure instance, while the TFVC one can only exist in one central place:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/22aa8e6b-dcaf-430c-8acc-7da6708203ff.png" style="width:27.33em;height:20.50em;"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Handling changes</h1>
                </header>
            
            <article>
                
<p>The best tool that you can use to work with TFVC is without a doubt Visual Studio. Let's discuss some points regarding the way it handles changes in your files.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Branching and merging capacity</h1>
                </header>
            
            <article>
                
<p>Compared to branches in Git, which are repository scoped, TFVC branches are path scoped and not as lightweight. Generally speaking, team members create additional workspaces for each branch they are working on. Changes are branch-independent, so to avoid chaos at integration time, you need to forward-integrate as many times as possible. The standard merge with TFVC uses a two-way merge (baseless).</p>
<p>Set your bar for creating branches high and only branch when you have a need for code or release isolation. It's more resource-intensive to use branches in TFVC. As the number of your feature branches increases, so do your storage requirements and branch hierarchy visualization fuzziness. In the following screenshot, you can see the situation as a developer; you can't merge because of conflicts:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/bf0c79ac-6d46-4088-8887-571142cce98a.png"/></p>
<p>In Git, a branch is only a pointer to a commit. The default diff in Git uses three-way merging, which also helps developers merge back.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">History</h1>
                </header>
            
            <article>
                
<p>Because of the centralized nature of TFVC, some pieces of information are not available when you are not connected. File history is not replicated to the client's development machine and can only be viewed when you are online with the server. This information is viewable via Visual Studio and the web portal. Via the context menu of an item, you can annotate files to see who changed a line, and when they changed it. The following screenshot shows what sort of information is given in the web portal:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/b8e0464d-b6ce-410f-9fa7-02f7854a03ca.png" style="width:55.58em;height:20.00em;"/></p>
<p>With Git, file history is replicated on the client's development machine. You can also view it when there is no connection to the TFS server. You can view history in Visual Studio and on the web portal, as well as on the specific Git server you are using, such as GitLab. By using Git's command option, you can find out who changed which lines in a file, and why. It can be a useful tool for identifying changes in your code as annotation is in TFVC. See the following <kbd>git blame</kbd> command:</p>
<pre><strong>$ git blame BSDLicence</strong><br/><strong> e2cc9eb2 (peter 2010-01-08 20:35:51 +0000  1) The files</strong><br/><strong> e2cc9eb2 (peter 2010-01-08 20:35:51 +0000  2)</strong><br/><strong> e2cc9eb2 (peter 2010-01-08 20:35:51 +0000  3) !PDF.Res</strong><br/><strong> e2cc9eb2 (peter 2010-01-08 20:35:51 +0000  4) !PDF.Sprites</strong><br/><strong> e2cc9eb2 (peter 2010-01-08 20:35:51 +0000  5) !PDF.Sprites22</strong><br/><strong> e2cc9eb2 (peter 2010-01-08 20:35:51 +0000  6) !PDF.Messages</strong><br/><strong> e2cc9eb2 (peter 2010-01-08 20:35:51 +0000  7) !PDF.Documents.Help/html</strong><br/><strong> e2cc9eb2 (peter 2010-01-08 20:35:51 +0000  8) !PDF.Documents.Help/txt</strong></pre>
<p class="mce-root">We can see that <kbd>peter</kbd> changed this file.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Traceability</h1>
                </header>
            
            <article>
                
<p>For some use cases, it is of the utmost importance to have good traceability. Think of companies such as banks and insurance companies who have to adhere to strict policies because of legislation. Since TFVC is a centralized repository type, its traceability is quite good out of the box. All change operations are recorded on the server and performed only by authorized individuals. There are direct links between issues, bugs, boards, and backlog items.</p>
<p>With Git, it is possible to setup the same system, but you need to make sure that your centralized repository enforces some extra checks and handles linking between entities (issue tracking in GitLab, for instance). By default, anyone can change the history of a Git repository, so out of the box, the traceability in Git is not very good.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">File handling</h1>
                </header>
            
            <article>
                
<p>Another big difference between Git and TFVC is when it comes to handling changes. This is connected to the fact that TFVC uses a central repository and Git is, by its nature, distributed. TFVC, with its central server, keeps all the files in a project under a single root path. Within this context, it is possible to apply permissions at a file level or lock files on the central server. By default, this is not possible with Git or with the basic GitLab configuration since there is no central place where you can enforce these authorizations. You can lock files somewhere, but a developer can happily continue developing locally and change code.</p>
<p>On the other hand, with Git, you can have multiple repositories in a GitLab project and have protection on a branch level or repository level. <span>You have the option to define multiple remotes to which you can push code. This means that you can store code in GitLab and also on Windows Azure. The following screenshot shows the menu that you can use to lock a file in TFVC:</span></p>
<p class="mce-root"/>
<p class="CDPAlignCenter CDPAlign"><img src="assets/8ab340e8-b268-4fd2-bacc-6f1363743f6f.png" style="width:41.25em;height:26.83em;"/></p>
<p>With TFVC, the files are all under one path and under control while in Git, there can be many branches and files spread over different remote servers. It's hard, if not impossible, to enforce centralized control.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The git-tfs tool</h1>
                </header>
            
            <article>
                
<p>There are several ways to migrate data from TFVC to Git. The simplest way is to do the migration in TFS itself. You can use their own import/export tools from the <a href="https://docs.microsoft.com/en-us/azure/devops/repos/git/import-from-tfvc?view=azure-devops&amp;tabs=new-nav&amp;viewFallbackFrom=vsts">https://docs.microsoft.com/en-us/azure/devops/repos/git/import-from-tfvc?view=azure-devops&amp;tabs=new-nav&amp;viewFallbackFrom=vsts</a> website.</p>
<p>There is also another tool that can be used for migration. <span>It is possible to have a bi-directional gateway between TFS and Git, just like there is with git-svn. It can put TFS commits into a Git repository, and allows you to push back changes to TFS.</span></p>
<p>The existence of these tools is caused by the fact that Microsoft internally switched to Git years ago and they have contributed a lot of source code to the codebase of Git. That is why it is standard (especially with Azure) to create new repositories using the Git format nowadays.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Preparing to migrate</h1>
                </header>
            
            <article>
                
<p>In this section, we will demonstrate how to migrate a TFVC project located on Azure DevOps. First, we will locate our project on Azure DevOps. You can do this by navigating to your organization at <a href="https://dev.azure.com">https://dev.azure.com</a>. Setting up an organization is outside the scope of this book, but it is quite easy and free if you are a small company or an open source project. You can read more about this on the Azure page, here: <a href="https://azure.microsoft.com/nl-nl/services/devops/">https://azure.microsoft.com/nl-nl/services/devops/</a>.</p>
<p>The project page for the git-tfs migration tool can be be found on GitHub (<a href="https://github.com/git-tfs/git-tfs">https://github.com/git-tfs/git-tfs</a>). Before you install git-tfs, there are a few prerequisites you need to take into account:</p>
<ul>
<li>You need a Windows machine to install it with.</li>
<li>It has to have Git for Windows.</li>
</ul>
<p>The git-tfs binaries can be downloaded from <a href="https://github.com/git-tfs/git-tfs/releases">https://github.com/git-tfs/git-tfs/releases</a>. Alternatively, you can do a managed install with chocolatey (<a href="https://chocolatey.org/">https://chocolatey.org/</a>). Installing with such a package manager takes care of the necessary details for you. Of course, you could build the package yourself because the source is also available. For these examples, we will use a basic Windows machine I already have set up. Let's get started:<a href="https://github.com/IvanBoyko/Dev-VM/tree/master/TFS-via-Vagrant"/></p>
<ol>
<li>It's easy to install Git using chocolatey:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/bcd3e27e-e476-4564-9acc-847e44babc9d.png" style="width:48.75em;height:20.58em;"/></p>
<ol start="2">
<li>The next step is to install git-tfs using the <kbd>gittfs</kbd> package:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/a0e201a5-fe03-4016-9fad-636b3940bc84.png"/></p>
<ol start="3">
<li>In order to perform the migration, we need to create a new project in our GitLab instance so that we have a destination for our Azure DevOps project:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/3e3bf9f3-5c9b-452d-9d2c-e8fc5f64005b.png"/></p>
<ol start="4">
<li>Now, we will use the git-tfs tool to clone the test project we created in Azure DevOps. It will bring up an authentication window:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/5cb26b68-f9f4-4d24-abea-f7a96b80c631.png" style="width:54.17em;height:41.00em;"/></p>
<ol start="5">
<li>It will automatically search through changesets and convert them into Git:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/4d5d1d73-956d-449a-b81d-6f5535bfbb73.png" style="width:25.17em;height:17.08em;"/></p>
<ol start="6">
<li>To copy this local Git repository to our GitLab project, we need to create a remote entry:</li>
</ol>
<pre style="padding-left: 60px">c:\git\MovingToGitlab&gt;git remote add origin https://gitlab.joustie.nl:8443/root/movingtogitlab.git</pre>
<ol start="7">
<li>Then, we will use <kbd>push -u</kbd> to push it to GitLab. Git for Windows will present you with a login screen, which you can authenticate against <a href="https://gitlab-ee.joustie.nl/users/sign_in">gitlab.joustie.nl</a>:<a href="https://gitlab-ee.joustie.nl/users/sign_in"/></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/64c4d021-814d-4643-909b-edcd7a43fd74.png" style="width:37.33em;height:11.83em;"/></p>
<ol start="8">
<li>When the migrations are finished, you can log in to your GitLab project. Here, you will find the pushed code:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/a2d48576-983d-4068-bf2f-58d1a486bc5b.png" style="width:66.25em;height:34.67em;"/></p>
<ol start="9">
<li>You can view the commit history in Git with <kbd>git log</kbd>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/50251b71-1541-488a-8c26-2a1f2fbd5b7b.png" style="width:41.42em;height:18.08em;"/></p>
<ol start="10">
<li>If you compare it with the history in TFVC, you will find it to be the same:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/f193b796-786d-4593-b130-8da2e49349ad.png" style="width:26.08em;height:9.67em;"/></p>
<p>By using the git-tfs tool, it is relatively easy to migrate your existing TFVC to Git.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<div>
<p><span>This chapter explained what TFS is and where its place is in the Microsoft product gamma. First, we compared TFVC and Git in terms of their architecture, as well as the way they handle branching and merging. We also took a look at how they treat history and the traceability of changes.</span></p>
<p><span>From there, we learned that there are different ways to migrate from TFS to Git. For one, you can export from the server itself. There's also a tool that you can use to create a mirror between a TFS and a Git repository that's called git-tfs.<strong> </strong></span><span>The most logical reason for this tool to exist is because, nowadays, Git relies heavily on Git repositories and needs to convert TFVC projects into Git format internally.</span></p>
<div>
<p><span>This chapter ends the part of this book about migrating data from other systems to GitLab. In the next part, we will extensively discuss the ways of connecting to GitLab.</span></p>
</div>
</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Questions</h1>
                </header>
            
            <article>
                
<ol>
<li><span>What is TFS used for in Microsoft's ALM suite?</span></li>
<li><span>What is the biggest difference between TFVC and Git?</span></li>
<li><span>TFS is part of what product in Azure?</span></li>
<li><span>How do you migrate a TFS Git repository to GitLab?</span></li>
<li><span>How are branches scoped in TFVC?</span></li>
<li><span>Where is history kept with TFVC?</span></li>
<li><span>What tool resembles git-tfs?</span></li>
<li><span>What tool on Windows makes it easy to install Git?</span></li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Further reading</h1>
                </header>
            
            <article>
                
<ul>
<li><span><em>Microsoft Team Foundation Server 2015 Cookbook</em> by <em>Tarun Arora</em>: <a href="https://www.packtpub.com/networking-and-servers/microsoft-team-foundation-server-2015-cookbook">https://www.packtpub.com/networking-and-servers/microsoft-team-foundation-server-2015-cookbook</a></span></li>
<li><span><em>Implementing DevOps with Microsoft Azure</em> by <em>Mitesh Soni</em>: <a href="https://www.packtpub.com/networking-and-servers/implementing-devops-microsoft-azure">https://www.packtpub.com/networking-and-servers/implementing-devops-microsoft-azure</a></span></li>
<li><span>TFS site: <a href="https://visualstudio.microsoft.com/tfs/">https://visualstudio.microsoft.com/tfs/</a></span></li>
<li><span>Git-tfs: <a href="https://github.com/git-tfs/git-tfs">https://github.com/git-tfs/git-tfs</a></span></li>
</ul>


            </article>

            
        </section>
    </body></html>