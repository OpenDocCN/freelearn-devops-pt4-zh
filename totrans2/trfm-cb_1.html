<html><head></head><body>
        <section>

                            <header class="header-title chapter-title">
                    Setting Up the Terraform Environment
                </header>
            
            <article>
                
<p>Before you start writing the Terraform configuration file, it is necessary to install and configure a local development environment. This development environment will allow Terraform's configuration file to be written and validated as it is developed.</p>
<p>In the recipes in this chapter, we will learn how to download and install Terraform manually on a Windows machine, as well as how to install it using a script on Windows and Linux. We will also learn how to use Terraform in a Docker container before learning how to migrate the Terraform configuration written in version 0.11 to version 0.13.</p>
<p class="mce-root">In this chapter, we'll cover the following recipes:</p>
<ul>
<li><span>Downloading and installing Terraform manually</span></li>
<li>Installing Terraform using a script on Linux</li>
<li>Installing Terraform using a script on Windows</li>
<li>Executing Terraform in a Docker container</li>
<li>Writing Terraform configuration in VS Code</li>
<li>Migrating your Terraform configuration to Terraform 0.13</li>
</ul>
<p>Let's get started!</p>
<h1 id="uuid-fb55cacb-2e3e-4e44-8785-2892365ba3dc">Technical requirements</h1>
<p>This chapter does not require that you have any specific technical knowledge. We will mainly use graphical user interfaces and simple Linux and Windows scripts. However, knowledge of Docker is also recommended so that you can complete the <em>Executing Terraform in a Docker container </em>recipe. </p>
<p>Finally, for the IDE, we will use Visual Studio Code, which is available for free at <a href="https://code.visualstudio.com/">https://code.visualstudio.com/</a>.</p>
<p><span>The source code for this chapter is available at <a href="https://github.com/PacktPublishing/Terraform-Cookbook/tree/master/CHAP01">https://github.com/PacktPublishing/Terraform-Cookbook/tree/master/CHAP01</a>.</span></p>
<p class="mce-root">Check out the following video to see the code in action: <a href="https://bit.ly/3h9noXz">https://bit.ly/3h9noXz</a></p>
<h1 id="uuid-eea9d43d-c68e-4a66-ac56-58768525dd3a">Downloading and installing Terraform manually</h1>
<p>In this recipe, we will learn how to download and install Terraform on a local machine under a Windows operating system.</p>
<h2 id="uuid-0179d6fb-14fd-4a17-86c2-17244ffa5c89">Getting ready</h2>
<p>To complete this recipe, the only prerequisite is that you're on a Windows operating system.</p>
<h2 id="uuid-5a24c7eb-162b-4360-934d-ca48e7cc63e8">How to do it…</h2>
<p>Perform the following steps:</p>
<ol>
<li class="mce-root">Open Windows File Explorer. Choose a location and create a folder called <kbd>Terraform</kbd><span>. We will use this to store the Terraform binary;</span> for example, <kbd>C:/Terraform</kbd>.</li>
<li class="mce-root">Launch a web browser and go to <a href="https://www.terraform.io/downloads.html">https://www.terraform.io/downloads.html</a>.</li>
<li class="mce-root">Scroll down the page until you reach the package for <span class="packt_screen">Windows</span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/ad4b8bc3-201c-4cd7-a9f4-4fa2838ac9d6.png"/></p>
<ol start="4">
<li class="mce-root">Click on the <span class="packt_screen">64-bit</span> link, which targets the Terraform ZIP package for the Windows 64-bit operating system. The package will be downloaded locally.</li>
<li>Unzip the content of the <span>downloaded </span><span>ZIP file into the <kbd>Terraform</kbd> folder that we created in <em>step 1</em>:</span></li>
</ol>
<p class="mce-root CDPAlignCenter CDPAlign"><img src="assets/84aca3c0-bab5-47f9-ac84-7b3e1a577fab.png"/></p>
<p>The last thing we need to do to install Terraform is configure the <span class="packt_screen">Path</span> environment variable by adding the path of the Terraform binary folder.</p>
<p>To do this, follow these steps:</p>
<ol>
<li>In File Explorer, right-click on the <span class="packt_screen">This PC</span> menu and choose <span class="packt_screen">Properties</span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/c00b8a0f-5220-4f52-97f4-94aa3c6f6864.png"/></p>
<ol start="2">
<li>Click on the <span class="packt_screen">Advanced system settings</span> link and click the <span class="packt_screen">Environment variables</span> button of the newly opened window:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/8fd73ee5-28fe-4d17-b228-b970746dcc04.png"/></p>
<ol start="3">
<li class="mce-root">When provided with a list of environments, select <span class="packt_screen">User variables</span> or <span class="packt_screen">Systems variables</span> (choose this option to apply the environment variable to all users of the workstation), and select the <span class="packt_screen">Path</span> variable. Then, click on the <span class="packt_screen">Edit</span> button:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/b07e5705-9816-401a-9376-a84ee6950dd2.png"/></p>
<ol start="4">
<li class="mce-root">From the list of paths, add the folder we created; that is, <kbd>C:\Terraform\</kbd>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/ab91057d-03be-4a31-8240-e8f1b3b410b2.png"/></p>
<p><span>Finally, we validate all the open windows by clicking on the <span class="packt_screen">OK</span> button, which is present at the bottom of every open window.</span></p>
<h2 id="uuid-ab33fd06-738e-4c5d-81b6-87f97be330cd">How it works…</h2>
<p>Downloading and installing Terraform is simple, and adding the path of the Terraform binary to the <kbd>PATH</kbd> environment variable makes it possible to execute the Terraform command line from any terminal location.</p>
<p><span>After completing all these steps, we can check that Terraform is working properly by opening a command-lin</span>e terminal or PowerShell an<span>d executing the following command:</span></p>
<pre><strong>terraform --help</strong></pre>
<p>The result of executing the preceding command is shown in the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/50a0e180-e4bb-49e5-a64a-9d262b0c0d12.png" style="width:33.58em;height:40.33em;"/></p>
<p>By doing this, the list of Terraform commands will be displayed in the terminal.</p>
<h1 id="uuid-5604d3d5-8f3f-4a23-9005-8d24038d9266">Installing Terraform using a script on Linux</h1>
<p>In this recipe, we will learn how to install Terraform on a Linux machine using a script.</p>
<h2 id="uuid-41e704c5-dd79-4197-9917-39ef6f122562">Getting ready</h2>
<p>To complete this recipe, the only prerequisites are that you are running a Linux operating system and that you have an <em>unzip</em> utility installed. The <kbd>gpg</kbd>, <kbd>curl</kbd>, and <kbd>shasum</kbd> tools must be installed; they are often installed by default on all Linux distributions.</p>
<h2 id="uuid-50241dab-0e42-4e9c-bff5-534187e21b50">How to do it…</h2>
<p>Perform the following steps:</p>
<ol>
<li>Open a command-line terminal and execute the following script:<span><br/></span></li>
</ol>
<pre style="padding-left: 60px">TERRAFORM_VERSION="0.12.29"<br/><br/>curl -Os https://releases.hashicorp.com/terraform/${TERRAFORM_VERSION}/terraform_${TERRAFORM_VERSION}_linux_amd64.zip \<br/>&amp;&amp; curl -Os https://releases.hashicorp.com/terraform/${TERRAFORM_VERSION}/terraform_${TERRAFORM_VERSION}_SHA256SUMS \<br/>&amp;&amp; curl https://keybase.io/hashicorp/pgp_keys.asc | gpg --import \<br/>&amp;&amp; curl -Os https://releases.hashicorp.com/terraform/${TERRAFORM_VERSION}/terraform_${TERRAFORM_VERSION}_SHA256SUMS.sig \<br/>&amp;&amp; gpg --verify terraform_${TERRAFORM_VERSION}_SHA256SUMS.sig terraform_${TERRAFORM_VERSION}_SHA256SUMS \<br/>&amp;&amp; shasum -a 256 -c terraform_${TERRAFORM_VERSION}_SHA256SUMS 2&gt;&amp;1 | grep "${TERRAFORM_VERSION}_linux_amd64.zip:\sOK" \<br/>&amp;&amp; unzip -o terraform_${TERRAFORM_VERSION}_linux_amd64.zip -d /usr/local/bin</pre>
<div class="packt_infobox">The source code for this script is also available in this book's GitHub repository: <a href="https://github.com/PacktPublishing/Terraform-Cookbook/blob/master/CHAP01/install_terraform_linux.sh">https://github.com/PacktPublishing/Terraform-Cookbook/blob/master/CHAP01/install_terraform_linux.sh</a></div>
<ol start="2">
<li class="mce-root">After executing this script, we can check the installation of Terraform by executing the following command:</li>
</ol>
<pre style="padding-left: 60px" class="mce-root"><strong>terraform --version</strong></pre>
<p class="mce-root">The preceding command displays the installed version of Terraform, which means we can check that Terraform is correctly installed and that the desired version is installed.</p>
<h2 id="uuid-f89f6eaf-e651-490c-a38d-77d01ec02f38">How it works…</h2>
<p>In this script, in the first line, the <kbd>TERRAFORM_VERSION</kbd> variable is filled in with the Terraform version that we want to install. This variable is only mentioned here since we don't want to keep repeating the version of Terraform we're using throughout the script.</p>
<div class="mce-root packt_infobox">In this recipe, the <span>0.12.29</span> version of Terraform is used, but we are free to modify this.</div>
<p class="mce-root">With the <kbd>curl</kbd> tool, the script downloads the ZIP file containing the Terraform binary. Then, the script checks the security integrity of the packaged. This is <span>called <kbd>shasum</kbd></span>.</p>
<p class="mce-root">In the last line, the script unzips the downloaded package inside the local directory, <kbd>/usr/local/bin</kbd>, which is already mentioned by default in the <kbd>PATH</kbd> environment variable.</p>
<p class="mce-root">You can check that the version of Terraform you have installed corresponds to the one mentioned in the script by executing the following command:</p>
<pre class="mce-root"><strong>terraform --version</strong></pre>
<p class="mce-root">This command displays the installed version of Terraform, as shown in the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/8223b9f0-dde6-402f-853d-eb359a76a090.png"/></p>
<p>As we can see, here, the version of Terraform we have is 0.12.29.</p>
<h2 id="uuid-0df07bcf-952a-4db1-a894-e3540cc8e4e3">There's more…</h2>
<p class="mce-root">In this Terraform installation script, we have specified the version number of Terraform to be installed.</p>
<p class="mce-root">If you want to install the latest version without having to know the version number, it is also possible to dynamically retrieve the version number of the latest version using the following API: <a href="https://checkpoint-api.hashicorp.com/v1/check/terraform">https://checkpoint-api.hashicorp.com/v1/check/terraform</a>. This retrieves information about the current version of Terraform.</p>
<p class="mce-root">The following screenshot shows our current version:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/0f3226ef-3ea6-44ae-bd64-df512298e96a.png"/></p>
<p class="mce-root">Note that the <kbd>current_version</kbd> property, which contains the latest Terraform version, is a value.</p>
<p class="mce-root">With this API, we can perfectly modify the first line of the installation script with the following code:</p>
<pre class="mce-root">TERRAFORM_VERSION=$(curl -s https://checkpoint-api.hashicorp.com/v1/check/terraform | jq -r .current_version)<br/><br/>....</pre>
<p>The complete script for installing Terraform with this block is available at <a href="https://github.com/PacktPublishing/Terraform-Cookbook/blob/master/CHAP01/install_terraform_linux_v2.sh">https://github.com/PacktPublishing/Terraform-Cookbook/blob/master/CHAP01/install_terraform_linux_v2.sh</a>.</p>
<p>This block of code uses the <kbd>curl</kbd> command to retrieve the API return and parses its contents to retrieve the value of the <kbd>current_version</kbd> property with the jq tool (available at <a href="https://stedolan.github.io/jq/">https://stedolan.github.io/jq/</a>).</p>
<p>In addition, the <kbd>terraform --version</kbd> command shows whether the latest version is installed. If you have installed an old version, this command displays a message indicating the latest version:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/be270c25-363b-4b52-a11d-c94de7c90de7.png"/></p>
<p class="CDPAlignLeft CDPAlign">Here, we can see that we have installed version 0.12.28 and that the latest version is 0.12.29 (at the time of writing this recipe).</p>
<p>Finally, HashiCorp announced that the Terraform binary will soon be available in the Linux package manager. For more information, take a look at the following article: <a href="https://www.hashicorp.com/blog/announcing-the-hashicorp-linux-repository">https://www.hashicorp.com/blog/announcing-the-hashicorp-linux-repository</a></p>
<h2 id="uuid-65de014f-e9e6-4ae7-b433-13e8bcf2687f">See also</h2>
<p>For more information on verifying the downloaded package, you can consult the HashiCorp documentation at <a href="https://www.hashicorp.com/security.html">https://www.hashicorp.com/security.html</a>.</p>
<h1 id="uuid-4ac10afe-379e-4e38-9c4e-30caf2e051db">Installing Terraform using a script on Windows</h1>
<p>In this recipe, we will learn how to install Terraform on a Windows machine using a script that uses the <strong>Chocolatey</strong> software package manager.</p>
<h2 id="uuid-171ddcb8-02fe-471c-80e3-851ab7ebf42b">Getting ready</h2>
<p>To complete this recipe, you'll need to be using a Windows operating system and have Chocolatey (<a href="https://chocolatey.org/">https://chocolatey.org/</a>) installed, which is a Windows software package manager.</p>
<p class="mce-root">If you don't have Chocolatey installed, you can easily install it by following these steps:</p>
<ol>
<li class="mce-root">Open a PowerShell terminal in administrator mode, as shown in the following screenshot:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/0ad32f94-49a2-4063-99bb-d9bef24123c1.png" style="width:38.08em;height:30.25em;"/></p>
<ol start="2">
<li class="mce-root">Then, execute this following script in the terminal:</li>
</ol>
<pre style="padding-left: 60px">Set-ExecutionPolicy Bypass -Scope Process -Force; [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072; iex ((New-Object System.Net.WebClient).DownloadString('https://chocolatey.org/install.ps1'))</pre>
<div class="packt_infobox">The complete installation documentation for Chocolatey is available at <a href="https://chocolatey.org/install">https://chocolatey.org/install</a>.</div>
<h2 id="uuid-1a5a2133-e938-45c8-9dab-fe6d1e213f8a">How to do it…</h2>
<p>Perform the following steps:</p>
<ol>
<li>Open a PowerShell command-line terminal in administrator mode.</li>
<li class="mce-root"><span>Execute the following command:</span></li>
</ol>
<pre style="color: black;padding-left: 60px"><strong>choco install -y  terraform</strong></pre>
<p class="mce-root"><span>The following screenshot shows the execution of this command:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/69b6593e-4d4f-46b9-829d-a11250c1bcf4.png"/></p>
<p style="padding-left: 60px">The <kbd>-y</kbd> option is optional. It allows us to accept the license agreement automatically.</p>
<h2 id="uuid-096c9afa-58b9-4bb8-9856-b36035730fd3">How it works…</h2>
<p>When Chocolatey installs the Terraform package, it executes the scripts in the package source code, available at <a href="https://github.com/jamestoyer/chocolatey-packages/tree/master/terraform">https://github.com/jamestoyer/chocolatey-packages/tree/master/terraform</a>.</p>
<p class="mce-root">Then, by executing the script available at <a href="https://github.com/jamestoyer/chocolatey-packages/blob/master/terraform/tools/chocolateyInstall.ps1">https://github.com/jamestoyer/chocolatey-packages/blob/master/terraform/tools/chocolateyInstall.ps1</a>, Chocolatey downloads the Terraform ZIP file into the binary directory of Chocolatey's packages, which is already included in the <kbd>PATH</kbd> environment variable.</p>
<h2 id="uuid-d5d11203-e0d6-4932-b85a-1be92e404f62">There's more…</h2>
<p>When upgrading Terraform, it is possible to upgrade it directly with Chocolatey by executing the <kbd>choco upgrade -y terraform</kbd> command.</p>
<p class="mce-root">By default, the <kbd>choco install</kbd> command installs the latest version of the mentioned package. It is also possible to specify a specific version by adding the <kbd>--version</kbd> option to the command, which in our case would give us, for example, the following:</p>
<pre class="mce-root">choco install -y terraform <strong>--version "0.12.28"</strong></pre>
<p class="mce-root">In this example, we have specified that we want to install version <kbd>0.12.28</kbd> of Terraform and not the latest version.</p>
<div class="packt_infobox">Be aware that the Terraform package from Chocolatey can have a time lag regarding the latest official version of Terraform, while in the Linux script, as shown in the <em>Installing Terraform on Linux </em>recipe, you can specify the latest version that has just been released.</div>
<h2 id="uuid-f2587912-e156-4467-9d0e-43b3e0d01113">See also</h2>
<p>To learn about all the commands provided with Chocolatey, I suggest reading the following documentation: <a href="https://chocolatey.org/docs/commands-reference#commands.">https://chocolatey.org/docs/commands-reference#commands</a></p>
<h1 id="uuid-f935ee23-83c6-46ba-8b8d-2d46888ad5b1">Executing Terraform in a Docker container</h1>
<p>In the previous recipes of this chapter, we discussed how to install Terraform locally, either manually or via a script, depending on the local operating system.</p>
<p><span>In this recipe, we will learn how</span> to run Terraform in a Docker container, which will allow us to enjoy the following benefits:</p>
<ul>
<li>There is no need to install Terraform locally.</li>
<li>We can have a Terraform runtime environment independent of the local operating system.</li>
<li>We can test our Terraform configuration with different versions of Terraform.</li>
</ul>
<p>Let's get started!</p>
<h2 id="uuid-df4b0308-66d3-4f0a-ad96-b2d5c0e15c93">Getting ready</h2>
<p>To complete this recipe, you'll need to know about Docker and its commands, as well as how to write Dockerfiles. Please read the documentation for more information: <a href="https://docs.docker.com/get-started/overview/">https://docs.docker.com/get-started/overview/</a></p>
<p class="mce-root">On our local computer, we installed Docker using a tool called Docker Desktop for Windows.</p>
<div class="mce-root packt_infobox">For Docker installation guides for other operating systems, please read the Docker installation documentation at <a href="https://docs.docker.com/get-docker/">https://docs.docker.com/get-docker/</a>.</div>
<p class="mce-root">We also have a Terraform configuration file already written, which will not be detailed here. This will be executed in our Docker container.</p>
<p class="mce-root">You will also need the respective Terraform commands, <kbd>init</kbd>, <kbd>plan</kbd>, and <kbd>apply</kbd>, which will not be explained in the context of this recipe.</p>
<h2 id="uuid-0bee1246-8125-424f-83c8-16337befa451">How to do it…</h2>
<p>Perform the following steps:</p>
<ol>
<li>At the root of the folder that contains the Terraform configuration, we need to create a Dockerfile that contains the following code:</li>
</ol>
<div>
<div>
<pre style="padding-left: 60px"><strong><span>FROM</span></strong><span><strong> </strong>golang:latest<br/></span><strong><span>ENV</span></strong><span><strong> </strong>TERRAFORM_VERSION=0.13.0<br/></span><strong><span>RUN</span></strong><span><strong> </strong>apt-get update &amp;&amp; apt-get install unzip \<br/></span><span>    &amp;&amp; curl -Os https://releases.hashicorp.com/terraform/${TERRAFORM_VERSION}/terraform_${TERRAFORM_VERSION}_linux_amd64.zip \<br/></span><span>    &amp;&amp; curl -Os https://releases.hashicorp.com/terraform/${TERRAFORM_VERSION}/terraform_${TERRAFORM_VERSION}_SHA256SUMS \<br/></span><span>    &amp;&amp; curl https://keybase.io/hashicorp/pgp_keys.asc | gpg --import \</span><span>    &amp;&amp; curl -Os https://releases.hashicorp.com/terraform/${TERRAFORM_VERSION}/terraform_${TERRAFORM_VERSION}_SHA256SUMS.sig \<br/></span><span>    &amp;&amp; gpg --verify terraform_${TERRAFORM_VERSION}_SHA256SUMS.sig terraform_${TERRAFORM_VERSION}_SHA256SUMS \<br/></span><span>    &amp;&amp; shasum -a 256 c terraform_${TERRAFORM_VERSION}_SHA256SUMS 2&gt;&amp;1 | grep </span><span>"${TERRAFORM_VERSION}_linux_amd64.zip:</span><span>\s</span><span>OK"</span><span> \<br/></span><span>    &amp;&amp; unzip -o terraform_${TERRAFORM_VERSION}_linux_amd64.zip -d /usr/bin<br/></span><strong><span>RUN</span></strong><span><strong> </strong>mkdir /tfcode<br/></span><strong><span>COPY</span></strong><span><strong> </strong>. /tfcode<br/></span><strong><span>WORKDIR</span></strong><span><strong> </strong>/tfcode</span></pre></div>
</div>
<div style="padding-left: 60px" class="packt_infobox">This source code is also available at <a href="https://github.com/PacktPublishing/Terraform-Cookbook/blob/master/CHAP01/terraform-docker/Dockerfile">https://github.com/PacktPublishing/Terraform-Cookbook/blob/master/CHAP01/terraform-docker/Dockerfile</a>.</div>
<ol start="2">
<li class="mce-root">Next, we need to create a new Docker image by executing the <kbd>docker build</kbd> command in a terminal:</li>
</ol>
<pre style="padding-left: 60px" class="mce-root"><strong>docker build -t terraform-code:v1.0 .</strong></pre>
<ol start="3">
<li class="mce-root">Then, we need to instantiate a new container of this image. To do this, we will execute the <kbd>docker run</kbd> command:</li>
</ol>
<pre style="padding-left: 60px" class="mce-root"><strong>docker run -it -d --name tfapp terraform-code:v1.0 /bin/bash</strong></pre>
<ol start="4">
<li class="mce-root">Now, we can execute the Terraform commands in our container by using the following commands:</li>
</ol>
<pre style="padding-left: 60px" class="mce-root"><strong>docker exec tfapp terraform init</strong><br/><strong>docker exec tfapp terraform plan</strong><br/><strong>docker exec tfapp terraform apply --auto-approve</strong></pre>
<p style="padding-left: 60px" class="mce-root">The following screenshot shows a part of the output of executing these commands (<kbd>terraform plan</kbd>):</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/4f62c061-ebe1-45fb-8708-29bcbe3e179e.png" style="width:34.67em;height:29.92em;"/></p>
<h2 id="uuid-bd66c2e5-3d39-4780-b408-5ed91a65951a">How it works…</h2>
<p>In <em>step 1</em>, we write the composition of the Docker image in the Dockerfile. We do this as follows:</p>
<ol>
<li>We use a Golang base image.</li>
<li>We initialize the <kbd>TERRAFORM_VERSION</kbd> variable with the version of Terraform to be installed.</li>
<li>We write the same Terraform installation script we wrote in the <em>Installing Terraform on Linux</em> recipe. </li>
<li>We copy the Terraform configuration from our local file into a new folder located in the image.</li>
<li>We specify that our workspace will be our new folder.</li>
</ol>
<p class="mce-root">Then, in <em>steps 2</em> and <em>3</em>, we create a Docker <kbd>terraform-code</kbd> image with a <kbd>v1.0</kbd> tag. This tag is used to version our Terraform configuration. Then, we create a <kbd>tfapp</kbd> instance of this image, which runs with the bash tool.</p>
<p class="mce-root">Finally, in <em>step 4</em>, in the <kbd>tfapp</kbd> instance, we execute the Terraform commands in our container workspace.</p>
<h2 id="uuid-13c48611-d269-44b7-a9ad-d0befa68fb56">There's more…</h2>
<p>In this recipe, we studied how to write, build, and use a Docker image that contains the Terraform binary. With this, it is possible to complete this image with other tools such as <strong>Terragrunt</strong>, which are also used to develop the Terraform configuration file.</p>
<p class="mce-root">If you want to use just Terraform, you can use the official image provided by HashiCorp. This is public and available on Docker Hub at <a href="https://hub.docker.com/r/hashicorp/terraform/">https://hub.docker.com/r/hashicorp/terraform/</a>.</p>
<h2 id="uuid-5e120cc5-746e-4f6e-80e9-7f7b71c61656">See also</h2>
<ul>
<li>The full Docker commands documentation at <a href="https://docs.docker.com/engine/reference/run/">https://docs.docker.com/engine/reference/run/</a>.</li>
<li>For an introduction to Docker, please refer to the book <em>Learning DevOps</em>, which is available at <a href="https://www.packtpub.com/cloud-networking/learning-devops">https://www.packtpub.com/cloud-networking/learning-devops</a>.</li>
</ul>
<h1 id="uuid-02def779-95c1-456e-ac0a-21d1fc301978">Writing Terraform configuration in VS Code</h1>
<p>Writing a Terraform configuration file does not require a special code editor. However, popular code editors have adapted and now offer plugins that simplify writing such a file.</p>
<p class="mce-root">In this recipe, we will focus on Visual Studio Code, which has the following benefits:</p>
<ul>
<li class="mce-root">It's cross-platform, which means it can be installed on Windows, Linux, and macOS.</li>
<li class="mce-root">It's free of charge.</li>
<li class="mce-root">It has a multitude of extensions that cover all the needs of developers on a daily basis.</li>
</ul>
<p class="mce-root">In this recipe, we will learn how to configure Visual Studio Code so that we can write the Terraform configuration. We'll also see how much faster it is to write code in this way.</p>
<h2 id="uuid-e5592e70-2b06-407a-89e9-014614d815d4">Getting ready</h2>
<p>For this recipe, you need to have Visual Studio Code installed on your local machine. You can install it by going to <a href="https://code.visualstudio.com/">https://code.visualstudio.com/</a>.</p>
<h2 id="uuid-2616fc0b-6e7c-4ae2-8302-fc3db2e8aa26">How to do it…</h2>
<p>To use Visual Studio Code with Terraform, we need to install the respective extension and configure it.</p>
<p class="mce-root">To install this extension, perform the following steps:</p>
<ol>
<li class="mce-root">Open Visual Studio Code and click on the extension tab. This can be found on the sidebar, on the left-hand side of the editor, as shown in the following screenshot:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/4d3aa041-07b5-4f8e-b8ac-f3400be70345.png"/></p>
<ol start="2">
<li class="mce-root">Then, we search for the extension by using the <kbd>Terraform</kbd> keyword.</li>
</ol>
<ol start="3">
<li class="mce-root">Install the first extension of the list, called <span class="packt_screen">Terraform</span>. This is published by <em>HashiCorp</em>. Do this by clicking on the <span class="packt_screen">Install</span> button of the extension:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/2d837492-fb0d-4683-8eef-48aaf83799ea.png"/></p>
<ol start="4">
<li>Reload Visual Studio Code to apply the extension.</li>
</ol>
<h2 id="uuid-fc55f0ec-37dd-4f09-8979-a862cd5b48f2">How it works…</h2>
<p>In the first part of this recipe, we installed the Terraform extension for Visual Studio Code.</p>
<div class="mce-root packt_infobox">When searching for Terraform extensions, several will appear, but the one we chose is one of the most powerful in my opinion.</div>
<p class="mce-root">Once installed, this extension offers a lot of functionalities for editing Terraform's configuration, such as autocompletion, validating the configuration, syntax for <kbd>tflint</kbd>, code formatting, links to the official documentation, and a module explorer.</p>
<p class="mce-root">This component allows Visual Studio Code to function better with Terraform 0.12 <span>–</span> at least when it comes to the extension's functionalities.</p>
<h2 id="uuid-94e7ea0a-1d75-462e-b048-54c510aa49e7">There's more…</h2>
<p>Once the extension has been installed and configured, we can write the Terraform configuration in our <kbd>main.tf</kbd> file. Here, we have some very useful features we can use to develop the Terraform configuration, some of which are as follows:</p>
<ul>
<li>Syntax highlighting:</li>
</ul>
<p class="CDPAlignCenter CDPAlign"><img src="assets/496f28aa-713f-4670-b687-a60c37cc0eaf.png" style="width:23.08em;height:9.83em;"/></p>
<ul>
<li class="mce-root">Autocompletion for resources and properties:</li>
</ul>
<p class="CDPAlignCenter CDPAlign"><img src="assets/7cca0dd5-3227-4dc2-afdc-be2fe4c97f8d.png" style="width:30.33em;height:18.25em;"/></p>
<ul>
<li class="mce-root">Real-time code validation:</li>
</ul>
<p class="CDPAlignCenter CDPAlign"><img src="assets/de926f81-05dc-46bf-b0ea-7ee31e2a20c6.png" style="width:41.00em;height:18.17em;"/></p>
<ul>
<li class="mce-root">The ability to display the number of references, along with a link to view them:</li>
</ul>
<p class="CDPAlignCenter CDPAlign"><img src="assets/2e9d332f-8f97-4bac-9e87-01fce98030f5.png"/></p>
<h2 id="uuid-e5fe311b-0442-4356-9458-1574722652e7">See also</h2>
<ul>
<li>To see the complete list of features for this extension, please refer to the following documentation: <a href="https://marketplace.visualstudio.com/items?itemName=HashiCorp.terraform">https://marketplace.visualstudio.com/items?itemName=HashiCorp.terraform</a>, and its change log: <a href="https://marketplace.visualstudio.com/items/HashiCorp.terraform/changelog">https://marketplace.visualstudio.com/items/HashiCorp.terraform/changelog</a><a href="https://marketplace.visualstudio.com/items?itemName=HashiCorp.terraform">.</a></li>
<li class="mce-root">All Visual Studio Code extensions related to Terraform can be found at <a href="https://marketplace.visualstudio.com/search?term=terraform&amp;target=VSCode&amp;category=All%20categories&amp;sortBy=Relevance">https://marketplace.visualstudio.com/search?term=terraform&amp;target=VSCode&amp;category=All%20categories&amp;sortBy=Relevance</a>.</li>
<li>To read more about the support provided for this extension by HashiCorp, please go to <a href="https://www.hashicorp.com/blog/supporting-the-hashicorp-terraform-extension-for-visual-studio-code/">https://www.hashicorp.com/blog/supporting-the-hashicorp-terraform-extension-for-visual-studio-code/</a>.</li>
</ul>
<h1 id="uuid-61f6291d-2c46-4bb5-89d4-93b6ba8d05d4">Migrating your Terraform configuration to Terraform 0.13</h1>
<p>Officially released in May 2019, version 0.12 of Terraform has brought many new features to the language, but also changes, and during this summer 2020, the new Terraform version 0.13 has been released, also providing new features and some changes.</p>
<p>We must take these changes into account before we upgrade the code.</p>
<p class="mce-root">In this recipe, we will discuss how to verify that our Terraform configuration is compatible with version 0.12. After that, we will learn how to migrate our Terraform configuration from version 0.11 to version 0.12 and then to version 0.13.</p>
<h2 id="uuid-7172dd2a-c4ba-44ef-b140-67221ba70583">Getting ready</h2>
<p>Before migrating your code  from version 0.11 to the latest version (currently 0.13), you will need to have code that works with the latest version of Terraform 0.11, which is 0.11.14. You can download this version from <a href="https://releases.hashicorp.com/terraform/0.11.14/">https://releases.hashicorp.com/terraform/0.11.14/</a>.</p>
<p>It is important to know that if your Terraform configuration is in version 0.11, it is not possible to migrate it directly to 0.13. You will first have to upgrade to 0.12 and then migrate to 0.13.</p>
<p>In addition, before any migration, it is strongly advised to read the upgrade documentation provided by HashiCorp (here for 0.12, <a href="https://www.terraform.io/upgrade-guides/0-12.html">https://www.terraform.io/upgrade-guides/0-12.html</a>, and here for 0.13, <a href="https://github.com/hashicorp/terraform/blob/master/website/upgrade-guides/0-13.html.markdown">https://github.com/hashicorp/terraform/blob/master/website/upgrade-guides/0-13.html.markdown</a>). This is because in the upgrade process, as we will study in this recipe, many elements are migrated automatically, but others will have to be done manually.</p>
<p>Finally, it is also recommended by HashiCorp, before performing the migration process, to commit its code in a source code manager (for example, Git) in order to be able to visualize the code changes brought by the migration.</p>
<p>The code source (version 0.11) used for this recipe is available here: <a href="https://github.com/PacktPublishing/Terraform-Cookbook/tree/master/CHAP01/tf011">https://github.com/PacktPublishing/Terraform-Cookbook/tree/master/CHAP01/tf011</a></p>
<h2 id="uuid-6c511000-46f9-4987-aacd-65dd9737921c">How to do it…</h2>
<p>The upgrade of the Terraform configuration from version 0.11 to version 0.13 takes place in two steps, First the code has to be migrated to 0.12, and then be migrated to 0.13.</p>
<p>To migrate our  Terraform configuration from version 0.11 to version 0.12, perform the following steps:</p>
<p>Before migrating this configuration to version 0.12, we must verify that it is compatible with this version. To do this, follow these steps:</p>
<ol>
<li class="mce-root">Using Terraform 0.11.14, in a terminal, execute the following command:</li>
</ol>
<pre style="padding-left: 60px" class="mce-root"><strong>terraform 0.12checklist</strong></pre>
<p style="padding-left: 60px" class="mce-root">The following screenshot shows the output of executing the preceding command:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/8639a559-e442-4965-8adc-80b2409cca09.png"/></p>
<p style="padding-left: 60px" class="mce-root">As we can see, our Terraform configuration is compatible with Terraform version 0.12. Now, we can migrate it.</p>
<ol start="2">
<li class="mce-root">Next, we need to install the latest version of Terraform 0.12 manually, as described in the <em>Downloading and installing Terraform manually</em> <span>recipe. We can also do this via a </span>script, according to our operating system, as shown in the <em>Installing Terraform on Linux</em> and <em>Installing Terraform using a script on Windows</em> <span>recipes</span>.</li>
<li class="mce-root">In the folder that contains our code, we execute the <kbd>init</kbd> command:</li>
</ol>
<pre style="padding-left: 60px" class="mce-root"><strong>terraform init</strong></pre>
<ol start="4">
<li class="mce-root">Then, we execute the following command:</li>
</ol>
<pre style="padding-left: 60px" class="mce-root"><strong>terraform 0.12upgrade</strong></pre>
<ol start="5">
<li>Finally, we confirm the migration by answering <kbd>yes</kbd> when prompted to enter a value, as shown in the following screenshot:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/ae9b39b4-a4af-4175-b198-e4821473d41e.png" style="width:37.25em;height:23.33em;"/></p>
<p>Then, to migrate our Terraform configuration from version 0.12 to version 0.13, perform the following steps:</p>
<ol>
<li><span>Download and install the latest version of Terraform 0.13.</span></li>
<li>Exactly as before for 0.12, run the <kbd>terraform 0.13upgrade</kbd> <span>command </span>to upgrade the configuration to 0.13:</li>
</ol>
<div style="margin-left: 2em" class="CDPAlignCenter CDPAlign"><img src="assets/950b79fb-4466-4d12-8e78-a46e141905cb.png" style="width:37.75em;height:19.00em;"/></div>
<h2 id="uuid-602dcb76-2f16-4fa2-bb6f-bb8b1c49b90d">How it works…</h2>
<p>In <em>step 1</em>, we verified that our Terraform configuration is compatible with the language evolution (HCL 2) included in Terraform 0.12.</p>
<p class="mce-root">Then, we installed Terraform 0.12 locally and started the migration process by executing the <kbd>terraform init</kbd> command, which is necessary to download the different providers that will be called in our code.</p>
<p class="mce-root">We migrated the Terraform configuration to the 0.12 version using the <kbd>terraform 0.12upgrade</kbd> command, which upgrades the Terraform configuration directly.</p>
<p>Finally, to upgrade the Terraform configuration to the 0.13 version, we installed the Terraform 0.13 binary and executed the command <kbd>terraform 0.13upgrade</kbd>.</p>
<h2 id="uuid-d59e34ef-4af3-4f80-9637-00ad9a1a7d8e">There's more…</h2>
<p>Please note that the migration procedure only changes the current Terraform configuration. If our Terraform configuration calls for modules, it is necessary to migrate the code of the modules beforehand.</p>
<h2 id="uuid-8644c933-fde3-4a02-a512-1524e6a65703">See also</h2>
<p>For more information on the migration procedure for Terraform to version 0.12, please refer to the technical documentation at <a href="https://www.terraform.io/upgrade-guides/0-12.html">https://www.terraform.io/upgrade-guides/0-12.html</a>.</p>
<p>To find out more about the evolution of Terraform and the changes that were made in this new major version, take a look at the following documentation and related articles:</p>
<ul>
<li><a href="https://www.hashicorp.com/resources/a-2nd-tour-of-terraform-0-12">https://www.hashicorp.com/resources/a-2nd-tour-of-terraform-0-12</a></li>
<li><a href="https://www.hashicorp.com/blog/announcing-terraform-0-12/">https://www.hashicorp.com/blog/announcing-terraform-0-12/</a></li>
</ul>
<p class="mce-root">Finally, the following is the official repository for Terraform: <a href="https://github.com/hashicorp/terraform-guides/tree/master/infrastructure-as-code/terraform-0.12-examples">https://github.com/hashicorp/terraform-guides/tree/master/infrastructure-as-code/terraform-0.12-examples</a>. It contains multiple code examples for Terraform 0.12, all of which we will look at throughout this book.</p>
<p>Regarding the Terraform 0.13, the upgrade guide is available here – <a href="https://github.com/hashicorp/terraform/blob/master/website/upgrade-guides/0-13.html.markdown">https://github.com/hashicorp/terraform/blob/master/website/upgrade-guides/0-13.html.markdown</a>, and the change log is available here – <a href="https://github.com/hashicorp/terraform/blob/master/CHANGELOG.md">https://github.com/hashicorp/terraform/blob/master/CHANGELOG.md</a>.</p>


            </article>

            
        </section>
    </body></html>